var kP=Object.defineProperty;var SP=(n,e,t)=>e in n?kP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var pi=(n,e,t)=>SP(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();var fn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function uo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function OP(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var Xx={exports:{}},uf={},Qx={exports:{}},_e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wu=Symbol.for("react.element"),AP=Symbol.for("react.portal"),PP=Symbol.for("react.fragment"),TP=Symbol.for("react.strict_mode"),IP=Symbol.for("react.profiler"),CP=Symbol.for("react.provider"),RP=Symbol.for("react.context"),$P=Symbol.for("react.forward_ref"),NP=Symbol.for("react.suspense"),jP=Symbol.for("react.memo"),LP=Symbol.for("react.lazy"),k_=Symbol.iterator;function DP(n){return n===null||typeof n!="object"?null:(n=k_&&n[k_]||n["@@iterator"],typeof n=="function"?n:null)}var Yx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},eE=Object.assign,tE={};function co(n,e,t){this.props=n,this.context=e,this.refs=tE,this.updater=t||Yx}co.prototype.isReactComponent={};co.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};co.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function nE(){}nE.prototype=co.prototype;function Yg(n,e,t){this.props=n,this.context=e,this.refs=tE,this.updater=t||Yx}var ey=Yg.prototype=new nE;ey.constructor=Yg;eE(ey,co.prototype);ey.isPureReactComponent=!0;var S_=Array.isArray,rE=Object.prototype.hasOwnProperty,ty={current:null},iE={key:!0,ref:!0,__self:!0,__source:!0};function aE(n,e,t){var r,i={},a=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(a=""+e.key),e)rE.call(e,r)&&!iE.hasOwnProperty(r)&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];i.children=l}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return{$$typeof:wu,type:n,key:a,ref:s,props:i,_owner:ty.current}}function FP(n,e){return{$$typeof:wu,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function ny(n){return typeof n=="object"&&n!==null&&n.$$typeof===wu}function MP(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var O_=/\/+/g;function hh(n,e){return typeof n=="object"&&n!==null&&n.key!=null?MP(""+n.key):e.toString(36)}function Nc(n,e,t,r,i){var a=typeof n;(a==="undefined"||a==="boolean")&&(n=null);var s=!1;if(n===null)s=!0;else switch(a){case"string":case"number":s=!0;break;case"object":switch(n.$$typeof){case wu:case AP:s=!0}}if(s)return s=n,i=i(s),n=r===""?"."+hh(s,0):r,S_(i)?(t="",n!=null&&(t=n.replace(O_,"$&/")+"/"),Nc(i,e,t,"",function(u){return u})):i!=null&&(ny(i)&&(i=FP(i,t+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(O_,"$&/")+"/")+n)),e.push(i)),1;if(s=0,r=r===""?".":r+":",S_(n))for(var o=0;o<n.length;o++){a=n[o];var l=r+hh(a,o);s+=Nc(a,e,t,l,i)}else if(l=DP(n),typeof l=="function")for(n=l.call(n),o=0;!(a=n.next()).done;)a=a.value,l=r+hh(a,o++),s+=Nc(a,e,t,l,i);else if(a==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function Vu(n,e,t){if(n==null)return n;var r=[],i=0;return Nc(n,r,"","",function(a){return e.call(t,a,i++)}),r}function UP(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Gt={current:null},jc={transition:null},zP={ReactCurrentDispatcher:Gt,ReactCurrentBatchConfig:jc,ReactCurrentOwner:ty};function sE(){throw Error("act(...) is not supported in production builds of React.")}_e.Children={map:Vu,forEach:function(n,e,t){Vu(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Vu(n,function(){e++}),e},toArray:function(n){return Vu(n,function(e){return e})||[]},only:function(n){if(!ny(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};_e.Component=co;_e.Fragment=PP;_e.Profiler=IP;_e.PureComponent=Yg;_e.StrictMode=TP;_e.Suspense=NP;_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zP;_e.act=sE;_e.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=eE({},n.props),i=n.key,a=n.ref,s=n._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,s=ty.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)rE.call(e,l)&&!iE.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:wu,type:n.type,key:i,ref:a,props:r,_owner:s}};_e.createContext=function(n){return n={$$typeof:RP,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:CP,_context:n},n.Consumer=n};_e.createElement=aE;_e.createFactory=function(n){var e=aE.bind(null,n);return e.type=n,e};_e.createRef=function(){return{current:null}};_e.forwardRef=function(n){return{$$typeof:$P,render:n}};_e.isValidElement=ny;_e.lazy=function(n){return{$$typeof:LP,_payload:{_status:-1,_result:n},_init:UP}};_e.memo=function(n,e){return{$$typeof:jP,type:n,compare:e===void 0?null:e}};_e.startTransition=function(n){var e=jc.transition;jc.transition={};try{n()}finally{jc.transition=e}};_e.unstable_act=sE;_e.useCallback=function(n,e){return Gt.current.useCallback(n,e)};_e.useContext=function(n){return Gt.current.useContext(n)};_e.useDebugValue=function(){};_e.useDeferredValue=function(n){return Gt.current.useDeferredValue(n)};_e.useEffect=function(n,e){return Gt.current.useEffect(n,e)};_e.useId=function(){return Gt.current.useId()};_e.useImperativeHandle=function(n,e,t){return Gt.current.useImperativeHandle(n,e,t)};_e.useInsertionEffect=function(n,e){return Gt.current.useInsertionEffect(n,e)};_e.useLayoutEffect=function(n,e){return Gt.current.useLayoutEffect(n,e)};_e.useMemo=function(n,e){return Gt.current.useMemo(n,e)};_e.useReducer=function(n,e,t){return Gt.current.useReducer(n,e,t)};_e.useRef=function(n){return Gt.current.useRef(n)};_e.useState=function(n){return Gt.current.useState(n)};_e.useSyncExternalStore=function(n,e,t){return Gt.current.useSyncExternalStore(n,e,t)};_e.useTransition=function(){return Gt.current.useTransition()};_e.version="18.3.1";Qx.exports=_e;var he=Qx.exports;const BP=uo(he);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HP=he,VP=Symbol.for("react.element"),qP=Symbol.for("react.fragment"),GP=Object.prototype.hasOwnProperty,WP=HP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,KP={key:!0,ref:!0,__self:!0,__source:!0};function oE(n,e,t){var r,i={},a=null,s=null;t!==void 0&&(a=""+t),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)GP.call(e,r)&&!KP.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:VP,type:n,key:a,ref:s,props:i,_owner:WP.current}}uf.Fragment=qP;uf.jsx=oE;uf.jsxs=oE;Xx.exports=uf;var ie=Xx.exports,lE={exports:{}},$n={},uE={exports:{}},cE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(O,A){var b=O.length;O.push(A);e:for(;0<b;){var F=b-1>>>1,N=O[F];if(0<i(N,A))O[F]=A,O[b]=N,b=F;else break e}}function t(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var A=O[0],b=O.pop();if(b!==A){O[0]=b;e:for(var F=0,N=O.length,v=N>>>1;F<v;){var Q=2*(F+1)-1,Z=O[Q],re=Q+1,Ye=O[re];if(0>i(Z,b))re<N&&0>i(Ye,Z)?(O[F]=Ye,O[re]=b,F=re):(O[F]=Z,O[Q]=b,F=Q);else if(re<N&&0>i(Ye,b))O[F]=Ye,O[re]=b,F=re;else break e}}return A}function i(O,A){var b=O.sortIndex-A.sortIndex;return b!==0?b:O.id-A.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();n.unstable_now=function(){return s.now()-o}}var l=[],u=[],c=1,d=null,f=3,h=!1,p=!1,m=!1,_=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(O){for(var A=t(u);A!==null;){if(A.callback===null)r(u);else if(A.startTime<=O)r(u),A.sortIndex=A.expirationTime,e(l,A);else break;A=t(u)}}function x(O){if(m=!1,w(O),!p)if(t(l)!==null)p=!0,$(k);else{var A=t(u);A!==null&&C(x,A.startTime-O)}}function k(O,A){p=!1,m&&(m=!1,g(R),R=-1),h=!0;var b=f;try{for(w(A),d=t(l);d!==null&&(!(d.expirationTime>A)||O&&!L());){var F=d.callback;if(typeof F=="function"){d.callback=null,f=d.priorityLevel;var N=F(d.expirationTime<=A);A=n.unstable_now(),typeof N=="function"?d.callback=N:d===t(l)&&r(l),w(A)}else r(l);d=t(l)}if(d!==null)var v=!0;else{var Q=t(u);Q!==null&&C(x,Q.startTime-A),v=!1}return v}finally{d=null,f=b,h=!1}}var E=!1,P=null,R=-1,H=5,j=-1;function L(){return!(n.unstable_now()-j<H)}function V(){if(P!==null){var O=n.unstable_now();j=O;var A=!0;try{A=P(!0,O)}finally{A?oe():(E=!1,P=null)}}else E=!1}var oe;if(typeof y=="function")oe=function(){y(V)};else if(typeof MessageChannel<"u"){var T=new MessageChannel,S=T.port2;T.port1.onmessage=V,oe=function(){S.postMessage(null)}}else oe=function(){_(V,0)};function $(O){P=O,E||(E=!0,oe())}function C(O,A){R=_(function(){O(n.unstable_now())},A)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(O){O.callback=null},n.unstable_continueExecution=function(){p||h||(p=!0,$(k))},n.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<O?Math.floor(1e3/O):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(O){switch(f){case 1:case 2:case 3:var A=3;break;default:A=f}var b=f;f=A;try{return O()}finally{f=b}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(O,A){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var b=f;f=O;try{return A()}finally{f=b}},n.unstable_scheduleCallback=function(O,A,b){var F=n.unstable_now();switch(typeof b=="object"&&b!==null?(b=b.delay,b=typeof b=="number"&&0<b?F+b:F):b=F,O){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=b+N,O={id:c++,callback:A,priorityLevel:O,startTime:b,expirationTime:N,sortIndex:-1},b>F?(O.sortIndex=b,e(u,O),t(l)===null&&O===t(u)&&(m?(g(R),R=-1):m=!0,C(x,b-F))):(O.sortIndex=N,e(l,O),p||h||(p=!0,$(k))),O},n.unstable_shouldYield=L,n.unstable_wrapCallback=function(O){var A=f;return function(){var b=f;f=A;try{return O.apply(this,arguments)}finally{f=b}}}})(cE);uE.exports=cE;var JP=uE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZP=he,Cn=JP;function U(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dE=new Set,Il={};function Ha(n,e){Gs(n,e),Gs(n+"Capture",e)}function Gs(n,e){for(Il[n]=e,n=0;n<e.length;n++)dE.add(e[n])}var oi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xp=Object.prototype.hasOwnProperty,XP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A_={},P_={};function QP(n){return Xp.call(P_,n)?!0:Xp.call(A_,n)?!1:XP.test(n)?P_[n]=!0:(A_[n]=!0,!1)}function YP(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function eT(n,e,t,r){if(e===null||typeof e>"u"||YP(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Wt(n,e,t,r,i,a,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=a,this.removeEmptyString=s}var Ot={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Ot[n]=new Wt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Ot[e]=new Wt(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Ot[n]=new Wt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Ot[n]=new Wt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Ot[n]=new Wt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Ot[n]=new Wt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Ot[n]=new Wt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Ot[n]=new Wt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Ot[n]=new Wt(n,5,!1,n.toLowerCase(),null,!1,!1)});var ry=/[\-:]([a-z])/g;function iy(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(ry,iy);Ot[e]=new Wt(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(ry,iy);Ot[e]=new Wt(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(ry,iy);Ot[e]=new Wt(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Ot[n]=new Wt(n,1,!1,n.toLowerCase(),null,!1,!1)});Ot.xlinkHref=new Wt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Ot[n]=new Wt(n,1,!1,n.toLowerCase(),null,!0,!0)});function ay(n,e,t,r){var i=Ot.hasOwnProperty(e)?Ot[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(eT(e,t,i,r)&&(t=null),r||i===null?QP(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var fi=ZP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,qu=Symbol.for("react.element"),fs=Symbol.for("react.portal"),hs=Symbol.for("react.fragment"),sy=Symbol.for("react.strict_mode"),Qp=Symbol.for("react.profiler"),fE=Symbol.for("react.provider"),hE=Symbol.for("react.context"),oy=Symbol.for("react.forward_ref"),Yp=Symbol.for("react.suspense"),em=Symbol.for("react.suspense_list"),ly=Symbol.for("react.memo"),ki=Symbol.for("react.lazy"),pE=Symbol.for("react.offscreen"),T_=Symbol.iterator;function Co(n){return n===null||typeof n!="object"?null:(n=T_&&n[T_]||n["@@iterator"],typeof n=="function"?n:null)}var We=Object.assign,ph;function qo(n){if(ph===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);ph=e&&e[1]||""}return`
`+ph+n}var mh=!1;function gh(n,e){if(!n||mh)return"";mh=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),a=r.stack.split(`
`),s=i.length-1,o=a.length-1;1<=s&&0<=o&&i[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(i[s]!==a[o]){if(s!==1||o!==1)do if(s--,o--,0>o||i[s]!==a[o]){var l=`
`+i[s].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=s&&0<=o);break}}}finally{mh=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?qo(n):""}function tT(n){switch(n.tag){case 5:return qo(n.type);case 16:return qo("Lazy");case 13:return qo("Suspense");case 19:return qo("SuspenseList");case 0:case 2:case 15:return n=gh(n.type,!1),n;case 11:return n=gh(n.type.render,!1),n;case 1:return n=gh(n.type,!0),n;default:return""}}function tm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case hs:return"Fragment";case fs:return"Portal";case Qp:return"Profiler";case sy:return"StrictMode";case Yp:return"Suspense";case em:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case hE:return(n.displayName||"Context")+".Consumer";case fE:return(n._context.displayName||"Context")+".Provider";case oy:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ly:return e=n.displayName||null,e!==null?e:tm(n.type)||"Memo";case ki:e=n._payload,n=n._init;try{return tm(n(e))}catch{}}return null}function nT(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tm(e);case 8:return e===sy?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gi(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function mE(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function rT(n){var e=mE(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,a=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,a.call(this,s)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Gu(n){n._valueTracker||(n._valueTracker=rT(n))}function gE(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=mE(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function id(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function nm(n,e){var t=e.checked;return We({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function I_(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Gi(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function yE(n,e){e=e.checked,e!=null&&ay(n,"checked",e,!1)}function rm(n,e){yE(n,e);var t=Gi(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?im(n,e.type,t):e.hasOwnProperty("defaultValue")&&im(n,e.type,Gi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function C_(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function im(n,e,t){(e!=="number"||id(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Go=Array.isArray;function Cs(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Gi(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function am(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(U(91));return We({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function R_(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(U(92));if(Go(t)){if(1<t.length)throw Error(U(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Gi(t)}}function wE(n,e){var t=Gi(e.value),r=Gi(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function $_(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function _E(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sm(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?_E(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Wu,bE=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Wu=Wu||document.createElement("div"),Wu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Wu.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Cl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var sl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},iT=["Webkit","ms","Moz","O"];Object.keys(sl).forEach(function(n){iT.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),sl[e]=sl[n]})});function vE(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||sl.hasOwnProperty(n)&&sl[n]?(""+e).trim():e+"px"}function xE(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=vE(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var aT=We({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function om(n,e){if(e){if(aT[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(U(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(U(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(U(61))}if(e.style!=null&&typeof e.style!="object")throw Error(U(62))}}function lm(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var um=null;function uy(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var cm=null,Rs=null,$s=null;function N_(n){if(n=vu(n)){if(typeof cm!="function")throw Error(U(280));var e=n.stateNode;e&&(e=pf(e),cm(n.stateNode,n.type,e))}}function EE(n){Rs?$s?$s.push(n):$s=[n]:Rs=n}function kE(){if(Rs){var n=Rs,e=$s;if($s=Rs=null,N_(n),e)for(n=0;n<e.length;n++)N_(e[n])}}function SE(n,e){return n(e)}function OE(){}var yh=!1;function AE(n,e,t){if(yh)return n(e,t);yh=!0;try{return SE(n,e,t)}finally{yh=!1,(Rs!==null||$s!==null)&&(OE(),kE())}}function Rl(n,e){var t=n.stateNode;if(t===null)return null;var r=pf(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(U(231,e,typeof t));return t}var dm=!1;if(oi)try{var Ro={};Object.defineProperty(Ro,"passive",{get:function(){dm=!0}}),window.addEventListener("test",Ro,Ro),window.removeEventListener("test",Ro,Ro)}catch{dm=!1}function sT(n,e,t,r,i,a,s,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var ol=!1,ad=null,sd=!1,fm=null,oT={onError:function(n){ol=!0,ad=n}};function lT(n,e,t,r,i,a,s,o,l){ol=!1,ad=null,sT.apply(oT,arguments)}function uT(n,e,t,r,i,a,s,o,l){if(lT.apply(this,arguments),ol){if(ol){var u=ad;ol=!1,ad=null}else throw Error(U(198));sd||(sd=!0,fm=u)}}function Va(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function PE(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function j_(n){if(Va(n)!==n)throw Error(U(188))}function cT(n){var e=n.alternate;if(!e){if(e=Va(n),e===null)throw Error(U(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===t)return j_(i),n;if(a===r)return j_(i),e;a=a.sibling}throw Error(U(188))}if(t.return!==r.return)t=i,r=a;else{for(var s=!1,o=i.child;o;){if(o===t){s=!0,t=i,r=a;break}if(o===r){s=!0,r=i,t=a;break}o=o.sibling}if(!s){for(o=a.child;o;){if(o===t){s=!0,t=a,r=i;break}if(o===r){s=!0,r=a,t=i;break}o=o.sibling}if(!s)throw Error(U(189))}}if(t.alternate!==r)throw Error(U(190))}if(t.tag!==3)throw Error(U(188));return t.stateNode.current===t?n:e}function TE(n){return n=cT(n),n!==null?IE(n):null}function IE(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=IE(n);if(e!==null)return e;n=n.sibling}return null}var CE=Cn.unstable_scheduleCallback,L_=Cn.unstable_cancelCallback,dT=Cn.unstable_shouldYield,fT=Cn.unstable_requestPaint,Xe=Cn.unstable_now,hT=Cn.unstable_getCurrentPriorityLevel,cy=Cn.unstable_ImmediatePriority,RE=Cn.unstable_UserBlockingPriority,od=Cn.unstable_NormalPriority,pT=Cn.unstable_LowPriority,$E=Cn.unstable_IdlePriority,cf=null,Mr=null;function mT(n){if(Mr&&typeof Mr.onCommitFiberRoot=="function")try{Mr.onCommitFiberRoot(cf,n,void 0,(n.current.flags&128)===128)}catch{}}var cr=Math.clz32?Math.clz32:wT,gT=Math.log,yT=Math.LN2;function wT(n){return n>>>=0,n===0?32:31-(gT(n)/yT|0)|0}var Ku=64,Ju=4194304;function Wo(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ld(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,a=n.pingedLanes,s=t&268435455;if(s!==0){var o=s&~i;o!==0?r=Wo(o):(a&=s,a!==0&&(r=Wo(a)))}else s=t&~i,s!==0?r=Wo(s):a!==0&&(r=Wo(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-cr(e),i=1<<t,r|=n[t],e&=~i;return r}function _T(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bT(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,a=n.pendingLanes;0<a;){var s=31-cr(a),o=1<<s,l=i[s];l===-1?(!(o&t)||o&r)&&(i[s]=_T(o,e)):l<=e&&(n.expiredLanes|=o),a&=~o}}function hm(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function NE(){var n=Ku;return Ku<<=1,!(Ku&4194240)&&(Ku=64),n}function wh(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function _u(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-cr(e),n[e]=t}function vT(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-cr(t),a=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~a}}function dy(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-cr(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Re=0;function jE(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var LE,fy,DE,FE,ME,pm=!1,Zu=[],Li=null,Di=null,Fi=null,$l=new Map,Nl=new Map,Ii=[],xT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function D_(n,e){switch(n){case"focusin":case"focusout":Li=null;break;case"dragenter":case"dragleave":Di=null;break;case"mouseover":case"mouseout":Fi=null;break;case"pointerover":case"pointerout":$l.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nl.delete(e.pointerId)}}function $o(n,e,t,r,i,a){return n===null||n.nativeEvent!==a?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},e!==null&&(e=vu(e),e!==null&&fy(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function ET(n,e,t,r,i){switch(e){case"focusin":return Li=$o(Li,n,e,t,r,i),!0;case"dragenter":return Di=$o(Di,n,e,t,r,i),!0;case"mouseover":return Fi=$o(Fi,n,e,t,r,i),!0;case"pointerover":var a=i.pointerId;return $l.set(a,$o($l.get(a)||null,n,e,t,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Nl.set(a,$o(Nl.get(a)||null,n,e,t,r,i)),!0}return!1}function UE(n){var e=_a(n.target);if(e!==null){var t=Va(e);if(t!==null){if(e=t.tag,e===13){if(e=PE(t),e!==null){n.blockedOn=e,ME(n.priority,function(){DE(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Lc(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=mm(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);um=r,t.target.dispatchEvent(r),um=null}else return e=vu(t),e!==null&&fy(e),n.blockedOn=t,!1;e.shift()}return!0}function F_(n,e,t){Lc(n)&&t.delete(e)}function kT(){pm=!1,Li!==null&&Lc(Li)&&(Li=null),Di!==null&&Lc(Di)&&(Di=null),Fi!==null&&Lc(Fi)&&(Fi=null),$l.forEach(F_),Nl.forEach(F_)}function No(n,e){n.blockedOn===e&&(n.blockedOn=null,pm||(pm=!0,Cn.unstable_scheduleCallback(Cn.unstable_NormalPriority,kT)))}function jl(n){function e(i){return No(i,n)}if(0<Zu.length){No(Zu[0],n);for(var t=1;t<Zu.length;t++){var r=Zu[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Li!==null&&No(Li,n),Di!==null&&No(Di,n),Fi!==null&&No(Fi,n),$l.forEach(e),Nl.forEach(e),t=0;t<Ii.length;t++)r=Ii[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ii.length&&(t=Ii[0],t.blockedOn===null);)UE(t),t.blockedOn===null&&Ii.shift()}var Ns=fi.ReactCurrentBatchConfig,ud=!0;function ST(n,e,t,r){var i=Re,a=Ns.transition;Ns.transition=null;try{Re=1,hy(n,e,t,r)}finally{Re=i,Ns.transition=a}}function OT(n,e,t,r){var i=Re,a=Ns.transition;Ns.transition=null;try{Re=4,hy(n,e,t,r)}finally{Re=i,Ns.transition=a}}function hy(n,e,t,r){if(ud){var i=mm(n,e,t,r);if(i===null)Ph(n,e,r,cd,t),D_(n,r);else if(ET(i,n,e,t,r))r.stopPropagation();else if(D_(n,r),e&4&&-1<xT.indexOf(n)){for(;i!==null;){var a=vu(i);if(a!==null&&LE(a),a=mm(n,e,t,r),a===null&&Ph(n,e,r,cd,t),a===i)break;i=a}i!==null&&r.stopPropagation()}else Ph(n,e,r,null,t)}}var cd=null;function mm(n,e,t,r){if(cd=null,n=uy(r),n=_a(n),n!==null)if(e=Va(n),e===null)n=null;else if(t=e.tag,t===13){if(n=PE(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return cd=n,null}function zE(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hT()){case cy:return 1;case RE:return 4;case od:case pT:return 16;case $E:return 536870912;default:return 16}default:return 16}}var Ni=null,py=null,Dc=null;function BE(){if(Dc)return Dc;var n,e=py,t=e.length,r,i="value"in Ni?Ni.value:Ni.textContent,a=i.length;for(n=0;n<t&&e[n]===i[n];n++);var s=t-n;for(r=1;r<=s&&e[t-r]===i[a-r];r++);return Dc=i.slice(n,1<r?1-r:void 0)}function Fc(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Xu(){return!0}function M_(){return!1}function Nn(n){function e(t,r,i,a,s){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=s,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Xu:M_,this.isPropagationStopped=M_,this}return We(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Xu)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Xu)},persist:function(){},isPersistent:Xu}),e}var fo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},my=Nn(fo),bu=We({},fo,{view:0,detail:0}),AT=Nn(bu),_h,bh,jo,df=We({},bu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gy,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==jo&&(jo&&n.type==="mousemove"?(_h=n.screenX-jo.screenX,bh=n.screenY-jo.screenY):bh=_h=0,jo=n),_h)},movementY:function(n){return"movementY"in n?n.movementY:bh}}),U_=Nn(df),PT=We({},df,{dataTransfer:0}),TT=Nn(PT),IT=We({},bu,{relatedTarget:0}),vh=Nn(IT),CT=We({},fo,{animationName:0,elapsedTime:0,pseudoElement:0}),RT=Nn(CT),$T=We({},fo,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),NT=Nn($T),jT=We({},fo,{data:0}),z_=Nn(jT),LT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},DT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MT(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=FT[n])?!!e[n]:!1}function gy(){return MT}var UT=We({},bu,{key:function(n){if(n.key){var e=LT[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Fc(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?DT[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gy,charCode:function(n){return n.type==="keypress"?Fc(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Fc(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),zT=Nn(UT),BT=We({},df,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),B_=Nn(BT),HT=We({},bu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gy}),VT=Nn(HT),qT=We({},fo,{propertyName:0,elapsedTime:0,pseudoElement:0}),GT=Nn(qT),WT=We({},df,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),KT=Nn(WT),JT=[9,13,27,32],yy=oi&&"CompositionEvent"in window,ll=null;oi&&"documentMode"in document&&(ll=document.documentMode);var ZT=oi&&"TextEvent"in window&&!ll,HE=oi&&(!yy||ll&&8<ll&&11>=ll),H_=" ",V_=!1;function VE(n,e){switch(n){case"keyup":return JT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qE(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ps=!1;function XT(n,e){switch(n){case"compositionend":return qE(e);case"keypress":return e.which!==32?null:(V_=!0,H_);case"textInput":return n=e.data,n===H_&&V_?null:n;default:return null}}function QT(n,e){if(ps)return n==="compositionend"||!yy&&VE(n,e)?(n=BE(),Dc=py=Ni=null,ps=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return HE&&e.locale!=="ko"?null:e.data;default:return null}}var YT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function q_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!YT[n.type]:e==="textarea"}function GE(n,e,t,r){EE(r),e=dd(e,"onChange"),0<e.length&&(t=new my("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var ul=null,Ll=null;function eI(n){rk(n,0)}function ff(n){var e=ys(n);if(gE(e))return n}function tI(n,e){if(n==="change")return e}var WE=!1;if(oi){var xh;if(oi){var Eh="oninput"in document;if(!Eh){var G_=document.createElement("div");G_.setAttribute("oninput","return;"),Eh=typeof G_.oninput=="function"}xh=Eh}else xh=!1;WE=xh&&(!document.documentMode||9<document.documentMode)}function W_(){ul&&(ul.detachEvent("onpropertychange",KE),Ll=ul=null)}function KE(n){if(n.propertyName==="value"&&ff(Ll)){var e=[];GE(e,Ll,n,uy(n)),AE(eI,e)}}function nI(n,e,t){n==="focusin"?(W_(),ul=e,Ll=t,ul.attachEvent("onpropertychange",KE)):n==="focusout"&&W_()}function rI(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return ff(Ll)}function iI(n,e){if(n==="click")return ff(e)}function aI(n,e){if(n==="input"||n==="change")return ff(e)}function sI(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var mr=typeof Object.is=="function"?Object.is:sI;function Dl(n,e){if(mr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Xp.call(e,i)||!mr(n[i],e[i]))return!1}return!0}function K_(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function J_(n,e){var t=K_(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=K_(t)}}function JE(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?JE(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function ZE(){for(var n=window,e=id();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=id(n.document)}return e}function wy(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function oI(n){var e=ZE(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&JE(t.ownerDocument.documentElement,t)){if(r!==null&&wy(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!n.extend&&a>r&&(i=r,r=a,a=i),i=J_(t,a);var s=J_(t,r);i&&s&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),a>r?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var lI=oi&&"documentMode"in document&&11>=document.documentMode,ms=null,gm=null,cl=null,ym=!1;function Z_(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;ym||ms==null||ms!==id(r)||(r=ms,"selectionStart"in r&&wy(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),cl&&Dl(cl,r)||(cl=r,r=dd(gm,"onSelect"),0<r.length&&(e=new my("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=ms)))}function Qu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var gs={animationend:Qu("Animation","AnimationEnd"),animationiteration:Qu("Animation","AnimationIteration"),animationstart:Qu("Animation","AnimationStart"),transitionend:Qu("Transition","TransitionEnd")},kh={},XE={};oi&&(XE=document.createElement("div").style,"AnimationEvent"in window||(delete gs.animationend.animation,delete gs.animationiteration.animation,delete gs.animationstart.animation),"TransitionEvent"in window||delete gs.transitionend.transition);function hf(n){if(kh[n])return kh[n];if(!gs[n])return n;var e=gs[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in XE)return kh[n]=e[t];return n}var QE=hf("animationend"),YE=hf("animationiteration"),ek=hf("animationstart"),tk=hf("transitionend"),nk=new Map,X_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function na(n,e){nk.set(n,e),Ha(e,[n])}for(var Sh=0;Sh<X_.length;Sh++){var Oh=X_[Sh],uI=Oh.toLowerCase(),cI=Oh[0].toUpperCase()+Oh.slice(1);na(uI,"on"+cI)}na(QE,"onAnimationEnd");na(YE,"onAnimationIteration");na(ek,"onAnimationStart");na("dblclick","onDoubleClick");na("focusin","onFocus");na("focusout","onBlur");na(tk,"onTransitionEnd");Gs("onMouseEnter",["mouseout","mouseover"]);Gs("onMouseLeave",["mouseout","mouseover"]);Gs("onPointerEnter",["pointerout","pointerover"]);Gs("onPointerLeave",["pointerout","pointerover"]);Ha("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ha("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ha("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ha("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ha("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ha("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ko="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dI=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ko));function Q_(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,uT(r,e,void 0,n),n.currentTarget=null}function rk(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var s=r.length-1;0<=s;s--){var o=r[s],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==a&&i.isPropagationStopped())break e;Q_(i,o,u),a=l}else for(s=0;s<r.length;s++){if(o=r[s],l=o.instance,u=o.currentTarget,o=o.listener,l!==a&&i.isPropagationStopped())break e;Q_(i,o,u),a=l}}}if(sd)throw n=fm,sd=!1,fm=null,n}function Me(n,e){var t=e[xm];t===void 0&&(t=e[xm]=new Set);var r=n+"__bubble";t.has(r)||(ik(e,n,2,!1),t.add(r))}function Ah(n,e,t){var r=0;e&&(r|=4),ik(t,n,r,e)}var Yu="_reactListening"+Math.random().toString(36).slice(2);function Fl(n){if(!n[Yu]){n[Yu]=!0,dE.forEach(function(t){t!=="selectionchange"&&(dI.has(t)||Ah(t,!1,n),Ah(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Yu]||(e[Yu]=!0,Ah("selectionchange",!1,e))}}function ik(n,e,t,r){switch(zE(e)){case 1:var i=ST;break;case 4:i=OT;break;default:i=hy}t=i.bind(null,e,t,n),i=void 0,!dm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Ph(n,e,t,r,i){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var o=r.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;o!==null;){if(s=_a(o),s===null)return;if(l=s.tag,l===5||l===6){r=a=s;continue e}o=o.parentNode}}r=r.return}AE(function(){var u=a,c=uy(t),d=[];e:{var f=nk.get(n);if(f!==void 0){var h=my,p=n;switch(n){case"keypress":if(Fc(t)===0)break e;case"keydown":case"keyup":h=zT;break;case"focusin":p="focus",h=vh;break;case"focusout":p="blur",h=vh;break;case"beforeblur":case"afterblur":h=vh;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=U_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=TT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=VT;break;case QE:case YE:case ek:h=RT;break;case tk:h=GT;break;case"scroll":h=AT;break;case"wheel":h=KT;break;case"copy":case"cut":case"paste":h=NT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=B_}var m=(e&4)!==0,_=!m&&n==="scroll",g=m?f!==null?f+"Capture":null:f;m=[];for(var y=u,w;y!==null;){w=y;var x=w.stateNode;if(w.tag===5&&x!==null&&(w=x,g!==null&&(x=Rl(y,g),x!=null&&m.push(Ml(y,x,w)))),_)break;y=y.return}0<m.length&&(f=new h(f,p,null,t,c),d.push({event:f,listeners:m}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",f&&t!==um&&(p=t.relatedTarget||t.fromElement)&&(_a(p)||p[li]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(p=t.relatedTarget||t.toElement,h=u,p=p?_a(p):null,p!==null&&(_=Va(p),p!==_||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=u),h!==p)){if(m=U_,x="onMouseLeave",g="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(m=B_,x="onPointerLeave",g="onPointerEnter",y="pointer"),_=h==null?f:ys(h),w=p==null?f:ys(p),f=new m(x,y+"leave",h,t,c),f.target=_,f.relatedTarget=w,x=null,_a(c)===u&&(m=new m(g,y+"enter",p,t,c),m.target=w,m.relatedTarget=_,x=m),_=x,h&&p)t:{for(m=h,g=p,y=0,w=m;w;w=Za(w))y++;for(w=0,x=g;x;x=Za(x))w++;for(;0<y-w;)m=Za(m),y--;for(;0<w-y;)g=Za(g),w--;for(;y--;){if(m===g||g!==null&&m===g.alternate)break t;m=Za(m),g=Za(g)}m=null}else m=null;h!==null&&Y_(d,f,h,m,!1),p!==null&&_!==null&&Y_(d,_,p,m,!0)}}e:{if(f=u?ys(u):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var k=tI;else if(q_(f))if(WE)k=aI;else{k=rI;var E=nI}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(k=iI);if(k&&(k=k(n,u))){GE(d,k,t,c);break e}E&&E(n,f,u),n==="focusout"&&(E=f._wrapperState)&&E.controlled&&f.type==="number"&&im(f,"number",f.value)}switch(E=u?ys(u):window,n){case"focusin":(q_(E)||E.contentEditable==="true")&&(ms=E,gm=u,cl=null);break;case"focusout":cl=gm=ms=null;break;case"mousedown":ym=!0;break;case"contextmenu":case"mouseup":case"dragend":ym=!1,Z_(d,t,c);break;case"selectionchange":if(lI)break;case"keydown":case"keyup":Z_(d,t,c)}var P;if(yy)e:{switch(n){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else ps?VE(n,t)&&(R="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(HE&&t.locale!=="ko"&&(ps||R!=="onCompositionStart"?R==="onCompositionEnd"&&ps&&(P=BE()):(Ni=c,py="value"in Ni?Ni.value:Ni.textContent,ps=!0)),E=dd(u,R),0<E.length&&(R=new z_(R,n,null,t,c),d.push({event:R,listeners:E}),P?R.data=P:(P=qE(t),P!==null&&(R.data=P)))),(P=ZT?XT(n,t):QT(n,t))&&(u=dd(u,"onBeforeInput"),0<u.length&&(c=new z_("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=P))}rk(d,e)})}function Ml(n,e,t){return{instance:n,listener:e,currentTarget:t}}function dd(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=Rl(n,t),a!=null&&r.unshift(Ml(n,a,i)),a=Rl(n,e),a!=null&&r.push(Ml(n,a,i))),n=n.return}return r}function Za(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Y_(n,e,t,r,i){for(var a=e._reactName,s=[];t!==null&&t!==r;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,i?(l=Rl(t,a),l!=null&&s.unshift(Ml(t,l,o))):i||(l=Rl(t,a),l!=null&&s.push(Ml(t,l,o)))),t=t.return}s.length!==0&&n.push({event:e,listeners:s})}var fI=/\r\n?/g,hI=/\u0000|\uFFFD/g;function eb(n){return(typeof n=="string"?n:""+n).replace(fI,`
`).replace(hI,"")}function ec(n,e,t){if(e=eb(e),eb(n)!==e&&t)throw Error(U(425))}function fd(){}var wm=null,_m=null;function bm(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var vm=typeof setTimeout=="function"?setTimeout:void 0,pI=typeof clearTimeout=="function"?clearTimeout:void 0,tb=typeof Promise=="function"?Promise:void 0,mI=typeof queueMicrotask=="function"?queueMicrotask:typeof tb<"u"?function(n){return tb.resolve(null).then(n).catch(gI)}:vm;function gI(n){setTimeout(function(){throw n})}function Th(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),jl(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);jl(e)}function Mi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function nb(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var ho=Math.random().toString(36).slice(2),jr="__reactFiber$"+ho,Ul="__reactProps$"+ho,li="__reactContainer$"+ho,xm="__reactEvents$"+ho,yI="__reactListeners$"+ho,wI="__reactHandles$"+ho;function _a(n){var e=n[jr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[li]||t[jr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=nb(n);n!==null;){if(t=n[jr])return t;n=nb(n)}return e}n=t,t=n.parentNode}return null}function vu(n){return n=n[jr]||n[li],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ys(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(U(33))}function pf(n){return n[Ul]||null}var Em=[],ws=-1;function ra(n){return{current:n}}function Ue(n){0>ws||(n.current=Em[ws],Em[ws]=null,ws--)}function De(n,e){ws++,Em[ws]=n.current,n.current=e}var Wi={},jt=ra(Wi),on=ra(!1),$a=Wi;function Ws(n,e){var t=n.type.contextTypes;if(!t)return Wi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in t)i[a]=e[a];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function ln(n){return n=n.childContextTypes,n!=null}function hd(){Ue(on),Ue(jt)}function rb(n,e,t){if(jt.current!==Wi)throw Error(U(168));De(jt,e),De(on,t)}function ak(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(U(108,nT(n)||"Unknown",i));return We({},t,r)}function pd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Wi,$a=jt.current,De(jt,n),De(on,on.current),!0}function ib(n,e,t){var r=n.stateNode;if(!r)throw Error(U(169));t?(n=ak(n,e,$a),r.__reactInternalMemoizedMergedChildContext=n,Ue(on),Ue(jt),De(jt,n)):Ue(on),De(on,t)}var ei=null,mf=!1,Ih=!1;function sk(n){ei===null?ei=[n]:ei.push(n)}function _I(n){mf=!0,sk(n)}function ia(){if(!Ih&&ei!==null){Ih=!0;var n=0,e=Re;try{var t=ei;for(Re=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ei=null,mf=!1}catch(i){throw ei!==null&&(ei=ei.slice(n+1)),CE(cy,ia),i}finally{Re=e,Ih=!1}}return null}var _s=[],bs=0,md=null,gd=0,Dn=[],Fn=0,Na=null,ni=1,ri="";function ca(n,e){_s[bs++]=gd,_s[bs++]=md,md=n,gd=e}function ok(n,e,t){Dn[Fn++]=ni,Dn[Fn++]=ri,Dn[Fn++]=Na,Na=n;var r=ni;n=ri;var i=32-cr(r)-1;r&=~(1<<i),t+=1;var a=32-cr(e)+i;if(30<a){var s=i-i%5;a=(r&(1<<s)-1).toString(32),r>>=s,i-=s,ni=1<<32-cr(e)+i|t<<i|r,ri=a+n}else ni=1<<a|t<<i|r,ri=n}function _y(n){n.return!==null&&(ca(n,1),ok(n,1,0))}function by(n){for(;n===md;)md=_s[--bs],_s[bs]=null,gd=_s[--bs],_s[bs]=null;for(;n===Na;)Na=Dn[--Fn],Dn[Fn]=null,ri=Dn[--Fn],Dn[Fn]=null,ni=Dn[--Fn],Dn[Fn]=null}var Tn=null,On=null,ze=!1,or=null;function lk(n,e){var t=Un(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function ab(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Tn=n,On=Mi(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Tn=n,On=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Na!==null?{id:ni,overflow:ri}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Un(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Tn=n,On=null,!0):!1;default:return!1}}function km(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Sm(n){if(ze){var e=On;if(e){var t=e;if(!ab(n,e)){if(km(n))throw Error(U(418));e=Mi(t.nextSibling);var r=Tn;e&&ab(n,e)?lk(r,t):(n.flags=n.flags&-4097|2,ze=!1,Tn=n)}}else{if(km(n))throw Error(U(418));n.flags=n.flags&-4097|2,ze=!1,Tn=n}}}function sb(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Tn=n}function tc(n){if(n!==Tn)return!1;if(!ze)return sb(n),ze=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!bm(n.type,n.memoizedProps)),e&&(e=On)){if(km(n))throw uk(),Error(U(418));for(;e;)lk(n,e),e=Mi(e.nextSibling)}if(sb(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(U(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){On=Mi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}On=null}}else On=Tn?Mi(n.stateNode.nextSibling):null;return!0}function uk(){for(var n=On;n;)n=Mi(n.nextSibling)}function Ks(){On=Tn=null,ze=!1}function vy(n){or===null?or=[n]:or.push(n)}var bI=fi.ReactCurrentBatchConfig;function Lo(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(U(309));var r=t.stateNode}if(!r)throw Error(U(147,n));var i=r,a=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(s){var o=i.refs;s===null?delete o[a]:o[a]=s},e._stringRef=a,e)}if(typeof n!="string")throw Error(U(284));if(!t._owner)throw Error(U(290,n))}return n}function nc(n,e){throw n=Object.prototype.toString.call(e),Error(U(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function ob(n){var e=n._init;return e(n._payload)}function ck(n){function e(g,y){if(n){var w=g.deletions;w===null?(g.deletions=[y],g.flags|=16):w.push(y)}}function t(g,y){if(!n)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function r(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function i(g,y){return g=Hi(g,y),g.index=0,g.sibling=null,g}function a(g,y,w){return g.index=w,n?(w=g.alternate,w!==null?(w=w.index,w<y?(g.flags|=2,y):w):(g.flags|=2,y)):(g.flags|=1048576,y)}function s(g){return n&&g.alternate===null&&(g.flags|=2),g}function o(g,y,w,x){return y===null||y.tag!==6?(y=Dh(w,g.mode,x),y.return=g,y):(y=i(y,w),y.return=g,y)}function l(g,y,w,x){var k=w.type;return k===hs?c(g,y,w.props.children,x,w.key):y!==null&&(y.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===ki&&ob(k)===y.type)?(x=i(y,w.props),x.ref=Lo(g,y,w),x.return=g,x):(x=qc(w.type,w.key,w.props,null,g.mode,x),x.ref=Lo(g,y,w),x.return=g,x)}function u(g,y,w,x){return y===null||y.tag!==4||y.stateNode.containerInfo!==w.containerInfo||y.stateNode.implementation!==w.implementation?(y=Fh(w,g.mode,x),y.return=g,y):(y=i(y,w.children||[]),y.return=g,y)}function c(g,y,w,x,k){return y===null||y.tag!==7?(y=Aa(w,g.mode,x,k),y.return=g,y):(y=i(y,w),y.return=g,y)}function d(g,y,w){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Dh(""+y,g.mode,w),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case qu:return w=qc(y.type,y.key,y.props,null,g.mode,w),w.ref=Lo(g,null,y),w.return=g,w;case fs:return y=Fh(y,g.mode,w),y.return=g,y;case ki:var x=y._init;return d(g,x(y._payload),w)}if(Go(y)||Co(y))return y=Aa(y,g.mode,w,null),y.return=g,y;nc(g,y)}return null}function f(g,y,w,x){var k=y!==null?y.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return k!==null?null:o(g,y,""+w,x);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case qu:return w.key===k?l(g,y,w,x):null;case fs:return w.key===k?u(g,y,w,x):null;case ki:return k=w._init,f(g,y,k(w._payload),x)}if(Go(w)||Co(w))return k!==null?null:c(g,y,w,x,null);nc(g,w)}return null}function h(g,y,w,x,k){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(w)||null,o(y,g,""+x,k);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case qu:return g=g.get(x.key===null?w:x.key)||null,l(y,g,x,k);case fs:return g=g.get(x.key===null?w:x.key)||null,u(y,g,x,k);case ki:var E=x._init;return h(g,y,w,E(x._payload),k)}if(Go(x)||Co(x))return g=g.get(w)||null,c(y,g,x,k,null);nc(y,x)}return null}function p(g,y,w,x){for(var k=null,E=null,P=y,R=y=0,H=null;P!==null&&R<w.length;R++){P.index>R?(H=P,P=null):H=P.sibling;var j=f(g,P,w[R],x);if(j===null){P===null&&(P=H);break}n&&P&&j.alternate===null&&e(g,P),y=a(j,y,R),E===null?k=j:E.sibling=j,E=j,P=H}if(R===w.length)return t(g,P),ze&&ca(g,R),k;if(P===null){for(;R<w.length;R++)P=d(g,w[R],x),P!==null&&(y=a(P,y,R),E===null?k=P:E.sibling=P,E=P);return ze&&ca(g,R),k}for(P=r(g,P);R<w.length;R++)H=h(P,g,R,w[R],x),H!==null&&(n&&H.alternate!==null&&P.delete(H.key===null?R:H.key),y=a(H,y,R),E===null?k=H:E.sibling=H,E=H);return n&&P.forEach(function(L){return e(g,L)}),ze&&ca(g,R),k}function m(g,y,w,x){var k=Co(w);if(typeof k!="function")throw Error(U(150));if(w=k.call(w),w==null)throw Error(U(151));for(var E=k=null,P=y,R=y=0,H=null,j=w.next();P!==null&&!j.done;R++,j=w.next()){P.index>R?(H=P,P=null):H=P.sibling;var L=f(g,P,j.value,x);if(L===null){P===null&&(P=H);break}n&&P&&L.alternate===null&&e(g,P),y=a(L,y,R),E===null?k=L:E.sibling=L,E=L,P=H}if(j.done)return t(g,P),ze&&ca(g,R),k;if(P===null){for(;!j.done;R++,j=w.next())j=d(g,j.value,x),j!==null&&(y=a(j,y,R),E===null?k=j:E.sibling=j,E=j);return ze&&ca(g,R),k}for(P=r(g,P);!j.done;R++,j=w.next())j=h(P,g,R,j.value,x),j!==null&&(n&&j.alternate!==null&&P.delete(j.key===null?R:j.key),y=a(j,y,R),E===null?k=j:E.sibling=j,E=j);return n&&P.forEach(function(V){return e(g,V)}),ze&&ca(g,R),k}function _(g,y,w,x){if(typeof w=="object"&&w!==null&&w.type===hs&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case qu:e:{for(var k=w.key,E=y;E!==null;){if(E.key===k){if(k=w.type,k===hs){if(E.tag===7){t(g,E.sibling),y=i(E,w.props.children),y.return=g,g=y;break e}}else if(E.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===ki&&ob(k)===E.type){t(g,E.sibling),y=i(E,w.props),y.ref=Lo(g,E,w),y.return=g,g=y;break e}t(g,E);break}else e(g,E);E=E.sibling}w.type===hs?(y=Aa(w.props.children,g.mode,x,w.key),y.return=g,g=y):(x=qc(w.type,w.key,w.props,null,g.mode,x),x.ref=Lo(g,y,w),x.return=g,g=x)}return s(g);case fs:e:{for(E=w.key;y!==null;){if(y.key===E)if(y.tag===4&&y.stateNode.containerInfo===w.containerInfo&&y.stateNode.implementation===w.implementation){t(g,y.sibling),y=i(y,w.children||[]),y.return=g,g=y;break e}else{t(g,y);break}else e(g,y);y=y.sibling}y=Fh(w,g.mode,x),y.return=g,g=y}return s(g);case ki:return E=w._init,_(g,y,E(w._payload),x)}if(Go(w))return p(g,y,w,x);if(Co(w))return m(g,y,w,x);nc(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,y!==null&&y.tag===6?(t(g,y.sibling),y=i(y,w),y.return=g,g=y):(t(g,y),y=Dh(w,g.mode,x),y.return=g,g=y),s(g)):t(g,y)}return _}var Js=ck(!0),dk=ck(!1),yd=ra(null),wd=null,vs=null,xy=null;function Ey(){xy=vs=wd=null}function ky(n){var e=yd.current;Ue(yd),n._currentValue=e}function Om(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function js(n,e){wd=n,xy=vs=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(sn=!0),n.firstContext=null)}function Vn(n){var e=n._currentValue;if(xy!==n)if(n={context:n,memoizedValue:e,next:null},vs===null){if(wd===null)throw Error(U(308));vs=n,wd.dependencies={lanes:0,firstContext:n}}else vs=vs.next=n;return e}var ba=null;function Sy(n){ba===null?ba=[n]:ba.push(n)}function fk(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Sy(e)):(t.next=i.next,i.next=t),e.interleaved=t,ui(n,r)}function ui(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Si=!1;function Oy(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hk(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ii(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Ui(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Oe&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ui(n,t)}return i=r.interleaved,i===null?(e.next=e,Sy(r)):(e.next=i.next,i.next=e),r.interleaved=e,ui(n,t)}function Mc(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,dy(n,t)}}function lb(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,a=null;if(t=t.firstBaseUpdate,t!==null){do{var s={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};a===null?i=a=s:a=a.next=s,t=t.next}while(t!==null);a===null?i=a=e:a=a.next=e}else i=a=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function _d(n,e,t,r){var i=n.updateQueue;Si=!1;var a=i.firstBaseUpdate,s=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var l=o,u=l.next;l.next=null,s===null?a=u:s.next=u,s=l;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==s&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(a!==null){var d=i.baseState;s=0,c=u=l=null,o=a;do{var f=o.lane,h=o.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=n,m=o;switch(f=e,h=t,m.tag){case 1:if(p=m.payload,typeof p=="function"){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,f=typeof p=="function"?p.call(h,d,f):p,f==null)break e;d=We({},d,f);break e;case 2:Si=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[o]:f.push(o))}else h={eventTime:h,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=h,l=d):c=c.next=h,s|=f;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;f=o,o=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);La|=s,n.lanes=s,n.memoizedState=d}}function ub(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(U(191,i));i.call(r)}}}var xu={},Ur=ra(xu),zl=ra(xu),Bl=ra(xu);function va(n){if(n===xu)throw Error(U(174));return n}function Ay(n,e){switch(De(Bl,e),De(zl,n),De(Ur,xu),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:sm(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=sm(e,n)}Ue(Ur),De(Ur,e)}function Zs(){Ue(Ur),Ue(zl),Ue(Bl)}function pk(n){va(Bl.current);var e=va(Ur.current),t=sm(e,n.type);e!==t&&(De(zl,n),De(Ur,t))}function Py(n){zl.current===n&&(Ue(Ur),Ue(zl))}var qe=ra(0);function bd(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ch=[];function Ty(){for(var n=0;n<Ch.length;n++)Ch[n]._workInProgressVersionPrimary=null;Ch.length=0}var Uc=fi.ReactCurrentDispatcher,Rh=fi.ReactCurrentBatchConfig,ja=0,Ge=null,st=null,ht=null,vd=!1,dl=!1,Hl=0,vI=0;function Pt(){throw Error(U(321))}function Iy(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!mr(n[t],e[t]))return!1;return!0}function Cy(n,e,t,r,i,a){if(ja=a,Ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Uc.current=n===null||n.memoizedState===null?SI:OI,n=t(r,i),dl){a=0;do{if(dl=!1,Hl=0,25<=a)throw Error(U(301));a+=1,ht=st=null,e.updateQueue=null,Uc.current=AI,n=t(r,i)}while(dl)}if(Uc.current=xd,e=st!==null&&st.next!==null,ja=0,ht=st=Ge=null,vd=!1,e)throw Error(U(300));return n}function Ry(){var n=Hl!==0;return Hl=0,n}function Cr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ht===null?Ge.memoizedState=ht=n:ht=ht.next=n,ht}function qn(){if(st===null){var n=Ge.alternate;n=n!==null?n.memoizedState:null}else n=st.next;var e=ht===null?Ge.memoizedState:ht.next;if(e!==null)ht=e,st=n;else{if(n===null)throw Error(U(310));st=n,n={memoizedState:st.memoizedState,baseState:st.baseState,baseQueue:st.baseQueue,queue:st.queue,next:null},ht===null?Ge.memoizedState=ht=n:ht=ht.next=n}return ht}function Vl(n,e){return typeof e=="function"?e(n):e}function $h(n){var e=qn(),t=e.queue;if(t===null)throw Error(U(311));t.lastRenderedReducer=n;var r=st,i=r.baseQueue,a=t.pending;if(a!==null){if(i!==null){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,t.pending=null}if(i!==null){a=i.next,r=r.baseState;var o=s=null,l=null,u=a;do{var c=u.lane;if((ja&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,s=r):l=l.next=d,Ge.lanes|=c,La|=c}u=u.next}while(u!==null&&u!==a);l===null?s=r:l.next=o,mr(r,e.memoizedState)||(sn=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do a=i.lane,Ge.lanes|=a,La|=a,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Nh(n){var e=qn(),t=e.queue;if(t===null)throw Error(U(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,a=e.memoizedState;if(i!==null){t.pending=null;var s=i=i.next;do a=n(a,s.action),s=s.next;while(s!==i);mr(a,e.memoizedState)||(sn=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),t.lastRenderedState=a}return[a,r]}function mk(){}function gk(n,e){var t=Ge,r=qn(),i=e(),a=!mr(r.memoizedState,i);if(a&&(r.memoizedState=i,sn=!0),r=r.queue,$y(_k.bind(null,t,r,n),[n]),r.getSnapshot!==e||a||ht!==null&&ht.memoizedState.tag&1){if(t.flags|=2048,ql(9,wk.bind(null,t,r,i,e),void 0,null),mt===null)throw Error(U(349));ja&30||yk(t,e,i)}return i}function yk(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ge.updateQueue,e===null?(e={lastEffect:null,stores:null},Ge.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function wk(n,e,t,r){e.value=t,e.getSnapshot=r,bk(e)&&vk(n)}function _k(n,e,t){return t(function(){bk(e)&&vk(n)})}function bk(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!mr(n,t)}catch{return!0}}function vk(n){var e=ui(n,1);e!==null&&dr(e,n,1,-1)}function cb(n){var e=Cr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vl,lastRenderedState:n},e.queue=n,n=n.dispatch=kI.bind(null,Ge,n),[e.memoizedState,n]}function ql(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Ge.updateQueue,e===null?(e={lastEffect:null,stores:null},Ge.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function xk(){return qn().memoizedState}function zc(n,e,t,r){var i=Cr();Ge.flags|=n,i.memoizedState=ql(1|e,t,void 0,r===void 0?null:r)}function gf(n,e,t,r){var i=qn();r=r===void 0?null:r;var a=void 0;if(st!==null){var s=st.memoizedState;if(a=s.destroy,r!==null&&Iy(r,s.deps)){i.memoizedState=ql(e,t,a,r);return}}Ge.flags|=n,i.memoizedState=ql(1|e,t,a,r)}function db(n,e){return zc(8390656,8,n,e)}function $y(n,e){return gf(2048,8,n,e)}function Ek(n,e){return gf(4,2,n,e)}function kk(n,e){return gf(4,4,n,e)}function Sk(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Ok(n,e,t){return t=t!=null?t.concat([n]):null,gf(4,4,Sk.bind(null,e,n),t)}function Ny(){}function Ak(n,e){var t=qn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Iy(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Pk(n,e){var t=qn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Iy(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Tk(n,e,t){return ja&21?(mr(t,e)||(t=NE(),Ge.lanes|=t,La|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,sn=!0),n.memoizedState=t)}function xI(n,e){var t=Re;Re=t!==0&&4>t?t:4,n(!0);var r=Rh.transition;Rh.transition={};try{n(!1),e()}finally{Re=t,Rh.transition=r}}function Ik(){return qn().memoizedState}function EI(n,e,t){var r=Bi(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Ck(n))Rk(e,t);else if(t=fk(n,e,t,r),t!==null){var i=Vt();dr(t,n,r,i),$k(t,e,r)}}function kI(n,e,t){var r=Bi(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Ck(n))Rk(e,i);else{var a=n.alternate;if(n.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var s=e.lastRenderedState,o=a(s,t);if(i.hasEagerState=!0,i.eagerState=o,mr(o,s)){var l=e.interleaved;l===null?(i.next=i,Sy(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=fk(n,e,i,r),t!==null&&(i=Vt(),dr(t,n,r,i),$k(t,e,r))}}function Ck(n){var e=n.alternate;return n===Ge||e!==null&&e===Ge}function Rk(n,e){dl=vd=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function $k(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,dy(n,t)}}var xd={readContext:Vn,useCallback:Pt,useContext:Pt,useEffect:Pt,useImperativeHandle:Pt,useInsertionEffect:Pt,useLayoutEffect:Pt,useMemo:Pt,useReducer:Pt,useRef:Pt,useState:Pt,useDebugValue:Pt,useDeferredValue:Pt,useTransition:Pt,useMutableSource:Pt,useSyncExternalStore:Pt,useId:Pt,unstable_isNewReconciler:!1},SI={readContext:Vn,useCallback:function(n,e){return Cr().memoizedState=[n,e===void 0?null:e],n},useContext:Vn,useEffect:db,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,zc(4194308,4,Sk.bind(null,e,n),t)},useLayoutEffect:function(n,e){return zc(4194308,4,n,e)},useInsertionEffect:function(n,e){return zc(4,2,n,e)},useMemo:function(n,e){var t=Cr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Cr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=EI.bind(null,Ge,n),[r.memoizedState,n]},useRef:function(n){var e=Cr();return n={current:n},e.memoizedState=n},useState:cb,useDebugValue:Ny,useDeferredValue:function(n){return Cr().memoizedState=n},useTransition:function(){var n=cb(!1),e=n[0];return n=xI.bind(null,n[1]),Cr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Ge,i=Cr();if(ze){if(t===void 0)throw Error(U(407));t=t()}else{if(t=e(),mt===null)throw Error(U(349));ja&30||yk(r,e,t)}i.memoizedState=t;var a={value:t,getSnapshot:e};return i.queue=a,db(_k.bind(null,r,a,n),[n]),r.flags|=2048,ql(9,wk.bind(null,r,a,t,e),void 0,null),t},useId:function(){var n=Cr(),e=mt.identifierPrefix;if(ze){var t=ri,r=ni;t=(r&~(1<<32-cr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Hl++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=vI++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},OI={readContext:Vn,useCallback:Ak,useContext:Vn,useEffect:$y,useImperativeHandle:Ok,useInsertionEffect:Ek,useLayoutEffect:kk,useMemo:Pk,useReducer:$h,useRef:xk,useState:function(){return $h(Vl)},useDebugValue:Ny,useDeferredValue:function(n){var e=qn();return Tk(e,st.memoizedState,n)},useTransition:function(){var n=$h(Vl)[0],e=qn().memoizedState;return[n,e]},useMutableSource:mk,useSyncExternalStore:gk,useId:Ik,unstable_isNewReconciler:!1},AI={readContext:Vn,useCallback:Ak,useContext:Vn,useEffect:$y,useImperativeHandle:Ok,useInsertionEffect:Ek,useLayoutEffect:kk,useMemo:Pk,useReducer:Nh,useRef:xk,useState:function(){return Nh(Vl)},useDebugValue:Ny,useDeferredValue:function(n){var e=qn();return st===null?e.memoizedState=n:Tk(e,st.memoizedState,n)},useTransition:function(){var n=Nh(Vl)[0],e=qn().memoizedState;return[n,e]},useMutableSource:mk,useSyncExternalStore:gk,useId:Ik,unstable_isNewReconciler:!1};function rr(n,e){if(n&&n.defaultProps){e=We({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Am(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:We({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var yf={isMounted:function(n){return(n=n._reactInternals)?Va(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Vt(),i=Bi(n),a=ii(r,i);a.payload=e,t!=null&&(a.callback=t),e=Ui(n,a,i),e!==null&&(dr(e,n,i,r),Mc(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Vt(),i=Bi(n),a=ii(r,i);a.tag=1,a.payload=e,t!=null&&(a.callback=t),e=Ui(n,a,i),e!==null&&(dr(e,n,i,r),Mc(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Vt(),r=Bi(n),i=ii(t,r);i.tag=2,e!=null&&(i.callback=e),e=Ui(n,i,r),e!==null&&(dr(e,n,r,t),Mc(e,n,r))}};function fb(n,e,t,r,i,a,s){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,a,s):e.prototype&&e.prototype.isPureReactComponent?!Dl(t,r)||!Dl(i,a):!0}function Nk(n,e,t){var r=!1,i=Wi,a=e.contextType;return typeof a=="object"&&a!==null?a=Vn(a):(i=ln(e)?$a:jt.current,r=e.contextTypes,a=(r=r!=null)?Ws(n,i):Wi),e=new e(t,a),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=yf,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=a),e}function hb(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&yf.enqueueReplaceState(e,e.state,null)}function Pm(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},Oy(n);var a=e.contextType;typeof a=="object"&&a!==null?i.context=Vn(a):(a=ln(e)?$a:jt.current,i.context=Ws(n,a)),i.state=n.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Am(n,e,a,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&yf.enqueueReplaceState(i,i.state,null),_d(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Xs(n,e){try{var t="",r=e;do t+=tT(r),r=r.return;while(r);var i=t}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:n,source:e,stack:i,digest:null}}function jh(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Tm(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var PI=typeof WeakMap=="function"?WeakMap:Map;function jk(n,e,t){t=ii(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){kd||(kd=!0,Mm=r),Tm(n,e)},t}function Lk(n,e,t){t=ii(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){Tm(n,e)}}var a=n.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(t.callback=function(){Tm(n,e),typeof r!="function"&&(zi===null?zi=new Set([this]):zi.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),t}function pb(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new PI;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=BI.bind(null,n,e,t),e.then(n,n))}function mb(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function gb(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ii(-1,1),e.tag=2,Ui(t,e,1))),t.lanes|=1),n)}var TI=fi.ReactCurrentOwner,sn=!1;function Ht(n,e,t,r){e.child=n===null?dk(e,null,t,r):Js(e,n.child,t,r)}function yb(n,e,t,r,i){t=t.render;var a=e.ref;return js(e,i),r=Cy(n,e,t,r,a,i),t=Ry(),n!==null&&!sn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ci(n,e,i)):(ze&&t&&_y(e),e.flags|=1,Ht(n,e,r,i),e.child)}function wb(n,e,t,r,i){if(n===null){var a=t.type;return typeof a=="function"&&!By(a)&&a.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=a,Dk(n,e,a,r,i)):(n=qc(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(a=n.child,!(n.lanes&i)){var s=a.memoizedProps;if(t=t.compare,t=t!==null?t:Dl,t(s,r)&&n.ref===e.ref)return ci(n,e,i)}return e.flags|=1,n=Hi(a,r),n.ref=e.ref,n.return=e,e.child=n}function Dk(n,e,t,r,i){if(n!==null){var a=n.memoizedProps;if(Dl(a,r)&&n.ref===e.ref)if(sn=!1,e.pendingProps=r=a,(n.lanes&i)!==0)n.flags&131072&&(sn=!0);else return e.lanes=n.lanes,ci(n,e,i)}return Im(n,e,t,r,i)}function Fk(n,e,t){var r=e.pendingProps,i=r.children,a=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},De(Es,Sn),Sn|=t;else{if(!(t&1073741824))return n=a!==null?a.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,De(Es,Sn),Sn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:t,De(Es,Sn),Sn|=r}else a!==null?(r=a.baseLanes|t,e.memoizedState=null):r=t,De(Es,Sn),Sn|=r;return Ht(n,e,i,t),e.child}function Mk(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Im(n,e,t,r,i){var a=ln(t)?$a:jt.current;return a=Ws(e,a),js(e,i),t=Cy(n,e,t,r,a,i),r=Ry(),n!==null&&!sn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ci(n,e,i)):(ze&&r&&_y(e),e.flags|=1,Ht(n,e,t,i),e.child)}function _b(n,e,t,r,i){if(ln(t)){var a=!0;pd(e)}else a=!1;if(js(e,i),e.stateNode===null)Bc(n,e),Nk(e,t,r),Pm(e,t,r,i),r=!0;else if(n===null){var s=e.stateNode,o=e.memoizedProps;s.props=o;var l=s.context,u=t.contextType;typeof u=="object"&&u!==null?u=Vn(u):(u=ln(t)?$a:jt.current,u=Ws(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof s.getSnapshotBeforeUpdate=="function";d||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o!==r||l!==u)&&hb(e,s,r,u),Si=!1;var f=e.memoizedState;s.state=f,_d(e,r,s,i),l=e.memoizedState,o!==r||f!==l||on.current||Si?(typeof c=="function"&&(Am(e,t,c,r),l=e.memoizedState),(o=Si||fb(e,t,o,r,f,l,u))?(d||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),s.props=r,s.state=l,s.context=u,r=o):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,hk(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:rr(e.type,o),s.props=u,d=e.pendingProps,f=s.context,l=t.contextType,typeof l=="object"&&l!==null?l=Vn(l):(l=ln(t)?$a:jt.current,l=Ws(e,l));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o!==d||f!==l)&&hb(e,s,r,l),Si=!1,f=e.memoizedState,s.state=f,_d(e,r,s,i);var p=e.memoizedState;o!==d||f!==p||on.current||Si?(typeof h=="function"&&(Am(e,t,h,r),p=e.memoizedState),(u=Si||fb(e,t,u,r,f,p,l)||!1)?(c||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,p,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,p,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),s.props=r,s.state=p,s.context=l,r=u):(typeof s.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return Cm(n,e,t,r,a,i)}function Cm(n,e,t,r,i,a){Mk(n,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&ib(e,t,!1),ci(n,e,a);r=e.stateNode,TI.current=e;var o=s&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&s?(e.child=Js(e,n.child,null,a),e.child=Js(e,null,o,a)):Ht(n,e,o,a),e.memoizedState=r.state,i&&ib(e,t,!0),e.child}function Uk(n){var e=n.stateNode;e.pendingContext?rb(n,e.pendingContext,e.pendingContext!==e.context):e.context&&rb(n,e.context,!1),Ay(n,e.containerInfo)}function bb(n,e,t,r,i){return Ks(),vy(i),e.flags|=256,Ht(n,e,t,r),e.child}var Rm={dehydrated:null,treeContext:null,retryLane:0};function $m(n){return{baseLanes:n,cachePool:null,transitions:null}}function zk(n,e,t){var r=e.pendingProps,i=qe.current,a=!1,s=(e.flags&128)!==0,o;if((o=s)||(o=n!==null&&n.memoizedState===null?!1:(i&2)!==0),o?(a=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),De(qe,i&1),n===null)return Sm(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,n=r.fallback,a?(r=e.mode,a=e.child,s={mode:"hidden",children:s},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=s):a=bf(s,r,0,null),n=Aa(n,r,t,null),a.return=e,n.return=e,a.sibling=n,e.child=a,e.child.memoizedState=$m(t),e.memoizedState=Rm,n):jy(e,s));if(i=n.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return II(n,e,s,r,o,i,t);if(a){a=r.fallback,s=e.mode,i=n.child,o=i.sibling;var l={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Hi(i,l),r.subtreeFlags=i.subtreeFlags&14680064),o!==null?a=Hi(o,a):(a=Aa(a,s,t,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,s=n.child.memoizedState,s=s===null?$m(t):{baseLanes:s.baseLanes|t,cachePool:null,transitions:s.transitions},a.memoizedState=s,a.childLanes=n.childLanes&~t,e.memoizedState=Rm,r}return a=n.child,n=a.sibling,r=Hi(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function jy(n,e){return e=bf({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function rc(n,e,t,r){return r!==null&&vy(r),Js(e,n.child,null,t),n=jy(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function II(n,e,t,r,i,a,s){if(t)return e.flags&256?(e.flags&=-257,r=jh(Error(U(422))),rc(n,e,s,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(a=r.fallback,i=e.mode,r=bf({mode:"visible",children:r.children},i,0,null),a=Aa(a,i,s,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&Js(e,n.child,null,s),e.child.memoizedState=$m(s),e.memoizedState=Rm,a);if(!(e.mode&1))return rc(n,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var o=r.dgst;return r=o,a=Error(U(419)),r=jh(a,r,void 0),rc(n,e,s,r)}if(o=(s&n.childLanes)!==0,sn||o){if(r=mt,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,ui(n,i),dr(r,n,i,-1))}return zy(),r=jh(Error(U(421))),rc(n,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=HI.bind(null,n),i._reactRetry=e,null):(n=a.treeContext,On=Mi(i.nextSibling),Tn=e,ze=!0,or=null,n!==null&&(Dn[Fn++]=ni,Dn[Fn++]=ri,Dn[Fn++]=Na,ni=n.id,ri=n.overflow,Na=e),e=jy(e,r.children),e.flags|=4096,e)}function vb(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Om(n.return,e,t)}function Lh(n,e,t,r,i){var a=n.memoizedState;a===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=t,a.tailMode=i)}function Bk(n,e,t){var r=e.pendingProps,i=r.revealOrder,a=r.tail;if(Ht(n,e,r.children,t),r=qe.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&vb(n,t,e);else if(n.tag===19)vb(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(De(qe,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&bd(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Lh(e,!1,i,t,a);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&bd(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Lh(e,!0,t,null,a);break;case"together":Lh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Bc(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ci(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),La|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(U(153));if(e.child!==null){for(n=e.child,t=Hi(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Hi(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function CI(n,e,t){switch(e.tag){case 3:Uk(e),Ks();break;case 5:pk(e);break;case 1:ln(e.type)&&pd(e);break;case 4:Ay(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;De(yd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(De(qe,qe.current&1),e.flags|=128,null):t&e.child.childLanes?zk(n,e,t):(De(qe,qe.current&1),n=ci(n,e,t),n!==null?n.sibling:null);De(qe,qe.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Bk(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),De(qe,qe.current),r)break;return null;case 22:case 23:return e.lanes=0,Fk(n,e,t)}return ci(n,e,t)}var Hk,Nm,Vk,qk;Hk=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Nm=function(){};Vk=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,va(Ur.current);var a=null;switch(t){case"input":i=nm(n,i),r=nm(n,r),a=[];break;case"select":i=We({},i,{value:void 0}),r=We({},r,{value:void 0}),a=[];break;case"textarea":i=am(n,i),r=am(n,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=fd)}om(t,r);var s;t=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var o=i[u];for(s in o)o.hasOwnProperty(s)&&(t||(t={}),t[s]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Il.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var l=r[u];if(o=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(s in o)!o.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(t||(t={}),t[s]="");for(s in l)l.hasOwnProperty(s)&&o[s]!==l[s]&&(t||(t={}),t[s]=l[s])}else t||(a||(a=[]),a.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(a=a||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(a=a||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Il.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Me("scroll",n),a||o===l||(a=[])):(a=a||[]).push(u,l))}t&&(a=a||[]).push("style",t);var u=a;(e.updateQueue=u)&&(e.flags|=4)}};qk=function(n,e,t,r){t!==r&&(e.flags|=4)};function Do(n,e){if(!ze)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Tt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function RI(n,e,t){var r=e.pendingProps;switch(by(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tt(e),null;case 1:return ln(e.type)&&hd(),Tt(e),null;case 3:return r=e.stateNode,Zs(),Ue(on),Ue(jt),Ty(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(tc(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,or!==null&&(Bm(or),or=null))),Nm(n,e),Tt(e),null;case 5:Py(e);var i=va(Bl.current);if(t=e.type,n!==null&&e.stateNode!=null)Vk(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(U(166));return Tt(e),null}if(n=va(Ur.current),tc(e)){r=e.stateNode,t=e.type;var a=e.memoizedProps;switch(r[jr]=e,r[Ul]=a,n=(e.mode&1)!==0,t){case"dialog":Me("cancel",r),Me("close",r);break;case"iframe":case"object":case"embed":Me("load",r);break;case"video":case"audio":for(i=0;i<Ko.length;i++)Me(Ko[i],r);break;case"source":Me("error",r);break;case"img":case"image":case"link":Me("error",r),Me("load",r);break;case"details":Me("toggle",r);break;case"input":I_(r,a),Me("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Me("invalid",r);break;case"textarea":R_(r,a),Me("invalid",r)}om(t,a),i=null;for(var s in a)if(a.hasOwnProperty(s)){var o=a[s];s==="children"?typeof o=="string"?r.textContent!==o&&(a.suppressHydrationWarning!==!0&&ec(r.textContent,o,n),i=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(a.suppressHydrationWarning!==!0&&ec(r.textContent,o,n),i=["children",""+o]):Il.hasOwnProperty(s)&&o!=null&&s==="onScroll"&&Me("scroll",r)}switch(t){case"input":Gu(r),C_(r,a,!0);break;case"textarea":Gu(r),$_(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=fd)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=_E(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=s.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=s.createElement(t,{is:r.is}):(n=s.createElement(t),t==="select"&&(s=n,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):n=s.createElementNS(n,t),n[jr]=e,n[Ul]=r,Hk(n,e,!1,!1),e.stateNode=n;e:{switch(s=lm(t,r),t){case"dialog":Me("cancel",n),Me("close",n),i=r;break;case"iframe":case"object":case"embed":Me("load",n),i=r;break;case"video":case"audio":for(i=0;i<Ko.length;i++)Me(Ko[i],n);i=r;break;case"source":Me("error",n),i=r;break;case"img":case"image":case"link":Me("error",n),Me("load",n),i=r;break;case"details":Me("toggle",n),i=r;break;case"input":I_(n,r),i=nm(n,r),Me("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=We({},r,{value:void 0}),Me("invalid",n);break;case"textarea":R_(n,r),i=am(n,r),Me("invalid",n);break;default:i=r}om(t,i),o=i;for(a in o)if(o.hasOwnProperty(a)){var l=o[a];a==="style"?xE(n,l):a==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&bE(n,l)):a==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Cl(n,l):typeof l=="number"&&Cl(n,""+l):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Il.hasOwnProperty(a)?l!=null&&a==="onScroll"&&Me("scroll",n):l!=null&&ay(n,a,l,s))}switch(t){case"input":Gu(n),C_(n,r,!1);break;case"textarea":Gu(n),$_(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Gi(r.value));break;case"select":n.multiple=!!r.multiple,a=r.value,a!=null?Cs(n,!!r.multiple,a,!1):r.defaultValue!=null&&Cs(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=fd)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Tt(e),null;case 6:if(n&&e.stateNode!=null)qk(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(U(166));if(t=va(Bl.current),va(Ur.current),tc(e)){if(r=e.stateNode,t=e.memoizedProps,r[jr]=e,(a=r.nodeValue!==t)&&(n=Tn,n!==null))switch(n.tag){case 3:ec(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ec(r.nodeValue,t,(n.mode&1)!==0)}a&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[jr]=e,e.stateNode=r}return Tt(e),null;case 13:if(Ue(qe),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(ze&&On!==null&&e.mode&1&&!(e.flags&128))uk(),Ks(),e.flags|=98560,a=!1;else if(a=tc(e),r!==null&&r.dehydrated!==null){if(n===null){if(!a)throw Error(U(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(U(317));a[jr]=e}else Ks(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Tt(e),a=!1}else or!==null&&(Bm(or),or=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||qe.current&1?lt===0&&(lt=3):zy())),e.updateQueue!==null&&(e.flags|=4),Tt(e),null);case 4:return Zs(),Nm(n,e),n===null&&Fl(e.stateNode.containerInfo),Tt(e),null;case 10:return ky(e.type._context),Tt(e),null;case 17:return ln(e.type)&&hd(),Tt(e),null;case 19:if(Ue(qe),a=e.memoizedState,a===null)return Tt(e),null;if(r=(e.flags&128)!==0,s=a.rendering,s===null)if(r)Do(a,!1);else{if(lt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(s=bd(n),s!==null){for(e.flags|=128,Do(a,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)a=t,n=r,a.flags&=14680066,s=a.alternate,s===null?(a.childLanes=0,a.lanes=n,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=s.childLanes,a.lanes=s.lanes,a.child=s.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=s.memoizedProps,a.memoizedState=s.memoizedState,a.updateQueue=s.updateQueue,a.type=s.type,n=s.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return De(qe,qe.current&1|2),e.child}n=n.sibling}a.tail!==null&&Xe()>Qs&&(e.flags|=128,r=!0,Do(a,!1),e.lanes=4194304)}else{if(!r)if(n=bd(s),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Do(a,!0),a.tail===null&&a.tailMode==="hidden"&&!s.alternate&&!ze)return Tt(e),null}else 2*Xe()-a.renderingStartTime>Qs&&t!==1073741824&&(e.flags|=128,r=!0,Do(a,!1),e.lanes=4194304);a.isBackwards?(s.sibling=e.child,e.child=s):(t=a.last,t!==null?t.sibling=s:e.child=s,a.last=s)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Xe(),e.sibling=null,t=qe.current,De(qe,r?t&1|2:t&1),e):(Tt(e),null);case 22:case 23:return Uy(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Sn&1073741824&&(Tt(e),e.subtreeFlags&6&&(e.flags|=8192)):Tt(e),null;case 24:return null;case 25:return null}throw Error(U(156,e.tag))}function $I(n,e){switch(by(e),e.tag){case 1:return ln(e.type)&&hd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Zs(),Ue(on),Ue(jt),Ty(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Py(e),null;case 13:if(Ue(qe),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(U(340));Ks()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ue(qe),null;case 4:return Zs(),null;case 10:return ky(e.type._context),null;case 22:case 23:return Uy(),null;case 24:return null;default:return null}}var ic=!1,Ct=!1,NI=typeof WeakSet=="function"?WeakSet:Set,K=null;function xs(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ke(n,e,r)}else t.current=null}function jm(n,e,t){try{t()}catch(r){Ke(n,e,r)}}var xb=!1;function jI(n,e){if(wm=ud,n=ZE(),wy(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{t.nodeType,a.nodeType}catch{t=null;break e}var s=0,o=-1,l=-1,u=0,c=0,d=n,f=null;t:for(;;){for(var h;d!==t||i!==0&&d.nodeType!==3||(o=s+i),d!==a||r!==0&&d.nodeType!==3||(l=s+r),d.nodeType===3&&(s+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===n)break t;if(f===t&&++u===i&&(o=s),f===a&&++c===r&&(l=s),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(_m={focusedElem:n,selectionRange:t},ud=!1,K=e;K!==null;)if(e=K,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,K=n;else for(;K!==null;){e=K;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,_=p.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?m:rr(e.type,m),_);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(U(163))}}catch(x){Ke(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,K=n;break}K=e.return}return p=xb,xb=!1,p}function fl(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var a=i.destroy;i.destroy=void 0,a!==void 0&&jm(e,t,a)}i=i.next}while(i!==r)}}function wf(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Lm(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Gk(n){var e=n.alternate;e!==null&&(n.alternate=null,Gk(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[jr],delete e[Ul],delete e[xm],delete e[yI],delete e[wI])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Wk(n){return n.tag===5||n.tag===3||n.tag===4}function Eb(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Wk(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Dm(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=fd));else if(r!==4&&(n=n.child,n!==null))for(Dm(n,e,t),n=n.sibling;n!==null;)Dm(n,e,t),n=n.sibling}function Fm(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Fm(n,e,t),n=n.sibling;n!==null;)Fm(n,e,t),n=n.sibling}var bt=null,ar=!1;function mi(n,e,t){for(t=t.child;t!==null;)Kk(n,e,t),t=t.sibling}function Kk(n,e,t){if(Mr&&typeof Mr.onCommitFiberUnmount=="function")try{Mr.onCommitFiberUnmount(cf,t)}catch{}switch(t.tag){case 5:Ct||xs(t,e);case 6:var r=bt,i=ar;bt=null,mi(n,e,t),bt=r,ar=i,bt!==null&&(ar?(n=bt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):bt.removeChild(t.stateNode));break;case 18:bt!==null&&(ar?(n=bt,t=t.stateNode,n.nodeType===8?Th(n.parentNode,t):n.nodeType===1&&Th(n,t),jl(n)):Th(bt,t.stateNode));break;case 4:r=bt,i=ar,bt=t.stateNode.containerInfo,ar=!0,mi(n,e,t),bt=r,ar=i;break;case 0:case 11:case 14:case 15:if(!Ct&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,s=a.destroy;a=a.tag,s!==void 0&&(a&2||a&4)&&jm(t,e,s),i=i.next}while(i!==r)}mi(n,e,t);break;case 1:if(!Ct&&(xs(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){Ke(t,e,o)}mi(n,e,t);break;case 21:mi(n,e,t);break;case 22:t.mode&1?(Ct=(r=Ct)||t.memoizedState!==null,mi(n,e,t),Ct=r):mi(n,e,t);break;default:mi(n,e,t)}}function kb(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new NI),e.forEach(function(r){var i=VI.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Zn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var a=n,s=e,o=s;e:for(;o!==null;){switch(o.tag){case 5:bt=o.stateNode,ar=!1;break e;case 3:bt=o.stateNode.containerInfo,ar=!0;break e;case 4:bt=o.stateNode.containerInfo,ar=!0;break e}o=o.return}if(bt===null)throw Error(U(160));Kk(a,s,i),bt=null,ar=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){Ke(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Jk(e,n),e=e.sibling}function Jk(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Zn(e,n),Sr(n),r&4){try{fl(3,n,n.return),wf(3,n)}catch(m){Ke(n,n.return,m)}try{fl(5,n,n.return)}catch(m){Ke(n,n.return,m)}}break;case 1:Zn(e,n),Sr(n),r&512&&t!==null&&xs(t,t.return);break;case 5:if(Zn(e,n),Sr(n),r&512&&t!==null&&xs(t,t.return),n.flags&32){var i=n.stateNode;try{Cl(i,"")}catch(m){Ke(n,n.return,m)}}if(r&4&&(i=n.stateNode,i!=null)){var a=n.memoizedProps,s=t!==null?t.memoizedProps:a,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&a.type==="radio"&&a.name!=null&&yE(i,a),lm(o,s);var u=lm(o,a);for(s=0;s<l.length;s+=2){var c=l[s],d=l[s+1];c==="style"?xE(i,d):c==="dangerouslySetInnerHTML"?bE(i,d):c==="children"?Cl(i,d):ay(i,c,d,u)}switch(o){case"input":rm(i,a);break;case"textarea":wE(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var h=a.value;h!=null?Cs(i,!!a.multiple,h,!1):f!==!!a.multiple&&(a.defaultValue!=null?Cs(i,!!a.multiple,a.defaultValue,!0):Cs(i,!!a.multiple,a.multiple?[]:"",!1))}i[Ul]=a}catch(m){Ke(n,n.return,m)}}break;case 6:if(Zn(e,n),Sr(n),r&4){if(n.stateNode===null)throw Error(U(162));i=n.stateNode,a=n.memoizedProps;try{i.nodeValue=a}catch(m){Ke(n,n.return,m)}}break;case 3:if(Zn(e,n),Sr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{jl(e.containerInfo)}catch(m){Ke(n,n.return,m)}break;case 4:Zn(e,n),Sr(n);break;case 13:Zn(e,n),Sr(n),i=n.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(Fy=Xe())),r&4&&kb(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(Ct=(u=Ct)||c,Zn(e,n),Ct=u):Zn(e,n),Sr(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(K=n,c=n.child;c!==null;){for(d=K=c;K!==null;){switch(f=K,h=f.child,f.tag){case 0:case 11:case 14:case 15:fl(4,f,f.return);break;case 1:xs(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){Ke(r,t,m)}}break;case 5:xs(f,f.return);break;case 22:if(f.memoizedState!==null){Ob(d);continue}}h!==null?(h.return=f,K=h):Ob(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,u?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(o=d.stateNode,l=d.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=vE("display",s))}catch(m){Ke(n,n.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){Ke(n,n.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Zn(e,n),Sr(n),r&4&&kb(n);break;case 21:break;default:Zn(e,n),Sr(n)}}function Sr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Wk(t)){var r=t;break e}t=t.return}throw Error(U(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Cl(i,""),r.flags&=-33);var a=Eb(n);Fm(n,a,i);break;case 3:case 4:var s=r.stateNode.containerInfo,o=Eb(n);Dm(n,o,s);break;default:throw Error(U(161))}}catch(l){Ke(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function LI(n,e,t){K=n,Zk(n)}function Zk(n,e,t){for(var r=(n.mode&1)!==0;K!==null;){var i=K,a=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||ic;if(!s){var o=i.alternate,l=o!==null&&o.memoizedState!==null||Ct;o=ic;var u=Ct;if(ic=s,(Ct=l)&&!u)for(K=i;K!==null;)s=K,l=s.child,s.tag===22&&s.memoizedState!==null?Ab(i):l!==null?(l.return=s,K=l):Ab(i);for(;a!==null;)K=a,Zk(a),a=a.sibling;K=i,ic=o,Ct=u}Sb(n)}else i.subtreeFlags&8772&&a!==null?(a.return=i,K=a):Sb(n)}}function Sb(n){for(;K!==null;){var e=K;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ct||wf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ct)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:rr(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&ub(e,a,r);break;case 3:var s=e.updateQueue;if(s!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}ub(e,s,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&jl(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(U(163))}Ct||e.flags&512&&Lm(e)}catch(f){Ke(e,e.return,f)}}if(e===n){K=null;break}if(t=e.sibling,t!==null){t.return=e.return,K=t;break}K=e.return}}function Ob(n){for(;K!==null;){var e=K;if(e===n){K=null;break}var t=e.sibling;if(t!==null){t.return=e.return,K=t;break}K=e.return}}function Ab(n){for(;K!==null;){var e=K;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{wf(4,e)}catch(l){Ke(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Ke(e,i,l)}}var a=e.return;try{Lm(e)}catch(l){Ke(e,a,l)}break;case 5:var s=e.return;try{Lm(e)}catch(l){Ke(e,s,l)}}}catch(l){Ke(e,e.return,l)}if(e===n){K=null;break}var o=e.sibling;if(o!==null){o.return=e.return,K=o;break}K=e.return}}var DI=Math.ceil,Ed=fi.ReactCurrentDispatcher,Ly=fi.ReactCurrentOwner,Hn=fi.ReactCurrentBatchConfig,Oe=0,mt=null,rt=null,St=0,Sn=0,Es=ra(0),lt=0,Gl=null,La=0,_f=0,Dy=0,hl=null,nn=null,Fy=0,Qs=1/0,Qr=null,kd=!1,Mm=null,zi=null,ac=!1,ji=null,Sd=0,pl=0,Um=null,Hc=-1,Vc=0;function Vt(){return Oe&6?Xe():Hc!==-1?Hc:Hc=Xe()}function Bi(n){return n.mode&1?Oe&2&&St!==0?St&-St:bI.transition!==null?(Vc===0&&(Vc=NE()),Vc):(n=Re,n!==0||(n=window.event,n=n===void 0?16:zE(n.type)),n):1}function dr(n,e,t,r){if(50<pl)throw pl=0,Um=null,Error(U(185));_u(n,t,r),(!(Oe&2)||n!==mt)&&(n===mt&&(!(Oe&2)&&(_f|=t),lt===4&&Ci(n,St)),un(n,r),t===1&&Oe===0&&!(e.mode&1)&&(Qs=Xe()+500,mf&&ia()))}function un(n,e){var t=n.callbackNode;bT(n,e);var r=ld(n,n===mt?St:0);if(r===0)t!==null&&L_(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&L_(t),e===1)n.tag===0?_I(Pb.bind(null,n)):sk(Pb.bind(null,n)),mI(function(){!(Oe&6)&&ia()}),t=null;else{switch(jE(r)){case 1:t=cy;break;case 4:t=RE;break;case 16:t=od;break;case 536870912:t=$E;break;default:t=od}t=iS(t,Xk.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Xk(n,e){if(Hc=-1,Vc=0,Oe&6)throw Error(U(327));var t=n.callbackNode;if(Ls()&&n.callbackNode!==t)return null;var r=ld(n,n===mt?St:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Od(n,r);else{e=r;var i=Oe;Oe|=2;var a=Yk();(mt!==n||St!==e)&&(Qr=null,Qs=Xe()+500,Oa(n,e));do try{UI();break}catch(o){Qk(n,o)}while(!0);Ey(),Ed.current=a,Oe=i,rt!==null?e=0:(mt=null,St=0,e=lt)}if(e!==0){if(e===2&&(i=hm(n),i!==0&&(r=i,e=zm(n,i))),e===1)throw t=Gl,Oa(n,0),Ci(n,r),un(n,Xe()),t;if(e===6)Ci(n,r);else{if(i=n.current.alternate,!(r&30)&&!FI(i)&&(e=Od(n,r),e===2&&(a=hm(n),a!==0&&(r=a,e=zm(n,a))),e===1))throw t=Gl,Oa(n,0),Ci(n,r),un(n,Xe()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(U(345));case 2:da(n,nn,Qr);break;case 3:if(Ci(n,r),(r&130023424)===r&&(e=Fy+500-Xe(),10<e)){if(ld(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Vt(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=vm(da.bind(null,n,nn,Qr),e);break}da(n,nn,Qr);break;case 4:if(Ci(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var s=31-cr(r);a=1<<s,s=e[s],s>i&&(i=s),r&=~a}if(r=i,r=Xe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*DI(r/1960))-r,10<r){n.timeoutHandle=vm(da.bind(null,n,nn,Qr),r);break}da(n,nn,Qr);break;case 5:da(n,nn,Qr);break;default:throw Error(U(329))}}}return un(n,Xe()),n.callbackNode===t?Xk.bind(null,n):null}function zm(n,e){var t=hl;return n.current.memoizedState.isDehydrated&&(Oa(n,e).flags|=256),n=Od(n,e),n!==2&&(e=nn,nn=t,e!==null&&Bm(e)),n}function Bm(n){nn===null?nn=n:nn.push.apply(nn,n)}function FI(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],a=i.getSnapshot;i=i.value;try{if(!mr(a(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ci(n,e){for(e&=~Dy,e&=~_f,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-cr(e),r=1<<t;n[t]=-1,e&=~r}}function Pb(n){if(Oe&6)throw Error(U(327));Ls();var e=ld(n,0);if(!(e&1))return un(n,Xe()),null;var t=Od(n,e);if(n.tag!==0&&t===2){var r=hm(n);r!==0&&(e=r,t=zm(n,r))}if(t===1)throw t=Gl,Oa(n,0),Ci(n,e),un(n,Xe()),t;if(t===6)throw Error(U(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,da(n,nn,Qr),un(n,Xe()),null}function My(n,e){var t=Oe;Oe|=1;try{return n(e)}finally{Oe=t,Oe===0&&(Qs=Xe()+500,mf&&ia())}}function Da(n){ji!==null&&ji.tag===0&&!(Oe&6)&&Ls();var e=Oe;Oe|=1;var t=Hn.transition,r=Re;try{if(Hn.transition=null,Re=1,n)return n()}finally{Re=r,Hn.transition=t,Oe=e,!(Oe&6)&&ia()}}function Uy(){Sn=Es.current,Ue(Es)}function Oa(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,pI(t)),rt!==null)for(t=rt.return;t!==null;){var r=t;switch(by(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&hd();break;case 3:Zs(),Ue(on),Ue(jt),Ty();break;case 5:Py(r);break;case 4:Zs();break;case 13:Ue(qe);break;case 19:Ue(qe);break;case 10:ky(r.type._context);break;case 22:case 23:Uy()}t=t.return}if(mt=n,rt=n=Hi(n.current,null),St=Sn=e,lt=0,Gl=null,Dy=_f=La=0,nn=hl=null,ba!==null){for(e=0;e<ba.length;e++)if(t=ba[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,a=t.pending;if(a!==null){var s=a.next;a.next=i,r.next=s}t.pending=r}ba=null}return n}function Qk(n,e){do{var t=rt;try{if(Ey(),Uc.current=xd,vd){for(var r=Ge.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}vd=!1}if(ja=0,ht=st=Ge=null,dl=!1,Hl=0,Ly.current=null,t===null||t.return===null){lt=1,Gl=e,rt=null;break}e:{var a=n,s=t.return,o=t,l=e;if(e=St,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=mb(s);if(h!==null){h.flags&=-257,gb(h,s,o,a,e),h.mode&1&&pb(a,u,e),e=h,l=u;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){pb(a,u,e),zy();break e}l=Error(U(426))}}else if(ze&&o.mode&1){var _=mb(s);if(_!==null){!(_.flags&65536)&&(_.flags|=256),gb(_,s,o,a,e),vy(Xs(l,o));break e}}a=l=Xs(l,o),lt!==4&&(lt=2),hl===null?hl=[a]:hl.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var g=jk(a,l,e);lb(a,g);break e;case 1:o=l;var y=a.type,w=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(zi===null||!zi.has(w)))){a.flags|=65536,e&=-e,a.lanes|=e;var x=Lk(a,o,e);lb(a,x);break e}}a=a.return}while(a!==null)}tS(t)}catch(k){e=k,rt===t&&t!==null&&(rt=t=t.return);continue}break}while(!0)}function Yk(){var n=Ed.current;return Ed.current=xd,n===null?xd:n}function zy(){(lt===0||lt===3||lt===2)&&(lt=4),mt===null||!(La&268435455)&&!(_f&268435455)||Ci(mt,St)}function Od(n,e){var t=Oe;Oe|=2;var r=Yk();(mt!==n||St!==e)&&(Qr=null,Oa(n,e));do try{MI();break}catch(i){Qk(n,i)}while(!0);if(Ey(),Oe=t,Ed.current=r,rt!==null)throw Error(U(261));return mt=null,St=0,lt}function MI(){for(;rt!==null;)eS(rt)}function UI(){for(;rt!==null&&!dT();)eS(rt)}function eS(n){var e=rS(n.alternate,n,Sn);n.memoizedProps=n.pendingProps,e===null?tS(n):rt=e,Ly.current=null}function tS(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=$I(t,e),t!==null){t.flags&=32767,rt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{lt=6,rt=null;return}}else if(t=RI(t,e,Sn),t!==null){rt=t;return}if(e=e.sibling,e!==null){rt=e;return}rt=e=n}while(e!==null);lt===0&&(lt=5)}function da(n,e,t){var r=Re,i=Hn.transition;try{Hn.transition=null,Re=1,zI(n,e,t,r)}finally{Hn.transition=i,Re=r}return null}function zI(n,e,t,r){do Ls();while(ji!==null);if(Oe&6)throw Error(U(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(U(177));n.callbackNode=null,n.callbackPriority=0;var a=t.lanes|t.childLanes;if(vT(n,a),n===mt&&(rt=mt=null,St=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||ac||(ac=!0,iS(od,function(){return Ls(),null})),a=(t.flags&15990)!==0,t.subtreeFlags&15990||a){a=Hn.transition,Hn.transition=null;var s=Re;Re=1;var o=Oe;Oe|=4,Ly.current=null,jI(n,t),Jk(t,n),oI(_m),ud=!!wm,_m=wm=null,n.current=t,LI(t),fT(),Oe=o,Re=s,Hn.transition=a}else n.current=t;if(ac&&(ac=!1,ji=n,Sd=i),a=n.pendingLanes,a===0&&(zi=null),mT(t.stateNode),un(n,Xe()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(kd)throw kd=!1,n=Mm,Mm=null,n;return Sd&1&&n.tag!==0&&Ls(),a=n.pendingLanes,a&1?n===Um?pl++:(pl=0,Um=n):pl=0,ia(),null}function Ls(){if(ji!==null){var n=jE(Sd),e=Hn.transition,t=Re;try{if(Hn.transition=null,Re=16>n?16:n,ji===null)var r=!1;else{if(n=ji,ji=null,Sd=0,Oe&6)throw Error(U(331));var i=Oe;for(Oe|=4,K=n.current;K!==null;){var a=K,s=a.child;if(K.flags&16){var o=a.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(K=u;K!==null;){var c=K;switch(c.tag){case 0:case 11:case 15:fl(8,c,a)}var d=c.child;if(d!==null)d.return=c,K=d;else for(;K!==null;){c=K;var f=c.sibling,h=c.return;if(Gk(c),c===u){K=null;break}if(f!==null){f.return=h,K=f;break}K=h}}}var p=a.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var _=m.sibling;m.sibling=null,m=_}while(m!==null)}}K=a}}if(a.subtreeFlags&2064&&s!==null)s.return=a,K=s;else e:for(;K!==null;){if(a=K,a.flags&2048)switch(a.tag){case 0:case 11:case 15:fl(9,a,a.return)}var g=a.sibling;if(g!==null){g.return=a.return,K=g;break e}K=a.return}}var y=n.current;for(K=y;K!==null;){s=K;var w=s.child;if(s.subtreeFlags&2064&&w!==null)w.return=s,K=w;else e:for(s=y;K!==null;){if(o=K,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:wf(9,o)}}catch(k){Ke(o,o.return,k)}if(o===s){K=null;break e}var x=o.sibling;if(x!==null){x.return=o.return,K=x;break e}K=o.return}}if(Oe=i,ia(),Mr&&typeof Mr.onPostCommitFiberRoot=="function")try{Mr.onPostCommitFiberRoot(cf,n)}catch{}r=!0}return r}finally{Re=t,Hn.transition=e}}return!1}function Tb(n,e,t){e=Xs(t,e),e=jk(n,e,1),n=Ui(n,e,1),e=Vt(),n!==null&&(_u(n,1,e),un(n,e))}function Ke(n,e,t){if(n.tag===3)Tb(n,n,t);else for(;e!==null;){if(e.tag===3){Tb(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(zi===null||!zi.has(r))){n=Xs(t,n),n=Lk(e,n,1),e=Ui(e,n,1),n=Vt(),e!==null&&(_u(e,1,n),un(e,n));break}}e=e.return}}function BI(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Vt(),n.pingedLanes|=n.suspendedLanes&t,mt===n&&(St&t)===t&&(lt===4||lt===3&&(St&130023424)===St&&500>Xe()-Fy?Oa(n,0):Dy|=t),un(n,e)}function nS(n,e){e===0&&(n.mode&1?(e=Ju,Ju<<=1,!(Ju&130023424)&&(Ju=4194304)):e=1);var t=Vt();n=ui(n,e),n!==null&&(_u(n,e,t),un(n,t))}function HI(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),nS(n,t)}function VI(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(U(314))}r!==null&&r.delete(e),nS(n,t)}var rS;rS=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||on.current)sn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return sn=!1,CI(n,e,t);sn=!!(n.flags&131072)}else sn=!1,ze&&e.flags&1048576&&ok(e,gd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Bc(n,e),n=e.pendingProps;var i=Ws(e,jt.current);js(e,t),i=Cy(null,e,r,n,i,t);var a=Ry();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ln(r)?(a=!0,pd(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Oy(e),i.updater=yf,e.stateNode=i,i._reactInternals=e,Pm(e,r,n,t),e=Cm(null,e,r,!0,a,t)):(e.tag=0,ze&&a&&_y(e),Ht(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Bc(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=GI(r),n=rr(r,n),i){case 0:e=Im(null,e,r,n,t);break e;case 1:e=_b(null,e,r,n,t);break e;case 11:e=yb(null,e,r,n,t);break e;case 14:e=wb(null,e,r,rr(r.type,n),t);break e}throw Error(U(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:rr(r,i),Im(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:rr(r,i),_b(n,e,r,i,t);case 3:e:{if(Uk(e),n===null)throw Error(U(387));r=e.pendingProps,a=e.memoizedState,i=a.element,hk(n,e),_d(e,r,null,t);var s=e.memoizedState;if(r=s.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=Xs(Error(U(423)),e),e=bb(n,e,r,t,i);break e}else if(r!==i){i=Xs(Error(U(424)),e),e=bb(n,e,r,t,i);break e}else for(On=Mi(e.stateNode.containerInfo.firstChild),Tn=e,ze=!0,or=null,t=dk(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ks(),r===i){e=ci(n,e,t);break e}Ht(n,e,r,t)}e=e.child}return e;case 5:return pk(e),n===null&&Sm(e),r=e.type,i=e.pendingProps,a=n!==null?n.memoizedProps:null,s=i.children,bm(r,i)?s=null:a!==null&&bm(r,a)&&(e.flags|=32),Mk(n,e),Ht(n,e,s,t),e.child;case 6:return n===null&&Sm(e),null;case 13:return zk(n,e,t);case 4:return Ay(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Js(e,null,r,t):Ht(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:rr(r,i),yb(n,e,r,i,t);case 7:return Ht(n,e,e.pendingProps,t),e.child;case 8:return Ht(n,e,e.pendingProps.children,t),e.child;case 12:return Ht(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,a=e.memoizedProps,s=i.value,De(yd,r._currentValue),r._currentValue=s,a!==null)if(mr(a.value,s)){if(a.children===i.children&&!on.current){e=ci(n,e,t);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var o=a.dependencies;if(o!==null){s=a.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(a.tag===1){l=ii(-1,t&-t),l.tag=2;var u=a.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}a.lanes|=t,l=a.alternate,l!==null&&(l.lanes|=t),Om(a.return,t,e),o.lanes|=t;break}l=l.next}}else if(a.tag===10)s=a.type===e.type?null:a.child;else if(a.tag===18){if(s=a.return,s===null)throw Error(U(341));s.lanes|=t,o=s.alternate,o!==null&&(o.lanes|=t),Om(s,t,e),s=a.sibling}else s=a.child;if(s!==null)s.return=a;else for(s=a;s!==null;){if(s===e){s=null;break}if(a=s.sibling,a!==null){a.return=s.return,s=a;break}s=s.return}a=s}Ht(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,js(e,t),i=Vn(i),r=r(i),e.flags|=1,Ht(n,e,r,t),e.child;case 14:return r=e.type,i=rr(r,e.pendingProps),i=rr(r.type,i),wb(n,e,r,i,t);case 15:return Dk(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:rr(r,i),Bc(n,e),e.tag=1,ln(r)?(n=!0,pd(e)):n=!1,js(e,t),Nk(e,r,i),Pm(e,r,i,t),Cm(null,e,r,!0,n,t);case 19:return Bk(n,e,t);case 22:return Fk(n,e,t)}throw Error(U(156,e.tag))};function iS(n,e){return CE(n,e)}function qI(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Un(n,e,t,r){return new qI(n,e,t,r)}function By(n){return n=n.prototype,!(!n||!n.isReactComponent)}function GI(n){if(typeof n=="function")return By(n)?1:0;if(n!=null){if(n=n.$$typeof,n===oy)return 11;if(n===ly)return 14}return 2}function Hi(n,e){var t=n.alternate;return t===null?(t=Un(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function qc(n,e,t,r,i,a){var s=2;if(r=n,typeof n=="function")By(n)&&(s=1);else if(typeof n=="string")s=5;else e:switch(n){case hs:return Aa(t.children,i,a,e);case sy:s=8,i|=8;break;case Qp:return n=Un(12,t,e,i|2),n.elementType=Qp,n.lanes=a,n;case Yp:return n=Un(13,t,e,i),n.elementType=Yp,n.lanes=a,n;case em:return n=Un(19,t,e,i),n.elementType=em,n.lanes=a,n;case pE:return bf(t,i,a,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case fE:s=10;break e;case hE:s=9;break e;case oy:s=11;break e;case ly:s=14;break e;case ki:s=16,r=null;break e}throw Error(U(130,n==null?n:typeof n,""))}return e=Un(s,t,e,i),e.elementType=n,e.type=r,e.lanes=a,e}function Aa(n,e,t,r){return n=Un(7,n,r,e),n.lanes=t,n}function bf(n,e,t,r){return n=Un(22,n,r,e),n.elementType=pE,n.lanes=t,n.stateNode={isHidden:!1},n}function Dh(n,e,t){return n=Un(6,n,null,e),n.lanes=t,n}function Fh(n,e,t){return e=Un(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function WI(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wh(0),this.expirationTimes=wh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wh(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Hy(n,e,t,r,i,a,s,o,l){return n=new WI(n,e,t,o,l),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Un(3,null,null,e),n.current=a,a.stateNode=n,a.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Oy(a),n}function KI(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fs,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function aS(n){if(!n)return Wi;n=n._reactInternals;e:{if(Va(n)!==n||n.tag!==1)throw Error(U(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ln(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(U(171))}if(n.tag===1){var t=n.type;if(ln(t))return ak(n,t,e)}return e}function sS(n,e,t,r,i,a,s,o,l){return n=Hy(t,r,!0,n,i,a,s,o,l),n.context=aS(null),t=n.current,r=Vt(),i=Bi(t),a=ii(r,i),a.callback=e??null,Ui(t,a,i),n.current.lanes=i,_u(n,i,r),un(n,r),n}function vf(n,e,t,r){var i=e.current,a=Vt(),s=Bi(i);return t=aS(t),e.context===null?e.context=t:e.pendingContext=t,e=ii(a,s),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Ui(i,e,s),n!==null&&(dr(n,i,s,a),Mc(n,i,s)),s}function Ad(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Ib(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Vy(n,e){Ib(n,e),(n=n.alternate)&&Ib(n,e)}function JI(){return null}var oS=typeof reportError=="function"?reportError:function(n){console.error(n)};function qy(n){this._internalRoot=n}xf.prototype.render=qy.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(U(409));vf(n,e,null,null)};xf.prototype.unmount=qy.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Da(function(){vf(null,n,null,null)}),e[li]=null}};function xf(n){this._internalRoot=n}xf.prototype.unstable_scheduleHydration=function(n){if(n){var e=FE();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ii.length&&e!==0&&e<Ii[t].priority;t++);Ii.splice(t,0,n),t===0&&UE(n)}};function Gy(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Ef(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Cb(){}function ZI(n,e,t,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var u=Ad(s);a.call(u)}}var s=sS(e,r,n,0,null,!1,!1,"",Cb);return n._reactRootContainer=s,n[li]=s.current,Fl(n.nodeType===8?n.parentNode:n),Da(),s}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var o=r;r=function(){var u=Ad(l);o.call(u)}}var l=Hy(n,0,!1,null,null,!1,!1,"",Cb);return n._reactRootContainer=l,n[li]=l.current,Fl(n.nodeType===8?n.parentNode:n),Da(function(){vf(e,l,t,r)}),l}function kf(n,e,t,r,i){var a=t._reactRootContainer;if(a){var s=a;if(typeof i=="function"){var o=i;i=function(){var l=Ad(s);o.call(l)}}vf(e,s,n,i)}else s=ZI(t,e,n,i,r);return Ad(s)}LE=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Wo(e.pendingLanes);t!==0&&(dy(e,t|1),un(e,Xe()),!(Oe&6)&&(Qs=Xe()+500,ia()))}break;case 13:Da(function(){var r=ui(n,1);if(r!==null){var i=Vt();dr(r,n,1,i)}}),Vy(n,1)}};fy=function(n){if(n.tag===13){var e=ui(n,134217728);if(e!==null){var t=Vt();dr(e,n,134217728,t)}Vy(n,134217728)}};DE=function(n){if(n.tag===13){var e=Bi(n),t=ui(n,e);if(t!==null){var r=Vt();dr(t,n,e,r)}Vy(n,e)}};FE=function(){return Re};ME=function(n,e){var t=Re;try{return Re=n,e()}finally{Re=t}};cm=function(n,e,t){switch(e){case"input":if(rm(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=pf(r);if(!i)throw Error(U(90));gE(r),rm(r,i)}}}break;case"textarea":wE(n,t);break;case"select":e=t.value,e!=null&&Cs(n,!!t.multiple,e,!1)}};SE=My;OE=Da;var XI={usingClientEntryPoint:!1,Events:[vu,ys,pf,EE,kE,My]},Fo={findFiberByHostInstance:_a,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},QI={bundleType:Fo.bundleType,version:Fo.version,rendererPackageName:Fo.rendererPackageName,rendererConfig:Fo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:fi.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=TE(n),n===null?null:n.stateNode},findFiberByHostInstance:Fo.findFiberByHostInstance||JI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var sc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sc.isDisabled&&sc.supportsFiber)try{cf=sc.inject(QI),Mr=sc}catch{}}$n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XI;$n.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gy(e))throw Error(U(200));return KI(n,e,null,t)};$n.createRoot=function(n,e){if(!Gy(n))throw Error(U(299));var t=!1,r="",i=oS;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Hy(n,1,!1,null,null,t,!1,r,i),n[li]=e.current,Fl(n.nodeType===8?n.parentNode:n),new qy(e)};$n.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(U(188)):(n=Object.keys(n).join(","),Error(U(268,n)));return n=TE(e),n=n===null?null:n.stateNode,n};$n.flushSync=function(n){return Da(n)};$n.hydrate=function(n,e,t){if(!Ef(e))throw Error(U(200));return kf(null,n,e,!0,t)};$n.hydrateRoot=function(n,e,t){if(!Gy(n))throw Error(U(405));var r=t!=null&&t.hydratedSources||null,i=!1,a="",s=oS;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),e=sS(e,null,n,1,t??null,i,!1,a,s),n[li]=e.current,Fl(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new xf(e)};$n.render=function(n,e,t){if(!Ef(e))throw Error(U(200));return kf(null,n,e,!1,t)};$n.unmountComponentAtNode=function(n){if(!Ef(n))throw Error(U(40));return n._reactRootContainer?(Da(function(){kf(null,null,n,!1,function(){n._reactRootContainer=null,n[li]=null})}),!0):!1};$n.unstable_batchedUpdates=My;$n.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Ef(t))throw Error(U(200));if(n==null||n._reactInternals===void 0)throw Error(U(38));return kf(n,e,t,!1,r)};$n.version="18.3.1-next-f1338f8080-20240426";function lS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lS)}catch(n){console.error(n)}}lS(),lE.exports=$n;var YI=lE.exports,uS,Rb=YI;uS=Rb.createRoot,Rb.hydrateRoot;var cS={exports:{}},eC="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",tC=eC,nC=tC;function dS(){}function fS(){}fS.resetWarningCache=dS;var rC=function(){function n(r,i,a,s,o,l){if(l!==nC){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:fS,resetWarningCache:dS};return t.PropTypes=t,t};cS.exports=rC();var iC=cS.exports;const Ne=uo(iC);function qa(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})}const aC=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Ys(n,e,t){const r=sC(n),{webkitRelativePath:i}=n,a=typeof e=="string"?e:typeof i=="string"&&i.length>0?i:`./${n.name}`;return typeof r.path!="string"&&$b(r,"path",a),$b(r,"relativePath",a),r}function sC(n){const{name:e}=n;if(e&&e.lastIndexOf(".")!==-1&&!n.type){const r=e.split(".").pop().toLowerCase(),i=aC.get(r);i&&Object.defineProperty(n,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return n}function $b(n,e,t){Object.defineProperty(n,e,{value:t,writable:!1,configurable:!1,enumerable:!0})}const oC=[".DS_Store","Thumbs.db"];function lC(n){return qa(this,void 0,void 0,function*(){return Pd(n)&&uC(n.dataTransfer)?hC(n.dataTransfer,n.type):cC(n)?dC(n):Array.isArray(n)&&n.every(e=>"getFile"in e&&typeof e.getFile=="function")?fC(n):[]})}function uC(n){return Pd(n)}function cC(n){return Pd(n)&&Pd(n.target)}function Pd(n){return typeof n=="object"&&n!==null}function dC(n){return Hm(n.target.files).map(e=>Ys(e))}function fC(n){return qa(this,void 0,void 0,function*(){return(yield Promise.all(n.map(t=>t.getFile()))).map(t=>Ys(t))})}function hC(n,e){return qa(this,void 0,void 0,function*(){if(n.items){const t=Hm(n.items).filter(i=>i.kind==="file");if(e!=="drop")return t;const r=yield Promise.all(t.map(pC));return Nb(hS(r))}return Nb(Hm(n.files).map(t=>Ys(t)))})}function Nb(n){return n.filter(e=>oC.indexOf(e.name)===-1)}function Hm(n){if(n===null)return[];const e=[];for(let t=0;t<n.length;t++){const r=n[t];e.push(r)}return e}function pC(n){if(typeof n.webkitGetAsEntry!="function")return jb(n);const e=n.webkitGetAsEntry();return e&&e.isDirectory?pS(e):jb(n,e)}function hS(n){return n.reduce((e,t)=>[...e,...Array.isArray(t)?hS(t):[t]],[])}function jb(n,e){return qa(this,void 0,void 0,function*(){var t;if(globalThis.isSecureContext&&typeof n.getAsFileSystemHandle=="function"){const a=yield n.getAsFileSystemHandle();if(a===null)throw new Error(`${n} is not a File`);if(a!==void 0){const s=yield a.getFile();return s.handle=a,Ys(s)}}const r=n.getAsFile();if(!r)throw new Error(`${n} is not a File`);return Ys(r,(t=e==null?void 0:e.fullPath)!==null&&t!==void 0?t:void 0)})}function mC(n){return qa(this,void 0,void 0,function*(){return n.isDirectory?pS(n):gC(n)})}function pS(n){const e=n.createReader();return new Promise((t,r)=>{const i=[];function a(){e.readEntries(s=>qa(this,void 0,void 0,function*(){if(s.length){const o=Promise.all(s.map(mC));i.push(o),a()}else try{const o=yield Promise.all(i);t(o)}catch(o){r(o)}}),s=>{r(s)})}a()})}function gC(n){return qa(this,void 0,void 0,function*(){return new Promise((e,t)=>{n.file(r=>{const i=Ys(r,n.fullPath);e(i)},r=>{t(r)})})})}var Mh=function(n,e){if(n&&e){var t=Array.isArray(e)?e:e.split(",");if(t.length===0)return!0;var r=n.name||"",i=(n.type||"").toLowerCase(),a=i.replace(/\/.*$/,"");return t.some(function(s){var o=s.trim().toLowerCase();return o.charAt(0)==="."?r.toLowerCase().endsWith(o):o.endsWith("/*")?a===o.replace(/\/.*$/,""):i===o})}return!0};function Lb(n){return _C(n)||wC(n)||gS(n)||yC()}function yC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wC(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function _C(n){if(Array.isArray(n))return Vm(n)}function Db(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Fb(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Db(Object(t),!0).forEach(function(r){mS(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Db(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function mS(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Wl(n,e){return xC(n)||vC(n,e)||gS(n,e)||bC()}function bC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gS(n,e){if(n){if(typeof n=="string")return Vm(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vm(n,e)}}function Vm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function vC(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],i=!0,a=!1,s,o;try{for(t=t.call(n);!(i=(s=t.next()).done)&&(r.push(s.value),!(e&&r.length===e));i=!0);}catch(l){a=!0,o=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw o}}return r}}function xC(n){if(Array.isArray(n))return n}var EC=typeof Mh=="function"?Mh:Mh.default,kC="file-invalid-type",SC="file-too-large",OC="file-too-small",AC="too-many-files",PC=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=e.split(","),r=t.length>1?"one of ".concat(t.join(", ")):t[0];return{code:kC,message:"File type must be ".concat(r)}},Mb=function(e){return{code:SC,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},Ub=function(e){return{code:OC,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},TC={code:AC,message:"Too many files"};function yS(n,e){var t=n.type==="application/x-moz-file"||EC(n,e);return[t,t?null:PC(e)]}function wS(n,e,t){if(ha(n.size))if(ha(e)&&ha(t)){if(n.size>t)return[!1,Mb(t)];if(n.size<e)return[!1,Ub(e)]}else{if(ha(e)&&n.size<e)return[!1,Ub(e)];if(ha(t)&&n.size>t)return[!1,Mb(t)]}return[!0,null]}function ha(n){return n!=null}function IC(n){var e=n.files,t=n.accept,r=n.minSize,i=n.maxSize,a=n.multiple,s=n.maxFiles,o=n.validator;return!a&&e.length>1||a&&s>=1&&e.length>s?!1:e.every(function(l){var u=yS(l,t),c=Wl(u,1),d=c[0],f=wS(l,r,i),h=Wl(f,1),p=h[0],m=o?o(l):null;return d&&p&&!m})}function Td(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function oc(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!n.target&&!!n.target.files}function zb(n){n.preventDefault()}function CC(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function RC(n){return n.indexOf("Edge/")!==-1}function $C(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return CC(n)||RC(n)}function Or(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(r){for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return e.some(function(o){return!Td(r)&&o&&o.apply(void 0,[r].concat(a)),Td(r)})}}function NC(){return"showOpenFilePicker"in window}function jC(n){if(ha(n)){var e=Object.entries(n).filter(function(t){var r=Wl(t,2),i=r[0],a=r[1],s=!0;return _S(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),s=!1),(!Array.isArray(a)||!a.every(bS))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),s=!1),s}).reduce(function(t,r){var i=Wl(r,2),a=i[0],s=i[1];return Fb(Fb({},t),{},mS({},a,s))},{});return[{description:"Files",accept:e}]}return n}function LC(n){if(ha(n))return Object.entries(n).reduce(function(e,t){var r=Wl(t,2),i=r[0],a=r[1];return[].concat(Lb(e),[i],Lb(a))},[]).filter(function(e){return _S(e)||bS(e)}).join(",")}function DC(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function FC(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}function _S(n){return n==="audio/*"||n==="video/*"||n==="image/*"||n==="text/*"||n==="application/*"||/\w+\/[-+.\w]+/g.test(n)}function bS(n){return/^.*\.[\w]+$/.test(n)}var MC=["children"],UC=["open"],zC=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],BC=["refKey","onChange","onClick"];function HC(n){return GC(n)||qC(n)||vS(n)||VC()}function VC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qC(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function GC(n){if(Array.isArray(n))return qm(n)}function Uh(n,e){return JC(n)||KC(n,e)||vS(n,e)||WC()}function WC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vS(n,e){if(n){if(typeof n=="string")return qm(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qm(n,e)}}function qm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function KC(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],i=!0,a=!1,s,o;try{for(t=t.call(n);!(i=(s=t.next()).done)&&(r.push(s.value),!(e&&r.length===e));i=!0);}catch(l){a=!0,o=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw o}}return r}}function JC(n){if(Array.isArray(n))return n}function Bb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function He(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Bb(Object(t),!0).forEach(function(r){Gm(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Bb(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Gm(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Id(n,e){if(n==null)return{};var t=ZC(n,e),r,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(i=0;i<a.length;i++)r=a[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function ZC(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,a;for(a=0;a<r.length;a++)i=r[a],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var Wy=he.forwardRef(function(n,e){var t=n.children,r=Id(n,MC),i=ES(r),a=i.open,s=Id(i,UC);return he.useImperativeHandle(e,function(){return{open:a}},[a]),BP.createElement(he.Fragment,null,t(He(He({},s),{},{open:a})))});Wy.displayName="Dropzone";var xS={disabled:!1,getFilesFromEvent:lC,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};Wy.defaultProps=xS;Wy.propTypes={children:Ne.func,accept:Ne.objectOf(Ne.arrayOf(Ne.string)),multiple:Ne.bool,preventDropOnDocument:Ne.bool,noClick:Ne.bool,noKeyboard:Ne.bool,noDrag:Ne.bool,noDragEventsBubbling:Ne.bool,minSize:Ne.number,maxSize:Ne.number,maxFiles:Ne.number,disabled:Ne.bool,getFilesFromEvent:Ne.func,onFileDialogCancel:Ne.func,onFileDialogOpen:Ne.func,useFsAccessApi:Ne.bool,autoFocus:Ne.bool,onDragEnter:Ne.func,onDragLeave:Ne.func,onDragOver:Ne.func,onDrop:Ne.func,onDropAccepted:Ne.func,onDropRejected:Ne.func,onError:Ne.func,validator:Ne.func};var Wm={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function ES(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=He(He({},xS),n),t=e.accept,r=e.disabled,i=e.getFilesFromEvent,a=e.maxSize,s=e.minSize,o=e.multiple,l=e.maxFiles,u=e.onDragEnter,c=e.onDragLeave,d=e.onDragOver,f=e.onDrop,h=e.onDropAccepted,p=e.onDropRejected,m=e.onFileDialogCancel,_=e.onFileDialogOpen,g=e.useFsAccessApi,y=e.autoFocus,w=e.preventDropOnDocument,x=e.noClick,k=e.noKeyboard,E=e.noDrag,P=e.noDragEventsBubbling,R=e.onError,H=e.validator,j=he.useMemo(function(){return LC(t)},[t]),L=he.useMemo(function(){return jC(t)},[t]),V=he.useMemo(function(){return typeof _=="function"?_:Hb},[_]),oe=he.useMemo(function(){return typeof m=="function"?m:Hb},[m]),T=he.useRef(null),S=he.useRef(null),$=he.useReducer(XC,Wm),C=Uh($,2),O=C[0],A=C[1],b=O.isFocused,F=O.isFileDialogActive,N=he.useRef(typeof window<"u"&&window.isSecureContext&&g&&NC()),v=function(){!N.current&&F&&setTimeout(function(){if(S.current){var ne=S.current.files;ne.length||(A({type:"closeDialog"}),oe())}},300)};he.useEffect(function(){return window.addEventListener("focus",v,!1),function(){window.removeEventListener("focus",v,!1)}},[S,F,oe,N]);var Q=he.useRef([]),Z=function(ne){T.current&&T.current.contains(ne.target)||(ne.preventDefault(),Q.current=[])};he.useEffect(function(){return w&&(document.addEventListener("dragover",zb,!1),document.addEventListener("drop",Z,!1)),function(){w&&(document.removeEventListener("dragover",zb),document.removeEventListener("drop",Z))}},[T,w]),he.useEffect(function(){return!r&&y&&T.current&&T.current.focus(),function(){}},[T,y,r]);var re=he.useCallback(function(G){R?R(G):console.error(G)},[R]),Ye=he.useCallback(function(G){G.preventDefault(),G.persist(),la(G),Q.current=[].concat(HC(Q.current),[G.target]),oc(G)&&Promise.resolve(i(G)).then(function(ne){if(!(Td(G)&&!P)){var I=ne.length,D=I>0&&IC({files:ne,accept:j,minSize:s,maxSize:a,multiple:o,maxFiles:l,validator:H}),Y=I>0&&!D;A({isDragAccept:D,isDragReject:Y,isDragActive:!0,type:"setDraggedFiles"}),u&&u(G)}}).catch(function(ne){return re(ne)})},[i,u,re,P,j,s,a,o,l,H]),Zt=he.useCallback(function(G){G.preventDefault(),G.persist(),la(G);var ne=oc(G);if(ne&&G.dataTransfer)try{G.dataTransfer.dropEffect="copy"}catch{}return ne&&d&&d(G),!1},[d,P]),gn=he.useCallback(function(G){G.preventDefault(),G.persist(),la(G);var ne=Q.current.filter(function(D){return T.current&&T.current.contains(D)}),I=ne.indexOf(G.target);I!==-1&&ne.splice(I,1),Q.current=ne,!(ne.length>0)&&(A({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),oc(G)&&c&&c(G))},[T,c,P]),Ft=he.useCallback(function(G,ne){var I=[],D=[];G.forEach(function(Y){var de=yS(Y,j),ke=Uh(de,2),Mt=ke[0],Jn=ke[1],yn=wS(Y,s,a),Er=Uh(yn,2),Gr=Er[0],yt=Er[1],kr=H?H(Y):null;if(Mt&&Gr&&!kr)I.push(Y);else{var wn=[Jn,yt];kr&&(wn=wn.concat(kr)),D.push({file:Y,errors:wn.filter(function(EP){return EP})})}}),(!o&&I.length>1||o&&l>=1&&I.length>l)&&(I.forEach(function(Y){D.push({file:Y,errors:[TC]})}),I.splice(0)),A({acceptedFiles:I,fileRejections:D,isDragReject:D.length>0,type:"setFiles"}),f&&f(I,D,ne),D.length>0&&p&&p(D,ne),I.length>0&&h&&h(I,ne)},[A,o,j,s,a,l,f,h,p,H]),Kn=he.useCallback(function(G){G.preventDefault(),G.persist(),la(G),Q.current=[],oc(G)&&Promise.resolve(i(G)).then(function(ne){Td(G)&&!P||Ft(ne,G)}).catch(function(ne){return re(ne)}),A({type:"reset"})},[i,Ft,re,P]),hi=he.useCallback(function(){if(N.current){A({type:"openDialog"}),V();var G={multiple:o,types:L};window.showOpenFilePicker(G).then(function(ne){return i(ne)}).then(function(ne){Ft(ne,null),A({type:"closeDialog"})}).catch(function(ne){DC(ne)?(oe(ne),A({type:"closeDialog"})):FC(ne)?(N.current=!1,S.current?(S.current.value=null,S.current.click()):re(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):re(ne)});return}S.current&&(A({type:"openDialog"}),V(),S.current.value=null,S.current.click())},[A,V,oe,g,Ft,re,L,o]),Bu=he.useCallback(function(G){!T.current||!T.current.isEqualNode(G.target)||(G.key===" "||G.key==="Enter"||G.keyCode===32||G.keyCode===13)&&(G.preventDefault(),hi())},[T,hi]),Hu=he.useCallback(function(){A({type:"focus"})},[]),Po=he.useCallback(function(){A({type:"blur"})},[]),To=he.useCallback(function(){x||($C()?setTimeout(hi,0):hi())},[x,hi]),qr=function(ne){return r?null:ne},Io=function(ne){return k?null:qr(ne)},oa=function(ne){return E?null:qr(ne)},la=function(ne){P&&ne.stopPropagation()},ch=he.useMemo(function(){return function(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ne=G.refKey,I=ne===void 0?"ref":ne,D=G.role,Y=G.onKeyDown,de=G.onFocus,ke=G.onBlur,Mt=G.onClick,Jn=G.onDragEnter,yn=G.onDragOver,Er=G.onDragLeave,Gr=G.onDrop,yt=Id(G,zC);return He(He(Gm({onKeyDown:Io(Or(Y,Bu)),onFocus:Io(Or(de,Hu)),onBlur:Io(Or(ke,Po)),onClick:qr(Or(Mt,To)),onDragEnter:oa(Or(Jn,Ye)),onDragOver:oa(Or(yn,Zt)),onDragLeave:oa(Or(Er,gn)),onDrop:oa(Or(Gr,Kn)),role:typeof D=="string"&&D!==""?D:"presentation"},I,T),!r&&!k?{tabIndex:0}:{}),yt)}},[T,Bu,Hu,Po,To,Ye,Zt,gn,Kn,k,E,r]),dh=he.useCallback(function(G){G.stopPropagation()},[]),fh=he.useMemo(function(){return function(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ne=G.refKey,I=ne===void 0?"ref":ne,D=G.onChange,Y=G.onClick,de=Id(G,BC),ke=Gm({accept:j,multiple:o,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:qr(Or(D,Kn)),onClick:qr(Or(Y,dh)),tabIndex:-1},I,S);return He(He({},ke),de)}},[S,t,o,Kn,r]);return He(He({},O),{},{isFocused:b&&!r,getRootProps:ch,getInputProps:fh,rootRef:T,inputRef:S,open:qr(hi)})}function XC(n,e){switch(e.type){case"focus":return He(He({},n),{},{isFocused:!0});case"blur":return He(He({},n),{},{isFocused:!1});case"openDialog":return He(He({},Wm),{},{isFileDialogActive:!0});case"closeDialog":return He(He({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":return He(He({},n),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return He(He({},n),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return He({},Wm);default:return n}}function Hb(){}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var QC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YC=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Sf=(n,e)=>{const t=he.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:o="",children:l,...u},c)=>he.createElement("svg",{ref:c,...QC,width:i,height:i,stroke:r,strokeWidth:s?Number(a)*24/Number(i):a,className:["lucide",`lucide-${YC(n)}`,o].join(" "),...u},[...e.map(([d,f])=>he.createElement(d,f)),...Array.isArray(l)?l:[l]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eR=Sf("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tR=Sf("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nR=Sf("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rR=Sf("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function iR({onFileSelect:n}){const e=he.useCallback(a=>{a.length>0&&n(a[0])},[n]),{getRootProps:t,getInputProps:r,isDragActive:i}=ES({onDrop:e,accept:{"text/plain":[".txt"],"application/pdf":[".pdf"]},maxFiles:1});return ie.jsxs("div",{...t(),className:`p-8 border-2 border-dashed rounded-lg cursor-pointer transition-colors
        ${i?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400"}`,children:[ie.jsx("input",{...r()}),ie.jsxs("div",{className:"flex flex-col items-center text-gray-600",children:[ie.jsx(rR,{className:"w-12 h-12 mb-4"}),i?ie.jsx("p",{children:"Drop the file here..."}):ie.jsxs(ie.Fragment,{children:[ie.jsx("p",{className:"font-medium",children:"Drag & drop a file here, or click to select"}),ie.jsx("p",{className:"text-sm mt-2",children:"Supports PDF and TXT files"})]})]})]})}function aR(n,e){const t={};return(n[n.length-1]===""?[...n,""]:n).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const sR=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,oR=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,lR={};function Vb(n,e){return(lR.jsx?oR:sR).test(n)}const uR=/[ \t\n\f\r]/g;function cR(n){return typeof n=="object"?n.type==="text"?qb(n.value):!1:qb(n)}function qb(n){return n.replace(uR,"")===""}class Eu{constructor(e,t,r){this.property=e,this.normal=t,r&&(this.space=r)}}Eu.prototype.property={};Eu.prototype.normal={};Eu.prototype.space=null;function kS(n,e){const t={},r={};let i=-1;for(;++i<n.length;)Object.assign(t,n[i].property),Object.assign(r,n[i].normal);return new Eu(t,r,e)}function Km(n){return n.toLowerCase()}class Wn{constructor(e,t){this.property=e,this.attribute=t}}Wn.prototype.space=null;Wn.prototype.boolean=!1;Wn.prototype.booleanish=!1;Wn.prototype.overloadedBoolean=!1;Wn.prototype.number=!1;Wn.prototype.commaSeparated=!1;Wn.prototype.spaceSeparated=!1;Wn.prototype.commaOrSpaceSeparated=!1;Wn.prototype.mustUseProperty=!1;Wn.prototype.defined=!1;let dR=0;const ue=Ga(),et=Ga(),SS=Ga(),z=Ga(),Le=Ga(),Ds=Ga(),bn=Ga();function Ga(){return 2**++dR}const Jm=Object.freeze(Object.defineProperty({__proto__:null,boolean:ue,booleanish:et,commaOrSpaceSeparated:bn,commaSeparated:Ds,number:z,overloadedBoolean:SS,spaceSeparated:Le},Symbol.toStringTag,{value:"Module"})),zh=Object.keys(Jm);class Ky extends Wn{constructor(e,t,r,i){let a=-1;if(super(e,t),Gb(this,"space",i),typeof r=="number")for(;++a<zh.length;){const s=zh[a];Gb(this,zh[a],(r&Jm[s])===Jm[s])}}}Ky.prototype.defined=!0;function Gb(n,e,t){t&&(n[e]=t)}const fR={}.hasOwnProperty;function po(n){const e={},t={};let r;for(r in n.properties)if(fR.call(n.properties,r)){const i=n.properties[r],a=new Ky(r,n.transform(n.attributes||{},r),i,n.space);n.mustUseProperty&&n.mustUseProperty.includes(r)&&(a.mustUseProperty=!0),e[r]=a,t[Km(r)]=r,t[Km(a.attribute)]=r}return new Eu(e,t,n.space)}const OS=po({space:"xlink",transform(n,e){return"xlink:"+e.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),AS=po({space:"xml",transform(n,e){return"xml:"+e.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function PS(n,e){return e in n?n[e]:e}function TS(n,e){return PS(n,e.toLowerCase())}const IS=po({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:TS,properties:{xmlns:null,xmlnsXLink:null}}),CS=po({transform(n,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:et,ariaAutoComplete:null,ariaBusy:et,ariaChecked:et,ariaColCount:z,ariaColIndex:z,ariaColSpan:z,ariaControls:Le,ariaCurrent:null,ariaDescribedBy:Le,ariaDetails:null,ariaDisabled:et,ariaDropEffect:Le,ariaErrorMessage:null,ariaExpanded:et,ariaFlowTo:Le,ariaGrabbed:et,ariaHasPopup:null,ariaHidden:et,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Le,ariaLevel:z,ariaLive:null,ariaModal:et,ariaMultiLine:et,ariaMultiSelectable:et,ariaOrientation:null,ariaOwns:Le,ariaPlaceholder:null,ariaPosInSet:z,ariaPressed:et,ariaReadOnly:et,ariaRelevant:null,ariaRequired:et,ariaRoleDescription:Le,ariaRowCount:z,ariaRowIndex:z,ariaRowSpan:z,ariaSelected:et,ariaSetSize:z,ariaSort:null,ariaValueMax:z,ariaValueMin:z,ariaValueNow:z,ariaValueText:null,role:null}}),hR=po({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:TS,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Ds,acceptCharset:Le,accessKey:Le,action:null,allow:null,allowFullScreen:ue,allowPaymentRequest:ue,allowUserMedia:ue,alt:null,as:null,async:ue,autoCapitalize:null,autoComplete:Le,autoFocus:ue,autoPlay:ue,blocking:Le,capture:null,charSet:null,checked:ue,cite:null,className:Le,cols:z,colSpan:null,content:null,contentEditable:et,controls:ue,controlsList:Le,coords:z|Ds,crossOrigin:null,data:null,dateTime:null,decoding:null,default:ue,defer:ue,dir:null,dirName:null,disabled:ue,download:SS,draggable:et,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:ue,formTarget:null,headers:Le,height:z,hidden:ue,high:z,href:null,hrefLang:null,htmlFor:Le,httpEquiv:Le,id:null,imageSizes:null,imageSrcSet:null,inert:ue,inputMode:null,integrity:null,is:null,isMap:ue,itemId:null,itemProp:Le,itemRef:Le,itemScope:ue,itemType:Le,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:ue,low:z,manifest:null,max:null,maxLength:z,media:null,method:null,min:null,minLength:z,multiple:ue,muted:ue,name:null,nonce:null,noModule:ue,noValidate:ue,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:ue,optimum:z,pattern:null,ping:Le,placeholder:null,playsInline:ue,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:ue,referrerPolicy:null,rel:Le,required:ue,reversed:ue,rows:z,rowSpan:z,sandbox:Le,scope:null,scoped:ue,seamless:ue,selected:ue,shadowRootClonable:ue,shadowRootDelegatesFocus:ue,shadowRootMode:null,shape:null,size:z,sizes:null,slot:null,span:z,spellCheck:et,src:null,srcDoc:null,srcLang:null,srcSet:null,start:z,step:null,style:null,tabIndex:z,target:null,title:null,translate:null,type:null,typeMustMatch:ue,useMap:null,value:et,width:z,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Le,axis:null,background:null,bgColor:null,border:z,borderColor:null,bottomMargin:z,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:ue,declare:ue,event:null,face:null,frame:null,frameBorder:null,hSpace:z,leftMargin:z,link:null,longDesc:null,lowSrc:null,marginHeight:z,marginWidth:z,noResize:ue,noHref:ue,noShade:ue,noWrap:ue,object:null,profile:null,prompt:null,rev:null,rightMargin:z,rules:null,scheme:null,scrolling:et,standby:null,summary:null,text:null,topMargin:z,valueType:null,version:null,vAlign:null,vLink:null,vSpace:z,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:ue,disableRemotePlayback:ue,prefix:null,property:null,results:z,security:null,unselectable:null}}),pR=po({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:PS,properties:{about:bn,accentHeight:z,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:z,amplitude:z,arabicForm:null,ascent:z,attributeName:null,attributeType:null,azimuth:z,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:z,by:null,calcMode:null,capHeight:z,className:Le,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:z,diffuseConstant:z,direction:null,display:null,dur:null,divisor:z,dominantBaseline:null,download:ue,dx:null,dy:null,edgeMode:null,editable:null,elevation:z,enableBackground:null,end:null,event:null,exponent:z,externalResourcesRequired:null,fill:null,fillOpacity:z,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Ds,g2:Ds,glyphName:Ds,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:z,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:z,horizOriginX:z,horizOriginY:z,id:null,ideographic:z,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:z,k:z,k1:z,k2:z,k3:z,k4:z,kernelMatrix:bn,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:z,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:z,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:z,overlineThickness:z,paintOrder:null,panose1:null,path:null,pathLength:z,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Le,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:z,pointsAtY:z,pointsAtZ:z,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:bn,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:bn,rev:bn,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:bn,requiredFeatures:bn,requiredFonts:bn,requiredFormats:bn,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:z,specularExponent:z,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:z,strikethroughThickness:z,string:null,stroke:null,strokeDashArray:bn,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:z,strokeOpacity:z,strokeWidth:null,style:null,surfaceScale:z,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:bn,tabIndex:z,tableValues:null,target:null,targetX:z,targetY:z,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:bn,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:z,underlineThickness:z,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:z,values:null,vAlphabetic:z,vMathematical:z,vectorEffect:null,vHanging:z,vIdeographic:z,version:null,vertAdvY:z,vertOriginX:z,vertOriginY:z,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:z,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),mR=/^data[-\w.:]+$/i,Wb=/-[a-z]/g,gR=/[A-Z]/g;function yR(n,e){const t=Km(e);let r=e,i=Wn;if(t in n.normal)return n.property[n.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&mR.test(e)){if(e.charAt(4)==="-"){const a=e.slice(5).replace(Wb,_R);r="data"+a.charAt(0).toUpperCase()+a.slice(1)}else{const a=e.slice(4);if(!Wb.test(a)){let s=a.replace(gR,wR);s.charAt(0)!=="-"&&(s="-"+s),e="data"+s}}i=Ky}return new i(r,e)}function wR(n){return"-"+n.toLowerCase()}function _R(n){return n.charAt(1).toUpperCase()}const bR={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},vR=kS([AS,OS,IS,CS,hR],"html"),Jy=kS([AS,OS,IS,CS,pR],"svg");function xR(n){return n.join(" ").trim()}var RS={},Kb=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,ER=/\n/g,kR=/^\s*/,SR=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,OR=/^:\s*/,AR=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,PR=/^[;\s]*/,TR=/^\s+|\s+$/g,IR=`
`,Jb="/",Zb="*",pa="",CR="comment",RR="declaration",$R=function(n,e){if(typeof n!="string")throw new TypeError("First argument must be a string");if(!n)return[];e=e||{};var t=1,r=1;function i(p){var m=p.match(ER);m&&(t+=m.length);var _=p.lastIndexOf(IR);r=~_?p.length-_:r+p.length}function a(){var p={line:t,column:r};return function(m){return m.position=new s(p),u(),m}}function s(p){this.start=p,this.end={line:t,column:r},this.source=e.source}s.prototype.content=n;function o(p){var m=new Error(e.source+":"+t+":"+r+": "+p);if(m.reason=p,m.filename=e.source,m.line=t,m.column=r,m.source=n,!e.silent)throw m}function l(p){var m=p.exec(n);if(m){var _=m[0];return i(_),n=n.slice(_.length),m}}function u(){l(kR)}function c(p){var m;for(p=p||[];m=d();)m!==!1&&p.push(m);return p}function d(){var p=a();if(!(Jb!=n.charAt(0)||Zb!=n.charAt(1))){for(var m=2;pa!=n.charAt(m)&&(Zb!=n.charAt(m)||Jb!=n.charAt(m+1));)++m;if(m+=2,pa===n.charAt(m-1))return o("End of comment missing");var _=n.slice(2,m-2);return r+=2,i(_),n=n.slice(m),r+=2,p({type:CR,comment:_})}}function f(){var p=a(),m=l(SR);if(m){if(d(),!l(OR))return o("property missing ':'");var _=l(AR),g=p({type:RR,property:Xb(m[0].replace(Kb,pa)),value:_?Xb(_[0].replace(Kb,pa)):pa});return l(PR),g}}function h(){var p=[];c(p);for(var m;m=f();)m!==!1&&(p.push(m),c(p));return p}return u(),h()};function Xb(n){return n?n.replace(TR,pa):pa}var NR=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(RS,"__esModule",{value:!0});var Qb=RS.default=LR,jR=NR($R);function LR(n,e){var t=null;if(!n||typeof n!="string")return t;var r=(0,jR.default)(n),i=typeof e=="function";return r.forEach(function(a){if(a.type==="declaration"){var s=a.property,o=a.value;i?e(s,o,a):o&&(t=t||{},t[s]=o)}}),t}const DR=Qb.default||Qb,$S=NS("end"),Zy=NS("start");function NS(n){return e;function e(t){const r=t&&t.position&&t.position[n]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function FR(n){const e=Zy(n),t=$S(n);if(e&&t)return{start:e,end:t}}function ml(n){return!n||typeof n!="object"?"":"position"in n||"type"in n?Yb(n.position):"start"in n||"end"in n?Yb(n):"line"in n||"column"in n?Zm(n):""}function Zm(n){return ev(n&&n.line)+":"+ev(n&&n.column)}function Yb(n){return Zm(n&&n.start)+"-"+Zm(n&&n.end)}function ev(n){return n&&typeof n=="number"?n:1}class Dt extends Error{constructor(e,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let i="",a={},s=!1;if(t&&("line"in t&&"column"in t?a={place:t}:"start"in t&&"end"in t?a={place:t}:"type"in t?a={ancestors:[t],place:t.position}:a={...t}),typeof e=="string"?i=e:!a.cause&&e&&(s=!0,i=e.message,a.cause=e),!a.ruleId&&!a.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?a.ruleId=r:(a.source=r.slice(0,l),a.ruleId=r.slice(l+1))}if(!a.place&&a.ancestors&&a.ancestors){const l=a.ancestors[a.ancestors.length-1];l&&(a.place=l.position)}const o=a.place&&"start"in a.place?a.place.start:a.place;this.ancestors=a.ancestors||void 0,this.cause=a.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file,this.message=i,this.line=o?o.line:void 0,this.name=ml(a.place)||"1:1",this.place=a.place||void 0,this.reason=this.message,this.ruleId=a.ruleId||void 0,this.source=a.source||void 0,this.stack=s&&a.cause&&typeof a.cause.stack=="string"?a.cause.stack:"",this.actual,this.expected,this.note,this.url}}Dt.prototype.file="";Dt.prototype.name="";Dt.prototype.reason="";Dt.prototype.message="";Dt.prototype.stack="";Dt.prototype.column=void 0;Dt.prototype.line=void 0;Dt.prototype.ancestors=void 0;Dt.prototype.cause=void 0;Dt.prototype.fatal=void 0;Dt.prototype.place=void 0;Dt.prototype.ruleId=void 0;Dt.prototype.source=void 0;const Xy={}.hasOwnProperty,MR=new Map,UR=/[A-Z]/g,zR=/-([a-z])/g,BR=new Set(["table","tbody","thead","tfoot","tr"]),HR=new Set(["td","th"]),jS="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function VR(n,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const t=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=QR(t,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=XR(t,e.jsx,e.jsxs)}const i={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:t,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?Jy:vR,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},a=LS(i,n,void 0);return a&&typeof a!="string"?a:i.create(n,i.Fragment,{children:a||void 0},void 0)}function LS(n,e,t){if(e.type==="element")return qR(n,e,t);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return GR(n,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return KR(n,e,t);if(e.type==="mdxjsEsm")return WR(n,e);if(e.type==="root")return JR(n,e,t);if(e.type==="text")return ZR(n,e)}function qR(n,e,t){const r=n.schema;let i=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(i=Jy,n.schema=i),n.ancestors.push(e);const a=FS(n,e.tagName,!1),s=YR(n,e);let o=Yy(n,e);return BR.has(e.tagName)&&(o=o.filter(function(l){return typeof l=="string"?!cR(l):!0})),DS(n,s,a,e),Qy(s,o),n.ancestors.pop(),n.schema=r,n.create(e,a,s,t)}function GR(n,e){if(e.data&&e.data.estree&&n.evaluater){const r=e.data.estree.body[0];return r.type,n.evaluater.evaluateExpression(r.expression)}Kl(n,e.position)}function WR(n,e){if(e.data&&e.data.estree&&n.evaluater)return n.evaluater.evaluateProgram(e.data.estree);Kl(n,e.position)}function KR(n,e,t){const r=n.schema;let i=r;e.name==="svg"&&r.space==="html"&&(i=Jy,n.schema=i),n.ancestors.push(e);const a=e.name===null?n.Fragment:FS(n,e.name,!0),s=e$(n,e),o=Yy(n,e);return DS(n,s,a,e),Qy(s,o),n.ancestors.pop(),n.schema=r,n.create(e,a,s,t)}function JR(n,e,t){const r={};return Qy(r,Yy(n,e)),n.create(e,n.Fragment,r,t)}function ZR(n,e){return e.value}function DS(n,e,t,r){typeof t!="string"&&t!==n.Fragment&&n.passNode&&(e.node=r)}function Qy(n,e){if(e.length>0){const t=e.length>1?e:e[0];t&&(n.children=t)}}function XR(n,e,t){return r;function r(i,a,s,o){const u=Array.isArray(s.children)?t:e;return o?u(a,s,o):u(a,s)}}function QR(n,e){return t;function t(r,i,a,s){const o=Array.isArray(a.children),l=Zy(r);return e(i,a,s,o,{columnNumber:l?l.column-1:void 0,fileName:n,lineNumber:l?l.line:void 0},void 0)}}function YR(n,e){const t={};let r,i;for(i in e.properties)if(i!=="children"&&Xy.call(e.properties,i)){const a=t$(n,i,e.properties[i]);if(a){const[s,o]=a;n.tableCellAlignToStyle&&s==="align"&&typeof o=="string"&&HR.has(e.tagName)?r=o:t[s]=o}}if(r){const a=t.style||(t.style={});a[n.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return t}function e$(n,e){const t={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&n.evaluater){const a=r.data.estree.body[0];a.type;const s=a.expression;s.type;const o=s.properties[0];o.type,Object.assign(t,n.evaluater.evaluateExpression(o.argument))}else Kl(n,e.position);else{const i=r.name;let a;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&n.evaluater){const o=r.value.data.estree.body[0];o.type,a=n.evaluater.evaluateExpression(o.expression)}else Kl(n,e.position);else a=r.value===null?!0:r.value;t[i]=a}return t}function Yy(n,e){const t=[];let r=-1;const i=n.passKeys?new Map:MR;for(;++r<e.children.length;){const a=e.children[r];let s;if(n.passKeys){const l=a.type==="element"?a.tagName:a.type==="mdxJsxFlowElement"||a.type==="mdxJsxTextElement"?a.name:void 0;if(l){const u=i.get(l)||0;s=l+"-"+u,i.set(l,u+1)}}const o=LS(n,a,s);o!==void 0&&t.push(o)}return t}function t$(n,e,t){const r=yR(n.schema,e);if(!(t==null||typeof t=="number"&&Number.isNaN(t))){if(Array.isArray(t)&&(t=r.commaSeparated?aR(t):xR(t)),r.property==="style"){let i=typeof t=="object"?t:n$(n,String(t));return n.stylePropertyNameCase==="css"&&(i=r$(i)),["style",i]}return[n.elementAttributeNameCase==="react"&&r.space?bR[r.property]||r.property:r.attribute,t]}}function n$(n,e){const t={};try{DR(e,r)}catch(i){if(!n.ignoreInvalidStyle){const a=i,s=new Dt("Cannot parse `style` attribute",{ancestors:n.ancestors,cause:a,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=n.filePath||void 0,s.url=jS+"#cannot-parse-style-attribute",s}}return t;function r(i,a){let s=i;s.slice(0,2)!=="--"&&(s.slice(0,4)==="-ms-"&&(s="ms-"+s.slice(4)),s=s.replace(zR,a$)),t[s]=a}}function FS(n,e,t){let r;if(!t)r={type:"Literal",value:e};else if(e.includes(".")){const i=e.split(".");let a=-1,s;for(;++a<i.length;){const o=Vb(i[a])?{type:"Identifier",name:i[a]}:{type:"Literal",value:i[a]};s=s?{type:"MemberExpression",object:s,property:o,computed:!!(a&&o.type==="Literal"),optional:!1}:o}r=s}else r=Vb(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const i=r.value;return Xy.call(n.components,i)?n.components[i]:i}if(n.evaluater)return n.evaluater.evaluateExpression(r);Kl(n)}function Kl(n,e){const t=new Dt("Cannot handle MDX estrees without `createEvaluater`",{ancestors:n.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw t.file=n.filePath||void 0,t.url=jS+"#cannot-handle-mdx-estrees-without-createevaluater",t}function r$(n){const e={};let t;for(t in n)Xy.call(n,t)&&(e[i$(t)]=n[t]);return e}function i$(n){let e=n.replace(UR,s$);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function a$(n,e){return e.toUpperCase()}function s$(n){return"-"+n.toLowerCase()}const Bh={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},o$={};function l$(n,e){const t=o$,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,i=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return MS(n,r,i)}function MS(n,e,t){if(u$(n)){if("value"in n)return n.type==="html"&&!t?"":n.value;if(e&&"alt"in n&&n.alt)return n.alt;if("children"in n)return tv(n.children,e,t)}return Array.isArray(n)?tv(n,e,t):""}function tv(n,e,t){const r=[];let i=-1;for(;++i<n.length;)r[i]=MS(n[i],e,t);return r.join("")}function u$(n){return!!(n&&typeof n=="object")}const nv=document.createElement("i");function ew(n){const e="&"+n+";";nv.innerHTML=e;const t=nv.textContent;return t.charCodeAt(t.length-1)===59&&n!=="semi"||t===e?!1:t}function Br(n,e,t,r){const i=n.length;let a=0,s;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,t=t>0?t:0,r.length<1e4)s=Array.from(r),s.unshift(e,t),n.splice(...s);else for(t&&n.splice(e,t);a<r.length;)s=r.slice(a,a+1e4),s.unshift(e,0),n.splice(...s),a+=1e4,e+=1e4}function Mn(n,e){return n.length>0?(Br(n,n.length,0,e),n):e}const rv={}.hasOwnProperty;function c$(n){const e={};let t=-1;for(;++t<n.length;)d$(e,n[t]);return e}function d$(n,e){let t;for(t in e){const i=(rv.call(n,t)?n[t]:void 0)||(n[t]={}),a=e[t];let s;if(a)for(s in a){rv.call(i,s)||(i[s]=[]);const o=a[s];f$(i[s],Array.isArray(o)?o:o?[o]:[])}}}function f$(n,e){let t=-1;const r=[];for(;++t<e.length;)(e[t].add==="after"?n:r).push(e[t]);Br(n,0,0,r)}function US(n,e){const t=Number.parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"�":String.fromCodePoint(t)}function Fs(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Lr=aa(/[A-Za-z]/),An=aa(/[\dA-Za-z]/),h$=aa(/[#-'*+\--9=?A-Z^-~]/);function Xm(n){return n!==null&&(n<32||n===127)}const Qm=aa(/\d/),p$=aa(/[\dA-Fa-f]/),m$=aa(/[!-/:-@[-`{-~]/);function se(n){return n!==null&&n<-2}function cn(n){return n!==null&&(n<0||n===32)}function Ae(n){return n===-2||n===-1||n===32}const g$=aa(new RegExp("\\p{P}|\\p{S}","u")),y$=aa(/\s/);function aa(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}function mo(n){const e=[];let t=-1,r=0,i=0;for(;++t<n.length;){const a=n.charCodeAt(t);let s="";if(a===37&&An(n.charCodeAt(t+1))&&An(n.charCodeAt(t+2)))i=2;else if(a<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(a))||(s=String.fromCharCode(a));else if(a>55295&&a<57344){const o=n.charCodeAt(t+1);a<56320&&o>56319&&o<57344?(s=String.fromCharCode(a,o),i=1):s="�"}else s=String.fromCharCode(a);s&&(e.push(n.slice(r,t),encodeURIComponent(s)),r=t+i+1,s=""),i&&(t+=i,i=0)}return e.join("")+n.slice(r)}function Fe(n,e,t,r){const i=r?r-1:Number.POSITIVE_INFINITY;let a=0;return s;function s(l){return Ae(l)?(n.enter(t),o(l)):e(l)}function o(l){return Ae(l)&&a++<i?(n.consume(l),o):(n.exit(t),e(l))}}const w$={tokenize:_$};function _$(n){const e=n.attempt(this.parser.constructs.contentInitial,r,i);let t;return e;function r(o){if(o===null){n.consume(o);return}return n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),Fe(n,e,"linePrefix")}function i(o){return n.enter("paragraph"),a(o)}function a(o){const l=n.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=l),t=l,s(o)}function s(o){if(o===null){n.exit("chunkText"),n.exit("paragraph"),n.consume(o);return}return se(o)?(n.consume(o),n.exit("chunkText"),a):(n.consume(o),s)}}const b$={tokenize:v$},iv={tokenize:x$};function v$(n){const e=this,t=[];let r=0,i,a,s;return o;function o(w){if(r<t.length){const x=t[r];return e.containerState=x[1],n.attempt(x[0].continuation,l,u)(w)}return u(w)}function l(w){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,i&&y();const x=e.events.length;let k=x,E;for(;k--;)if(e.events[k][0]==="exit"&&e.events[k][1].type==="chunkFlow"){E=e.events[k][1].end;break}g(r);let P=x;for(;P<e.events.length;)e.events[P][1].end={...E},P++;return Br(e.events,k+1,0,e.events.slice(x)),e.events.length=P,u(w)}return o(w)}function u(w){if(r===t.length){if(!i)return f(w);if(i.currentConstruct&&i.currentConstruct.concrete)return p(w);e.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return e.containerState={},n.check(iv,c,d)(w)}function c(w){return i&&y(),g(r),f(w)}function d(w){return e.parser.lazy[e.now().line]=r!==t.length,s=e.now().offset,p(w)}function f(w){return e.containerState={},n.attempt(iv,h,p)(w)}function h(w){return r++,t.push([e.currentConstruct,e.containerState]),f(w)}function p(w){if(w===null){i&&y(),g(0),n.consume(w);return}return i=i||e.parser.flow(e.now()),n.enter("chunkFlow",{_tokenizer:i,contentType:"flow",previous:a}),m(w)}function m(w){if(w===null){_(n.exit("chunkFlow"),!0),g(0),n.consume(w);return}return se(w)?(n.consume(w),_(n.exit("chunkFlow")),r=0,e.interrupt=void 0,o):(n.consume(w),m)}function _(w,x){const k=e.sliceStream(w);if(x&&k.push(null),w.previous=a,a&&(a.next=w),a=w,i.defineSkip(w.start),i.write(k),e.parser.lazy[w.start.line]){let E=i.events.length;for(;E--;)if(i.events[E][1].start.offset<s&&(!i.events[E][1].end||i.events[E][1].end.offset>s))return;const P=e.events.length;let R=P,H,j;for(;R--;)if(e.events[R][0]==="exit"&&e.events[R][1].type==="chunkFlow"){if(H){j=e.events[R][1].end;break}H=!0}for(g(r),E=P;E<e.events.length;)e.events[E][1].end={...j},E++;Br(e.events,R+1,0,e.events.slice(P)),e.events.length=E}}function g(w){let x=t.length;for(;x-- >w;){const k=t[x];e.containerState=k[1],k[0].exit.call(e,n)}t.length=w}function y(){i.write([null]),a=void 0,i=void 0,e.containerState._closeFlow=void 0}}function x$(n,e,t){return Fe(n,n.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function av(n){if(n===null||cn(n)||y$(n))return 1;if(g$(n))return 2}function tw(n,e,t){const r=[];let i=-1;for(;++i<n.length;){const a=n[i].resolveAll;a&&!r.includes(a)&&(e=a(e,t),r.push(a))}return e}const Ym={name:"attention",resolveAll:E$,tokenize:k$};function E$(n,e){let t=-1,r,i,a,s,o,l,u,c;for(;++t<n.length;)if(n[t][0]==="enter"&&n[t][1].type==="attentionSequence"&&n[t][1]._close){for(r=t;r--;)if(n[r][0]==="exit"&&n[r][1].type==="attentionSequence"&&n[r][1]._open&&e.sliceSerialize(n[r][1]).charCodeAt(0)===e.sliceSerialize(n[t][1]).charCodeAt(0)){if((n[r][1]._close||n[t][1]._open)&&(n[t][1].end.offset-n[t][1].start.offset)%3&&!((n[r][1].end.offset-n[r][1].start.offset+n[t][1].end.offset-n[t][1].start.offset)%3))continue;l=n[r][1].end.offset-n[r][1].start.offset>1&&n[t][1].end.offset-n[t][1].start.offset>1?2:1;const d={...n[r][1].end},f={...n[t][1].start};sv(d,-l),sv(f,l),s={type:l>1?"strongSequence":"emphasisSequence",start:d,end:{...n[r][1].end}},o={type:l>1?"strongSequence":"emphasisSequence",start:{...n[t][1].start},end:f},a={type:l>1?"strongText":"emphasisText",start:{...n[r][1].end},end:{...n[t][1].start}},i={type:l>1?"strong":"emphasis",start:{...s.start},end:{...o.end}},n[r][1].end={...s.start},n[t][1].start={...o.end},u=[],n[r][1].end.offset-n[r][1].start.offset&&(u=Mn(u,[["enter",n[r][1],e],["exit",n[r][1],e]])),u=Mn(u,[["enter",i,e],["enter",s,e],["exit",s,e],["enter",a,e]]),u=Mn(u,tw(e.parser.constructs.insideSpan.null,n.slice(r+1,t),e)),u=Mn(u,[["exit",a,e],["enter",o,e],["exit",o,e],["exit",i,e]]),n[t][1].end.offset-n[t][1].start.offset?(c=2,u=Mn(u,[["enter",n[t][1],e],["exit",n[t][1],e]])):c=0,Br(n,r-1,t-r+3,u),t=r+u.length-c-2;break}}for(t=-1;++t<n.length;)n[t][1].type==="attentionSequence"&&(n[t][1].type="data");return n}function k$(n,e){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,i=av(r);let a;return s;function s(l){return a=l,n.enter("attentionSequence"),o(l)}function o(l){if(l===a)return n.consume(l),o;const u=n.exit("attentionSequence"),c=av(l),d=!c||c===2&&i||t.includes(l),f=!i||i===2&&c||t.includes(r);return u._open=!!(a===42?d:d&&(i||!f)),u._close=!!(a===42?f:f&&(c||!d)),e(l)}}function sv(n,e){n.column+=e,n.offset+=e,n._bufferIndex+=e}const S$={name:"autolink",tokenize:O$};function O$(n,e,t){let r=0;return i;function i(h){return n.enter("autolink"),n.enter("autolinkMarker"),n.consume(h),n.exit("autolinkMarker"),n.enter("autolinkProtocol"),a}function a(h){return Lr(h)?(n.consume(h),s):h===64?t(h):u(h)}function s(h){return h===43||h===45||h===46||An(h)?(r=1,o(h)):u(h)}function o(h){return h===58?(n.consume(h),r=0,l):(h===43||h===45||h===46||An(h))&&r++<32?(n.consume(h),o):(r=0,u(h))}function l(h){return h===62?(n.exit("autolinkProtocol"),n.enter("autolinkMarker"),n.consume(h),n.exit("autolinkMarker"),n.exit("autolink"),e):h===null||h===32||h===60||Xm(h)?t(h):(n.consume(h),l)}function u(h){return h===64?(n.consume(h),c):h$(h)?(n.consume(h),u):t(h)}function c(h){return An(h)?d(h):t(h)}function d(h){return h===46?(n.consume(h),r=0,c):h===62?(n.exit("autolinkProtocol").type="autolinkEmail",n.enter("autolinkMarker"),n.consume(h),n.exit("autolinkMarker"),n.exit("autolink"),e):f(h)}function f(h){if((h===45||An(h))&&r++<63){const p=h===45?f:d;return n.consume(h),p}return t(h)}}const Of={partial:!0,tokenize:A$};function A$(n,e,t){return r;function r(a){return Ae(a)?Fe(n,i,"linePrefix")(a):i(a)}function i(a){return a===null||se(a)?e(a):t(a)}}const zS={continuation:{tokenize:T$},exit:I$,name:"blockQuote",tokenize:P$};function P$(n,e,t){const r=this;return i;function i(s){if(s===62){const o=r.containerState;return o.open||(n.enter("blockQuote",{_container:!0}),o.open=!0),n.enter("blockQuotePrefix"),n.enter("blockQuoteMarker"),n.consume(s),n.exit("blockQuoteMarker"),a}return t(s)}function a(s){return Ae(s)?(n.enter("blockQuotePrefixWhitespace"),n.consume(s),n.exit("blockQuotePrefixWhitespace"),n.exit("blockQuotePrefix"),e):(n.exit("blockQuotePrefix"),e(s))}}function T$(n,e,t){const r=this;return i;function i(s){return Ae(s)?Fe(n,a,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):a(s)}function a(s){return n.attempt(zS,e,t)(s)}}function I$(n){n.exit("blockQuote")}const BS={name:"characterEscape",tokenize:C$};function C$(n,e,t){return r;function r(a){return n.enter("characterEscape"),n.enter("escapeMarker"),n.consume(a),n.exit("escapeMarker"),i}function i(a){return m$(a)?(n.enter("characterEscapeValue"),n.consume(a),n.exit("characterEscapeValue"),n.exit("characterEscape"),e):t(a)}}const HS={name:"characterReference",tokenize:R$};function R$(n,e,t){const r=this;let i=0,a,s;return o;function o(d){return n.enter("characterReference"),n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),l}function l(d){return d===35?(n.enter("characterReferenceMarkerNumeric"),n.consume(d),n.exit("characterReferenceMarkerNumeric"),u):(n.enter("characterReferenceValue"),a=31,s=An,c(d))}function u(d){return d===88||d===120?(n.enter("characterReferenceMarkerHexadecimal"),n.consume(d),n.exit("characterReferenceMarkerHexadecimal"),n.enter("characterReferenceValue"),a=6,s=p$,c):(n.enter("characterReferenceValue"),a=7,s=Qm,c(d))}function c(d){if(d===59&&i){const f=n.exit("characterReferenceValue");return s===An&&!ew(r.sliceSerialize(f))?t(d):(n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),n.exit("characterReference"),e)}return s(d)&&i++<a?(n.consume(d),c):t(d)}}const ov={partial:!0,tokenize:N$},lv={concrete:!0,name:"codeFenced",tokenize:$$};function $$(n,e,t){const r=this,i={partial:!0,tokenize:k};let a=0,s=0,o;return l;function l(E){return u(E)}function u(E){const P=r.events[r.events.length-1];return a=P&&P[1].type==="linePrefix"?P[2].sliceSerialize(P[1],!0).length:0,o=E,n.enter("codeFenced"),n.enter("codeFencedFence"),n.enter("codeFencedFenceSequence"),c(E)}function c(E){return E===o?(s++,n.consume(E),c):s<3?t(E):(n.exit("codeFencedFenceSequence"),Ae(E)?Fe(n,d,"whitespace")(E):d(E))}function d(E){return E===null||se(E)?(n.exit("codeFencedFence"),r.interrupt?e(E):n.check(ov,m,x)(E)):(n.enter("codeFencedFenceInfo"),n.enter("chunkString",{contentType:"string"}),f(E))}function f(E){return E===null||se(E)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),d(E)):Ae(E)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),Fe(n,h,"whitespace")(E)):E===96&&E===o?t(E):(n.consume(E),f)}function h(E){return E===null||se(E)?d(E):(n.enter("codeFencedFenceMeta"),n.enter("chunkString",{contentType:"string"}),p(E))}function p(E){return E===null||se(E)?(n.exit("chunkString"),n.exit("codeFencedFenceMeta"),d(E)):E===96&&E===o?t(E):(n.consume(E),p)}function m(E){return n.attempt(i,x,_)(E)}function _(E){return n.enter("lineEnding"),n.consume(E),n.exit("lineEnding"),g}function g(E){return a>0&&Ae(E)?Fe(n,y,"linePrefix",a+1)(E):y(E)}function y(E){return E===null||se(E)?n.check(ov,m,x)(E):(n.enter("codeFlowValue"),w(E))}function w(E){return E===null||se(E)?(n.exit("codeFlowValue"),y(E)):(n.consume(E),w)}function x(E){return n.exit("codeFenced"),e(E)}function k(E,P,R){let H=0;return j;function j(S){return E.enter("lineEnding"),E.consume(S),E.exit("lineEnding"),L}function L(S){return E.enter("codeFencedFence"),Ae(S)?Fe(E,V,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(S):V(S)}function V(S){return S===o?(E.enter("codeFencedFenceSequence"),oe(S)):R(S)}function oe(S){return S===o?(H++,E.consume(S),oe):H>=s?(E.exit("codeFencedFenceSequence"),Ae(S)?Fe(E,T,"whitespace")(S):T(S)):R(S)}function T(S){return S===null||se(S)?(E.exit("codeFencedFence"),P(S)):R(S)}}}function N$(n,e,t){const r=this;return i;function i(s){return s===null?t(s):(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),a)}function a(s){return r.parser.lazy[r.now().line]?t(s):e(s)}}const Hh={name:"codeIndented",tokenize:L$},j$={partial:!0,tokenize:D$};function L$(n,e,t){const r=this;return i;function i(u){return n.enter("codeIndented"),Fe(n,a,"linePrefix",5)(u)}function a(u){const c=r.events[r.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?s(u):t(u)}function s(u){return u===null?l(u):se(u)?n.attempt(j$,s,l)(u):(n.enter("codeFlowValue"),o(u))}function o(u){return u===null||se(u)?(n.exit("codeFlowValue"),s(u)):(n.consume(u),o)}function l(u){return n.exit("codeIndented"),e(u)}}function D$(n,e,t){const r=this;return i;function i(s){return r.parser.lazy[r.now().line]?t(s):se(s)?(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),i):Fe(n,a,"linePrefix",5)(s)}function a(s){const o=r.events[r.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(s):se(s)?i(s):t(s)}}const F$={name:"codeText",previous:U$,resolve:M$,tokenize:z$};function M$(n){let e=n.length-4,t=3,r,i;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(r=t;++r<e;)if(n[r][1].type==="codeTextData"){n[t][1].type="codeTextPadding",n[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)i===void 0?r!==e&&n[r][1].type!=="lineEnding"&&(i=r):(r===e||n[r][1].type==="lineEnding")&&(n[i][1].type="codeTextData",r!==i+2&&(n[i][1].end=n[r-1][1].end,n.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return n}function U$(n){return n!==96||this.events[this.events.length-1][1].type==="characterEscape"}function z$(n,e,t){let r=0,i,a;return s;function s(d){return n.enter("codeText"),n.enter("codeTextSequence"),o(d)}function o(d){return d===96?(n.consume(d),r++,o):(n.exit("codeTextSequence"),l(d))}function l(d){return d===null?t(d):d===32?(n.enter("space"),n.consume(d),n.exit("space"),l):d===96?(a=n.enter("codeTextSequence"),i=0,c(d)):se(d)?(n.enter("lineEnding"),n.consume(d),n.exit("lineEnding"),l):(n.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||se(d)?(n.exit("codeTextData"),l(d)):(n.consume(d),u)}function c(d){return d===96?(n.consume(d),i++,c):i===r?(n.exit("codeTextSequence"),n.exit("codeText"),e(d)):(a.type="codeTextData",u(d))}}class B${constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,t,r){const i=t||0;this.setCursor(Math.trunc(e));const a=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&Mo(this.left,r),a.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Mo(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Mo(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);Mo(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Mo(this.left,t.reverse())}}}function Mo(n,e){let t=0;if(e.length<1e4)n.push(...e);else for(;t<e.length;)n.push(...e.slice(t,t+1e4)),t+=1e4}function VS(n){const e={};let t=-1,r,i,a,s,o,l,u;const c=new B$(n);for(;++t<c.length;){for(;t in e;)t=e[t];if(r=c.get(t),t&&r[1].type==="chunkFlow"&&c.get(t-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,a=0,a<l.length&&l[a][1].type==="lineEndingBlank"&&(a+=2),a<l.length&&l[a][1].type==="content"))for(;++a<l.length&&l[a][1].type!=="content";)l[a][1].type==="chunkText"&&(l[a][1]._isInFirstContentOfListItem=!0,a++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,H$(c,t)),t=e[t],u=!0);else if(r[1]._container){for(a=t,i=void 0;a--;)if(s=c.get(a),s[1].type==="lineEnding"||s[1].type==="lineEndingBlank")s[0]==="enter"&&(i&&(c.get(i)[1].type="lineEndingBlank"),s[1].type="lineEnding",i=a);else if(s[1].type!=="linePrefix")break;i&&(r[1].end={...c.get(i)[1].start},o=c.slice(i,t),o.unshift(r),c.splice(i,t-i+1,o))}}return Br(n,0,Number.POSITIVE_INFINITY,c.slice(0)),!u}function H$(n,e){const t=n.get(e)[1],r=n.get(e)[2];let i=e-1;const a=[],s=t._tokenizer||r.parser[t.contentType](t.start),o=s.events,l=[],u={};let c,d,f=-1,h=t,p=0,m=0;const _=[m];for(;h;){for(;n.get(++i)[1]!==h;);a.push(i),h._tokenizer||(c=r.sliceStream(h),h.next||c.push(null),d&&s.defineSkip(h.start),h._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(c),h._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),d=h,h=h.next}for(h=t;++f<o.length;)o[f][0]==="exit"&&o[f-1][0]==="enter"&&o[f][1].type===o[f-1][1].type&&o[f][1].start.line!==o[f][1].end.line&&(m=f+1,_.push(m),h._tokenizer=void 0,h.previous=void 0,h=h.next);for(s.events=[],h?(h._tokenizer=void 0,h.previous=void 0):_.pop(),f=_.length;f--;){const g=o.slice(_[f],_[f+1]),y=a.pop();l.push([y,y+g.length-1]),n.splice(y,2,g)}for(l.reverse(),f=-1;++f<l.length;)u[p+l[f][0]]=p+l[f][1],p+=l[f][1]-l[f][0]-1;return u}const V$={resolve:G$,tokenize:W$},q$={partial:!0,tokenize:K$};function G$(n){return VS(n),n}function W$(n,e){let t;return r;function r(o){return n.enter("content"),t=n.enter("chunkContent",{contentType:"content"}),i(o)}function i(o){return o===null?a(o):se(o)?n.check(q$,s,a)(o):(n.consume(o),i)}function a(o){return n.exit("chunkContent"),n.exit("content"),e(o)}function s(o){return n.consume(o),n.exit("chunkContent"),t.next=n.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,i}}function K$(n,e,t){const r=this;return i;function i(s){return n.exit("chunkContent"),n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),Fe(n,a,"linePrefix")}function a(s){if(s===null||se(s))return t(s);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(s):n.interrupt(r.parser.constructs.flow,t,e)(s)}}function qS(n,e,t,r,i,a,s,o,l){const u=l||Number.POSITIVE_INFINITY;let c=0;return d;function d(g){return g===60?(n.enter(r),n.enter(i),n.enter(a),n.consume(g),n.exit(a),f):g===null||g===32||g===41||Xm(g)?t(g):(n.enter(r),n.enter(s),n.enter(o),n.enter("chunkString",{contentType:"string"}),m(g))}function f(g){return g===62?(n.enter(a),n.consume(g),n.exit(a),n.exit(i),n.exit(r),e):(n.enter(o),n.enter("chunkString",{contentType:"string"}),h(g))}function h(g){return g===62?(n.exit("chunkString"),n.exit(o),f(g)):g===null||g===60||se(g)?t(g):(n.consume(g),g===92?p:h)}function p(g){return g===60||g===62||g===92?(n.consume(g),h):h(g)}function m(g){return!c&&(g===null||g===41||cn(g))?(n.exit("chunkString"),n.exit(o),n.exit(s),n.exit(r),e(g)):c<u&&g===40?(n.consume(g),c++,m):g===41?(n.consume(g),c--,m):g===null||g===32||g===40||Xm(g)?t(g):(n.consume(g),g===92?_:m)}function _(g){return g===40||g===41||g===92?(n.consume(g),m):m(g)}}function GS(n,e,t,r,i,a){const s=this;let o=0,l;return u;function u(h){return n.enter(r),n.enter(i),n.consume(h),n.exit(i),n.enter(a),c}function c(h){return o>999||h===null||h===91||h===93&&!l||h===94&&!o&&"_hiddenFootnoteSupport"in s.parser.constructs?t(h):h===93?(n.exit(a),n.enter(i),n.consume(h),n.exit(i),n.exit(r),e):se(h)?(n.enter("lineEnding"),n.consume(h),n.exit("lineEnding"),c):(n.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===null||h===91||h===93||se(h)||o++>999?(n.exit("chunkString"),c(h)):(n.consume(h),l||(l=!Ae(h)),h===92?f:d)}function f(h){return h===91||h===92||h===93?(n.consume(h),o++,d):d(h)}}function WS(n,e,t,r,i,a){let s;return o;function o(f){return f===34||f===39||f===40?(n.enter(r),n.enter(i),n.consume(f),n.exit(i),s=f===40?41:f,l):t(f)}function l(f){return f===s?(n.enter(i),n.consume(f),n.exit(i),n.exit(r),e):(n.enter(a),u(f))}function u(f){return f===s?(n.exit(a),l(s)):f===null?t(f):se(f)?(n.enter("lineEnding"),n.consume(f),n.exit("lineEnding"),Fe(n,u,"linePrefix")):(n.enter("chunkString",{contentType:"string"}),c(f))}function c(f){return f===s||f===null||se(f)?(n.exit("chunkString"),u(f)):(n.consume(f),f===92?d:c)}function d(f){return f===s||f===92?(n.consume(f),c):c(f)}}function gl(n,e){let t;return r;function r(i){return se(i)?(n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),t=!0,r):Ae(i)?Fe(n,r,t?"linePrefix":"lineSuffix")(i):e(i)}}const J$={name:"definition",tokenize:X$},Z$={partial:!0,tokenize:Q$};function X$(n,e,t){const r=this;let i;return a;function a(h){return n.enter("definition"),s(h)}function s(h){return GS.call(r,n,o,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(h)}function o(h){return i=Fs(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),h===58?(n.enter("definitionMarker"),n.consume(h),n.exit("definitionMarker"),l):t(h)}function l(h){return cn(h)?gl(n,u)(h):u(h)}function u(h){return qS(n,c,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(h)}function c(h){return n.attempt(Z$,d,d)(h)}function d(h){return Ae(h)?Fe(n,f,"whitespace")(h):f(h)}function f(h){return h===null||se(h)?(n.exit("definition"),r.parser.defined.push(i),e(h)):t(h)}}function Q$(n,e,t){return r;function r(o){return cn(o)?gl(n,i)(o):t(o)}function i(o){return WS(n,a,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function a(o){return Ae(o)?Fe(n,s,"whitespace")(o):s(o)}function s(o){return o===null||se(o)?e(o):t(o)}}const Y$={name:"hardBreakEscape",tokenize:eN};function eN(n,e,t){return r;function r(a){return n.enter("hardBreakEscape"),n.consume(a),i}function i(a){return se(a)?(n.exit("hardBreakEscape"),e(a)):t(a)}}const tN={name:"headingAtx",resolve:nN,tokenize:rN};function nN(n,e){let t=n.length-2,r=3,i,a;return n[r][1].type==="whitespace"&&(r+=2),t-2>r&&n[t][1].type==="whitespace"&&(t-=2),n[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&n[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(i={type:"atxHeadingText",start:n[r][1].start,end:n[t][1].end},a={type:"chunkText",start:n[r][1].start,end:n[t][1].end,contentType:"text"},Br(n,r,t-r+1,[["enter",i,e],["enter",a,e],["exit",a,e],["exit",i,e]])),n}function rN(n,e,t){let r=0;return i;function i(c){return n.enter("atxHeading"),a(c)}function a(c){return n.enter("atxHeadingSequence"),s(c)}function s(c){return c===35&&r++<6?(n.consume(c),s):c===null||cn(c)?(n.exit("atxHeadingSequence"),o(c)):t(c)}function o(c){return c===35?(n.enter("atxHeadingSequence"),l(c)):c===null||se(c)?(n.exit("atxHeading"),e(c)):Ae(c)?Fe(n,o,"whitespace")(c):(n.enter("atxHeadingText"),u(c))}function l(c){return c===35?(n.consume(c),l):(n.exit("atxHeadingSequence"),o(c))}function u(c){return c===null||c===35||cn(c)?(n.exit("atxHeadingText"),o(c)):(n.consume(c),u)}}const iN=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],uv=["pre","script","style","textarea"],aN={concrete:!0,name:"htmlFlow",resolveTo:lN,tokenize:uN},sN={partial:!0,tokenize:dN},oN={partial:!0,tokenize:cN};function lN(n){let e=n.length;for(;e--&&!(n[e][0]==="enter"&&n[e][1].type==="htmlFlow"););return e>1&&n[e-2][1].type==="linePrefix"&&(n[e][1].start=n[e-2][1].start,n[e+1][1].start=n[e-2][1].start,n.splice(e-2,2)),n}function uN(n,e,t){const r=this;let i,a,s,o,l;return u;function u(v){return c(v)}function c(v){return n.enter("htmlFlow"),n.enter("htmlFlowData"),n.consume(v),d}function d(v){return v===33?(n.consume(v),f):v===47?(n.consume(v),a=!0,m):v===63?(n.consume(v),i=3,r.interrupt?e:b):Lr(v)?(n.consume(v),s=String.fromCharCode(v),_):t(v)}function f(v){return v===45?(n.consume(v),i=2,h):v===91?(n.consume(v),i=5,o=0,p):Lr(v)?(n.consume(v),i=4,r.interrupt?e:b):t(v)}function h(v){return v===45?(n.consume(v),r.interrupt?e:b):t(v)}function p(v){const Q="CDATA[";return v===Q.charCodeAt(o++)?(n.consume(v),o===Q.length?r.interrupt?e:V:p):t(v)}function m(v){return Lr(v)?(n.consume(v),s=String.fromCharCode(v),_):t(v)}function _(v){if(v===null||v===47||v===62||cn(v)){const Q=v===47,Z=s.toLowerCase();return!Q&&!a&&uv.includes(Z)?(i=1,r.interrupt?e(v):V(v)):iN.includes(s.toLowerCase())?(i=6,Q?(n.consume(v),g):r.interrupt?e(v):V(v)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(v):a?y(v):w(v))}return v===45||An(v)?(n.consume(v),s+=String.fromCharCode(v),_):t(v)}function g(v){return v===62?(n.consume(v),r.interrupt?e:V):t(v)}function y(v){return Ae(v)?(n.consume(v),y):j(v)}function w(v){return v===47?(n.consume(v),j):v===58||v===95||Lr(v)?(n.consume(v),x):Ae(v)?(n.consume(v),w):j(v)}function x(v){return v===45||v===46||v===58||v===95||An(v)?(n.consume(v),x):k(v)}function k(v){return v===61?(n.consume(v),E):Ae(v)?(n.consume(v),k):w(v)}function E(v){return v===null||v===60||v===61||v===62||v===96?t(v):v===34||v===39?(n.consume(v),l=v,P):Ae(v)?(n.consume(v),E):R(v)}function P(v){return v===l?(n.consume(v),l=null,H):v===null||se(v)?t(v):(n.consume(v),P)}function R(v){return v===null||v===34||v===39||v===47||v===60||v===61||v===62||v===96||cn(v)?k(v):(n.consume(v),R)}function H(v){return v===47||v===62||Ae(v)?w(v):t(v)}function j(v){return v===62?(n.consume(v),L):t(v)}function L(v){return v===null||se(v)?V(v):Ae(v)?(n.consume(v),L):t(v)}function V(v){return v===45&&i===2?(n.consume(v),$):v===60&&i===1?(n.consume(v),C):v===62&&i===4?(n.consume(v),F):v===63&&i===3?(n.consume(v),b):v===93&&i===5?(n.consume(v),A):se(v)&&(i===6||i===7)?(n.exit("htmlFlowData"),n.check(sN,N,oe)(v)):v===null||se(v)?(n.exit("htmlFlowData"),oe(v)):(n.consume(v),V)}function oe(v){return n.check(oN,T,N)(v)}function T(v){return n.enter("lineEnding"),n.consume(v),n.exit("lineEnding"),S}function S(v){return v===null||se(v)?oe(v):(n.enter("htmlFlowData"),V(v))}function $(v){return v===45?(n.consume(v),b):V(v)}function C(v){return v===47?(n.consume(v),s="",O):V(v)}function O(v){if(v===62){const Q=s.toLowerCase();return uv.includes(Q)?(n.consume(v),F):V(v)}return Lr(v)&&s.length<8?(n.consume(v),s+=String.fromCharCode(v),O):V(v)}function A(v){return v===93?(n.consume(v),b):V(v)}function b(v){return v===62?(n.consume(v),F):v===45&&i===2?(n.consume(v),b):V(v)}function F(v){return v===null||se(v)?(n.exit("htmlFlowData"),N(v)):(n.consume(v),F)}function N(v){return n.exit("htmlFlow"),e(v)}}function cN(n,e,t){const r=this;return i;function i(s){return se(s)?(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),a):t(s)}function a(s){return r.parser.lazy[r.now().line]?t(s):e(s)}}function dN(n,e,t){return r;function r(i){return n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),n.attempt(Of,e,t)}}const fN={name:"htmlText",tokenize:hN};function hN(n,e,t){const r=this;let i,a,s;return o;function o(b){return n.enter("htmlText"),n.enter("htmlTextData"),n.consume(b),l}function l(b){return b===33?(n.consume(b),u):b===47?(n.consume(b),k):b===63?(n.consume(b),w):Lr(b)?(n.consume(b),R):t(b)}function u(b){return b===45?(n.consume(b),c):b===91?(n.consume(b),a=0,p):Lr(b)?(n.consume(b),y):t(b)}function c(b){return b===45?(n.consume(b),h):t(b)}function d(b){return b===null?t(b):b===45?(n.consume(b),f):se(b)?(s=d,C(b)):(n.consume(b),d)}function f(b){return b===45?(n.consume(b),h):d(b)}function h(b){return b===62?$(b):b===45?f(b):d(b)}function p(b){const F="CDATA[";return b===F.charCodeAt(a++)?(n.consume(b),a===F.length?m:p):t(b)}function m(b){return b===null?t(b):b===93?(n.consume(b),_):se(b)?(s=m,C(b)):(n.consume(b),m)}function _(b){return b===93?(n.consume(b),g):m(b)}function g(b){return b===62?$(b):b===93?(n.consume(b),g):m(b)}function y(b){return b===null||b===62?$(b):se(b)?(s=y,C(b)):(n.consume(b),y)}function w(b){return b===null?t(b):b===63?(n.consume(b),x):se(b)?(s=w,C(b)):(n.consume(b),w)}function x(b){return b===62?$(b):w(b)}function k(b){return Lr(b)?(n.consume(b),E):t(b)}function E(b){return b===45||An(b)?(n.consume(b),E):P(b)}function P(b){return se(b)?(s=P,C(b)):Ae(b)?(n.consume(b),P):$(b)}function R(b){return b===45||An(b)?(n.consume(b),R):b===47||b===62||cn(b)?H(b):t(b)}function H(b){return b===47?(n.consume(b),$):b===58||b===95||Lr(b)?(n.consume(b),j):se(b)?(s=H,C(b)):Ae(b)?(n.consume(b),H):$(b)}function j(b){return b===45||b===46||b===58||b===95||An(b)?(n.consume(b),j):L(b)}function L(b){return b===61?(n.consume(b),V):se(b)?(s=L,C(b)):Ae(b)?(n.consume(b),L):H(b)}function V(b){return b===null||b===60||b===61||b===62||b===96?t(b):b===34||b===39?(n.consume(b),i=b,oe):se(b)?(s=V,C(b)):Ae(b)?(n.consume(b),V):(n.consume(b),T)}function oe(b){return b===i?(n.consume(b),i=void 0,S):b===null?t(b):se(b)?(s=oe,C(b)):(n.consume(b),oe)}function T(b){return b===null||b===34||b===39||b===60||b===61||b===96?t(b):b===47||b===62||cn(b)?H(b):(n.consume(b),T)}function S(b){return b===47||b===62||cn(b)?H(b):t(b)}function $(b){return b===62?(n.consume(b),n.exit("htmlTextData"),n.exit("htmlText"),e):t(b)}function C(b){return n.exit("htmlTextData"),n.enter("lineEnding"),n.consume(b),n.exit("lineEnding"),O}function O(b){return Ae(b)?Fe(n,A,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(b):A(b)}function A(b){return n.enter("htmlTextData"),s(b)}}const nw={name:"labelEnd",resolveAll:yN,resolveTo:wN,tokenize:_N},pN={tokenize:bN},mN={tokenize:vN},gN={tokenize:xN};function yN(n){let e=-1;const t=[];for(;++e<n.length;){const r=n[e][1];if(t.push(n[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const i=r.type==="labelImage"?4:2;r.type="data",e+=i}}return n.length!==t.length&&Br(n,0,n.length,t),n}function wN(n,e){let t=n.length,r=0,i,a,s,o;for(;t--;)if(i=n[t][1],a){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;n[t][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(s){if(n[t][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(a=t,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(s=t);const l={type:n[a][1].type==="labelLink"?"link":"image",start:{...n[a][1].start},end:{...n[n.length-1][1].end}},u={type:"label",start:{...n[a][1].start},end:{...n[s][1].end}},c={type:"labelText",start:{...n[a+r+2][1].end},end:{...n[s-2][1].start}};return o=[["enter",l,e],["enter",u,e]],o=Mn(o,n.slice(a+1,a+r+3)),o=Mn(o,[["enter",c,e]]),o=Mn(o,tw(e.parser.constructs.insideSpan.null,n.slice(a+r+4,s-3),e)),o=Mn(o,[["exit",c,e],n[s-2],n[s-1],["exit",u,e]]),o=Mn(o,n.slice(s+1)),o=Mn(o,[["exit",l,e]]),Br(n,a,n.length,o),n}function _N(n,e,t){const r=this;let i=r.events.length,a,s;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){a=r.events[i][1];break}return o;function o(f){return a?a._inactive?d(f):(s=r.parser.defined.includes(Fs(r.sliceSerialize({start:a.end,end:r.now()}))),n.enter("labelEnd"),n.enter("labelMarker"),n.consume(f),n.exit("labelMarker"),n.exit("labelEnd"),l):t(f)}function l(f){return f===40?n.attempt(pN,c,s?c:d)(f):f===91?n.attempt(mN,c,s?u:d)(f):s?c(f):d(f)}function u(f){return n.attempt(gN,c,d)(f)}function c(f){return e(f)}function d(f){return a._balanced=!0,t(f)}}function bN(n,e,t){return r;function r(d){return n.enter("resource"),n.enter("resourceMarker"),n.consume(d),n.exit("resourceMarker"),i}function i(d){return cn(d)?gl(n,a)(d):a(d)}function a(d){return d===41?c(d):qS(n,s,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function s(d){return cn(d)?gl(n,l)(d):c(d)}function o(d){return t(d)}function l(d){return d===34||d===39||d===40?WS(n,u,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):c(d)}function u(d){return cn(d)?gl(n,c)(d):c(d)}function c(d){return d===41?(n.enter("resourceMarker"),n.consume(d),n.exit("resourceMarker"),n.exit("resource"),e):t(d)}}function vN(n,e,t){const r=this;return i;function i(o){return GS.call(r,n,a,s,"reference","referenceMarker","referenceString")(o)}function a(o){return r.parser.defined.includes(Fs(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(o):t(o)}function s(o){return t(o)}}function xN(n,e,t){return r;function r(a){return n.enter("reference"),n.enter("referenceMarker"),n.consume(a),n.exit("referenceMarker"),i}function i(a){return a===93?(n.enter("referenceMarker"),n.consume(a),n.exit("referenceMarker"),n.exit("reference"),e):t(a)}}const EN={name:"labelStartImage",resolveAll:nw.resolveAll,tokenize:kN};function kN(n,e,t){const r=this;return i;function i(o){return n.enter("labelImage"),n.enter("labelImageMarker"),n.consume(o),n.exit("labelImageMarker"),a}function a(o){return o===91?(n.enter("labelMarker"),n.consume(o),n.exit("labelMarker"),n.exit("labelImage"),s):t(o)}function s(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(o):e(o)}}const SN={name:"labelStartLink",resolveAll:nw.resolveAll,tokenize:ON};function ON(n,e,t){const r=this;return i;function i(s){return n.enter("labelLink"),n.enter("labelMarker"),n.consume(s),n.exit("labelMarker"),n.exit("labelLink"),a}function a(s){return s===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(s):e(s)}}const Vh={name:"lineEnding",tokenize:AN};function AN(n,e){return t;function t(r){return n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),Fe(n,e,"linePrefix")}}const Gc={name:"thematicBreak",tokenize:PN};function PN(n,e,t){let r=0,i;return a;function a(u){return n.enter("thematicBreak"),s(u)}function s(u){return i=u,o(u)}function o(u){return u===i?(n.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||se(u))?(n.exit("thematicBreak"),e(u)):t(u)}function l(u){return u===i?(n.consume(u),r++,l):(n.exit("thematicBreakSequence"),Ae(u)?Fe(n,o,"whitespace")(u):o(u))}}const en={continuation:{tokenize:RN},exit:NN,name:"list",tokenize:CN},TN={partial:!0,tokenize:jN},IN={partial:!0,tokenize:$N};function CN(n,e,t){const r=this,i=r.events[r.events.length-1];let a=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,s=0;return o;function o(h){const p=r.containerState.type||(h===42||h===43||h===45?"listUnordered":"listOrdered");if(p==="listUnordered"?!r.containerState.marker||h===r.containerState.marker:Qm(h)){if(r.containerState.type||(r.containerState.type=p,n.enter(p,{_container:!0})),p==="listUnordered")return n.enter("listItemPrefix"),h===42||h===45?n.check(Gc,t,u)(h):u(h);if(!r.interrupt||h===49)return n.enter("listItemPrefix"),n.enter("listItemValue"),l(h)}return t(h)}function l(h){return Qm(h)&&++s<10?(n.consume(h),l):(!r.interrupt||s<2)&&(r.containerState.marker?h===r.containerState.marker:h===41||h===46)?(n.exit("listItemValue"),u(h)):t(h)}function u(h){return n.enter("listItemMarker"),n.consume(h),n.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||h,n.check(Of,r.interrupt?t:c,n.attempt(TN,f,d))}function c(h){return r.containerState.initialBlankLine=!0,a++,f(h)}function d(h){return Ae(h)?(n.enter("listItemPrefixWhitespace"),n.consume(h),n.exit("listItemPrefixWhitespace"),f):t(h)}function f(h){return r.containerState.size=a+r.sliceSerialize(n.exit("listItemPrefix"),!0).length,e(h)}}function RN(n,e,t){const r=this;return r.containerState._closeFlow=void 0,n.check(Of,i,a);function i(o){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Fe(n,e,"listItemIndent",r.containerState.size+1)(o)}function a(o){return r.containerState.furtherBlankLines||!Ae(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,s(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,n.attempt(IN,e,s)(o))}function s(o){return r.containerState._closeFlow=!0,r.interrupt=void 0,Fe(n,n.attempt(en,e,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function $N(n,e,t){const r=this;return Fe(n,i,"listItemIndent",r.containerState.size+1);function i(a){const s=r.events[r.events.length-1];return s&&s[1].type==="listItemIndent"&&s[2].sliceSerialize(s[1],!0).length===r.containerState.size?e(a):t(a)}}function NN(n){n.exit(this.containerState.type)}function jN(n,e,t){const r=this;return Fe(n,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(a){const s=r.events[r.events.length-1];return!Ae(a)&&s&&s[1].type==="listItemPrefixWhitespace"?e(a):t(a)}}const cv={name:"setextUnderline",resolveTo:LN,tokenize:DN};function LN(n,e){let t=n.length,r,i,a;for(;t--;)if(n[t][0]==="enter"){if(n[t][1].type==="content"){r=t;break}n[t][1].type==="paragraph"&&(i=t)}else n[t][1].type==="content"&&n.splice(t,1),!a&&n[t][1].type==="definition"&&(a=t);const s={type:"setextHeading",start:{...n[i][1].start},end:{...n[n.length-1][1].end}};return n[i][1].type="setextHeadingText",a?(n.splice(i,0,["enter",s,e]),n.splice(a+1,0,["exit",n[r][1],e]),n[r][1].end={...n[a][1].end}):n[r][1]=s,n.push(["exit",s,e]),n}function DN(n,e,t){const r=this;let i;return a;function a(u){let c=r.events.length,d;for(;c--;)if(r.events[c][1].type!=="lineEnding"&&r.events[c][1].type!=="linePrefix"&&r.events[c][1].type!=="content"){d=r.events[c][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(n.enter("setextHeadingLine"),i=u,s(u)):t(u)}function s(u){return n.enter("setextHeadingLineSequence"),o(u)}function o(u){return u===i?(n.consume(u),o):(n.exit("setextHeadingLineSequence"),Ae(u)?Fe(n,l,"lineSuffix")(u):l(u))}function l(u){return u===null||se(u)?(n.exit("setextHeadingLine"),e(u)):t(u)}}const FN={tokenize:MN};function MN(n){const e=this,t=n.attempt(Of,r,n.attempt(this.parser.constructs.flowInitial,i,Fe(n,n.attempt(this.parser.constructs.flow,i,n.attempt(V$,i)),"linePrefix")));return t;function r(a){if(a===null){n.consume(a);return}return n.enter("lineEndingBlank"),n.consume(a),n.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function i(a){if(a===null){n.consume(a);return}return n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),e.currentConstruct=void 0,t}}const UN={resolveAll:JS()},zN=KS("string"),BN=KS("text");function KS(n){return{resolveAll:JS(n==="text"?HN:void 0),tokenize:e};function e(t){const r=this,i=this.parser.constructs[n],a=t.attempt(i,s,o);return s;function s(c){return u(c)?a(c):o(c)}function o(c){if(c===null){t.consume(c);return}return t.enter("data"),t.consume(c),l}function l(c){return u(c)?(t.exit("data"),a(c)):(t.consume(c),l)}function u(c){if(c===null)return!0;const d=i[c];let f=-1;if(d)for(;++f<d.length;){const h=d[f];if(!h.previous||h.previous.call(r,r.previous))return!0}return!1}}}function JS(n){return e;function e(t,r){let i=-1,a;for(;++i<=t.length;)a===void 0?t[i]&&t[i][1].type==="data"&&(a=i,i++):(!t[i]||t[i][1].type!=="data")&&(i!==a+2&&(t[a][1].end=t[i-1][1].end,t.splice(a+2,i-a-2),i=a+2),a=void 0);return n?n(t,r):t}}function HN(n,e){let t=0;for(;++t<=n.length;)if((t===n.length||n[t][1].type==="lineEnding")&&n[t-1][1].type==="data"){const r=n[t-1][1],i=e.sliceStream(r);let a=i.length,s=-1,o=0,l;for(;a--;){const u=i[a];if(typeof u=="string"){for(s=u.length;u.charCodeAt(s-1)===32;)o++,s--;if(s)break;s=-1}else if(u===-2)l=!0,o++;else if(u!==-1){a++;break}}if(o){const u={type:t===n.length||l||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:a?s:r.start._bufferIndex+s,_index:r.start._index+a,line:r.end.line,column:r.end.column-o,offset:r.end.offset-o},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(n.splice(t,0,["enter",u,e],["exit",u,e]),t+=2)}t++}return n}const VN={42:en,43:en,45:en,48:en,49:en,50:en,51:en,52:en,53:en,54:en,55:en,56:en,57:en,62:zS},qN={91:J$},GN={[-2]:Hh,[-1]:Hh,32:Hh},WN={35:tN,42:Gc,45:[cv,Gc],60:aN,61:cv,95:Gc,96:lv,126:lv},KN={38:HS,92:BS},JN={[-5]:Vh,[-4]:Vh,[-3]:Vh,33:EN,38:HS,42:Ym,60:[S$,fN],91:SN,92:[Y$,BS],93:nw,95:Ym,96:F$},ZN={null:[Ym,UN]},XN={null:[42,95]},QN={null:[]},YN=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:XN,contentInitial:qN,disable:QN,document:VN,flow:WN,flowInitial:GN,insideSpan:ZN,string:KN,text:JN},Symbol.toStringTag,{value:"Module"}));function ej(n,e,t){let r={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const i={},a=[];let s=[],o=[];const l={attempt:P(k),check:P(E),consume:y,enter:w,exit:x,interrupt:P(E,{interrupt:!0})},u={code:null,containerState:{},defineSkip:m,events:[],now:p,parser:n,previous:null,sliceSerialize:f,sliceStream:h,write:d};let c=e.tokenize.call(u,l);return e.resolveAll&&a.push(e),u;function d(L){return s=Mn(s,L),_(),s[s.length-1]!==null?[]:(R(e,0),u.events=tw(a,u.events,u),u.events)}function f(L,V){return nj(h(L),V)}function h(L){return tj(s,L)}function p(){const{_bufferIndex:L,_index:V,line:oe,column:T,offset:S}=r;return{_bufferIndex:L,_index:V,line:oe,column:T,offset:S}}function m(L){i[L.line]=L.column,j()}function _(){let L;for(;r._index<s.length;){const V=s[r._index];if(typeof V=="string")for(L=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===L&&r._bufferIndex<V.length;)g(V.charCodeAt(r._bufferIndex));else g(V)}}function g(L){c=c(L)}function y(L){se(L)?(r.line++,r.column=1,r.offset+=L===-3?2:1,j()):L!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=L}function w(L,V){const oe=V||{};return oe.type=L,oe.start=p(),u.events.push(["enter",oe,u]),o.push(oe),oe}function x(L){const V=o.pop();return V.end=p(),u.events.push(["exit",V,u]),V}function k(L,V){R(L,V.from)}function E(L,V){V.restore()}function P(L,V){return oe;function oe(T,S,$){let C,O,A,b;return Array.isArray(T)?N(T):"tokenize"in T?N([T]):F(T);function F(re){return Ye;function Ye(Zt){const gn=Zt!==null&&re[Zt],Ft=Zt!==null&&re.null,Kn=[...Array.isArray(gn)?gn:gn?[gn]:[],...Array.isArray(Ft)?Ft:Ft?[Ft]:[]];return N(Kn)(Zt)}}function N(re){return C=re,O=0,re.length===0?$:v(re[O])}function v(re){return Ye;function Ye(Zt){return b=H(),A=re,re.partial||(u.currentConstruct=re),re.name&&u.parser.constructs.disable.null.includes(re.name)?Z():re.tokenize.call(V?Object.assign(Object.create(u),V):u,l,Q,Z)(Zt)}}function Q(re){return L(A,b),S}function Z(re){return b.restore(),++O<C.length?v(C[O]):$}}}function R(L,V){L.resolveAll&&!a.includes(L)&&a.push(L),L.resolve&&Br(u.events,V,u.events.length-V,L.resolve(u.events.slice(V),u)),L.resolveTo&&(u.events=L.resolveTo(u.events,u))}function H(){const L=p(),V=u.previous,oe=u.currentConstruct,T=u.events.length,S=Array.from(o);return{from:T,restore:$};function $(){r=L,u.previous=V,u.currentConstruct=oe,u.events.length=T,o=S,j()}}function j(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function tj(n,e){const t=e.start._index,r=e.start._bufferIndex,i=e.end._index,a=e.end._bufferIndex;let s;if(t===i)s=[n[t].slice(r,a)];else{if(s=n.slice(t,i),r>-1){const o=s[0];typeof o=="string"?s[0]=o.slice(r):s.shift()}a>0&&s.push(n[i].slice(0,a))}return s}function nj(n,e){let t=-1;const r=[];let i;for(;++t<n.length;){const a=n[t];let s;if(typeof a=="string")s=a;else switch(a){case-5:{s="\r";break}case-4:{s=`
`;break}case-3:{s=`\r
`;break}case-2:{s=e?" ":"	";break}case-1:{if(!e&&i)continue;s=" ";break}default:s=String.fromCharCode(a)}i=a===-2,r.push(s)}return r.join("")}function rj(n){const r={constructs:c$([YN,...(n||{}).extensions||[]]),content:i(w$),defined:[],document:i(b$),flow:i(FN),lazy:{},string:i(zN),text:i(BN)};return r;function i(a){return s;function s(o){return ej(r,a,o)}}}function ij(n){for(;!VS(n););return n}const dv=/[\0\t\n\r]/g;function aj(){let n=1,e="",t=!0,r;return i;function i(a,s,o){const l=[];let u,c,d,f,h;for(a=e+(typeof a=="string"?a.toString():new TextDecoder(s||void 0).decode(a)),d=0,e="",t&&(a.charCodeAt(0)===65279&&d++,t=void 0);d<a.length;){if(dv.lastIndex=d,u=dv.exec(a),f=u&&u.index!==void 0?u.index:a.length,h=a.charCodeAt(f),!u){e=a.slice(d);break}if(h===10&&d===f&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),d<f&&(l.push(a.slice(d,f)),n+=f-d),h){case 0:{l.push(65533),n++;break}case 9:{for(c=Math.ceil(n/4)*4,l.push(-2);n++<c;)l.push(-1);break}case 10:{l.push(-4),n=1;break}default:r=!0,n=1}d=f+1}return o&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const sj=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function oj(n){return n.replace(sj,lj)}function lj(n,e,t){if(e)return e;if(t.charCodeAt(0)===35){const i=t.charCodeAt(1),a=i===120||i===88;return US(t.slice(a?2:1),a?16:10)}return ew(t)||n}const ZS={}.hasOwnProperty;function uj(n,e,t){return typeof e!="string"&&(t=e,e=void 0),cj(t)(ij(rj(t).document().write(aj()(n,e,!0))))}function cj(n){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:a(oa),autolinkProtocol:H,autolinkEmail:H,atxHeading:a(Po),blockQuote:a(Ft),characterEscape:H,characterReference:H,codeFenced:a(Kn),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:a(Kn,s),codeText:a(hi,s),codeTextData:H,data:H,codeFlowValue:H,definition:a(Bu),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:a(Hu),hardBreakEscape:a(To),hardBreakTrailing:a(To),htmlFlow:a(qr,s),htmlFlowData:H,htmlText:a(qr,s),htmlTextData:H,image:a(Io),label:s,link:a(oa),listItem:a(ch),listItemValue:f,listOrdered:a(la,d),listUnordered:a(la),paragraph:a(dh),reference:v,referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:a(Po),strong:a(fh),thematicBreak:a(ne)},exit:{atxHeading:l(),atxHeadingSequence:k,autolink:l(),autolinkEmail:gn,autolinkProtocol:Zt,blockQuote:l(),characterEscapeValue:j,characterReferenceMarkerHexadecimal:Z,characterReferenceMarkerNumeric:Z,characterReferenceValue:re,characterReference:Ye,codeFenced:l(_),codeFencedFence:m,codeFencedFenceInfo:h,codeFencedFenceMeta:p,codeFlowValue:j,codeIndented:l(g),codeText:l(S),codeTextData:j,data:j,definition:l(),definitionDestinationString:x,definitionLabelString:y,definitionTitleString:w,emphasis:l(),hardBreakEscape:l(V),hardBreakTrailing:l(V),htmlFlow:l(oe),htmlFlowData:j,htmlText:l(T),htmlTextData:j,image:l(C),label:A,labelText:O,lineEnding:L,link:l($),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:Q,resourceDestinationString:b,resourceTitleString:F,resource:N,setextHeading:l(R),setextHeadingLineSequence:P,setextHeadingText:E,strong:l(),thematicBreak:l()}};XS(e,(n||{}).mdastExtensions||[]);const t={};return r;function r(I){let D={type:"root",children:[]};const Y={stack:[D],tokenStack:[],config:e,enter:o,exit:u,buffer:s,resume:c,data:t},de=[];let ke=-1;for(;++ke<I.length;)if(I[ke][1].type==="listOrdered"||I[ke][1].type==="listUnordered")if(I[ke][0]==="enter")de.push(ke);else{const Mt=de.pop();ke=i(I,Mt,ke)}for(ke=-1;++ke<I.length;){const Mt=e[I[ke][0]];ZS.call(Mt,I[ke][1].type)&&Mt[I[ke][1].type].call(Object.assign({sliceSerialize:I[ke][2].sliceSerialize},Y),I[ke][1])}if(Y.tokenStack.length>0){const Mt=Y.tokenStack[Y.tokenStack.length-1];(Mt[1]||fv).call(Y,void 0,Mt[0])}for(D.position={start:gi(I.length>0?I[0][1].start:{line:1,column:1,offset:0}),end:gi(I.length>0?I[I.length-2][1].end:{line:1,column:1,offset:0})},ke=-1;++ke<e.transforms.length;)D=e.transforms[ke](D)||D;return D}function i(I,D,Y){let de=D-1,ke=-1,Mt=!1,Jn,yn,Er,Gr;for(;++de<=Y;){const yt=I[de];switch(yt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{yt[0]==="enter"?ke++:ke--,Gr=void 0;break}case"lineEndingBlank":{yt[0]==="enter"&&(Jn&&!Gr&&!ke&&!Er&&(Er=de),Gr=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Gr=void 0}if(!ke&&yt[0]==="enter"&&yt[1].type==="listItemPrefix"||ke===-1&&yt[0]==="exit"&&(yt[1].type==="listUnordered"||yt[1].type==="listOrdered")){if(Jn){let kr=de;for(yn=void 0;kr--;){const wn=I[kr];if(wn[1].type==="lineEnding"||wn[1].type==="lineEndingBlank"){if(wn[0]==="exit")continue;yn&&(I[yn][1].type="lineEndingBlank",Mt=!0),wn[1].type="lineEnding",yn=kr}else if(!(wn[1].type==="linePrefix"||wn[1].type==="blockQuotePrefix"||wn[1].type==="blockQuotePrefixWhitespace"||wn[1].type==="blockQuoteMarker"||wn[1].type==="listItemIndent"))break}Er&&(!yn||Er<yn)&&(Jn._spread=!0),Jn.end=Object.assign({},yn?I[yn][1].start:yt[1].end),I.splice(yn||de,0,["exit",Jn,yt[2]]),de++,Y++}if(yt[1].type==="listItemPrefix"){const kr={type:"listItem",_spread:!1,start:Object.assign({},yt[1].start),end:void 0};Jn=kr,I.splice(de,0,["enter",kr,yt[2]]),de++,Y++,Er=void 0,Gr=!0}}}return I[D][1]._spread=Mt,Y}function a(I,D){return Y;function Y(de){o.call(this,I(de),de),D&&D.call(this,de)}}function s(){this.stack.push({type:"fragment",children:[]})}function o(I,D,Y){this.stack[this.stack.length-1].children.push(I),this.stack.push(I),this.tokenStack.push([D,Y||void 0]),I.position={start:gi(D.start),end:void 0}}function l(I){return D;function D(Y){I&&I.call(this,Y),u.call(this,Y)}}function u(I,D){const Y=this.stack.pop(),de=this.tokenStack.pop();if(de)de[0].type!==I.type&&(D?D.call(this,I,de[0]):(de[1]||fv).call(this,I,de[0]));else throw new Error("Cannot close `"+I.type+"` ("+ml({start:I.start,end:I.end})+"): it’s not open");Y.position.end=gi(I.end)}function c(){return l$(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function f(I){if(this.data.expectingFirstListItemValue){const D=this.stack[this.stack.length-2];D.start=Number.parseInt(this.sliceSerialize(I),10),this.data.expectingFirstListItemValue=void 0}}function h(){const I=this.resume(),D=this.stack[this.stack.length-1];D.lang=I}function p(){const I=this.resume(),D=this.stack[this.stack.length-1];D.meta=I}function m(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function _(){const I=this.resume(),D=this.stack[this.stack.length-1];D.value=I.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){const I=this.resume(),D=this.stack[this.stack.length-1];D.value=I.replace(/(\r?\n|\r)$/g,"")}function y(I){const D=this.resume(),Y=this.stack[this.stack.length-1];Y.label=D,Y.identifier=Fs(this.sliceSerialize(I)).toLowerCase()}function w(){const I=this.resume(),D=this.stack[this.stack.length-1];D.title=I}function x(){const I=this.resume(),D=this.stack[this.stack.length-1];D.url=I}function k(I){const D=this.stack[this.stack.length-1];if(!D.depth){const Y=this.sliceSerialize(I).length;D.depth=Y}}function E(){this.data.setextHeadingSlurpLineEnding=!0}function P(I){const D=this.stack[this.stack.length-1];D.depth=this.sliceSerialize(I).codePointAt(0)===61?1:2}function R(){this.data.setextHeadingSlurpLineEnding=void 0}function H(I){const Y=this.stack[this.stack.length-1].children;let de=Y[Y.length-1];(!de||de.type!=="text")&&(de=G(),de.position={start:gi(I.start),end:void 0},Y.push(de)),this.stack.push(de)}function j(I){const D=this.stack.pop();D.value+=this.sliceSerialize(I),D.position.end=gi(I.end)}function L(I){const D=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Y=D.children[D.children.length-1];Y.position.end=gi(I.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(D.type)&&(H.call(this,I),j.call(this,I))}function V(){this.data.atHardBreak=!0}function oe(){const I=this.resume(),D=this.stack[this.stack.length-1];D.value=I}function T(){const I=this.resume(),D=this.stack[this.stack.length-1];D.value=I}function S(){const I=this.resume(),D=this.stack[this.stack.length-1];D.value=I}function $(){const I=this.stack[this.stack.length-1];if(this.data.inReference){const D=this.data.referenceType||"shortcut";I.type+="Reference",I.referenceType=D,delete I.url,delete I.title}else delete I.identifier,delete I.label;this.data.referenceType=void 0}function C(){const I=this.stack[this.stack.length-1];if(this.data.inReference){const D=this.data.referenceType||"shortcut";I.type+="Reference",I.referenceType=D,delete I.url,delete I.title}else delete I.identifier,delete I.label;this.data.referenceType=void 0}function O(I){const D=this.sliceSerialize(I),Y=this.stack[this.stack.length-2];Y.label=oj(D),Y.identifier=Fs(D).toLowerCase()}function A(){const I=this.stack[this.stack.length-1],D=this.resume(),Y=this.stack[this.stack.length-1];if(this.data.inReference=!0,Y.type==="link"){const de=I.children;Y.children=de}else Y.alt=D}function b(){const I=this.resume(),D=this.stack[this.stack.length-1];D.url=I}function F(){const I=this.resume(),D=this.stack[this.stack.length-1];D.title=I}function N(){this.data.inReference=void 0}function v(){this.data.referenceType="collapsed"}function Q(I){const D=this.resume(),Y=this.stack[this.stack.length-1];Y.label=D,Y.identifier=Fs(this.sliceSerialize(I)).toLowerCase(),this.data.referenceType="full"}function Z(I){this.data.characterReferenceType=I.type}function re(I){const D=this.sliceSerialize(I),Y=this.data.characterReferenceType;let de;Y?(de=US(D,Y==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):de=ew(D);const ke=this.stack[this.stack.length-1];ke.value+=de}function Ye(I){const D=this.stack.pop();D.position.end=gi(I.end)}function Zt(I){j.call(this,I);const D=this.stack[this.stack.length-1];D.url=this.sliceSerialize(I)}function gn(I){j.call(this,I);const D=this.stack[this.stack.length-1];D.url="mailto:"+this.sliceSerialize(I)}function Ft(){return{type:"blockquote",children:[]}}function Kn(){return{type:"code",lang:null,meta:null,value:""}}function hi(){return{type:"inlineCode",value:""}}function Bu(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Hu(){return{type:"emphasis",children:[]}}function Po(){return{type:"heading",depth:0,children:[]}}function To(){return{type:"break"}}function qr(){return{type:"html",value:""}}function Io(){return{type:"image",title:null,url:"",alt:null}}function oa(){return{type:"link",title:null,url:"",children:[]}}function la(I){return{type:"list",ordered:I.type==="listOrdered",start:null,spread:I._spread,children:[]}}function ch(I){return{type:"listItem",spread:I._spread,checked:null,children:[]}}function dh(){return{type:"paragraph",children:[]}}function fh(){return{type:"strong",children:[]}}function G(){return{type:"text",value:""}}function ne(){return{type:"thematicBreak"}}}function gi(n){return{line:n.line,column:n.column,offset:n.offset}}function XS(n,e){let t=-1;for(;++t<e.length;){const r=e[t];Array.isArray(r)?XS(n,r):dj(n,r)}}function dj(n,e){let t;for(t in e)if(ZS.call(e,t))switch(t){case"canContainEols":{const r=e[t];r&&n[t].push(...r);break}case"transforms":{const r=e[t];r&&n[t].push(...r);break}case"enter":case"exit":{const r=e[t];r&&Object.assign(n[t],r);break}}}function fv(n,e){throw n?new Error("Cannot close `"+n.type+"` ("+ml({start:n.start,end:n.end})+"): a different token (`"+e.type+"`, "+ml({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+ml({start:e.start,end:e.end})+") is still open")}function fj(n){const e=this;e.parser=t;function t(r){return uj(r,{...e.data("settings"),...n,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function hj(n,e){const t={type:"element",tagName:"blockquote",properties:{},children:n.wrap(n.all(e),!0)};return n.patch(e,t),n.applyData(e,t)}function pj(n,e){const t={type:"element",tagName:"br",properties:{},children:[]};return n.patch(e,t),[n.applyData(e,t),{type:"text",value:`
`}]}function mj(n,e){const t=e.value?e.value+`
`:"",r={};e.lang&&(r.className=["language-"+e.lang]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return e.meta&&(i.data={meta:e.meta}),n.patch(e,i),i=n.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},n.patch(e,i),i}function gj(n,e){const t={type:"element",tagName:"del",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function yj(n,e){const t={type:"element",tagName:"em",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function wj(n,e){const t=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),i=mo(r.toLowerCase()),a=n.footnoteOrder.indexOf(r);let s,o=n.footnoteCounts.get(r);o===void 0?(o=0,n.footnoteOrder.push(r),s=n.footnoteOrder.length):s=a+1,o+=1,n.footnoteCounts.set(r,o);const l={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+i,id:t+"fnref-"+i+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(s)}]};n.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return n.patch(e,u),n.applyData(e,u)}function _j(n,e){const t={type:"element",tagName:"h"+e.depth,properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function bj(n,e){if(n.options.allowDangerousHtml){const t={type:"raw",value:e.value};return n.patch(e,t),n.applyData(e,t)}}function QS(n,e){const t=e.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const i=n.all(e),a=i[0];a&&a.type==="text"?a.value="["+a.value:i.unshift({type:"text",value:"["});const s=i[i.length-1];return s&&s.type==="text"?s.value+=r:i.push({type:"text",value:r}),i}function vj(n,e){const t=String(e.identifier).toUpperCase(),r=n.definitionById.get(t);if(!r)return QS(n,e);const i={src:mo(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(i.title=r.title);const a={type:"element",tagName:"img",properties:i,children:[]};return n.patch(e,a),n.applyData(e,a)}function xj(n,e){const t={src:mo(e.url)};e.alt!==null&&e.alt!==void 0&&(t.alt=e.alt),e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"img",properties:t,children:[]};return n.patch(e,r),n.applyData(e,r)}function Ej(n,e){const t={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};n.patch(e,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return n.patch(e,r),n.applyData(e,r)}function kj(n,e){const t=String(e.identifier).toUpperCase(),r=n.definitionById.get(t);if(!r)return QS(n,e);const i={href:mo(r.url||"")};r.title!==null&&r.title!==void 0&&(i.title=r.title);const a={type:"element",tagName:"a",properties:i,children:n.all(e)};return n.patch(e,a),n.applyData(e,a)}function Sj(n,e){const t={href:mo(e.url)};e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"a",properties:t,children:n.all(e)};return n.patch(e,r),n.applyData(e,r)}function Oj(n,e,t){const r=n.all(e),i=t?Aj(t):YS(e),a={},s=[];if(typeof e.checked=="boolean"){const c=r[0];let d;c&&c.type==="element"&&c.tagName==="p"?d=c:(d={type:"element",tagName:"p",properties:{},children:[]},r.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),a.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const c=r[o];(i||o!==0||c.type!=="element"||c.tagName!=="p")&&s.push({type:"text",value:`
`}),c.type==="element"&&c.tagName==="p"&&!i?s.push(...c.children):s.push(c)}const l=r[r.length-1];l&&(i||l.type!=="element"||l.tagName!=="p")&&s.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:a,children:s};return n.patch(e,u),n.applyData(e,u)}function Aj(n){let e=!1;if(n.type==="list"){e=n.spread||!1;const t=n.children;let r=-1;for(;!e&&++r<t.length;)e=YS(t[r])}return e}function YS(n){const e=n.spread;return e??n.children.length>1}function Pj(n,e){const t={},r=n.all(e);let i=-1;for(typeof e.start=="number"&&e.start!==1&&(t.start=e.start);++i<r.length;){const s=r[i];if(s.type==="element"&&s.tagName==="li"&&s.properties&&Array.isArray(s.properties.className)&&s.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const a={type:"element",tagName:e.ordered?"ol":"ul",properties:t,children:n.wrap(r,!0)};return n.patch(e,a),n.applyData(e,a)}function Tj(n,e){const t={type:"element",tagName:"p",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function Ij(n,e){const t={type:"root",children:n.wrap(n.all(e))};return n.patch(e,t),n.applyData(e,t)}function Cj(n,e){const t={type:"element",tagName:"strong",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function Rj(n,e){const t=n.all(e),r=t.shift(),i=[];if(r){const s={type:"element",tagName:"thead",properties:{},children:n.wrap([r],!0)};n.patch(e.children[0],s),i.push(s)}if(t.length>0){const s={type:"element",tagName:"tbody",properties:{},children:n.wrap(t,!0)},o=Zy(e.children[1]),l=$S(e.children[e.children.length-1]);o&&l&&(s.position={start:o,end:l}),i.push(s)}const a={type:"element",tagName:"table",properties:{},children:n.wrap(i,!0)};return n.patch(e,a),n.applyData(e,a)}function $j(n,e,t){const r=t?t.children:void 0,a=(r?r.indexOf(e):1)===0?"th":"td",s=t&&t.type==="table"?t.align:void 0,o=s?s.length:e.children.length;let l=-1;const u=[];for(;++l<o;){const d=e.children[l],f={},h=s?s[l]:void 0;h&&(f.align=h);let p={type:"element",tagName:a,properties:f,children:[]};d&&(p.children=n.all(d),n.patch(d,p),p=n.applyData(d,p)),u.push(p)}const c={type:"element",tagName:"tr",properties:{},children:n.wrap(u,!0)};return n.patch(e,c),n.applyData(e,c)}function Nj(n,e){const t={type:"element",tagName:"td",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}const hv=9,pv=32;function jj(n){const e=String(n),t=/\r?\n|\r/g;let r=t.exec(e),i=0;const a=[];for(;r;)a.push(mv(e.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=t.exec(e);return a.push(mv(e.slice(i),i>0,!1)),a.join("")}function mv(n,e,t){let r=0,i=n.length;if(e){let a=n.codePointAt(r);for(;a===hv||a===pv;)r++,a=n.codePointAt(r)}if(t){let a=n.codePointAt(i-1);for(;a===hv||a===pv;)i--,a=n.codePointAt(i-1)}return i>r?n.slice(r,i):""}function Lj(n,e){const t={type:"text",value:jj(String(e.value))};return n.patch(e,t),n.applyData(e,t)}function Dj(n,e){const t={type:"element",tagName:"hr",properties:{},children:[]};return n.patch(e,t),n.applyData(e,t)}const Fj={blockquote:hj,break:pj,code:mj,delete:gj,emphasis:yj,footnoteReference:wj,heading:_j,html:bj,imageReference:vj,image:xj,inlineCode:Ej,linkReference:kj,link:Sj,listItem:Oj,list:Pj,paragraph:Tj,root:Ij,strong:Cj,table:Rj,tableCell:Nj,tableRow:$j,text:Lj,thematicBreak:Dj,toml:lc,yaml:lc,definition:lc,footnoteDefinition:lc};function lc(){}const e1=-1,Af=0,yl=1,Cd=2,rw=3,iw=4,aw=5,sw=6,t1=7,n1=8,gv=typeof self=="object"?self:globalThis,Mj=(n,e)=>{const t=(i,a)=>(n.set(a,i),i),r=i=>{if(n.has(i))return n.get(i);const[a,s]=e[i];switch(a){case Af:case e1:return t(s,i);case yl:{const o=t([],i);for(const l of s)o.push(r(l));return o}case Cd:{const o=t({},i);for(const[l,u]of s)o[r(l)]=r(u);return o}case rw:return t(new Date(s),i);case iw:{const{source:o,flags:l}=s;return t(new RegExp(o,l),i)}case aw:{const o=t(new Map,i);for(const[l,u]of s)o.set(r(l),r(u));return o}case sw:{const o=t(new Set,i);for(const l of s)o.add(r(l));return o}case t1:{const{name:o,message:l}=s;return t(new gv[o](l),i)}case n1:return t(BigInt(s),i);case"BigInt":return t(Object(BigInt(s)),i);case"ArrayBuffer":return t(new Uint8Array(s).buffer,s);case"DataView":{const{buffer:o}=new Uint8Array(s);return t(new DataView(o),s)}}return t(new gv[a](s),i)};return r},yv=n=>Mj(new Map,n)(0),Xa="",{toString:Uj}={},{keys:zj}=Object,Uo=n=>{const e=typeof n;if(e!=="object"||!n)return[Af,e];const t=Uj.call(n).slice(8,-1);switch(t){case"Array":return[yl,Xa];case"Object":return[Cd,Xa];case"Date":return[rw,Xa];case"RegExp":return[iw,Xa];case"Map":return[aw,Xa];case"Set":return[sw,Xa];case"DataView":return[yl,t]}return t.includes("Array")?[yl,t]:t.includes("Error")?[t1,t]:[Cd,t]},uc=([n,e])=>n===Af&&(e==="function"||e==="symbol"),Bj=(n,e,t,r)=>{const i=(s,o)=>{const l=r.push(s)-1;return t.set(o,l),l},a=s=>{if(t.has(s))return t.get(s);let[o,l]=Uo(s);switch(o){case Af:{let c=s;switch(l){case"bigint":o=n1,c=s.toString();break;case"function":case"symbol":if(n)throw new TypeError("unable to serialize "+l);c=null;break;case"undefined":return i([e1],s)}return i([o,c],s)}case yl:{if(l){let f=s;return l==="DataView"?f=new Uint8Array(s.buffer):l==="ArrayBuffer"&&(f=new Uint8Array(s)),i([l,[...f]],s)}const c=[],d=i([o,c],s);for(const f of s)c.push(a(f));return d}case Cd:{if(l)switch(l){case"BigInt":return i([l,s.toString()],s);case"Boolean":case"Number":case"String":return i([l,s.valueOf()],s)}if(e&&"toJSON"in s)return a(s.toJSON());const c=[],d=i([o,c],s);for(const f of zj(s))(n||!uc(Uo(s[f])))&&c.push([a(f),a(s[f])]);return d}case rw:return i([o,s.toISOString()],s);case iw:{const{source:c,flags:d}=s;return i([o,{source:c,flags:d}],s)}case aw:{const c=[],d=i([o,c],s);for(const[f,h]of s)(n||!(uc(Uo(f))||uc(Uo(h))))&&c.push([a(f),a(h)]);return d}case sw:{const c=[],d=i([o,c],s);for(const f of s)(n||!uc(Uo(f)))&&c.push(a(f));return d}}const{message:u}=s;return i([o,{name:l,message:u}],s)};return a},wv=(n,{json:e,lossy:t}={})=>{const r=[];return Bj(!(e||t),!!e,new Map,r)(n),r},Rd=typeof structuredClone=="function"?(n,e)=>e&&("json"in e||"lossy"in e)?yv(wv(n,e)):structuredClone(n):(n,e)=>yv(wv(n,e));function Hj(n,e){const t=[{type:"text",value:"↩"}];return e>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),t}function Vj(n,e){return"Back to reference "+(n+1)+(e>1?"-"+e:"")}function qj(n){const e=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",t=n.options.footnoteBackContent||Hj,r=n.options.footnoteBackLabel||Vj,i=n.options.footnoteLabel||"Footnotes",a=n.options.footnoteLabelTagName||"h2",s=n.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let l=-1;for(;++l<n.footnoteOrder.length;){const u=n.footnoteById.get(n.footnoteOrder[l]);if(!u)continue;const c=n.all(u),d=String(u.identifier).toUpperCase(),f=mo(d.toLowerCase());let h=0;const p=[],m=n.footnoteCounts.get(d);for(;m!==void 0&&++h<=m;){p.length>0&&p.push({type:"text",value:" "});let y=typeof t=="string"?t:t(l,h);typeof y=="string"&&(y={type:"text",value:y}),p.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+f+(h>1?"-"+h:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,h),className:["data-footnote-backref"]},children:Array.isArray(y)?y:[y]})}const _=c[c.length-1];if(_&&_.type==="element"&&_.tagName==="p"){const y=_.children[_.children.length-1];y&&y.type==="text"?y.value+=" ":_.children.push({type:"text",value:" "}),_.children.push(...p)}else c.push(...p);const g={type:"element",tagName:"li",properties:{id:e+"fn-"+f},children:n.wrap(c,!0)};n.patch(u,g),o.push(g)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:a,properties:{...Rd(s),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:n.wrap(o,!0)},{type:"text",value:`
`}]}}const r1=function(n){if(n==null)return Jj;if(typeof n=="function")return Pf(n);if(typeof n=="object")return Array.isArray(n)?Gj(n):Wj(n);if(typeof n=="string")return Kj(n);throw new Error("Expected function, string, or object as test")};function Gj(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=r1(n[t]);return Pf(r);function r(...i){let a=-1;for(;++a<e.length;)if(e[a].apply(this,i))return!0;return!1}}function Wj(n){const e=n;return Pf(t);function t(r){const i=r;let a;for(a in n)if(i[a]!==e[a])return!1;return!0}}function Kj(n){return Pf(e);function e(t){return t&&t.type===n}}function Pf(n){return e;function e(t,r,i){return!!(Zj(t)&&n.call(this,t,typeof r=="number"?r:void 0,i||void 0))}}function Jj(){return!0}function Zj(n){return n!==null&&typeof n=="object"&&"type"in n}const i1=[],Xj=!0,_v=!1,Qj="skip";function Yj(n,e,t,r){let i;typeof e=="function"&&typeof t!="function"?(r=t,t=e):i=e;const a=r1(i),s=r?-1:1;o(n,void 0,[])();function o(l,u,c){const d=l&&typeof l=="object"?l:{};if(typeof d.type=="string"){const h=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(l.type+(h?"<"+h+">":""))+")"})}return f;function f(){let h=i1,p,m,_;if((!e||a(l,u,c[c.length-1]||void 0))&&(h=eL(t(l,c)),h[0]===_v))return h;if("children"in l&&l.children){const g=l;if(g.children&&h[0]!==Qj)for(m=(r?g.children.length:-1)+s,_=c.concat(g);m>-1&&m<g.children.length;){const y=g.children[m];if(p=o(y,m,_)(),p[0]===_v)return p;m=typeof p[1]=="number"?p[1]:m+s}}return h}}}function eL(n){return Array.isArray(n)?n:typeof n=="number"?[Xj,n]:n==null?i1:[n]}function a1(n,e,t,r){let i,a,s;typeof e=="function"?(a=void 0,s=e,i=t):(a=e,s=t,i=r),Yj(n,a,o,i);function o(l,u){const c=u[u.length-1],d=c?c.children.indexOf(l):void 0;return s(l,d,c)}}const eg={}.hasOwnProperty,tL={};function nL(n,e){const t=e||tL,r=new Map,i=new Map,a=new Map,s={...Fj,...t.handlers},o={all:u,applyData:iL,definitionById:r,footnoteById:i,footnoteCounts:a,footnoteOrder:[],handlers:s,one:l,options:t,patch:rL,wrap:sL};return a1(n,function(c){if(c.type==="definition"||c.type==="footnoteDefinition"){const d=c.type==="definition"?r:i,f=String(c.identifier).toUpperCase();d.has(f)||d.set(f,c)}}),o;function l(c,d){const f=c.type,h=o.handlers[f];if(eg.call(o.handlers,f)&&h)return h(o,c,d);if(o.options.passThrough&&o.options.passThrough.includes(f)){if("children"in c){const{children:m,..._}=c,g=Rd(_);return g.children=o.all(c),g}return Rd(c)}return(o.options.unknownHandler||aL)(o,c,d)}function u(c){const d=[];if("children"in c){const f=c.children;let h=-1;for(;++h<f.length;){const p=o.one(f[h],c);if(p){if(h&&f[h-1].type==="break"&&(!Array.isArray(p)&&p.type==="text"&&(p.value=bv(p.value)),!Array.isArray(p)&&p.type==="element")){const m=p.children[0];m&&m.type==="text"&&(m.value=bv(m.value))}Array.isArray(p)?d.push(...p):d.push(p)}}}return d}}function rL(n,e){n.position&&(e.position=FR(n))}function iL(n,e){let t=e;if(n&&n.data){const r=n.data.hName,i=n.data.hChildren,a=n.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const s="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:s}}t.type==="element"&&a&&Object.assign(t.properties,Rd(a)),"children"in t&&t.children&&i!==null&&i!==void 0&&(t.children=i)}return t}function aL(n,e){const t=e.data||{},r="value"in e&&!(eg.call(t,"hProperties")||eg.call(t,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:n.all(e)};return n.patch(e,r),n.applyData(e,r)}function sL(n,e){const t=[];let r=-1;for(e&&t.push({type:"text",value:`
`});++r<n.length;)r&&t.push({type:"text",value:`
`}),t.push(n[r]);return e&&n.length>0&&t.push({type:"text",value:`
`}),t}function bv(n){let e=0,t=n.charCodeAt(e);for(;t===9||t===32;)e++,t=n.charCodeAt(e);return n.slice(e)}function vv(n,e){const t=nL(n,e),r=t.one(n,void 0),i=qj(t),a=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&a.children.push({type:"text",value:`
`},i),a}function oL(n,e){return n&&"run"in n?async function(t,r){const i=vv(t,{file:r,...e});await n.run(i,r)}:function(t,r){return vv(t,{file:r,...n||e})}}function xv(n){if(n)throw n}var Wc=Object.prototype.hasOwnProperty,s1=Object.prototype.toString,Ev=Object.defineProperty,kv=Object.getOwnPropertyDescriptor,Sv=function(e){return typeof Array.isArray=="function"?Array.isArray(e):s1.call(e)==="[object Array]"},Ov=function(e){if(!e||s1.call(e)!=="[object Object]")return!1;var t=Wc.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Wc.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var i;for(i in e);return typeof i>"u"||Wc.call(e,i)},Av=function(e,t){Ev&&t.name==="__proto__"?Ev(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},Pv=function(e,t){if(t==="__proto__")if(Wc.call(e,t)){if(kv)return kv(e,t).value}else return;return e[t]},lL=function n(){var e,t,r,i,a,s,o=arguments[0],l=1,u=arguments.length,c=!1;for(typeof o=="boolean"&&(c=o,o=arguments[1]||{},l=2),(o==null||typeof o!="object"&&typeof o!="function")&&(o={});l<u;++l)if(e=arguments[l],e!=null)for(t in e)r=Pv(o,t),i=Pv(e,t),o!==i&&(c&&i&&(Ov(i)||(a=Sv(i)))?(a?(a=!1,s=r&&Sv(r)?r:[]):s=r&&Ov(r)?r:{},Av(o,{name:t,newValue:n(c,s,i)})):typeof i<"u"&&Av(o,{name:t,newValue:i}));return o};const qh=uo(lL);function tg(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}function uL(){const n=[],e={run:t,use:r};return e;function t(...i){let a=-1;const s=i.pop();if(typeof s!="function")throw new TypeError("Expected function as last argument, not "+s);o(null,...i);function o(l,...u){const c=n[++a];let d=-1;if(l){s(l);return}for(;++d<i.length;)(u[d]===null||u[d]===void 0)&&(u[d]=i[d]);i=u,c?cL(c,o)(...u):s(null,...u)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return n.push(i),e}}function cL(n,e){let t;return r;function r(...s){const o=n.length>s.length;let l;o&&s.push(i);try{l=n.apply(this,s)}catch(u){const c=u;if(o&&t)throw c;return i(c)}o||(l&&l.then&&typeof l.then=="function"?l.then(a,i):l instanceof Error?i(l):a(l))}function i(s,...o){t||(t=!0,e(s,...o))}function a(s){i(null,s)}}const Rr={basename:dL,dirname:fL,extname:hL,join:pL,sep:"/"};function dL(n,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');ku(n);let t=0,r=-1,i=n.length,a;if(e===void 0||e.length===0||e.length>n.length){for(;i--;)if(n.codePointAt(i)===47){if(a){t=i+1;break}}else r<0&&(a=!0,r=i+1);return r<0?"":n.slice(t,r)}if(e===n)return"";let s=-1,o=e.length-1;for(;i--;)if(n.codePointAt(i)===47){if(a){t=i+1;break}}else s<0&&(a=!0,s=i+1),o>-1&&(n.codePointAt(i)===e.codePointAt(o--)?o<0&&(r=i):(o=-1,r=s));return t===r?r=s:r<0&&(r=n.length),n.slice(t,r)}function fL(n){if(ku(n),n.length===0)return".";let e=-1,t=n.length,r;for(;--t;)if(n.codePointAt(t)===47){if(r){e=t;break}}else r||(r=!0);return e<0?n.codePointAt(0)===47?"/":".":e===1&&n.codePointAt(0)===47?"//":n.slice(0,e)}function hL(n){ku(n);let e=n.length,t=-1,r=0,i=-1,a=0,s;for(;e--;){const o=n.codePointAt(e);if(o===47){if(s){r=e+1;break}continue}t<0&&(s=!0,t=e+1),o===46?i<0?i=e:a!==1&&(a=1):i>-1&&(a=-1)}return i<0||t<0||a===0||a===1&&i===t-1&&i===r+1?"":n.slice(i,t)}function pL(...n){let e=-1,t;for(;++e<n.length;)ku(n[e]),n[e]&&(t=t===void 0?n[e]:t+"/"+n[e]);return t===void 0?".":mL(t)}function mL(n){ku(n);const e=n.codePointAt(0)===47;let t=gL(n,!e);return t.length===0&&!e&&(t="."),t.length>0&&n.codePointAt(n.length-1)===47&&(t+="/"),e?"/"+t:t}function gL(n,e){let t="",r=0,i=-1,a=0,s=-1,o,l;for(;++s<=n.length;){if(s<n.length)o=n.codePointAt(s);else{if(o===47)break;o=47}if(o===47){if(!(i===s-1||a===1))if(i!==s-1&&a===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(l=t.lastIndexOf("/"),l!==t.length-1){l<0?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),i=s,a=0;continue}}else if(t.length>0){t="",r=0,i=s,a=0;continue}}e&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+n.slice(i+1,s):t=n.slice(i+1,s),r=s-i-1;i=s,a=0}else o===46&&a>-1?a++:a=-1}return t}function ku(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}const yL={cwd:wL};function wL(){return"/"}function ng(n){return!!(n!==null&&typeof n=="object"&&"href"in n&&n.href&&"protocol"in n&&n.protocol&&n.auth===void 0)}function _L(n){if(typeof n=="string")n=new URL(n);else if(!ng(n)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+n+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(n.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return bL(n)}function bL(n){if(n.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=n.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const r=e.codePointAt(t+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(e)}const Gh=["history","path","basename","stem","extname","dirname"];class o1{constructor(e){let t;e?ng(e)?t={path:e}:typeof e=="string"||vL(e)?t={value:e}:t=e:t={},this.cwd="cwd"in t?"":yL.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Gh.length;){const a=Gh[r];a in t&&t[a]!==void 0&&t[a]!==null&&(this[a]=a==="history"?[...t[a]]:t[a])}let i;for(i in t)Gh.includes(i)||(this[i]=t[i])}get basename(){return typeof this.path=="string"?Rr.basename(this.path):void 0}set basename(e){Kh(e,"basename"),Wh(e,"basename"),this.path=Rr.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?Rr.dirname(this.path):void 0}set dirname(e){Tv(this.basename,"dirname"),this.path=Rr.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?Rr.extname(this.path):void 0}set extname(e){if(Wh(e,"extname"),Tv(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Rr.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){ng(e)&&(e=_L(e)),Kh(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?Rr.basename(this.path,this.extname):void 0}set stem(e){Kh(e,"stem"),Wh(e,"stem"),this.path=Rr.join(this.dirname||"",e+(this.extname||""))}fail(e,t,r){const i=this.message(e,t,r);throw i.fatal=!0,i}info(e,t,r){const i=this.message(e,t,r);return i.fatal=void 0,i}message(e,t,r){const i=new Dt(e,t,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function Wh(n,e){if(n&&n.includes(Rr.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+Rr.sep+"`")}function Kh(n,e){if(!n)throw new Error("`"+e+"` cannot be empty")}function Tv(n,e){if(!n)throw new Error("Setting `"+e+"` requires `path` to be set too")}function vL(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const xL=function(n){const r=this.constructor.prototype,i=r[n],a=function(){return i.apply(a,arguments)};return Object.setPrototypeOf(a,r),a},EL={}.hasOwnProperty;class ow extends xL{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=uL()}copy(){const e=new ow;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];e.use(...r)}return e.data(qh(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(Xh("data",this.frozen),this.namespace[e]=t,this):EL.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Xh("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=t.call(e,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=cc(e),r=this.parser||this.Parser;return Jh("parse",r),r(String(t),t)}process(e,t){const r=this;return this.freeze(),Jh("process",this.parser||this.Parser),Zh("process",this.compiler||this.Compiler),t?i(void 0,t):new Promise(i);function i(a,s){const o=cc(e),l=r.parse(o);r.run(l,o,function(c,d,f){if(c||!d||!f)return u(c);const h=d,p=r.stringify(h,f);OL(p)?f.value=p:f.result=p,u(c,f)});function u(c,d){c||!d?s(c):a?a(d):t(void 0,d)}}}processSync(e){let t=!1,r;return this.freeze(),Jh("processSync",this.parser||this.Parser),Zh("processSync",this.compiler||this.Compiler),this.process(e,i),Cv("processSync","process",t),r;function i(a,s){t=!0,xv(a),r=s}}run(e,t,r){Iv(e),this.freeze();const i=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?a(void 0,r):new Promise(a);function a(s,o){const l=cc(t);i.run(e,l,u);function u(c,d,f){const h=d||e;c?o(c):s?s(h):r(void 0,h,f)}}}runSync(e,t){let r=!1,i;return this.run(e,t,a),Cv("runSync","run",r),i;function a(s,o){xv(s),i=o,r=!0}}stringify(e,t){this.freeze();const r=cc(t),i=this.compiler||this.Compiler;return Zh("stringify",i),Iv(e),i(e,r)}use(e,...t){const r=this.attachers,i=this.namespace;if(Xh("use",this.frozen),e!=null)if(typeof e=="function")l(e,t);else if(typeof e=="object")Array.isArray(e)?o(e):s(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function a(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[c,...d]=u;l(c,d)}else s(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function s(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(u.plugins),u.settings&&(i.settings=qh(!0,i.settings,u.settings))}function o(u){let c=-1;if(u!=null)if(Array.isArray(u))for(;++c<u.length;){const d=u[c];a(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,c){let d=-1,f=-1;for(;++d<r.length;)if(r[d][0]===u){f=d;break}if(f===-1)r.push([u,...c]);else if(c.length>0){let[h,...p]=c;const m=r[f][1];tg(m)&&tg(h)&&(h=qh(!0,m,h)),r[f]=[u,h,...p]}}}}const kL=new ow().freeze();function Jh(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `parser`")}function Zh(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `compiler`")}function Xh(n,e){if(e)throw new Error("Cannot call `"+n+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Iv(n){if(!tg(n)||typeof n.type!="string")throw new TypeError("Expected node, got `"+n+"`")}function Cv(n,e,t){if(!t)throw new Error("`"+n+"` finished async. Use `"+e+"` instead")}function cc(n){return SL(n)?n:new o1(n)}function SL(n){return!!(n&&typeof n=="object"&&"message"in n&&"messages"in n)}function OL(n){return typeof n=="string"||AL(n)}function AL(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const PL="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Rv=[],$v={allowDangerousHtml:!0},TL=/^(https?|ircs?|mailto|xmpp)$/i,IL=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function CL(n){const e=n.allowedElements,t=n.allowElement,r=n.children||"",i=n.className,a=n.components,s=n.disallowedElements,o=n.rehypePlugins||Rv,l=n.remarkPlugins||Rv,u=n.remarkRehypeOptions?{...n.remarkRehypeOptions,...$v}:$v,c=n.skipHtml,d=n.unwrapDisallowed,f=n.urlTransform||RL,h=kL().use(fj).use(l).use(oL,u).use(o),p=new o1;typeof r=="string"&&(p.value=r);for(const y of IL)Object.hasOwn(n,y.from)&&(""+y.from+(y.to?"use `"+y.to+"` instead":"remove it")+PL+y.id,void 0);const m=h.parse(p);let _=h.runSync(m,p);return i&&(_={type:"element",tagName:"div",properties:{className:i},children:_.type==="root"?_.children:[_]}),a1(_,g),VR(_,{Fragment:ie.Fragment,components:a,ignoreInvalidStyle:!0,jsx:ie.jsx,jsxs:ie.jsxs,passKeys:!0,passNode:!0});function g(y,w,x){if(y.type==="raw"&&x&&typeof w=="number")return c?x.children.splice(w,1):x.children[w]={type:"text",value:y.value},w;if(y.type==="element"){let k;for(k in Bh)if(Object.hasOwn(Bh,k)&&Object.hasOwn(y.properties,k)){const E=y.properties[k],P=Bh[k];(P===null||P.includes(y.tagName))&&(y.properties[k]=f(String(E||""),k,y))}}if(y.type==="element"){let k=e?!e.includes(y.tagName):s?s.includes(y.tagName):!1;if(!k&&t&&typeof w=="number"&&(k=!t(y,w,x)),k&&x&&typeof w=="number")return d&&y.children?x.children.splice(w,1,...y.children):x.children.splice(w,1),w}}}function RL(n){const e=n.indexOf(":"),t=n.indexOf("?"),r=n.indexOf("#"),i=n.indexOf("/");return e===-1||i!==-1&&e>i||t!==-1&&e>t||r!==-1&&e>r||TL.test(n.slice(0,e))?n:""}function $L({messages:n,onSendMessage:e,isLoading:t}){const[r,i]=he.useState(""),a=s=>{s.preventDefault(),r.trim()&&!t&&(e(r.trim()),i(""))};return ie.jsxs("div",{className:"flex flex-col h-full",children:[ie.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.map((s,o)=>ie.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:ie.jsx("div",{className:`max-w-[80%] rounded-lg p-4 ${s.role==="user"?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:ie.jsx(CL,{children:s.content})})},o)),t&&ie.jsx("div",{className:"flex justify-start",children:ie.jsx("div",{className:"bg-gray-100 rounded-lg p-4",children:ie.jsxs("div",{className:"animate-pulse flex space-x-2",children:[ie.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),ie.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),ie.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})]})})})]}),ie.jsx("form",{onSubmit:a,className:"p-4 border-t",children:ie.jsxs("div",{className:"flex space-x-4",children:[ie.jsx("input",{type:"text",value:r,onChange:s=>i(s.target.value),placeholder:"Ask a question about your documents...",className:"flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:t}),ie.jsx("button",{type:"submit",disabled:t||!r.trim(),className:"bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:ie.jsx(nR,{className:"w-5 h-5"})})]})})]})}const rg="RFC3986",ig={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},NL="RFC1738",jL=Array.isArray,Ar=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),Qh=1024,LL=(n,e,t,r,i)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let s="";for(let o=0;o<a.length;o+=Qh){const l=a.length>=Qh?a.slice(o,o+Qh):a,u=[];for(let c=0;c<l.length;++c){let d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||i===NL&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=Ar[d];continue}if(d<2048){u[u.length]=Ar[192|d>>6]+Ar[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=Ar[224|d>>12]+Ar[128|d>>6&63]+Ar[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=Ar[240|d>>18]+Ar[128|d>>12&63]+Ar[128|d>>6&63]+Ar[128|d&63]}s+=u.join("")}return s};function DL(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function Nv(n,e){if(jL(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const FL=Object.prototype.hasOwnProperty,l1={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},$r=Array.isArray,ML=Array.prototype.push,u1=function(n,e){ML.apply(n,$r(e)?e:[e])},UL=Date.prototype.toISOString,at={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:LL,encodeValuesOnly:!1,format:rg,formatter:ig[rg],indices:!1,serializeDate(n){return UL.call(n)},skipNulls:!1,strictNullHandling:!1};function zL(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const Yh={};function c1(n,e,t,r,i,a,s,o,l,u,c,d,f,h,p,m,_,g){let y=n,w=g,x=0,k=!1;for(;(w=w.get(Yh))!==void 0&&!k;){const j=w.get(n);if(x+=1,typeof j<"u"){if(j===x)throw new RangeError("Cyclic object value");k=!0}typeof w.get(Yh)>"u"&&(x=0)}if(typeof u=="function"?y=u(e,y):y instanceof Date?y=f==null?void 0:f(y):t==="comma"&&$r(y)&&(y=Nv(y,function(j){return j instanceof Date?f==null?void 0:f(j):j})),y===null){if(a)return l&&!m?l(e,at.encoder,_,"key",h):e;y=""}if(zL(y)||DL(y)){if(l){const j=m?e:l(e,at.encoder,_,"key",h);return[(p==null?void 0:p(j))+"="+(p==null?void 0:p(l(y,at.encoder,_,"value",h)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(y)))]}const E=[];if(typeof y>"u")return E;let P;if(t==="comma"&&$r(y))m&&l&&(y=Nv(y,l)),P=[{value:y.length>0?y.join(",")||null:void 0}];else if($r(u))P=u;else{const j=Object.keys(y);P=c?j.sort(c):j}const R=o?String(e).replace(/\./g,"%2E"):String(e),H=r&&$r(y)&&y.length===1?R+"[]":R;if(i&&$r(y)&&y.length===0)return H+"[]";for(let j=0;j<P.length;++j){const L=P[j],V=typeof L=="object"&&typeof L.value<"u"?L.value:y[L];if(s&&V===null)continue;const oe=d&&o?L.replace(/\./g,"%2E"):L,T=$r(y)?typeof t=="function"?t(H,oe):H:H+(d?"."+oe:"["+oe+"]");g.set(n,x);const S=new WeakMap;S.set(Yh,g),u1(E,c1(V,T,t,r,i,a,s,o,t==="comma"&&m&&$r(y)?null:l,u,c,d,f,h,p,m,_,S))}return E}function BL(n=at){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||at.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=rg;if(typeof n.format<"u"){if(!FL.call(ig,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=ig[t];let i=at.filter;(typeof n.filter=="function"||$r(n.filter))&&(i=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in l1?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=at.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const s=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:at.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:at.addQueryPrefix,allowDots:s,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:at.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:at.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?at.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:at.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:at.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:at.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:at.encodeValuesOnly,filter:i,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:at.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:at.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:at.strictNullHandling}}function HL(n,e={}){let t=n;const r=BL(e);let i,a;typeof r.filter=="function"?(a=r.filter,t=a("",t)):$r(r.filter)&&(a=r.filter,i=a);const s=[];if(typeof t!="object"||t===null)return"";const o=l1[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);const u=new WeakMap;for(let f=0;f<i.length;++f){const h=i[f];r.skipNulls&&t[h]===null||u1(s,c1(t[h],h,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const c=s.join(r.delimiter);let d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}const os="4.82.0";let jv=!1,wl,d1,f1,ag,h1,p1,m1,g1,y1;function VL(n,e={auto:!1}){if(jv)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(wl)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${wl}'\``);jv=e.auto,wl=n.kind,d1=n.fetch,f1=n.FormData,ag=n.File,h1=n.ReadableStream,p1=n.getMultipartRequestOptions,m1=n.getDefaultAgent,g1=n.fileFromPath,y1=n.isFsReadStream}class qL{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function GL({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,i,a;try{t=fetch,r=Request,i=Response,a=Headers}catch(s){throw new Error(`this environment is missing the following Web Fetch API type: ${s.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:i,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(s,o)=>({...o,body:new qL(s)}),getDefaultAgent:s=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:s=>!1}}wl||VL(GL(),{auto:!0});class ve extends Error{}class At extends ve{constructor(e,t,r,i){super(`${At.makeMessage(e,t,r)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"],this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,r){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,r,i){if(!e||!i)return new Tf({message:r,cause:og(t)});const a=t==null?void 0:t.error;return e===400?new w1(e,a,r,i):e===401?new _1(e,a,r,i):e===403?new b1(e,a,r,i):e===404?new v1(e,a,r,i):e===409?new x1(e,a,r,i):e===422?new E1(e,a,r,i):e===429?new k1(e,a,r,i):e>=500?new S1(e,a,r,i):new At(e,a,r,i)}}class zn extends At{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Tf extends At{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class If extends Tf{constructor({message:e}={}){super({message:e??"Request timed out."})}}class w1 extends At{}class _1 extends At{}class b1 extends At{}class v1 extends At{}class x1 extends At{}class E1 extends At{}class k1 extends At{}class S1 extends At{}class O1 extends ve{constructor(){super("Could not parse response content as the length limit was reached")}}class A1 extends ve{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Fa{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Fa.NEWLINE_CHARS.has(t[t.length-1]||"");let i=t.split(Fa.NEWLINE_REGEXP);return r&&i.pop(),i.length===1&&!r?(this.buffer.push(i[0]),[]):(this.buffer.length>0&&(i=[this.buffer.join("")+i[0],...i.slice(1)],this.buffer=[]),r||(this.buffer=[i.pop()||""]),i)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ve(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ve(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ve("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Fa.NEWLINE_CHARS=new Set([`
`,"\r"]);Fa.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function P1(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class Fr{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const s of WL(e,t))if(!a){if(s.data.startsWith("[DONE]")){a=!0;continue}if(s.event===null){let o;try{o=JSON.parse(s.data)}catch(l){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),l}if(o&&o.error)throw new At(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(s.data)}catch(l){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),l}if(s.event=="error")throw new At(void 0,o.error,o.message,void 0);yield{event:s.event,data:o}}}a=!0}catch(s){if(s instanceof Error&&s.name==="AbortError")return;throw s}finally{a||t.abort()}}return new Fr(i,t)}static fromReadableStream(e,t){let r=!1;async function*i(){const s=new Fa,o=P1(e);for await(const l of o)for(const u of s.decode(l))yield u;for(const l of s.flush())yield l}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const o of i())s||o&&(yield JSON.parse(o));s=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{s||t.abort()}}return new Fr(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),i=a=>({next:()=>{if(a.length===0){const s=r.next();e.push(s),t.push(s)}return a.shift()}});return[new Fr(()=>i(e),this.controller),new Fr(()=>i(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new h1({async start(){t=e[Symbol.asyncIterator]()},async pull(i){try{const{value:a,done:s}=await t.next();if(s)return i.close();const o=r.encode(JSON.stringify(a)+`
`);i.enqueue(o)}catch(a){i.error(a)}},async cancel(){var i;await((i=t.return)==null?void 0:i.call(t))}})}}async function*WL(n,e){if(!n.body)throw e.abort(),new ve("Attempted to iterate over a response with no body");const t=new ZL,r=new Fa,i=P1(n.body);for await(const a of KL(i))for(const s of r.decode(a)){const o=t.decode(s);o&&(yield o)}for(const a of r.flush()){const s=t.decode(a);s&&(yield s)}}async function*KL(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let i=new Uint8Array(e.length+r.length);i.set(e),i.set(r,e.length),e=i;let a;for(;(a=JL(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function JL(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class ZL{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,i]=XL(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}}function XL(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const T1=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",I1=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Cf(n),Cf=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",QL=n=>I1(n)||T1(n)||y1(n);async function C1(n,e,t){var i;if(n=await n,I1(n))return n;if(T1(n)){const a=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const s=Cf(a)?[await a.arrayBuffer()]:[a];return new ag(s,e,t)}const r=await YL(n);if(e||(e=t2(n)??"unknown_file"),!(t!=null&&t.type)){const a=(i=r[0])==null?void 0:i.type;typeof a=="string"&&(t={...t,type:a})}return new ag(r,e,t)}async function YL(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Cf(n))e.push(await n.arrayBuffer());else if(n2(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${e2(n)}`);return e}function e2(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function t2(n){var e;return ep(n.name)||ep(n.filename)||((e=ep(n.path))==null?void 0:e.split(/[\\/]/).pop())}const ep=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},n2=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Lv=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",eo=async n=>{const e=await r2(n.body);return p1(e,n)},r2=async n=>{const e=new f1;return await Promise.all(Object.entries(n||{}).map(([t,r])=>sg(e,t,r))),e},sg=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(QL(t)){const r=await C1(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>sg(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,i])=>sg(n,`${e}[${r}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Ms={},i2=function(n,e,t,r,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t},a2=function(n,e,t,r){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},dc;async function R1(n){const{response:e}=n;if(n.options.stream)return Us("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Fr.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const a=await e.json();return Us("response",e.status,e.url,e.headers,a),$1(a,e)}const i=await e.text();return Us("response",e.status,e.url,e.headers,i),i}function $1(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Rf extends Promise{constructor(e,t=R1){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Rf(this.responsePromise,async t=>$1(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class s2{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:i,fetch:a}){this.baseURL=e,this.maxRetries=tp("maxRetries",t),this.timeout=tp("timeout",r),this.httpAgent=i,this.fetch=a??d1}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...f2(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${g2()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async i=>{const a=i&&Cf(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:e,path:t,...i,body:a}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var m;const{method:r,path:i,query:a,headers:s={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Lv(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),u=this.buildURL(i,a);"timeout"in e&&tp("timeout",e.timeout);const c=e.timeout??this.timeout,d=e.httpAgent??this.httpAgent??m1(u),f=c+1e3;typeof((m=d==null?void 0:d.options)==null?void 0:m.timeout)=="number"&&f>(d.options.timeout??0)&&(d.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);const h=this.buildHeaders({options:e,headers:s,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:h,...d&&{agent:d},signal:e.signal??null},url:u,timeout:c}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:i}){const a={};r&&(a["content-length"]=r);const s=this.defaultHeaders(e);return Uv(a,s),Uv(a,t),Lv(e.body)&&wl!=="node"&&delete a["content-type"],Bv(s,"x-stainless-retry-count")===void 0&&Bv(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(i)),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,i){return At.generate(e,t,r,i)}request(e,t=null){return new Rf(this.makeRequest(e,t))}async makeRequest(e,t){var d,f;const r=await e,i=r.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(r);const{req:a,url:s,timeout:o}=this.buildRequest(r,{retryCount:i-t});if(await this.prepareRequest(a,{url:s,options:r}),Us("request",s,r,a.headers),(d=r.signal)!=null&&d.aborted)throw new zn;const l=new AbortController,u=await this.fetchWithTimeout(s,a,o,l).catch(og);if(u instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new zn;if(t)return this.retryRequest(r,t);throw u.name==="AbortError"?new If:new Tf({cause:u})}const c=l2(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const y=`retrying, ${t} attempts remaining`;return Us(`response (error; ${y})`,u.status,s,c),this.retryRequest(r,t,c)}const h=await u.text().catch(y=>og(y).message),p=h2(h),m=p?void 0:h;throw Us(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,s,c,m),this.makeStatusError(u.status,p,m,c)}return{response:u,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new o2(this,r,e)}buildURL(e,t){const r=m2(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return j1(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new ve(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,i){const{signal:a,...s}=t||{};a&&a.addEventListener("abort",()=>i.abort());const o=setTimeout(()=>i.abort(),r),l={signal:i.signal,...s};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let i;const a=r==null?void 0:r["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(i=o)}const s=r==null?void 0:r["retry-after"];if(s&&!i){const o=parseFloat(s);Number.isNaN(o)?i=Date.parse(s)-Date.now():i=o*1e3}if(!(i&&0<=i&&i<60*1e3)){const o=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Su(i),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,s=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return s*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${os}`}}class N1{constructor(e,t,r,i){dc.set(this,void 0),i2(this,dc,e),this.options=i,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ve("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[i,a]of r)e.url.searchParams.set(i,a);t.query=void 0,t.path=e.url.toString()}return await a2(this,dc,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(dc=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class o2 extends Rf{constructor(e,t,r){super(t,async i=>new r(e,i.response,await R1(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const l2=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),u2={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},hn=n=>typeof n=="object"&&n!==null&&!j1(n)&&Object.keys(n).every(e=>L1(u2,e)),c2=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":os,"X-Stainless-OS":Fv(Deno.build.os),"X-Stainless-Arch":Dv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":os,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":os,"X-Stainless-OS":Fv(process.platform),"X-Stainless-Arch":Dv(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=d2();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":os,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":os,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function d2(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const i=r[1]||0,a=r[2]||0,s=r[3]||0;return{browser:e,version:`${i}.${a}.${s}`}}}return null}const Dv=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Fv=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Mv;const f2=()=>Mv??(Mv=c2()),h2=n=>{try{return JSON.parse(n)}catch{return}},p2=/^[a-z][a-z0-9+.-]*:/i,m2=n=>p2.test(n),Su=n=>new Promise(e=>setTimeout(e,n)),tp=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ve(`${n} must be an integer`);if(e<0)throw new ve(`${n} must be a positive integer`);return e},og=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},fc=n=>{var e,t,r,i;if(typeof process<"u")return((e=Ms==null?void 0:Ms[n])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(r=(t=Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:i.trim()};function j1(n){if(!n)return!0;for(const e in n)return!1;return!0}function L1(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Uv(n,e){for(const t in e){if(!L1(e,t))continue;const r=t.toLowerCase();if(!r)continue;const i=e[t];i===null?delete n[r]:i!==void 0&&(n[r]=i)}}const zv=new Set(["authorization","api-key"]);function Us(n,...e){if(typeof process<"u"&&(Ms==null?void 0:Ms.DEBUG)==="true"){const t=e.map(r=>{if(!r)return r;if(r.headers){const a={...r,headers:{...r.headers}};for(const s in r.headers)zv.has(s.toLowerCase())&&(a.headers[s]="REDACTED");return a}let i=null;for(const a in r)zv.has(a.toLowerCase())&&(i??(i={...r}),i[a]="REDACTED");return i??r});console.log(`OpenAI:DEBUG:${n}`,...t)}}const g2=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),y2=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",w2=n=>typeof(n==null?void 0:n.get)=="function",Bv=(n,e)=>{var r;const t=e.toLowerCase();if(w2(n)){const i=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,s,o)=>s+o.toUpperCase());for(const a of[e,t,e.toUpperCase(),i]){const s=n.get(a);if(s)return s}}for(const[i,a]of Object.entries(n))if(i.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};function np(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class _2 extends N1{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class _r extends N1{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}class Te{constructor(e){this._client=e}}let D1=class extends Te{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},lw=class extends Te{constructor(){super(...arguments),this.completions=new D1(this._client)}};lw.Completions=D1;class F1 extends Te{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class M1 extends Te{create(e,t){return this._client.post("/audio/transcriptions",eo({body:e,...t}))}}class U1 extends Te{create(e,t){return this._client.post("/audio/translations",eo({body:e,...t}))}}class Ou extends Te{constructor(){super(...arguments),this.transcriptions=new M1(this._client),this.translations=new U1(this._client),this.speech=new F1(this._client)}}Ou.Transcriptions=M1;Ou.Translations=U1;Ou.Speech=F1;class uw extends Te{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return hn(e)?this.list({},e):this._client.getAPIList("/batches",cw,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class cw extends _r{}uw.BatchesPage=cw;class dw extends Te{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return hn(e)?this.list({},e):this._client.getAPIList("/assistants",fw,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class fw extends _r{}dw.AssistantsPage=fw;function Hv(n){return typeof n.parse=="function"}const zs=n=>(n==null?void 0:n.role)==="assistant",z1=n=>(n==null?void 0:n.role)==="function",B1=n=>(n==null?void 0:n.role)==="tool";var nr=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},Be=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},lg,Kc,Jc,Jo,Zo,Zc,Xo,Zr,Qo,$d,Nd,ls,H1;class V1{constructor(){lg.add(this),this.controller=new AbortController,Kc.set(this,void 0),Jc.set(this,()=>{}),Jo.set(this,()=>{}),Zo.set(this,void 0),Zc.set(this,()=>{}),Xo.set(this,()=>{}),Zr.set(this,{}),Qo.set(this,!1),$d.set(this,!1),Nd.set(this,!1),ls.set(this,!1),nr(this,Kc,new Promise((e,t)=>{nr(this,Jc,e,"f"),nr(this,Jo,t,"f")}),"f"),nr(this,Zo,new Promise((e,t)=>{nr(this,Zc,e,"f"),nr(this,Xo,t,"f")}),"f"),Be(this,Kc,"f").catch(()=>{}),Be(this,Zo,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Be(this,lg,"m",H1).bind(this))},0)}_connected(){this.ended||(Be(this,Jc,"f").call(this),this._emit("connect"))}get ended(){return Be(this,Qo,"f")}get errored(){return Be(this,$d,"f")}get aborted(){return Be(this,Nd,"f")}abort(){this.controller.abort()}on(e,t){return(Be(this,Zr,"f")[e]||(Be(this,Zr,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Be(this,Zr,"f")[e];if(!r)return this;const i=r.findIndex(a=>a.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(Be(this,Zr,"f")[e]||(Be(this,Zr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{nr(this,ls,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){nr(this,ls,!0,"f"),await Be(this,Zo,"f")}_emit(e,...t){if(Be(this,Qo,"f"))return;e==="end"&&(nr(this,Qo,!0,"f"),Be(this,Zc,"f").call(this));const r=Be(this,Zr,"f")[e];if(r&&(Be(this,Zr,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!Be(this,ls,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Be(this,Jo,"f").call(this,i),Be(this,Xo,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!Be(this,ls,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Be(this,Jo,"f").call(this,i),Be(this,Xo,"f").call(this,i),this._emit("end")}}_emitFinal(){}}Kc=new WeakMap,Jc=new WeakMap,Jo=new WeakMap,Zo=new WeakMap,Zc=new WeakMap,Xo=new WeakMap,Zr=new WeakMap,Qo=new WeakMap,$d=new WeakMap,Nd=new WeakMap,ls=new WeakMap,lg=new WeakSet,H1=function(e){if(nr(this,$d,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new zn),e instanceof zn)return nr(this,Nd,!0,"f"),this._emit("abort",e);if(e instanceof ve)return this._emit("error",e);if(e instanceof Error){const t=new ve(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ve(String(e)))};function q1(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function Au(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function b2(n,e){return!e||!G1(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:hw(n,e)}function hw(n,e){const t=n.choices.map(r=>{var i;if(r.finish_reason==="length")throw new O1;if(r.finish_reason==="content_filter")throw new A1;return{...r,message:{...r.message,tool_calls:((i=r.message.tool_calls)==null?void 0:i.map(a=>x2(e,a)))??[],parsed:r.message.content&&!r.message.refusal?v2(e,r.message.content):null}}});return{...n,choices:t}}function v2(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function x2(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(i=>{var a;return((a=i.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Au(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function E2(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(i=>{var a;return((a=i.function)==null?void 0:a.name)===e.function.name});return Au(t)||(t==null?void 0:t.function.strict)||!1}function G1(n){var e;return q1(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>Au(t)||t.type==="function"&&t.function.strict===!0))??!1}function k2(n){for(const e of n??[]){if(e.type!=="function")throw new ve(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new ve(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var tn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},It,ug,jd,cg,dg,fg,W1,hg;const Vv=10;class K1 extends V1{constructor(){super(...arguments),It.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(z1(e)||B1(e))&&e.content)this._emit("functionCallResult",e.content);else if(zs(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(zs(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ve("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),tn(this,It,"m",ug).call(this)}async finalMessage(){return await this.done(),tn(this,It,"m",jd).call(this)}async finalFunctionCall(){return await this.done(),tn(this,It,"m",cg).call(this)}async finalFunctionCallResult(){return await this.done(),tn(this,It,"m",dg).call(this)}async totalUsage(){return await this.done(),tn(this,It,"m",fg).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=tn(this,It,"m",jd).call(this);t&&this._emit("finalMessage",t);const r=tn(this,It,"m",ug).call(this);r&&this._emit("finalContent",r);const i=tn(this,It,"m",cg).call(this);i&&this._emit("finalFunctionCall",i);const a=tn(this,It,"m",dg).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(s=>s.usage)&&this._emit("totalUsage",tn(this,It,"m",fg).call(this))}async _createChatCompletion(e,t,r){const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),tn(this,It,"m",W1).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(hw(a,t))}async _runChatCompletion(e,t,r){for(const i of t.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;const i="function",{function_call:a="auto",stream:s,...o}=t,l=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:u=Vv}=r||{},c={};for(const h of t.functions)c[h.name||h.function.name]=h;const d=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<u;++h){const m=(f=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!m)throw new ve("missing message in ChatCompletion response");if(!m.function_call)return;const{name:_,arguments:g}=m.function_call,y=c[_];if(y){if(l&&l!==_){const E=`Invalid function_call: ${JSON.stringify(_)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,name:_,content:E});continue}}else{const E=`Invalid function_call: ${JSON.stringify(_)}. Available options are: ${d.map(P=>JSON.stringify(P.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:_,content:E});continue}let w;try{w=Hv(y)?await y.parse(g):g}catch(E){this._addMessage({role:i,name:_,content:E instanceof Error?E.message:String(E)});continue}const x=await y.function(w,this),k=tn(this,It,"m",hg).call(this,x);if(this._addMessage({role:i,name:_,content:k}),l)return}}async _runTools(e,t,r){var h,p,m;const i="tool",{tool_choice:a="auto",stream:s,...o}=t,l=typeof a!="string"&&((h=a==null?void 0:a.function)==null?void 0:h.name),{maxChatCompletions:u=Vv}=r||{},c=t.tools.map(_=>{if(Au(_)){if(!_.$callback)throw new ve("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:_.$callback,name:_.function.name,description:_.function.description||"",parameters:_.function.parameters,parse:_.$parseRaw,strict:!0}}}return _}),d={};for(const _ of c)_.type==="function"&&(d[_.function.name||_.function.function.name]=_.function);const f="tools"in t?c.map(_=>_.type==="function"?{type:"function",function:{name:_.function.name||_.function.function.name,parameters:_.function.parameters,description:_.function.description,strict:_.function.strict}}:_):void 0;for(const _ of t.messages)this._addMessage(_,!1);for(let _=0;_<u;++_){const y=(p=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:f,messages:[...this.messages]},r)).choices[0])==null?void 0:p.message;if(!y)throw new ve("missing message in ChatCompletion response");if(!((m=y.tool_calls)!=null&&m.length))return;for(const w of y.tool_calls){if(w.type!=="function")continue;const x=w.id,{name:k,arguments:E}=w.function,P=d[k];if(P){if(l&&l!==k){const L=`Invalid tool_call: ${JSON.stringify(k)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,tool_call_id:x,content:L});continue}}else{const L=`Invalid tool_call: ${JSON.stringify(k)}. Available options are: ${Object.keys(d).map(V=>JSON.stringify(V)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:x,content:L});continue}let R;try{R=Hv(P)?await P.parse(E):E}catch(L){const V=L instanceof Error?L.message:String(L);this._addMessage({role:i,tool_call_id:x,content:V});continue}const H=await P.function(R,this),j=tn(this,It,"m",hg).call(this,H);if(this._addMessage({role:i,tool_call_id:x,content:j}),l)return}}}}It=new WeakSet,ug=function(){return tn(this,It,"m",jd).call(this).content??null},jd=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(zs(t)){const{function_call:r,...i}=t,a={...i,content:t.content??null,refusal:t.refusal??null};return r&&(a.function_call=r),a}}throw new ve("stream ended without producing a ChatCompletionMessage with role=assistant")},cg=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const i=this.messages[r];if(zs(i)&&(i!=null&&i.function_call))return i.function_call;if(zs(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(t=i.tool_calls.at(-1))==null?void 0:t.function}},dg=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(z1(t)&&t.content!=null||B1(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var i;return r.role==="assistant"&&((i=r.tool_calls)==null?void 0:i.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},fg=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},W1=function(e){if(e.n!=null&&e.n>1)throw new ve("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},hg=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Jl extends K1{static runFunctions(e,t,r){const i=new Jl,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,t,a)),i}static runTools(e,t,r){const i=new Jl,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,a)),i}_addMessage(e,t=!0){super._addMessage(e,t),zs(e)&&e.content&&this._emit("content",e.content)}}const J1=1,Z1=2,X1=4,Q1=8,Y1=16,eO=32,tO=64,nO=128,rO=256,S2=nO|rO,O2=Y1|eO|S2|tO,A2=J1|Z1|O2,P2=X1|Q1,T2=A2|P2,dt={STR:J1,NUM:Z1,ARR:X1,OBJ:Q1,NULL:Y1,BOOL:eO,NAN:tO,INFINITY:nO,MINUS_INFINITY:rO,ALL:T2};class I2 extends Error{}class C2 extends Error{}function R2(n,e=dt.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return $2(n.trim(),e)}const $2=(n,e)=>{const t=n.length;let r=0;const i=f=>{throw new I2(`${f} at position ${r}`)},a=f=>{throw new C2(`${f} at position ${r}`)},s=()=>(d(),r>=t&&i("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?l():n[r]==="["?u():n.substring(r,r+4)==="null"||dt.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||dt.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||dt.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||dt.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||dt.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||dt.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):c()),o=()=>{const f=r;let h=!1;for(r++;r<t&&(n[r]!=='"'||h&&n[r-1]==="\\");)h=n[r]==="\\"?!h:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(f,++r-Number(h)))}catch(p){a(String(p))}else if(dt.STR&e)try{return JSON.parse(n.substring(f,r-Number(h))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},l=()=>{r++,d();const f={};try{for(;n[r]!=="}";){if(d(),r>=t&&dt.OBJ&e)return f;const h=o();d(),r++;try{const p=s();Object.defineProperty(f,h,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(dt.OBJ&e)return f;throw p}d(),n[r]===","&&r++}}catch{if(dt.OBJ&e)return f;i("Expected '}' at end of object")}return r++,f},u=()=>{r++;const f=[];try{for(;n[r]!=="]";)f.push(s()),d(),n[r]===","&&r++}catch{if(dt.ARR&e)return f;i("Expected ']' at end of array")}return r++,f},c=()=>{if(r===0){n==="-"&&dt.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n)}catch(h){if(dt.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}a(String(h))}}const f=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(dt.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(n.substring(f,r))}catch{n.substring(f,r)==="-"&&dt.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(p){a(String(p))}}},d=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return s()},qv=n=>R2(n,dt.ALL^dt.NUM);var Qa=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},$e=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},it,Wr,Ya,yi,rp,hc,ip,ap,sp,pc,op,Gv;class Zl extends K1{constructor(e){super(),it.add(this),Wr.set(this,void 0),Ya.set(this,void 0),yi.set(this,void 0),Qa(this,Wr,e,"f"),Qa(this,Ya,[],"f")}get currentChatCompletionSnapshot(){return $e(this,yi,"f")}static fromReadableStream(e){const t=new Zl(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const i=new Zl(t);return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,t,r){var s;super._createChatCompletion;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),$e(this,it,"m",rp).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)$e(this,it,"m",ip).call(this,o);if((s=a.controller.signal)!=null&&s.aborted)throw new zn;return this._addChatCompletion($e(this,it,"m",pc).call(this))}async _fromReadableStream(e,t){var s;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),$e(this,it,"m",rp).call(this),this._connected();const i=Fr.fromReadableStream(e,this.controller);let a;for await(const o of i)a&&a!==o.id&&this._addChatCompletion($e(this,it,"m",pc).call(this)),$e(this,it,"m",ip).call(this,o),a=o.id;if((s=i.controller.signal)!=null&&s.aborted)throw new zn;return this._addChatCompletion($e(this,it,"m",pc).call(this))}[(Wr=new WeakMap,Ya=new WeakMap,yi=new WeakMap,it=new WeakSet,rp=function(){this.ended||Qa(this,yi,void 0,"f")},hc=function(t){let r=$e(this,Ya,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},$e(this,Ya,"f")[t.index]=r,r)},ip=function(t){var i,a,s,o,l,u,c,d,f,h,p,m,_,g,y;if(this.ended)return;const r=$e(this,it,"m",Gv).call(this,t);this._emit("chunk",t,r);for(const w of t.choices){const x=r.choices[w.index];w.delta.content!=null&&((i=x.message)==null?void 0:i.role)==="assistant"&&((a=x.message)!=null&&a.content)&&(this._emit("content",w.delta.content,x.message.content),this._emit("content.delta",{delta:w.delta.content,snapshot:x.message.content,parsed:x.message.parsed})),w.delta.refusal!=null&&((s=x.message)==null?void 0:s.role)==="assistant"&&((o=x.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:w.delta.refusal,snapshot:x.message.refusal}),((l=w.logprobs)==null?void 0:l.content)!=null&&((u=x.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(c=w.logprobs)==null?void 0:c.content,snapshot:((d=x.logprobs)==null?void 0:d.content)??[]}),((f=w.logprobs)==null?void 0:f.refusal)!=null&&((h=x.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=w.logprobs)==null?void 0:p.refusal,snapshot:((m=x.logprobs)==null?void 0:m.refusal)??[]});const k=$e(this,it,"m",hc).call(this,x);x.finish_reason&&($e(this,it,"m",sp).call(this,x),k.current_tool_call_index!=null&&$e(this,it,"m",ap).call(this,x,k.current_tool_call_index));for(const E of w.delta.tool_calls??[])k.current_tool_call_index!==E.index&&($e(this,it,"m",sp).call(this,x),k.current_tool_call_index!=null&&$e(this,it,"m",ap).call(this,x,k.current_tool_call_index)),k.current_tool_call_index=E.index;for(const E of w.delta.tool_calls??[]){const P=(_=x.message.tool_calls)==null?void 0:_[E.index];P!=null&&P.type&&((P==null?void 0:P.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(g=P.function)==null?void 0:g.name,index:E.index,arguments:P.function.arguments,parsed_arguments:P.function.parsed_arguments,arguments_delta:((y=E.function)==null?void 0:y.arguments)??""}):(P==null||P.type,void 0))}}},ap=function(t,r){var s,o,l;if($e(this,it,"m",hc).call(this,t).done_tool_calls.has(r))return;const a=(s=t.message.tool_calls)==null?void 0:s[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const u=(l=(o=$e(this,Wr,"f"))==null?void 0:o.tools)==null?void 0:l.find(c=>c.type==="function"&&c.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Au(u)?u.$parseRaw(a.function.arguments):u!=null&&u.function.strict?JSON.parse(a.function.arguments):null})}else a.type},sp=function(t){var i,a;const r=$e(this,it,"m",hc).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const s=$e(this,it,"m",op).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(i=t.logprobs)!=null&&i.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},pc=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=$e(this,yi,"f");if(!t)throw new ve("request ended without sending any chunks");return Qa(this,yi,void 0,"f"),Qa(this,Ya,[],"f"),N2(t,$e(this,Wr,"f"))},op=function(){var r;const t=(r=$e(this,Wr,"f"))==null?void 0:r.response_format;return q1(t)?t:null},Gv=function(t){var r,i,a,s;let o=$e(this,yi,"f");const{choices:l,...u}=t;o?Object.assign(o,u):o=Qa(this,yi,{...u,choices:[]},"f");for(const{delta:c,finish_reason:d,index:f,logprobs:h=null,...p}of t.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:h,...p}),h)if(!m.logprobs)m.logprobs=Object.assign({},h);else{const{content:E,refusal:P,...R}=h;Object.assign(m.logprobs,R),E&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...E)),P&&((i=m.logprobs).refusal??(i.refusal=[]),m.logprobs.refusal.push(...P))}if(d&&(m.finish_reason=d,$e(this,Wr,"f")&&G1($e(this,Wr,"f")))){if(d==="length")throw new O1;if(d==="content_filter")throw new A1}if(Object.assign(m,p),!c)continue;const{content:_,refusal:g,function_call:y,role:w,tool_calls:x,...k}=c;if(Object.assign(m.message,k),g&&(m.message.refusal=(m.message.refusal||"")+g),w&&(m.message.role=w),y&&(m.message.function_call?(y.name&&(m.message.function_call.name=y.name),y.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=y.arguments)):m.message.function_call=y),_&&(m.message.content=(m.message.content||"")+_,!m.message.refusal&&$e(this,it,"m",op).call(this)&&(m.message.parsed=qv(m.message.content))),x){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:E,id:P,type:R,function:H,...j}of x){const L=(s=m.message.tool_calls)[E]??(s[E]={});Object.assign(L,j),P&&(L.id=P),R&&(L.type=R),H&&(L.function??(L.function={name:H.name??"",arguments:""})),H!=null&&H.name&&(L.function.name=H.name),H!=null&&H.arguments&&(L.function.arguments+=H.arguments,E2($e(this,Wr,"f"),L)&&(L.function.parsed_arguments=qv(L.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Fr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function N2(n,e){const{id:t,choices:r,created:i,model:a,system_fingerprint:s,...o}=n,l={...o,id:t,choices:r.map(({message:u,finish_reason:c,index:d,logprobs:f,...h})=>{if(!c)throw new ve(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:_,...g}=u,y=u.role;if(!y)throw new ve(`missing role for choice ${d}`);if(m){const{arguments:w,name:x}=m;if(w==null)throw new ve(`missing function_call.arguments for choice ${d}`);if(!x)throw new ve(`missing function_call.name for choice ${d}`);return{...h,message:{content:p,function_call:{arguments:w,name:x},role:y,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}return _?{...h,index:d,finish_reason:c,logprobs:f,message:{...g,role:y,content:p,refusal:u.refusal??null,tool_calls:_.map((w,x)=>{const{function:k,type:E,id:P,...R}=w,{arguments:H,name:j,...L}=k||{};if(P==null)throw new ve(`missing choices[${d}].tool_calls[${x}].id
${mc(n)}`);if(E==null)throw new ve(`missing choices[${d}].tool_calls[${x}].type
${mc(n)}`);if(j==null)throw new ve(`missing choices[${d}].tool_calls[${x}].function.name
${mc(n)}`);if(H==null)throw new ve(`missing choices[${d}].tool_calls[${x}].function.arguments
${mc(n)}`);return{...R,id:P,type:E,function:{...L,name:j,arguments:H}}})}}:{...h,message:{...g,content:p,role:y,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}),created:i,model:a,object:"chat.completion",...s?{system_fingerprint:s}:{}};return b2(l,e)}function mc(n){return JSON.stringify(n)}class Bs extends Zl{static fromReadableStream(e){const t=new Bs(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const i=new Bs(null),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,t,a)),i}static runTools(e,t,r){const i=new Bs(t),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,a)),i}}let iO=class extends Te{parse(e,t){return k2(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>hw(r,e))}runFunctions(e,t){return e.stream?Bs.runFunctions(this._client,e,t):Jl.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Bs.runTools(this._client,e,t):Jl.runTools(this._client,e,t)}stream(e,t){return Zl.createChatCompletion(this._client,e,t)}};class pg extends Te{constructor(){super(...arguments),this.completions=new iO(this._client)}}(function(n){n.Completions=iO})(pg||(pg={}));class aO extends Te{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class pw extends Te{constructor(){super(...arguments),this.sessions=new aO(this._client)}}pw.Sessions=aO;var ee=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},_n=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},vt,mg,Nr,Xc,ir,xa,ks,ma,Ld,xn,Qc,Yc,_l,Yo,el,Wv,Kv,Jv,Zv,Xv,Qv,Yv;class lr extends V1{constructor(){super(...arguments),vt.add(this),mg.set(this,[]),Nr.set(this,{}),Xc.set(this,{}),ir.set(this,void 0),xa.set(this,void 0),ks.set(this,void 0),ma.set(this,void 0),Ld.set(this,void 0),xn.set(this,void 0),Qc.set(this,void 0),Yc.set(this,void 0),_l.set(this,void 0)}[(mg=new WeakMap,Nr=new WeakMap,Xc=new WeakMap,ir=new WeakMap,xa=new WeakMap,ks=new WeakMap,ma=new WeakMap,Ld=new WeakMap,xn=new WeakMap,Qc=new WeakMap,Yc=new WeakMap,_l=new WeakMap,vt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new lr;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Fr.fromReadableStream(e,this.controller);for await(const s of i)ee(this,vt,"m",Yo).call(this,s);if((a=i.controller.signal)!=null&&a.aborted)throw new zn;return this._addRun(ee(this,vt,"m",el).call(this))}toReadableStream(){return new Fr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,i,a){const s=new lr;return s._run(()=>s._runToolAssistantStream(e,t,r,i,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,t,r,i,a){var u;const s=a==null?void 0:a.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const o={...i,stream:!0},l=await e.submitToolOutputs(t,r,o,{...a,signal:this.controller.signal});this._connected();for await(const c of l)ee(this,vt,"m",Yo).call(this,c);if((u=l.controller.signal)!=null&&u.aborted)throw new zn;return this._addRun(ee(this,vt,"m",el).call(this))}static createThreadAssistantStream(e,t,r){const i=new lr;return i._run(()=>i._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,t,r,i){const a=new lr;return a._run(()=>a._runAssistantStream(e,t,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return ee(this,Qc,"f")}currentRun(){return ee(this,Yc,"f")}currentMessageSnapshot(){return ee(this,ir,"f")}currentRunStepSnapshot(){return ee(this,_l,"f")}async finalRunSteps(){return await this.done(),Object.values(ee(this,Nr,"f"))}async finalMessages(){return await this.done(),Object.values(ee(this,Xc,"f"))}async finalRun(){if(await this.done(),!ee(this,xa,"f"))throw Error("Final run was not received.");return ee(this,xa,"f")}async _createThreadAssistantStream(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},s=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(const l of s)ee(this,vt,"m",Yo).call(this,l);if((o=s.controller.signal)!=null&&o.aborted)throw new zn;return this._addRun(ee(this,vt,"m",el).call(this))}async _createAssistantStream(e,t,r,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const s={...r,stream:!0},o=await e.create(t,s,{...i,signal:this.controller.signal});this._connected();for await(const u of o)ee(this,vt,"m",Yo).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new zn;return this._addRun(ee(this,vt,"m",el).call(this))}static accumulateDelta(e,t){for(const[r,i]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=i;continue}let a=e[r];if(a==null){e[r]=i;continue}if(r==="index"||r==="type"){e[r]=i;continue}if(typeof a=="string"&&typeof i=="string")a+=i;else if(typeof a=="number"&&typeof i=="number")a+=i;else if(np(a)&&np(i))a=this.accumulateDelta(a,i);else if(Array.isArray(a)&&Array.isArray(i)){if(a.every(s=>typeof s=="string"||typeof s=="number")){a.push(...i);continue}for(const s of i){if(!np(s))throw new Error(`Expected array delta entry to be an object but got: ${s}`);const o=s.index;if(o==null)throw console.error(s),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=a[o];l==null?a.push(s):a[o]=this.accumulateDelta(l,s)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${i}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,i){return await this._createAssistantStream(t,e,r,i)}async _runToolAssistantStream(e,t,r,i,a){return await this._createToolAssistantStream(r,e,t,i,a)}}Yo=function(e){if(!this.ended)switch(_n(this,Qc,e,"f"),ee(this,vt,"m",Jv).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ee(this,vt,"m",Yv).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ee(this,vt,"m",Kv).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ee(this,vt,"m",Wv).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},el=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");if(!ee(this,xa,"f"))throw Error("Final run has not been received");return ee(this,xa,"f")},Wv=function(e){const[t,r]=ee(this,vt,"m",Xv).call(this,e,ee(this,ir,"f"));_n(this,ir,t,"f"),ee(this,Xc,"f")[t.id]=t;for(const i of r){const a=t.content[i.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let a=i.text,s=t.content[i.index];if(s&&s.type=="text")this._emit("textDelta",a,s.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=ee(this,ks,"f")){if(ee(this,ma,"f"))switch(ee(this,ma,"f").type){case"text":this._emit("textDone",ee(this,ma,"f").text,ee(this,ir,"f"));break;case"image_file":this._emit("imageFileDone",ee(this,ma,"f").image_file,ee(this,ir,"f"));break}_n(this,ks,i.index,"f")}_n(this,ma,t.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(ee(this,ks,"f")!==void 0){const i=e.data.content[ee(this,ks,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,ee(this,ir,"f"));break;case"text":this._emit("textDone",i.text,ee(this,ir,"f"));break}}ee(this,ir,"f")&&this._emit("messageDone",e.data),_n(this,ir,void 0,"f")}},Kv=function(e){const t=ee(this,vt,"m",Zv).call(this,e);switch(_n(this,_l,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of r.step_details.tool_calls)a.index==ee(this,Ld,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(ee(this,xn,"f")&&this._emit("toolCallDone",ee(this,xn,"f")),_n(this,Ld,a.index,"f"),_n(this,xn,t.step_details.tool_calls[a.index],"f"),ee(this,xn,"f")&&this._emit("toolCallCreated",ee(this,xn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":_n(this,_l,void 0,"f"),e.data.step_details.type=="tool_calls"&&ee(this,xn,"f")&&(this._emit("toolCallDone",ee(this,xn,"f")),_n(this,xn,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Jv=function(e){ee(this,mg,"f").push(e),this._emit("event",e)},Zv=function(e){switch(e.event){case"thread.run.step.created":return ee(this,Nr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=ee(this,Nr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const i=lr.accumulateDelta(t,r.delta);ee(this,Nr,"f")[e.data.id]=i}return ee(this,Nr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ee(this,Nr,"f")[e.data.id]=e.data;break}if(ee(this,Nr,"f")[e.data.id])return ee(this,Nr,"f")[e.data.id];throw new Error("No snapshot available")},Xv=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const a of i.delta.content)if(a.index in t.content){let s=t.content[a.index];t.content[a.index]=ee(this,vt,"m",Qv).call(this,a,s)}else t.content[a.index]=a,r.push(a);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Qv=function(e,t){return lr.accumulateDelta(t,e)},Yv=function(e){switch(_n(this,Yc,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":_n(this,xa,e.data,"f"),ee(this,xn,"f")&&(this._emit("toolCallDone",ee(this,xn,"f")),_n(this,xn,void 0,"f"));break}};class mw extends Te{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,i){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t={},r){return hn(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,gw,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class gw extends _r{}mw.MessagesPage=gw;class yw extends Te{retrieve(e,t,r,i={},a){return hn(i)?this.retrieve(e,t,r,{},i):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:i,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,r={},i){return hn(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,ww,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class ww extends _r{}yw.RunStepsPage=ww;class Pu extends Te{constructor(){super(...arguments),this.steps=new yw(this._client)}create(e,t,r){const{include:i,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,i){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t={},r){return hn(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,_w,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const i=await this.create(e,t,r);return await this.poll(e,i.id,r)}createAndStream(e,t,r){return lr.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:a,response:s}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...i}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=s.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Su(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,r){return lr.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,i){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,i){const a=await this.submitToolOutputs(e,t,r,i);return await this.poll(e,a.id,i)}submitToolOutputsStream(e,t,r,i){return lr.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,i)}}class _w extends _r{}Pu.RunsPage=_w;Pu.Steps=yw;Pu.RunStepsPage=ww;class go extends Te{constructor(){super(...arguments),this.runs=new Pu(this._client),this.messages=new mw(this._client)}create(e={},t){return hn(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return lr.createThreadAssistantStream(e,this._client.beta.threads,t)}}go.Runs=Pu;go.RunsPage=_w;go.Messages=mw;go.MessagesPage=gw;const j2=async n=>{const e=await Promise.allSettled(n),t=e.filter(i=>i.status==="rejected");if(t.length){for(const i of t)console.error(i.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const i of e)i.status==="fulfilled"&&r.push(i.value);return r};let bw=class extends Te{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return hn(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,$f,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const i=await this.create(e,t,r);return await this.poll(e,i.id,r)}async poll(e,t,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...r,headers:i}).withResponse(),s=a.data;switch(s.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Su(o);break;case"failed":case"completed":return s}}}async upload(e,t,r){const i=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:i.id},r)}async uploadAndPoll(e,t,r){const i=await this.upload(e,t,r);return await this.poll(e,i.id,r)}};class $f extends _r{}bw.VectorStoreFilesPage=$f;class sO extends Te{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const i=await this.create(e,t);return await this.poll(e,i.id,r)}listFiles(e,t,r={},i){return hn(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,$f,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,t,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:a,response:s}=await this.retrieve(e,t,{...r,headers:i}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=s.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Su(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},i){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(i==null?void 0:i.maxConcurrency)??5,s=Math.min(a,t.length),o=this._client,l=t.values(),u=[...r];async function c(f){for(let h of f){const p=await o.files.create({file:h,purpose:"assistants"},i);u.push(p.id)}}const d=Array(s).fill(l).map(c);return await j2(d),await this.createAndPoll(e,{file_ids:u})}}class yo extends Te{constructor(){super(...arguments),this.files=new bw(this._client),this.fileBatches=new sO(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return hn(e)?this.list({},e):this._client.getAPIList("/vector_stores",vw,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class vw extends _r{}yo.VectorStoresPage=vw;yo.Files=bw;yo.VectorStoreFilesPage=$f;yo.FileBatches=sO;class sa extends Te{constructor(){super(...arguments),this.realtime=new pw(this._client),this.vectorStores=new yo(this._client),this.chat=new pg(this._client),this.assistants=new dw(this._client),this.threads=new go(this._client)}}sa.Realtime=pw;sa.VectorStores=yo;sa.VectorStoresPage=vw;sa.Assistants=dw;sa.AssistantsPage=fw;sa.Threads=go;class oO extends Te{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}let lO=class extends Te{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};class xw extends Te{create(e,t){return this._client.post("/files",eo({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return hn(e)?this.list({},e):this._client.getAPIList("/files",Ew,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),a=Date.now();let s=await this.retrieve(e);for(;!s.status||!i.has(s.status);)if(await Su(t),s=await this.retrieve(e),Date.now()-a>r)throw new If({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return s}}class Ew extends _r{}xw.FileObjectsPage=Ew;class kw extends Te{list(e,t={},r){return hn(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Sw,{query:t,...r})}}class Sw extends _r{}kw.FineTuningJobCheckpointsPage=Sw;class wo extends Te{constructor(){super(...arguments),this.checkpoints=new kw(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return hn(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Ow,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return hn(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Aw,{query:t,...r})}}class Ow extends _r{}class Aw extends _r{}wo.FineTuningJobsPage=Ow;wo.FineTuningJobEventsPage=Aw;wo.Checkpoints=kw;wo.FineTuningJobCheckpointsPage=Sw;class Tu extends Te{constructor(){super(...arguments),this.jobs=new wo(this._client)}}Tu.Jobs=wo;Tu.FineTuningJobsPage=Ow;Tu.FineTuningJobEventsPage=Aw;class uO extends Te{createVariation(e,t){return this._client.post("/images/variations",eo({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",eo({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Pw extends Te{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Tw,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Tw extends _2{}Pw.ModelsPage=Tw;class cO extends Te{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class dO extends Te{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,eo({body:t,...r}))}}class Iw extends Te{constructor(){super(...arguments),this.parts=new dO(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}Iw.Parts=dO;var fO;let Ee=class extends s2{constructor({baseURL:e=fc("OPENAI_BASE_URL"),apiKey:t=fc("OPENAI_API_KEY"),organization:r=fc("OPENAI_ORG_ID")??null,project:i=fc("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new ve("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const s={apiKey:t,organization:r,project:i,...a,baseURL:e||"https://api.openai.com/v1"};if(!s.dangerouslyAllowBrowser&&y2())throw new ve(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:s.baseURL,timeout:s.timeout??6e5,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new oO(this),this.chat=new lw(this),this.embeddings=new lO(this),this.files=new xw(this),this.images=new uO(this),this.audio=new Ou(this),this.moderations=new cO(this),this.models=new Pw(this),this.fineTuning=new Tu(this),this.beta=new sa(this),this.batches=new uw(this),this.uploads=new Iw(this),this._options=s,this.apiKey=t,this.organization=r,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return HL(e,{arrayFormat:"brackets"})}};fO=Ee;Ee.OpenAI=fO;Ee.DEFAULT_TIMEOUT=6e5;Ee.OpenAIError=ve;Ee.APIError=At;Ee.APIConnectionError=Tf;Ee.APIConnectionTimeoutError=If;Ee.APIUserAbortError=zn;Ee.NotFoundError=v1;Ee.ConflictError=x1;Ee.RateLimitError=k1;Ee.BadRequestError=w1;Ee.AuthenticationError=_1;Ee.InternalServerError=S1;Ee.PermissionDeniedError=b1;Ee.UnprocessableEntityError=E1;Ee.toFile=C1;Ee.fileFromPath=g1;Ee.Completions=oO;Ee.Chat=lw;Ee.Embeddings=lO;Ee.Files=xw;Ee.FileObjectsPage=Ew;Ee.Images=uO;Ee.Audio=Ou;Ee.Moderations=cO;Ee.Models=Pw;Ee.ModelsPage=Tw;Ee.FineTuning=Tu;Ee.Beta=sa;Ee.Batches=uw;Ee.BatchesPage=cw;Ee.Uploads=Iw;function L2(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,i=!1;for(let a of n){if(r)a==='"'&&!i?r=!1:a===`
`&&!i?a="\\n":a==="\\"?i=!i:i=!1;else if(a==='"')r=!0,i=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}r&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}var D2=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const hO=uo(D2);var pO={exports:{}};const F2=/[\p{Lu}]/u,M2=/[\p{Ll}]/u,e0=/^[\p{Lu}](?![\p{Lu}])/gu,mO=/([\p{Alpha}\p{N}_]|$)/u,gO=/[_.\- ]+/,U2=new RegExp("^"+gO.source),t0=new RegExp(gO.source+mO.source,"gu"),n0=new RegExp("\\d+"+mO.source,"gu"),z2=(n,e,t)=>{let r=!1,i=!1,a=!1;for(let s=0;s<n.length;s++){const o=n[s];r&&F2.test(o)?(n=n.slice(0,s)+"-"+n.slice(s),r=!1,a=i,i=!0,s++):i&&a&&M2.test(o)?(n=n.slice(0,s-1)+"-"+n.slice(s-1),a=i,i=!1,r=!0):(r=e(o)===o&&t(o)!==o,a=i,i=t(o)===o&&e(o)!==o)}return n},B2=(n,e)=>(e0.lastIndex=0,n.replace(e0,t=>e(t))),H2=(n,e)=>(t0.lastIndex=0,n0.lastIndex=0,n.replace(t0,(t,r)=>e(r)).replace(n0,t=>e(t))),yO=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(a=>a.trim()).filter(a=>a.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),r=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=z2(n,t,r)),n=n.replace(U2,""),e.preserveConsecutiveUppercase?n=B2(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),H2(n,r))};pO.exports=yO;pO.exports.default=yO;function V2(n,e){return(e==null?void 0:e[n])||hO(n)}function q2(n,e,t){const r={};for(const i in n)Object.hasOwn(n,i)&&(r[e(i,t)]=n[i]);return r}function r0(n){return Array.isArray(n)?[...n]:{...n}}function G2(n,e){const t=r0(n);for(const[r,i]of Object.entries(e)){const[a,...s]=r.split(".").reverse();let o=t;for(const l of s.reverse()){if(o[l]===void 0)break;o[l]=r0(o[l]),o=o[l]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[i]})}return t}function wO(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}let Xl=class _O{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,wO(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof _O||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((i,a)=>(i[a]=a in this?this[a]:this.lc_kwargs[a],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(r,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let a=this,s=r;const[o,...l]=i.split(".").reverse();for(const u of l.reverse()){if(!(u in a)||a[u]===void 0)return;(!(u in s)||s[u]===void 0)&&(typeof a[u]=="object"&&a[u]!=null?s[u]={}:Array.isArray(a[u])&&(s[u]=[])),a=a[u],s=s[u]}o in a&&a[o]!==void 0&&(s[o]=s[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:q2(Object.keys(t).length?G2(r,t):r,V2,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function _o(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?[...n,...e]:[...n,{type:"text",text:e}]}let Iu=class extends Xl{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}};function pn(n,e){const t={...n};for(const[r,i]of Object.entries(e))if(t[r]==null)t[r]=i;else{if(i==null)continue;if(typeof t[r]!=typeof i||Array.isArray(t[r])!==Array.isArray(i))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string")t[r]=t[r]+i;else if(!Array.isArray(t[r])&&typeof t[r]=="object")t[r]=pn(t[r],i);else if(Array.isArray(t[r]))t[r]=bO(t[r],i);else{if(t[r]===i)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function bO(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const i=t.findIndex(a=>a.index===r.index);i!==-1?t[i]=pn(t[i],r):t.push(r)}else t.push(r);return t}}}let bo=class extends Iu{};function W2(n){return typeof(n==null?void 0:n._getType)=="function"}class Cw extends bo{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Cw({content:_o(this.content,e.content),additional_kwargs:pn(this.additional_kwargs,e.additional_kwargs),response_metadata:pn(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}}function K2(n){const e=[],t=[];for(const r of n)if(r.function){const i=r.function.name;try{const a=JSON.parse(r.function.arguments),s={name:i||"",args:a||{},id:r.id};e.push(s)}catch{t.push({name:i,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}let vO=class extends Iu{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var i;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const a=(i=r.additional_kwargs)==null?void 0:i.tool_calls,s=r.tool_calls;a!=null&&a.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&s===void 0){const[o,l]=K2(a);r.tool_calls=o??[],r.invalid_tool_calls=l??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}},xO=class EO extends bo{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const r=[],i=[];for(const a of e.tool_call_chunks){let s={};try{if(s=L2(a.args??"{}")??{},typeof s!="object"||Array.isArray(s))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:s,id:a.id})}catch{i.push({name:a.name,args:a.args,id:a.id,error:"Malformed args."})}}t={...e,tool_calls:r,invalid_tool_calls:i}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=(t==null?void 0:t.tool_call_chunks)??this.tool_call_chunks,this.tool_calls=(t==null?void 0:t.tool_calls)??this.tool_calls,this.invalid_tool_calls=(t==null?void 0:t.invalid_tool_calls)??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const t={content:_o(this.content,e.content),additional_kwargs:pn(this.additional_kwargs,e.additional_kwargs),response_metadata:pn(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const r=bO(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}return new EO(t)}},kO=class SO extends Iu{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return SO}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}};class Rw extends bo{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Rw({content:_o(this.content,e.content),additional_kwargs:pn(this.additional_kwargs,e.additional_kwargs),response_metadata:pn(this.response_metadata,e.response_metadata),role:this.role})}}class $w extends bo{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new $w({content:_o(this.content,e.content),additional_kwargs:pn(this.additional_kwargs,e.additional_kwargs),response_metadata:pn(this.response_metadata,e.response_metadata),name:this.name??""})}}let Dd=class extends Iu{static lc_name(){return"HumanMessage"}_getType(){return"human"}};class Nw extends bo{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Nw({content:_o(this.content,e.content),additional_kwargs:pn(this.additional_kwargs,e.additional_kwargs),response_metadata:pn(this.response_metadata,e.response_metadata)})}}let J2=class extends Iu{static lc_name(){return"SystemMessage"}_getType(){return"system"}};class jw extends bo{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new jw({content:_o(this.content,e.content),additional_kwargs:pn(this.additional_kwargs,e.additional_kwargs),response_metadata:pn(this.response_metadata,e.response_metadata)})}}function tl(n){if(typeof n=="string")return new Dd(n);if(W2(n))return n;const[e,t]=n;if(e==="human"||e==="user")return new Dd({content:t});if(e==="ai"||e==="assistant")return new vO({content:t});if(e==="system")return new J2({content:t});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function OO(n,e="Human",t="AI"){const r=[];for(const i of n){let a;if(i._getType()==="human")a=e;else if(i._getType()==="ai")a=t;else if(i._getType()==="system")a="System";else if(i._getType()==="function")a="Function";else if(i._getType()==="tool")a="Tool";else if(i._getType()==="generic")a=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);const s=i.name?`${i.name}, `:"";r.push(`${a}: ${s}${i.content}`)}return r.join(`
`)}const i0="__run";let Z2=class AO{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new AO({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}};class Lw extends Z2{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Lw({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}var lp={};const X2=()=>typeof window<"u"&&typeof window.document<"u",Q2=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Y2=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),PO=()=>typeof Deno<"u",eD=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!PO(),tD=()=>{let n;return X2()?n="browser":eD()?n="node":Q2()?n="webworker":Y2()?n="jsdom":PO()?n="deno":n="other",n};let up;async function nD(){return up===void 0&&(up={library:"langchain-js",runtime:tD()}),up}function Ze(n){try{return typeof process<"u"?lp==null?void 0:lp[n]:void 0}catch{return}}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var rD=typeof window=="object"?window:{},pe="0123456789abcdef".split(""),iD=[-2147483648,8388608,32768,128],Xn=[24,16,8,0],ut=[];function gr(n){n?(ut[0]=ut[16]=ut[1]=ut[2]=ut[3]=ut[4]=ut[5]=ut[6]=ut[7]=ut[8]=ut[9]=ut[10]=ut[11]=ut[12]=ut[13]=ut[14]=ut[15]=0,this.blocks=ut):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}gr.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===rD.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,i,a=n.length||0,s=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)for(i=this.start;r<a&&i<64;++r)s[i>>2]|=n[r]<<Xn[i++&3];else for(i=this.start;r<a&&i<64;++r)t=n.charCodeAt(r),t<128?s[i>>2]|=t<<Xn[i++&3]:t<2048?(s[i>>2]|=(192|t>>6)<<Xn[i++&3],s[i>>2]|=(128|t&63)<<Xn[i++&3]):t<55296||t>=57344?(s[i>>2]|=(224|t>>12)<<Xn[i++&3],s[i>>2]|=(128|t>>6&63)<<Xn[i++&3],s[i>>2]|=(128|t&63)<<Xn[i++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),s[i>>2]|=(240|t>>18)<<Xn[i++&3],s[i>>2]|=(128|t>>12&63)<<Xn[i++&3],s[i>>2]|=(128|t>>6&63)<<Xn[i++&3],s[i>>2]|=(128|t&63)<<Xn[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=s[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};gr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=iD[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};gr.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a,s,o,l=this.blocks;for(s=16;s<80;++s)o=l[s-3]^l[s-8]^l[s-14]^l[s-16],l[s]=o<<1|o>>>31;for(s=0;s<20;s+=5)a=e&t|~e&r,o=n<<5|n>>>27,i=o+a+i+1518500249+l[s]<<0,e=e<<30|e>>>2,a=n&e|~n&t,o=i<<5|i>>>27,r=o+a+r+1518500249+l[s+1]<<0,n=n<<30|n>>>2,a=i&n|~i&e,o=r<<5|r>>>27,t=o+a+t+1518500249+l[s+2]<<0,i=i<<30|i>>>2,a=r&i|~r&n,o=t<<5|t>>>27,e=o+a+e+1518500249+l[s+3]<<0,r=r<<30|r>>>2,a=t&r|~t&i,o=e<<5|e>>>27,n=o+a+n+1518500249+l[s+4]<<0,t=t<<30|t>>>2;for(;s<40;s+=5)a=e^t^r,o=n<<5|n>>>27,i=o+a+i+1859775393+l[s]<<0,e=e<<30|e>>>2,a=n^e^t,o=i<<5|i>>>27,r=o+a+r+1859775393+l[s+1]<<0,n=n<<30|n>>>2,a=i^n^e,o=r<<5|r>>>27,t=o+a+t+1859775393+l[s+2]<<0,i=i<<30|i>>>2,a=r^i^n,o=t<<5|t>>>27,e=o+a+e+1859775393+l[s+3]<<0,r=r<<30|r>>>2,a=t^r^i,o=e<<5|e>>>27,n=o+a+n+1859775393+l[s+4]<<0,t=t<<30|t>>>2;for(;s<60;s+=5)a=e&t|e&r|t&r,o=n<<5|n>>>27,i=o+a+i-1894007588+l[s]<<0,e=e<<30|e>>>2,a=n&e|n&t|e&t,o=i<<5|i>>>27,r=o+a+r-1894007588+l[s+1]<<0,n=n<<30|n>>>2,a=i&n|i&e|n&e,o=r<<5|r>>>27,t=o+a+t-1894007588+l[s+2]<<0,i=i<<30|i>>>2,a=r&i|r&n|i&n,o=t<<5|t>>>27,e=o+a+e-1894007588+l[s+3]<<0,r=r<<30|r>>>2,a=t&r|t&i|r&i,o=e<<5|e>>>27,n=o+a+n-1894007588+l[s+4]<<0,t=t<<30|t>>>2;for(;s<80;s+=5)a=e^t^r,o=n<<5|n>>>27,i=o+a+i-899497514+l[s]<<0,e=e<<30|e>>>2,a=n^e^t,o=i<<5|i>>>27,r=o+a+r-899497514+l[s+1]<<0,n=n<<30|n>>>2,a=i^n^e,o=r<<5|r>>>27,t=o+a+t-899497514+l[s+2]<<0,i=i<<30|i>>>2,a=r^i^n,o=t<<5|t>>>27,e=o+a+e-899497514+l[s+3]<<0,r=r<<30|r>>>2,a=t^r^i,o=e<<5|e>>>27,n=o+a+n-899497514+l[s+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+i<<0};gr.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4;return pe[n>>28&15]+pe[n>>24&15]+pe[n>>20&15]+pe[n>>16&15]+pe[n>>12&15]+pe[n>>8&15]+pe[n>>4&15]+pe[n&15]+pe[e>>28&15]+pe[e>>24&15]+pe[e>>20&15]+pe[e>>16&15]+pe[e>>12&15]+pe[e>>8&15]+pe[e>>4&15]+pe[e&15]+pe[t>>28&15]+pe[t>>24&15]+pe[t>>20&15]+pe[t>>16&15]+pe[t>>12&15]+pe[t>>8&15]+pe[t>>4&15]+pe[t&15]+pe[r>>28&15]+pe[r>>24&15]+pe[r>>20&15]+pe[r>>16&15]+pe[r>>12&15]+pe[r>>8&15]+pe[r>>4&15]+pe[r&15]+pe[i>>28&15]+pe[i>>24&15]+pe[i>>20&15]+pe[i>>16&15]+pe[i>>12&15]+pe[i>>8&15]+pe[i>>4&15]+pe[i&15]};gr.prototype.toString=gr.prototype.hex;gr.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,i>>24&255,i>>16&255,i>>8&255,i&255]};gr.prototype.array=gr.prototype.digest;gr.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};const aD=n=>new gr(!0).update(n).hex(),a0=(...n)=>aD(n.join("_"));let sD=class{};const oD=new Map;let lD=class TO extends sD{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(a0(e,t))??null)}async update(e,t,r){this.cache.set(a0(e,t),r)}static global(){return new TO(oD)}},IO=class extends Xl{},uD=class extends IO{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Dd(this.value)]}},cD=class extends IO{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return OO(this.messages)}toChatMessages(){return this.messages}};var Nf={exports:{}},CO={};function Gn(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var dD=Gn;Gn.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Gn.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Gn.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};Gn.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Gn.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};Gn.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};Gn.prototype.start=Gn.prototype.try;Gn.prototype.errors=function(){return this._errors};Gn.prototype.attempts=function(){return this._attempts};Gn.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var i=this._errors[r],a=i.message,s=(n[a]||0)+1;n[a]=s,s>=t&&(e=i,t=s)}return e};(function(n){var e=dD;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)r[i]=t[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],s=0;s<r.retries;s++)a.push(this.createTimeout(s,r));return t&&t.forever&&!a.length&&a.push(this.createTimeout(s,r)),a.sort(function(o,l){return o-l}),a},n.createTimeout=function(t,r){var i=r.randomize?Math.random()+1:1,a=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return a=Math.min(a,r.maxTimeout),a},n.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var a in t)typeof t[a]=="function"&&i.push(a)}for(var s=0;s<i.length;s++){var o=i[s],l=t[o];t[o]=(function(c){var d=n.operation(r),f=Array.prototype.slice.call(arguments,1),h=f.pop();f.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),h.apply(this,arguments))}),d.attempt(function(){c.apply(t,f)})}).bind(t,l),t[o].options=r}}})(CO);var fD=CO;const hD=fD,pD=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class RO extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const mD=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},gD=n=>pD.includes(n),$O=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const i=hD.operation(e);i.attempt(async a=>{try{t(await n(a))}catch(s){if(!(s instanceof Error)){r(new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`));return}if(s instanceof RO)i.stop(),r(s.originalError);else if(s instanceof TypeError&&!gD(s.message))i.stop(),r(s);else{mD(s,a,e);try{await e.onFailedAttempt(s)}catch(o){r(o);return}i.retry(s)||r(i.mainError())}}})});Nf.exports=$O;Nf.exports.default=$O;Nf.exports.AbortError=RO;var yD=Nf.exports;const Ki=uo(yD);var NO={},jO={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new i(c,d||l,f),p=t?t+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function s(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,f,h,p){var m=t?t+u:u;if(!this._events[m])return!1;var _=this._events[m],g=arguments.length,y,w;if(_.fn){switch(_.once&&this.removeListener(u,_.fn,void 0,!0),g){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,c),!0;case 3:return _.fn.call(_.context,c,d),!0;case 4:return _.fn.call(_.context,c,d,f),!0;case 5:return _.fn.call(_.context,c,d,f,h),!0;case 6:return _.fn.call(_.context,c,d,f,h,p),!0}for(w=1,y=new Array(g-1);w<g;w++)y[w-1]=arguments[w];_.fn.apply(_.context,y)}else{var x=_.length,k;for(w=0;w<x;w++)switch(_[w].once&&this.removeListener(u,_[w].fn,void 0,!0),g){case 1:_[w].fn.call(_[w].context);break;case 2:_[w].fn.call(_[w].context,c);break;case 3:_[w].fn.call(_[w].context,c,d);break;case 4:_[w].fn.call(_[w].context,c,d,f);break;default:if(!y)for(k=1,y=new Array(g-1);k<g;k++)y[k-1]=arguments[k];_[w].fn.apply(_[w].context,y)}}return!0},o.prototype.on=function(u,c,d){return a(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return a(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,f){var h=t?t+u:u;if(!this._events[h])return this;if(!c)return s(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&s(this,h);else{for(var m=0,_=[],g=p.length;m<g;m++)(p[m].fn!==c||f&&!p[m].once||d&&p[m].context!==d)&&_.push(p[m]);_.length?this._events[h]=_.length===1?_[0]:_:s(this,h)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&s(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(jO);var wD=jO.exports,jf={exports:{}},_D=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const bD=_D;class LO extends Error{constructor(e){super(e),this.name="TimeoutError"}}const DO=(n,e,t)=>new Promise((r,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const a=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(l){i(l)}return}const s=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new LO(s);typeof n.cancel=="function"&&n.cancel(),i(o)},e);bD(n.then(r,i),()=>{clearTimeout(a)})});jf.exports=DO;jf.exports.default=DO;jf.exports.TimeoutError=LO;var vD=jf.exports,Dw={},Fw={};Object.defineProperty(Fw,"__esModule",{value:!0});function xD(n,e,t){let r=0,i=n.length;for(;i>0;){const a=i/2|0;let s=r+a;t(n[s],e)<=0?(r=++s,i-=a+1):i=a}return r}Fw.default=xD;Object.defineProperty(Dw,"__esModule",{value:!0});const ED=Fw;class kD{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const i=ED.default(this._queue,r,(a,s)=>s.priority-a.priority);this._queue.splice(i,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Dw.default=kD;Object.defineProperty(NO,"__esModule",{value:!0});const SD=wD,FO=vD,OD=Dw,gc=()=>{},AD=new FO.TimeoutError;class PD extends SD{constructor(e){var t,r,i,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=gc,this._resolveIdle=gc,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:OD.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=gc,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=gc,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{const a=async()=>{this._pendingCount++,this._intervalCount++;try{const s=this._timeout===void 0&&t.timeout===void 0?e():FO.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&i(AD)});r(await s)}catch(s){i(s)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var gt=NO.default=PD;const TD=[400,401,402,403,404,405,406,407,409],ID=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&TD.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const i=new Error(n==null?void 0:n.message);throw i.name="InsufficientQuotaError",i}};let Lf=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??ID;const t="default"in gt?gt.default:gt;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Ki(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,a)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var Df={};Df.byteLength=$D;Df.toByteArray=jD;Df.fromByteArray=FD;var Dr=[],Ln=[],CD=typeof Uint8Array<"u"?Uint8Array:Array,cp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var es=0,RD=cp.length;es<RD;++es)Dr[es]=cp[es],Ln[cp.charCodeAt(es)]=es;Ln[45]=62;Ln[95]=63;function MO(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function $D(n){var e=MO(n),t=e[0],r=e[1];return(t+r)*3/4-r}function ND(n,e,t){return(e+t)*3/4-t}function jD(n){var e,t=MO(n),r=t[0],i=t[1],a=new CD(ND(n,r,i)),s=0,o=i>0?r-4:r,l;for(l=0;l<o;l+=4)e=Ln[n.charCodeAt(l)]<<18|Ln[n.charCodeAt(l+1)]<<12|Ln[n.charCodeAt(l+2)]<<6|Ln[n.charCodeAt(l+3)],a[s++]=e>>16&255,a[s++]=e>>8&255,a[s++]=e&255;return i===2&&(e=Ln[n.charCodeAt(l)]<<2|Ln[n.charCodeAt(l+1)]>>4,a[s++]=e&255),i===1&&(e=Ln[n.charCodeAt(l)]<<10|Ln[n.charCodeAt(l+1)]<<4|Ln[n.charCodeAt(l+2)]>>2,a[s++]=e>>8&255,a[s++]=e&255),a}function LD(n){return Dr[n>>18&63]+Dr[n>>12&63]+Dr[n>>6&63]+Dr[n&63]}function DD(n,e,t){for(var r,i=[],a=e;a<t;a+=3)r=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(n[a+2]&255),i.push(LD(r));return i.join("")}function FD(n){for(var e,t=n.length,r=t%3,i=[],a=16383,s=0,o=t-r;s<o;s+=a)i.push(DD(n,s,s+a>o?o:s+a));return r===1?(e=n[t-1],i.push(Dr[e>>2]+Dr[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Dr[e>>10]+Dr[e>>4&63]+Dr[e<<2&63]+"=")),i.join("")}var MD=Object.defineProperty,UD=(n,e,t)=>e in n?MD(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,zD=(n,e,t)=>(UD(n,e+"",t),t);function BD(n,e){let t=Array.from({length:n.length},(r,i)=>({start:i,end:i+1}));for(;t.length>1;){let r=null;for(let i=0;i<t.length-1;i++){const a=n.slice(t[i].start,t[i+1].end),s=e.get(a.join(","));s!=null&&(r==null||s<r[0])&&(r=[s,i])}if(r!=null){const i=r[1];t[i]={start:t[i].start,end:t[i+1].end},t.splice(i+1,1)}else break}return t}function HD(n,e){return n.length===1?[e.get(n.join(","))]:BD(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function VD(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var gg=class{constructor(n,e){pi(this,"specialTokens");pi(this,"inverseSpecialTokens");pi(this,"patStr");pi(this,"textEncoder",new TextEncoder);pi(this,"textDecoder",new TextDecoder("utf-8"));pi(this,"rankMap",new Map);pi(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,i)=>{const[a,s,...o]=i.split(" "),l=Number.parseInt(s,10);return o.forEach((u,c)=>r[u]=l+c),r},{});for(const[r,i]of Object.entries(t)){const a=Df.toByteArray(r);this.rankMap.set(a.join(","),i),this.textMap.set(i,a)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[i,a])=>(r[a]=this.textEncoder.encode(i),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),i=gg.specialTokenRegex(Object.keys(this.specialTokens)),a=[],s=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!s.has(u)):t);if(o.size>0){const u=gg.specialTokenRegex([...o]),c=n.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;i.lastIndex=c,u=i.exec(n),!(u==null||s.has(u[0]));)c=u.index+1;const d=(u==null?void 0:u.index)??n.length;for(const h of n.substring(l,d).matchAll(r)){const p=this.textEncoder.encode(h[0]),m=this.rankMap.get(p.join(","));if(m!=null){a.push(m);continue}a.push(...HD(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];a.push(f),l=u.index+u[0].length}return a}decode(n){const e=[];let t=0;for(let a=0;a<n.length;++a){const s=n[a],o=this.textMap.get(s)??this.inverseSpecialTokens[s];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let i=0;for(const a of e)r.set(a,i),i+=a.length;return this.textDecoder.decode(r)}},Mw=gg;zD(Mw,"specialTokenRegex",n=>new RegExp(n.map(e=>VD(e)).join("|"),"g"));function UO(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const yc={},qD=new Lf({});async function GD(n){return n in yc||(yc[n]=qD.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new Mw(e)).catch(e=>{throw delete yc[n],e})),await yc[n]}async function WD(n){return GD(UO(n))}var Se;(function(n){n.assertEqual=i=>i;function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const a={};for(const s of i)a[s]=s;return a},n.getValidEnumValues=i=>{const a=n.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(const o of a)s[o]=i[o];return n.objectValues(s)},n.objectValues=i=>n.objectKeys(i).map(function(a){return i[a]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const a=[];for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},n.find=(i,a)=>{for(const s of i)if(a(s))return s},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function r(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}n.joinValues=r,n.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Se||(Se={}));var yg;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(yg||(yg={}));const W=Se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ti=n=>{switch(typeof n){case"undefined":return W.undefined;case"string":return W.string;case"number":return isNaN(n)?W.nan:W.number;case"boolean":return W.boolean;case"function":return W.function;case"bigint":return W.bigint;case"symbol":return W.symbol;case"object":return Array.isArray(n)?W.array:n===null?W.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?W.promise:typeof Map<"u"&&n instanceof Map?W.map:typeof Set<"u"&&n instanceof Set?W.set:typeof Date<"u"&&n instanceof Date?W.date:W.object;default:return W.unknown}},M=Se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),KD=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class In extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},r={_errors:[]},i=a=>{for(const s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)r._errors.push(t(s));else{let o=r,l=0;for(;l<s.path.length;){const u=s.path[l];l===s.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(s))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return i(this),r}static assert(e){if(!(e instanceof In))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}In.create=n=>new In(n);const to=(n,e)=>{let t;switch(n.code){case M.invalid_type:n.received===W.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case M.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,Se.jsonStringifyReplacer)}`;break;case M.unrecognized_keys:t=`Unrecognized key(s) in object: ${Se.joinValues(n.keys,", ")}`;break;case M.invalid_union:t="Invalid input";break;case M.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Se.joinValues(n.options)}`;break;case M.invalid_enum_value:t=`Invalid enum value. Expected ${Se.joinValues(n.options)}, received '${n.received}'`;break;case M.invalid_arguments:t="Invalid function arguments";break;case M.invalid_return_type:t="Invalid function return type";break;case M.invalid_date:t="Invalid date";break;case M.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:Se.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case M.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case M.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case M.custom:t="Invalid input";break;case M.invalid_intersection_types:t="Intersection results could not be merged";break;case M.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case M.not_finite:t="Number must be finite";break;default:t=e.defaultError,Se.assertNever(n)}return{message:t}};let zO=to;function JD(n){zO=n}function Fd(){return zO}const Md=n=>{const{data:e,path:t,errorMaps:r,issueData:i}=n,a=[...t,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="";const l=r.filter(u=>!!u).slice().reverse();for(const u of l)o=u(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},ZD=[];function q(n,e){const t=Fd(),r=Md({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===to?void 0:to].filter(i=>!!i)});n.common.issues.push(r)}class Lt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const i of t){if(i.status==="aborted")return ae;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const i of t){const a=await i.key,s=await i.value;r.push({key:a,value:s})}return Lt.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const i of t){const{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return ae;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}}const ae=Object.freeze({status:"aborted"}),Ss=n=>({status:"dirty",value:n}),qt=n=>({status:"valid",value:n}),wg=n=>n.status==="aborted",_g=n=>n.status==="dirty",Ma=n=>n.status==="valid",Ql=n=>typeof Promise<"u"&&n instanceof Promise;function Ud(n,e,t,r){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function BO(n,e,t,r,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var J;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(J||(J={}));var nl,rl;class Hr{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const s0=(n,e)=>{if(Ma(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new In(n.common.issues);return this._error=t,this._error}}};function ce(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:i}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var l,u;const{message:c}=n;return s.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(u=c??t)!==null&&u!==void 0?u:o.defaultError}},description:i}}class ye{get description(){return this._def.description}_getType(e){return ti(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ti(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Lt,ctx:{common:e.parent.common,data:e.data,parsedType:ti(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ql(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const i={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ti(e)},a=this._parseSync({data:e,path:i.path,parent:i});return s0(i,a)}"~validate"(e){var t,r;const i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ti(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:i});return Ma(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((r=(t=a==null?void 0:a.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Ma(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ti(e)},i=this._parse({data:e,path:r.path,parent:r}),a=await(Ql(i)?i:Promise.resolve(i));return s0(r,a)}refine(e,t){const r=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,a)=>{const s=e(i),o=()=>a.addIssue({code:M.custom,...r(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(l=>l?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new yr({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return hr.create(this,this._def)}nullable(){return Qi.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return fr.create(this)}promise(){return ro.create(this,this._def)}or(e){return nu.create([this,e],this._def)}and(e){return ru.create(this,e,this._def)}transform(e){return new yr({...ce(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new lu({...ce(this._def),innerType:this,defaultValue:t,typeName:B.ZodDefault})}brand(){return new Uw({typeName:B.ZodBranded,type:this,...ce(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new uu({...ce(this._def),innerType:this,catchValue:t,typeName:B.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Cu.create(this,e)}readonly(){return cu.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const XD=/^c[^\s-]{8,}$/i,QD=/^[0-9a-z]+$/,YD=/^[0-9A-HJKMNP-TV-Z]{26}$/i,eF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,tF=/^[a-z0-9_-]{21}$/i,nF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,rF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,iF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,aF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let dp;const sF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,oF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,lF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,uF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,cF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,HO="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",fF=new RegExp(`^${HO}$`);function VO(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function hF(n){return new RegExp(`^${VO(n)}$`)}function qO(n){let e=`${HO}T${VO(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function pF(n,e){return!!((e==="v4"||!e)&&sF.test(n)||(e==="v6"||!e)&&lF.test(n))}function mF(n,e){if(!nF.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function gF(n,e){return!!((e==="v4"||!e)&&oF.test(n)||(e==="v6"||!e)&&uF.test(n))}class ur extends ye{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==W.string){const a=this._getOrReturnCtx(e);return q(a,{code:M.invalid_type,expected:W.string,received:a.parsedType}),ae}const r=new Lt;let i;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),q(i,{code:M.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),q(i,{code:M.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?q(i,{code:M.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&q(i,{code:M.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")iF.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"email",code:M.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")dp||(dp=new RegExp(aF,"u")),dp.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"emoji",code:M.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")eF.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"uuid",code:M.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")tF.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"nanoid",code:M.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")XD.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"cuid",code:M.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")QD.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"cuid2",code:M.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")YD.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"ulid",code:M.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),q(i,{validation:"url",code:M.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"regex",code:M.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),q(i,{code:M.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),q(i,{code:M.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),q(i,{code:M.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?qO(a).test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{code:M.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?fF.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{code:M.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?hF(a).test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{code:M.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?rF.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"duration",code:M.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?pF(e.data,a.version)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"ip",code:M.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?mF(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"jwt",code:M.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?gF(e.data,a.version)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"cidr",code:M.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?cF.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"base64",code:M.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?dF.test(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{validation:"base64url",code:M.invalid_string,message:a.message}),r.dirty()):Se.assertNever(a);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(i=>e.test(i),{validation:t,code:M.invalid_string,...J.errToObj(r)})}_addCheck(e){return new ur({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...J.errToObj(e)})}url(e){return this._addCheck({kind:"url",...J.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...J.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...J.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...J.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...J.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...J.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...J.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...J.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...J.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...J.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...J.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...J.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...J.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...J.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...J.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...J.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...J.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...J.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...J.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...J.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...J.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...J.errToObj(t)})}nonempty(e){return this.min(1,J.errToObj(e))}trim(){return new ur({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ur({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ur({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ur.create=n=>{var e;return new ur({checks:[],typeName:B.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...ce(n)})};function yF(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,a=parseInt(n.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}class Ji extends ye{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==W.number){const a=this._getOrReturnCtx(e);return q(a,{code:M.invalid_type,expected:W.number,received:a.parsedType}),ae}let r;const i=new Lt;for(const a of this._def.checks)a.kind==="int"?Se.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{code:M.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),q(r,{code:M.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),q(r,{code:M.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?yF(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),q(r,{code:M.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{code:M.not_finite,message:a.message}),i.dirty()):Se.assertNever(a);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,J.toString(t))}gt(e,t){return this.setLimit("min",e,!1,J.toString(t))}lte(e,t){return this.setLimit("max",e,!0,J.toString(t))}lt(e,t){return this.setLimit("max",e,!1,J.toString(t))}setLimit(e,t,r,i){return new Ji({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:J.toString(i)}]})}_addCheck(e){return new Ji({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:J.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:J.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:J.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:J.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:J.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:J.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:J.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:J.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:J.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Se.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ji.create=n=>new Ji({checks:[],typeName:B.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...ce(n)});class Zi extends ye{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==W.bigint)return this._getInvalidInput(e);let r;const i=new Lt;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),q(r,{code:M.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),q(r,{code:M.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),q(r,{code:M.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Se.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return q(t,{code:M.invalid_type,expected:W.bigint,received:t.parsedType}),ae}gte(e,t){return this.setLimit("min",e,!0,J.toString(t))}gt(e,t){return this.setLimit("min",e,!1,J.toString(t))}lte(e,t){return this.setLimit("max",e,!0,J.toString(t))}lt(e,t){return this.setLimit("max",e,!1,J.toString(t))}setLimit(e,t,r,i){return new Zi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:J.toString(i)}]})}_addCheck(e){return new Zi({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:J.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:J.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:J.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:J.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:J.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Zi.create=n=>{var e;return new Zi({checks:[],typeName:B.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...ce(n)})};class Yl extends ye{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==W.boolean){const r=this._getOrReturnCtx(e);return q(r,{code:M.invalid_type,expected:W.boolean,received:r.parsedType}),ae}return qt(e.data)}}Yl.create=n=>new Yl({typeName:B.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...ce(n)});class Ua extends ye{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==W.date){const a=this._getOrReturnCtx(e);return q(a,{code:M.invalid_type,expected:W.date,received:a.parsedType}),ae}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return q(a,{code:M.invalid_date}),ae}const r=new Lt;let i;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),q(i,{code:M.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),q(i,{code:M.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Se.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ua({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:J.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:J.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Ua.create=n=>new Ua({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:B.ZodDate,...ce(n)});class zd extends ye{_parse(e){if(this._getType(e)!==W.symbol){const r=this._getOrReturnCtx(e);return q(r,{code:M.invalid_type,expected:W.symbol,received:r.parsedType}),ae}return qt(e.data)}}zd.create=n=>new zd({typeName:B.ZodSymbol,...ce(n)});class eu extends ye{_parse(e){if(this._getType(e)!==W.undefined){const r=this._getOrReturnCtx(e);return q(r,{code:M.invalid_type,expected:W.undefined,received:r.parsedType}),ae}return qt(e.data)}}eu.create=n=>new eu({typeName:B.ZodUndefined,...ce(n)});class tu extends ye{_parse(e){if(this._getType(e)!==W.null){const r=this._getOrReturnCtx(e);return q(r,{code:M.invalid_type,expected:W.null,received:r.parsedType}),ae}return qt(e.data)}}tu.create=n=>new tu({typeName:B.ZodNull,...ce(n)});class no extends ye{constructor(){super(...arguments),this._any=!0}_parse(e){return qt(e.data)}}no.create=n=>new no({typeName:B.ZodAny,...ce(n)});class Pa extends ye{constructor(){super(...arguments),this._unknown=!0}_parse(e){return qt(e.data)}}Pa.create=n=>new Pa({typeName:B.ZodUnknown,...ce(n)});class di extends ye{_parse(e){const t=this._getOrReturnCtx(e);return q(t,{code:M.invalid_type,expected:W.never,received:t.parsedType}),ae}}di.create=n=>new di({typeName:B.ZodNever,...ce(n)});class Bd extends ye{_parse(e){if(this._getType(e)!==W.undefined){const r=this._getOrReturnCtx(e);return q(r,{code:M.invalid_type,expected:W.void,received:r.parsedType}),ae}return qt(e.data)}}Bd.create=n=>new Bd({typeName:B.ZodVoid,...ce(n)});class fr extends ye{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==W.array)return q(t,{code:M.invalid_type,expected:W.array,received:t.parsedType}),ae;if(i.exactLength!==null){const s=t.data.length>i.exactLength.value,o=t.data.length<i.exactLength.value;(s||o)&&(q(t,{code:s?M.too_big:M.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(q(t,{code:M.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(q(t,{code:M.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((s,o)=>i.type._parseAsync(new Hr(t,s,t.path,o)))).then(s=>Lt.mergeArray(r,s));const a=[...t.data].map((s,o)=>i.type._parseSync(new Hr(t,s,t.path,o)));return Lt.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new fr({...this._def,minLength:{value:e,message:J.toString(t)}})}max(e,t){return new fr({...this._def,maxLength:{value:e,message:J.toString(t)}})}length(e,t){return new fr({...this._def,exactLength:{value:e,message:J.toString(t)}})}nonempty(e){return this.min(1,e)}}fr.create=(n,e)=>new fr({type:n,minLength:null,maxLength:null,exactLength:null,typeName:B.ZodArray,...ce(e)});function us(n){if(n instanceof Ve){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=hr.create(us(r))}return new Ve({...n._def,shape:()=>e})}else return n instanceof fr?new fr({...n._def,type:us(n.element)}):n instanceof hr?hr.create(us(n.unwrap())):n instanceof Qi?Qi.create(us(n.unwrap())):n instanceof Vr?Vr.create(n.items.map(e=>us(e))):n}class Ve extends ye{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Se.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==W.object){const u=this._getOrReturnCtx(e);return q(u,{code:M.invalid_type,expected:W.object,received:u.parsedType}),ae}const{status:r,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof di&&this._def.unknownKeys==="strip"))for(const u in i.data)s.includes(u)||o.push(u);const l=[];for(const u of s){const c=a[u],d=i.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Hr(i,d,i.path,u)),alwaysSet:u in i.data})}if(this._def.catchall instanceof di){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:i.data[c]}});else if(u==="strict")o.length>0&&(q(i,{code:M.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const d=i.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Hr(i,d,i.path,c)),alwaysSet:c in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const d=await c.key,f=await c.value;u.push({key:d,value:f,alwaysSet:c.alwaysSet})}return u}).then(u=>Lt.mergeObjectSync(r,u)):Lt.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return J.errToObj,new Ve({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,a,s,o;const l=(s=(a=(i=this._def).errorMap)===null||a===void 0?void 0:a.call(i,t,r).message)!==null&&s!==void 0?s:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=J.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new Ve({...this._def,unknownKeys:"strip"})}passthrough(){return new Ve({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ve({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ve({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:B.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ve({...this._def,catchall:e})}pick(e){const t={};return Se.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new Ve({...this._def,shape:()=>t})}omit(e){const t={};return Se.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new Ve({...this._def,shape:()=>t})}deepPartial(){return us(this)}partial(e){const t={};return Se.objectKeys(this.shape).forEach(r=>{const i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}),new Ve({...this._def,shape:()=>t})}required(e){const t={};return Se.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof hr;)a=a._def.innerType;t[r]=a}}),new Ve({...this._def,shape:()=>t})}keyof(){return GO(Se.objectKeys(this.shape))}}Ve.create=(n,e)=>new Ve({shape:()=>n,unknownKeys:"strip",catchall:di.create(),typeName:B.ZodObject,...ce(e)});Ve.strictCreate=(n,e)=>new Ve({shape:()=>n,unknownKeys:"strict",catchall:di.create(),typeName:B.ZodObject,...ce(e)});Ve.lazycreate=(n,e)=>new Ve({shape:n,unknownKeys:"strip",catchall:di.create(),typeName:B.ZodObject,...ce(e)});class nu extends ye{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function i(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const s=a.map(o=>new In(o.ctx.common.issues));return q(t,{code:M.invalid_union,unionErrors:s}),ae}if(t.common.async)return Promise.all(r.map(async a=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(i);{let a;const s=[];for(const l of r){const u={...t,common:{...t.common,issues:[]},parent:null},c=l._parseSync({data:t.data,path:t.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:u}),u.common.issues.length&&s.push(u.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(l=>new In(l));return q(t,{code:M.invalid_union,unionErrors:o}),ae}}get options(){return this._def.options}}nu.create=(n,e)=>new nu({options:n,typeName:B.ZodUnion,...ce(e)});const Xr=n=>n instanceof au?Xr(n.schema):n instanceof yr?Xr(n.innerType()):n instanceof su?[n.value]:n instanceof Xi?n.options:n instanceof ou?Se.objectValues(n.enum):n instanceof lu?Xr(n._def.innerType):n instanceof eu?[void 0]:n instanceof tu?[null]:n instanceof hr?[void 0,...Xr(n.unwrap())]:n instanceof Qi?[null,...Xr(n.unwrap())]:n instanceof Uw||n instanceof cu?Xr(n.unwrap()):n instanceof uu?Xr(n._def.innerType):[];class Ff extends ye{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.object)return q(t,{code:M.invalid_type,expected:W.object,received:t.parsedType}),ae;const r=this.discriminator,i=t.data[r],a=this.optionsMap.get(i);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(q(t,{code:M.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ae)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const i=new Map;for(const a of t){const s=Xr(a.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of s){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,a)}}return new Ff({typeName:B.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...ce(r)})}}function bg(n,e){const t=ti(n),r=ti(e);if(n===e)return{valid:!0,data:n};if(t===W.object&&r===W.object){const i=Se.objectKeys(e),a=Se.objectKeys(n).filter(o=>i.indexOf(o)!==-1),s={...n,...e};for(const o of a){const l=bg(n[o],e[o]);if(!l.valid)return{valid:!1};s[o]=l.data}return{valid:!0,data:s}}else if(t===W.array&&r===W.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let a=0;a<n.length;a++){const s=n[a],o=e[a],l=bg(s,o);if(!l.valid)return{valid:!1};i.push(l.data)}return{valid:!0,data:i}}else return t===W.date&&r===W.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class ru extends ye{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=(a,s)=>{if(wg(a)||wg(s))return ae;const o=bg(a.value,s.value);return o.valid?((_g(a)||_g(s))&&t.dirty(),{status:t.value,value:o.data}):(q(r,{code:M.invalid_intersection_types}),ae)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ru.create=(n,e,t)=>new ru({left:n,right:e,typeName:B.ZodIntersection,...ce(t)});class Vr extends ye{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==W.array)return q(r,{code:M.invalid_type,expected:W.array,received:r.parsedType}),ae;if(r.data.length<this._def.items.length)return q(r,{code:M.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ae;!this._def.rest&&r.data.length>this._def.items.length&&(q(r,{code:M.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...r.data].map((s,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Hr(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(a).then(s=>Lt.mergeArray(t,s)):Lt.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Vr({...this._def,rest:e})}}Vr.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Vr({items:n,typeName:B.ZodTuple,rest:null,...ce(e)})};class iu extends ye{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==W.object)return q(r,{code:M.invalid_type,expected:W.object,received:r.parsedType}),ae;const i=[],a=this._def.keyType,s=this._def.valueType;for(const o in r.data)i.push({key:a._parse(new Hr(r,o,r.path,o)),value:s._parse(new Hr(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Lt.mergeObjectAsync(t,i):Lt.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof ye?new iu({keyType:e,valueType:t,typeName:B.ZodRecord,...ce(r)}):new iu({keyType:ur.create(),valueType:e,typeName:B.ZodRecord,...ce(t)})}}class Hd extends ye{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==W.map)return q(r,{code:M.invalid_type,expected:W.map,received:r.parsedType}),ae;const i=this._def.keyType,a=this._def.valueType,s=[...r.data.entries()].map(([o,l],u)=>({key:i._parse(new Hr(r,o,r.path,[u,"key"])),value:a._parse(new Hr(r,l,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of s){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return ae;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of s){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return ae;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}}}}Hd.create=(n,e,t)=>new Hd({valueType:e,keyType:n,typeName:B.ZodMap,...ce(t)});class za extends ye{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==W.set)return q(r,{code:M.invalid_type,expected:W.set,received:r.parsedType}),ae;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(q(r,{code:M.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(q(r,{code:M.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const a=this._def.valueType;function s(l){const u=new Set;for(const c of l){if(c.status==="aborted")return ae;c.status==="dirty"&&t.dirty(),u.add(c.value)}return{status:t.value,value:u}}const o=[...r.data.values()].map((l,u)=>a._parse(new Hr(r,l,r.path,u)));return r.common.async?Promise.all(o).then(l=>s(l)):s(o)}min(e,t){return new za({...this._def,minSize:{value:e,message:J.toString(t)}})}max(e,t){return new za({...this._def,maxSize:{value:e,message:J.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}za.create=(n,e)=>new za({valueType:n,minSize:null,maxSize:null,typeName:B.ZodSet,...ce(e)});class Hs extends ye{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.function)return q(t,{code:M.invalid_type,expected:W.function,received:t.parsedType}),ae;function r(o,l){return Md({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Fd(),to].filter(u=>!!u),issueData:{code:M.invalid_arguments,argumentsError:l}})}function i(o,l){return Md({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Fd(),to].filter(u=>!!u),issueData:{code:M.invalid_return_type,returnTypeError:l}})}const a={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof ro){const o=this;return qt(async function(...l){const u=new In([]),c=await o._def.args.parseAsync(l,a).catch(h=>{throw u.addIssue(r(l,h)),u}),d=await Reflect.apply(s,this,c);return await o._def.returns._def.type.parseAsync(d,a).catch(h=>{throw u.addIssue(i(d,h)),u})})}else{const o=this;return qt(function(...l){const u=o._def.args.safeParse(l,a);if(!u.success)throw new In([r(l,u.error)]);const c=Reflect.apply(s,this,u.data),d=o._def.returns.safeParse(c,a);if(!d.success)throw new In([i(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Hs({...this._def,args:Vr.create(e).rest(Pa.create())})}returns(e){return new Hs({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Hs({args:e||Vr.create([]).rest(Pa.create()),returns:t||Pa.create(),typeName:B.ZodFunction,...ce(r)})}}class au extends ye{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}au.create=(n,e)=>new au({getter:n,typeName:B.ZodLazy,...ce(e)});class su extends ye{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return q(t,{received:t.data,code:M.invalid_literal,expected:this._def.value}),ae}return{status:"valid",value:e.data}}get value(){return this._def.value}}su.create=(n,e)=>new su({value:n,typeName:B.ZodLiteral,...ce(e)});function GO(n,e){return new Xi({values:n,typeName:B.ZodEnum,...ce(e)})}class Xi extends ye{constructor(){super(...arguments),nl.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return q(t,{expected:Se.joinValues(r),received:t.parsedType,code:M.invalid_type}),ae}if(Ud(this,nl)||BO(this,nl,new Set(this._def.values)),!Ud(this,nl).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return q(t,{received:t.data,code:M.invalid_enum_value,options:r}),ae}return qt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Xi.create(e,{...this._def,...t})}exclude(e,t=this._def){return Xi.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}nl=new WeakMap;Xi.create=GO;class ou extends ye{constructor(){super(...arguments),rl.set(this,void 0)}_parse(e){const t=Se.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==W.string&&r.parsedType!==W.number){const i=Se.objectValues(t);return q(r,{expected:Se.joinValues(i),received:r.parsedType,code:M.invalid_type}),ae}if(Ud(this,rl)||BO(this,rl,new Set(Se.getValidEnumValues(this._def.values))),!Ud(this,rl).has(e.data)){const i=Se.objectValues(t);return q(r,{received:r.data,code:M.invalid_enum_value,options:i}),ae}return qt(e.data)}get enum(){return this._def.values}}rl=new WeakMap;ou.create=(n,e)=>new ou({values:n,typeName:B.ZodNativeEnum,...ce(e)});class ro extends ye{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.promise&&t.common.async===!1)return q(t,{code:M.invalid_type,expected:W.promise,received:t.parsedType}),ae;const r=t.parsedType===W.promise?t.data:Promise.resolve(t.data);return qt(r.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ro.create=(n,e)=>new ro({type:n,typeName:B.ZodPromise,...ce(e)});class yr extends ye{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===B.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{q(r,s),s.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){const s=i.transform(r.data,a);if(r.common.async)return Promise.resolve(s).then(async o=>{if(t.value==="aborted")return ae;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?ae:l.status==="dirty"||t.value==="dirty"?Ss(l.value):l});{if(t.value==="aborted")return ae;const o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?ae:o.status==="dirty"||t.value==="dirty"?Ss(o.value):o}}if(i.type==="refinement"){const s=o=>{const l=i.refinement(o,a);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?ae:(o.status==="dirty"&&t.dirty(),s(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?ae:(o.status==="dirty"&&t.dirty(),s(o.value).then(()=>({status:t.value,value:o.value}))))}if(i.type==="transform")if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Ma(s))return s;const o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>Ma(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:t.value,value:o})):s);Se.assertNever(i)}}yr.create=(n,e,t)=>new yr({schema:n,typeName:B.ZodEffects,effect:e,...ce(t)});yr.createWithPreprocess=(n,e,t)=>new yr({schema:e,effect:{type:"preprocess",transform:n},typeName:B.ZodEffects,...ce(t)});class hr extends ye{_parse(e){return this._getType(e)===W.undefined?qt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}hr.create=(n,e)=>new hr({innerType:n,typeName:B.ZodOptional,...ce(e)});class Qi extends ye{_parse(e){return this._getType(e)===W.null?qt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Qi.create=(n,e)=>new Qi({innerType:n,typeName:B.ZodNullable,...ce(e)});class lu extends ye{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===W.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}lu.create=(n,e)=>new lu({innerType:n,typeName:B.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ce(e)});class uu extends ye{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ql(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new In(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new In(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}uu.create=(n,e)=>new uu({innerType:n,typeName:B.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ce(e)});class Vd extends ye{_parse(e){if(this._getType(e)!==W.nan){const r=this._getOrReturnCtx(e);return q(r,{code:M.invalid_type,expected:W.nan,received:r.parsedType}),ae}return{status:"valid",value:e.data}}}Vd.create=n=>new Vd({typeName:B.ZodNaN,...ce(n)});const wF=Symbol("zod_brand");class Uw extends ye{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Cu extends ye{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ae:a.status==="dirty"?(t.dirty(),Ss(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?ae:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,t){return new Cu({in:e,out:t,typeName:B.ZodPipeline})}}class cu extends ye{_parse(e){const t=this._def.innerType._parse(e),r=i=>(Ma(i)&&(i.value=Object.freeze(i.value)),i);return Ql(t)?t.then(i=>r(i)):r(t)}unwrap(){return this._def.innerType}}cu.create=(n,e)=>new cu({innerType:n,typeName:B.ZodReadonly,...ce(e)});function WO(n,e={},t){return n?no.create().superRefine((r,i)=>{var a,s;if(!n(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,l=(s=(a=o.fatal)!==null&&a!==void 0?a:t)!==null&&s!==void 0?s:!0,u=typeof o=="string"?{message:o}:o;i.addIssue({code:"custom",...u,fatal:l})}}):no.create()}const _F={object:Ve.lazycreate};var B;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(B||(B={}));const bF=(n,e={message:`Input not instance of ${n.name}`})=>WO(t=>t instanceof n,e),KO=ur.create,JO=Ji.create,vF=Vd.create,xF=Zi.create,ZO=Yl.create,EF=Ua.create,kF=zd.create,SF=eu.create,OF=tu.create,AF=no.create,PF=Pa.create,TF=di.create,IF=Bd.create,CF=fr.create,RF=Ve.create,$F=Ve.strictCreate,NF=nu.create,jF=Ff.create,LF=ru.create,DF=Vr.create,FF=iu.create,MF=Hd.create,UF=za.create,zF=Hs.create,BF=au.create,HF=su.create,VF=Xi.create,qF=ou.create,GF=ro.create,o0=yr.create,WF=hr.create,KF=Qi.create,JF=yr.createWithPreprocess,ZF=Cu.create,XF=()=>KO().optional(),QF=()=>JO().optional(),YF=()=>ZO().optional(),eM={string:n=>ur.create({...n,coerce:!0}),number:n=>Ji.create({...n,coerce:!0}),boolean:n=>Yl.create({...n,coerce:!0}),bigint:n=>Zi.create({...n,coerce:!0}),date:n=>Ua.create({...n,coerce:!0})},tM=ae;var Ta=Object.freeze({__proto__:null,defaultErrorMap:to,setErrorMap:JD,getErrorMap:Fd,makeIssue:Md,EMPTY_PATH:ZD,addIssueToContext:q,ParseStatus:Lt,INVALID:ae,DIRTY:Ss,OK:qt,isAborted:wg,isDirty:_g,isValid:Ma,isAsync:Ql,get util(){return Se},get objectUtil(){return yg},ZodParsedType:W,getParsedType:ti,ZodType:ye,datetimeRegex:qO,ZodString:ur,ZodNumber:Ji,ZodBigInt:Zi,ZodBoolean:Yl,ZodDate:Ua,ZodSymbol:zd,ZodUndefined:eu,ZodNull:tu,ZodAny:no,ZodUnknown:Pa,ZodNever:di,ZodVoid:Bd,ZodArray:fr,ZodObject:Ve,ZodUnion:nu,ZodDiscriminatedUnion:Ff,ZodIntersection:ru,ZodTuple:Vr,ZodRecord:iu,ZodMap:Hd,ZodSet:za,ZodFunction:Hs,ZodLazy:au,ZodLiteral:su,ZodEnum:Xi,ZodNativeEnum:ou,ZodPromise:ro,ZodEffects:yr,ZodTransformer:yr,ZodOptional:hr,ZodNullable:Qi,ZodDefault:lu,ZodCatch:uu,ZodNaN:Vd,BRAND:wF,ZodBranded:Uw,ZodPipeline:Cu,ZodReadonly:cu,custom:WO,Schema:ye,ZodSchema:ye,late:_F,get ZodFirstPartyTypeKind(){return B},coerce:eM,any:AF,array:CF,bigint:xF,boolean:ZO,date:EF,discriminatedUnion:jF,effect:o0,enum:VF,function:zF,instanceof:bF,intersection:LF,lazy:BF,literal:HF,map:MF,nan:vF,nativeEnum:qF,never:TF,null:OF,nullable:KF,number:JO,object:RF,oboolean:YF,onumber:QF,optional:WF,ostring:XF,pipeline:ZF,preprocess:JF,promise:GF,record:FF,set:UF,strictObject:$F,string:KO,symbol:kF,transformer:o0,tuple:DF,undefined:SF,union:NF,unknown:PF,void:IF,NEVER:tM,ZodIssueCode:M,quotelessJson:KD,ZodError:In});let wc;const nM=new Uint8Array(16);function rM(){if(!wc&&(wc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wc(nM)}const iM=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function aM(n){return typeof n=="string"&&iM.test(n)}const wt=[];for(let n=0;n<256;++n)wt.push((n+256).toString(16).slice(1));function sM(n,e=0){return wt[n[e+0]]+wt[n[e+1]]+wt[n[e+2]]+wt[n[e+3]]+"-"+wt[n[e+4]]+wt[n[e+5]]+"-"+wt[n[e+6]]+wt[n[e+7]]+"-"+wt[n[e+8]]+wt[n[e+9]]+"-"+wt[n[e+10]]+wt[n[e+11]]+wt[n[e+12]]+wt[n[e+13]]+wt[n[e+14]]+wt[n[e+15]]}const oM=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),l0={randomUUID:oM};function Oi(n,e,t){if(l0.randomUUID&&!n)return l0.randomUUID();n=n||{};const r=n.random||(n.rng||rM)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,sM(r)}let lM=class{},zw=class XO extends lM{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,wO(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Ze("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return Xl.prototype.toJSON.call(this)}toJSONNotImplemented(){return Xl.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends XO{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Oi()}),Object.assign(this,e)}}return new t}};var Bw={exports:{}};Bw.exports;(function(n){const t=(a=0)=>s=>`\x1B[${38+a};5;${s}m`,r=(a=0)=>(s,o,l)=>`\x1B[${38+a};2;${s};${o};${l}m`;function i(){const a=new Map,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};s.color.gray=s.color.blackBright,s.bgColor.bgGray=s.bgColor.bgBlackBright,s.color.grey=s.color.blackBright,s.bgColor.bgGrey=s.bgColor.bgBlackBright;for(const[o,l]of Object.entries(s)){for(const[u,c]of Object.entries(l))s[u]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},l[u]=s[u],a.set(c[0],c[1]);Object.defineProperty(s,o,{value:l,enumerable:!1})}return Object.defineProperty(s,"codes",{value:a,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi256=t(),s.color.ansi16m=r(),s.bgColor.ansi256=t(10),s.bgColor.ansi16m=r(10),Object.defineProperties(s,{rgbToAnsi256:{value:(o,l,u)=>o===l&&l===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:u}=l.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const c=Number.parseInt(u,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>s.rgbToAnsi256(...s.hexToRgb(o)),enumerable:!1}}),s}Object.defineProperty(n,"exports",{enumerable:!0,get:i})})(Bw);var uM=Bw.exports;const Mf=uo(uM);function fp(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function cM(n){return n.replace(/[-:.]/g,"")}function dM(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return cM(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}let Uf=class extends zw{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){var i;const t=dM(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const a=this.runMap.get(r.parent_run_id);a&&(this._addChildRun(a,r),a.child_execution_order=Math.max(a.child_execution_order,r.child_execution_order),r.trace_id=a.trace_id,a.dotted_order!==void 0&&(r.dotted_order=[a.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;this.runMap.set(r.id,r),await((i=this.onRunCreate)==null?void 0:i.call(this,r))}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,i,a,s,o,l){var h;const u=this._getExecutionOrder(i),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:s||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleChatModelStart(e,t,r,i,a,s,o,l){var h;const u=this._getExecutionOrder(i),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:s||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleLLMEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onLLMEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleLLMError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onLLMError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleChainStart(e,t,r,i,a,s,o,l){var f;const u=this._getExecutionOrder(i),c=Date.now(),d={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return await this._startTrace(d),await((f=this.onChainStart)==null?void 0:f.call(this,d)),d}async handleChainEnd(e,t,r,i,a){var o;const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=fp(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(s.inputs=fp(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleChainError(e,t,r,i,a){var o;const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(s.inputs=fp(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleToolStart(e,t,r,i,a,s,o){var d;const l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return await this._startTrace(c),await((d=this.onToolStart)==null?void 0:d.call(this,c)),c}async handleToolEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onToolEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onToolError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const i=r;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,r))}async handleAgentEnd(e,t){var i;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentEnd)==null?void 0:i.call(this,r)))}async handleRetrieverStart(e,t,r,i,a,s,o){var d;const l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return await this._startTrace(c),await((d=this.onRetrieverStart)==null?void 0:d.call(this,c)),c}async handleRetrieverEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var i;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((i=this.onText)==null?void 0:i.call(this,r)))}async handleLLMNewToken(e,t,r,i,a,s){var l;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s==null?void 0:s.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:s==null?void 0:s.chunk})),o}};function Ut(n,e){return`${n.open}${e}${n.close}`}function Qn(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function wi(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Xt}=Mf;let u0=class extends Uf{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const i=this.runMap.get(r.parent_run_id);if(i)t.push(i),r=i;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((i,a,s)=>{const o=`${i.execution_order}:${i.run_type}:${i.name}`;return a===s.length-1?Ut(Mf.bold,o):o}).join(" > ");return Ut(Xt.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Qn(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.cyan,"[chain/end]")} [${t}] [${wi(e)}] Exiting Chain run with output: ${Qn(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.red,"[chain/error]")} [${t}] [${wi(e)}] Chain run errored with error: ${Qn(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${Ut(Xt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Qn(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.cyan,"[llm/end]")} [${t}] [${wi(e)}] Exiting LLM run with output: ${Qn(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.red,"[llm/error]")} [${t}] [${wi(e)}] LLM run errored with error: ${Qn(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,i;const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.cyan,"[tool/end]")} [${t}] [${wi(e)}] Exiting Tool run with output: "${(i=(r=e.outputs)==null?void 0:r.output)==null?void 0:i.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.red,"[tool/error]")} [${t}] [${wi(e)}] Tool run errored with error: ${Qn(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Qn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.cyan,"[retriever/end]")} [${t}] [${wi(e)}] Exiting Retriever run with output: ${Qn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Ut(Xt.red,"[retriever/error]")} [${t}] [${wi(e)}] Retriever run errored with error: ${Qn(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${Ut(Xt.blue,"[agent/action]")} [${r}] Agent selected action: ${Qn(t.actions[t.actions.length-1],"[action]")}`)}};const fM=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Vs(n){return typeof n=="string"&&fM.test(n)}var _t=[];for(var hp=0;hp<256;++hp)_t.push((hp+256).toString(16).slice(1));function hM(n,e=0){return(_t[n[e+0]]+_t[n[e+1]]+_t[n[e+2]]+_t[n[e+3]]+"-"+_t[n[e+4]]+_t[n[e+5]]+"-"+_t[n[e+6]]+_t[n[e+7]]+"-"+_t[n[e+8]]+_t[n[e+9]]+"-"+_t[n[e+10]]+_t[n[e+11]]+_t[n[e+12]]+_t[n[e+13]]+_t[n[e+14]]+_t[n[e+15]]).toLowerCase()}var _c,pM=new Uint8Array(16);function mM(){if(!_c&&(_c=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_c))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _c(pM)}var gM=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const c0={randomUUID:gM};function Et(n,e,t){if(c0.randomUUID&&!n)return c0.randomUUID();n=n||{};var r=n.random||(n.rng||mM)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,hM(r)}const yM=(...n)=>fetch(...n),wM=Symbol.for("ls:fetch_implementation"),te=()=>globalThis[wM]??yM,_M=[400,401,403,404,405,406,407,408],bM=[409];let d0=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in gt?this.queue=new gt.default({concurrency:this.maxConcurrency}):this.queue=new gt({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>Ki(()=>e(...t).catch(i=>{throw i instanceof Error?i:new Error(i)}),{async onFailedAttempt(i){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||(i==null?void 0:i.code)==="ECONNABORTED")throw i;const a=i==null?void 0:i.response,s=a==null?void 0:a.status;if(s){if(_M.includes(+s))throw i;if(bM.includes(+s))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,a)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>te()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function f0(n){return typeof(n==null?void 0:n._getType)=="function"}function h0(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}var bl={};let Kr;const vM=()=>typeof window<"u"&&typeof window.document<"u",xM=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",EM=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),QO=()=>typeof Deno<"u",kM=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!QO(),SM=()=>Kr||(vM()?Kr="browser":kM()?Kr="node":xM()?Kr="webworker":EM()?Kr="jsdom":QO()?Kr="deno":Kr="other",Kr);let pp;function OM(){if(pp===void 0){const n=SM(),e=TM();pp={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:sA,...e}}return pp}function AM(){const n=PM()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,i]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof i=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[r]=i);return e}function PM(){try{return typeof process<"u"&&bl?Object.entries(bl).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function vg(n){try{return typeof process<"u"?bl==null?void 0:bl[n]:void 0}catch{return}}function cs(n){return vg(`LANGSMITH_${n}`)||vg(`LANGCHAIN_${n}`)}let mp;function TM(){if(mp!==void 0)return mp;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=vg(t);r!==void 0&&(e[t]=r)}return mp=e,e}function be(n,e){if(!Vs(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const p0={};function IM(n){p0[n]||(console.warn(n),p0[n]=!0)}var xg={exports:{}};const CM="2.0.0",YO=256,RM=Number.MAX_SAFE_INTEGER||9007199254740991,$M=16,NM=YO-6,jM=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var zf={MAX_LENGTH:YO,MAX_SAFE_COMPONENT_LENGTH:$M,MAX_SAFE_BUILD_LENGTH:NM,MAX_SAFE_INTEGER:RM,RELEASE_TYPES:jM,SEMVER_SPEC_VERSION:CM,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},gp={};const LM=typeof process=="object"&&gp&&gp.NODE_DEBUG&&/\bsemver\b/i.test(gp.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};var Bf=LM;(function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=zf,a=Bf;e=n.exports={};const s=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],c=e.t={};let d=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[f,r]],p=_=>{for(const[g,y]of h)_=_.split(`${g}*`).join(`${g}{0,${y}}`).split(`${g}+`).join(`${g}{1,${y}}`);return _},m=(_,g,y)=>{const w=p(g),x=d++;a(_,x,g),c[_]=x,l[x]=g,u[x]=w,s[x]=new RegExp(g,y?"g":void 0),o[x]=new RegExp(w,y?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),m("FULL",`^${l[c.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),m("LOOSE",`^${l[c.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),m("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[c.COERCE],!0),m("COERCERTLFULL",l[c.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(xg,xg.exports);var Ru=xg.exports;const DM=Object.freeze({loose:!0}),FM=Object.freeze({}),MM=n=>n?typeof n!="object"?DM:n:FM;var Hw=MM;const m0=/^[0-9]+$/,eA=(n,e)=>{const t=m0.test(n),r=m0.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},UM=(n,e)=>eA(e,n);var tA={compareIdentifiers:eA,rcompareIdentifiers:UM};const bc=Bf,{MAX_LENGTH:g0,MAX_SAFE_INTEGER:vc}=zf,{safeRe:y0,safeSrc:w0,t:xc}=Ru,zM=Hw,{compareIdentifiers:ts}=tA;let BM=class Pr{constructor(e,t){if(t=zM(t),e instanceof Pr){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>g0)throw new TypeError(`version is longer than ${g0} characters`);bc("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?y0[xc.LOOSE]:y0[xc.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>vc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>vc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>vc||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const a=+i;if(a>=0&&a<vc)return a}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(bc("SemVer.compare",this.version,this.options,e),!(e instanceof Pr)){if(typeof e=="string"&&e===this.version)return 0;e=new Pr(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Pr||(e=new Pr(e,this.options)),ts(this.major,e.major)||ts(this.minor,e.minor)||ts(this.patch,e.patch)}comparePre(e){if(e instanceof Pr||(e=new Pr(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],i=e.prerelease[t];if(bc("prerelease compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return ts(r,i)}while(++t)}compareBuild(e){e instanceof Pr||(e=new Pr(e,this.options));let t=0;do{const r=this.build[t],i=e.build[t];if(bc("build compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return ts(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){const i=new RegExp(`^${this.options.loose?w0[xc.PRERELEASELOOSE]:w0[xc.PRERELEASE]}$`),a=`-${t}`.match(i);if(!a||a[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let a=[t,i];r===!1&&(a=[t]),ts(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var Kt=BM;const _0=Kt,HM=(n,e,t=!1)=>{if(n instanceof _0)return n;try{return new _0(n,e)}catch(r){if(!t)return null;throw r}};var vo=HM;const VM=vo,qM=(n,e)=>{const t=VM(n,e);return t?t.version:null};var GM=qM;const WM=vo,KM=(n,e)=>{const t=WM(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};var JM=KM;const b0=Kt,ZM=(n,e,t,r,i)=>{typeof t=="string"&&(i=r,r=t,t=void 0);try{return new b0(n instanceof b0?n.version:n,t).inc(e,r,i).version}catch{return null}};var XM=ZM;const v0=vo,QM=(n,e)=>{const t=v0(n,null,!0),r=v0(e,null,!0),i=t.compare(r);if(i===0)return null;const a=i>0,s=a?t:r,o=a?r:t,l=!!s.prerelease.length;if(!!o.prerelease.length&&!l){if(!o.patch&&!o.minor)return"major";if(o.compareMain(s)===0)return o.minor&&!o.patch?"minor":"patch"}const c=l?"pre":"";return t.major!==r.major?c+"major":t.minor!==r.minor?c+"minor":t.patch!==r.patch?c+"patch":"prerelease"};var YM=QM;const eU=Kt,tU=(n,e)=>new eU(n,e).major;var nU=tU;const rU=Kt,iU=(n,e)=>new rU(n,e).minor;var aU=iU;const sU=Kt,oU=(n,e)=>new sU(n,e).patch;var lU=oU;const uU=vo,cU=(n,e)=>{const t=uU(n,e);return t&&t.prerelease.length?t.prerelease:null};var dU=cU;const x0=Kt,fU=(n,e,t)=>new x0(n,t).compare(new x0(e,t));var br=fU;const hU=br,pU=(n,e,t)=>hU(e,n,t);var mU=pU;const gU=br,yU=(n,e)=>gU(n,e,!0);var wU=yU;const E0=Kt,_U=(n,e,t)=>{const r=new E0(n,t),i=new E0(e,t);return r.compare(i)||r.compareBuild(i)};var Vw=_U;const bU=Vw,vU=(n,e)=>n.sort((t,r)=>bU(t,r,e));var xU=vU;const EU=Vw,kU=(n,e)=>n.sort((t,r)=>EU(r,t,e));var SU=kU;const OU=br,AU=(n,e,t)=>OU(n,e,t)>0;var Hf=AU;const PU=br,TU=(n,e,t)=>PU(n,e,t)<0;var qw=TU;const IU=br,CU=(n,e,t)=>IU(n,e,t)===0;var nA=CU;const RU=br,$U=(n,e,t)=>RU(n,e,t)!==0;var rA=$U;const NU=br,jU=(n,e,t)=>NU(n,e,t)>=0;var Gw=jU;const LU=br,DU=(n,e,t)=>LU(n,e,t)<=0;var Ww=DU;const FU=nA,MU=rA,UU=Hf,zU=Gw,BU=qw,HU=Ww,VU=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return FU(n,t,r);case"!=":return MU(n,t,r);case">":return UU(n,t,r);case">=":return zU(n,t,r);case"<":return BU(n,t,r);case"<=":return HU(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};var iA=VU;const qU=Kt,GU=vo,{safeRe:Ec,t:kc}=Ru,WU=(n,e)=>{if(n instanceof qU)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?Ec[kc.COERCEFULL]:Ec[kc.COERCE]);else{const l=e.includePrerelease?Ec[kc.COERCERTLFULL]:Ec[kc.COERCERTL];let u;for(;(u=l.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||u.index+u[0].length!==t.index+t[0].length)&&(t=u),l.lastIndex=u.index+u[1].length+u[2].length;l.lastIndex=-1}if(t===null)return null;const r=t[2],i=t[3]||"0",a=t[4]||"0",s=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return GU(`${r}.${i}.${a}${s}${o}`,e)};var KU=WU;let JU=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};var ZU=JU,yp,k0;function vr(){if(k0)return yp;k0=1;const n=/\s+/g;class e{constructor(S,$){if($=i($),S instanceof e)return S.loose===!!$.loose&&S.includePrerelease===!!$.includePrerelease?S:new e(S.raw,$);if(S instanceof a)return this.raw=S.value,this.set=[[S]],this.formatted=void 0,this;if(this.options=$,this.loose=!!$.loose,this.includePrerelease=!!$.includePrerelease,this.raw=S.trim().replace(n," "),this.set=this.raw.split("||").map(C=>this.parseRange(C.trim())).filter(C=>C.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const C=this.set[0];if(this.set=this.set.filter(O=>!m(O[0])),this.set.length===0)this.set=[C];else if(this.set.length>1){for(const O of this.set)if(O.length===1&&_(O[0])){this.set=[O];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let S=0;S<this.set.length;S++){S>0&&(this.formatted+="||");const $=this.set[S];for(let C=0;C<$.length;C++)C>0&&(this.formatted+=" "),this.formatted+=$[C].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(S){const C=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+S,O=r.get(C);if(O)return O;const A=this.options.loose,b=A?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];S=S.replace(b,V(this.options.includePrerelease)),s("hyphen replace",S),S=S.replace(l[u.COMPARATORTRIM],c),s("comparator trim",S),S=S.replace(l[u.TILDETRIM],d),s("tilde trim",S),S=S.replace(l[u.CARETTRIM],f),s("caret trim",S);let F=S.split(" ").map(Z=>y(Z,this.options)).join(" ").split(/\s+/).map(Z=>L(Z,this.options));A&&(F=F.filter(Z=>(s("loose invalid filter",Z,this.options),!!Z.match(l[u.COMPARATORLOOSE])))),s("range list",F);const N=new Map,v=F.map(Z=>new a(Z,this.options));for(const Z of v){if(m(Z))return[Z];N.set(Z.value,Z)}N.size>1&&N.has("")&&N.delete("");const Q=[...N.values()];return r.set(C,Q),Q}intersects(S,$){if(!(S instanceof e))throw new TypeError("a Range is required");return this.set.some(C=>g(C,$)&&S.set.some(O=>g(O,$)&&C.every(A=>O.every(b=>A.intersects(b,$)))))}test(S){if(!S)return!1;if(typeof S=="string")try{S=new o(S,this.options)}catch{return!1}for(let $=0;$<this.set.length;$++)if(oe(this.set[$],S,this.options))return!0;return!1}}yp=e;const t=ZU,r=new t,i=Hw,a=Vf(),s=Bf,o=Kt,{safeRe:l,t:u,comparatorTrimReplace:c,tildeTrimReplace:d,caretTrimReplace:f}=Ru,{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=zf,m=T=>T.value==="<0.0.0-0",_=T=>T.value==="",g=(T,S)=>{let $=!0;const C=T.slice();let O=C.pop();for(;$&&C.length;)$=C.every(A=>O.intersects(A,S)),O=C.pop();return $},y=(T,S)=>(s("comp",T,S),T=E(T,S),s("caret",T),T=x(T,S),s("tildes",T),T=R(T,S),s("xrange",T),T=j(T,S),s("stars",T),T),w=T=>!T||T.toLowerCase()==="x"||T==="*",x=(T,S)=>T.trim().split(/\s+/).map($=>k($,S)).join(" "),k=(T,S)=>{const $=S.loose?l[u.TILDELOOSE]:l[u.TILDE];return T.replace($,(C,O,A,b,F)=>{s("tilde",T,C,O,A,b,F);let N;return w(O)?N="":w(A)?N=`>=${O}.0.0 <${+O+1}.0.0-0`:w(b)?N=`>=${O}.${A}.0 <${O}.${+A+1}.0-0`:F?(s("replaceTilde pr",F),N=`>=${O}.${A}.${b}-${F} <${O}.${+A+1}.0-0`):N=`>=${O}.${A}.${b} <${O}.${+A+1}.0-0`,s("tilde return",N),N})},E=(T,S)=>T.trim().split(/\s+/).map($=>P($,S)).join(" "),P=(T,S)=>{s("caret",T,S);const $=S.loose?l[u.CARETLOOSE]:l[u.CARET],C=S.includePrerelease?"-0":"";return T.replace($,(O,A,b,F,N)=>{s("caret",T,O,A,b,F,N);let v;return w(A)?v="":w(b)?v=`>=${A}.0.0${C} <${+A+1}.0.0-0`:w(F)?A==="0"?v=`>=${A}.${b}.0${C} <${A}.${+b+1}.0-0`:v=`>=${A}.${b}.0${C} <${+A+1}.0.0-0`:N?(s("replaceCaret pr",N),A==="0"?b==="0"?v=`>=${A}.${b}.${F}-${N} <${A}.${b}.${+F+1}-0`:v=`>=${A}.${b}.${F}-${N} <${A}.${+b+1}.0-0`:v=`>=${A}.${b}.${F}-${N} <${+A+1}.0.0-0`):(s("no pr"),A==="0"?b==="0"?v=`>=${A}.${b}.${F}${C} <${A}.${b}.${+F+1}-0`:v=`>=${A}.${b}.${F}${C} <${A}.${+b+1}.0-0`:v=`>=${A}.${b}.${F} <${+A+1}.0.0-0`),s("caret return",v),v})},R=(T,S)=>(s("replaceXRanges",T,S),T.split(/\s+/).map($=>H($,S)).join(" ")),H=(T,S)=>{T=T.trim();const $=S.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return T.replace($,(C,O,A,b,F,N)=>{s("xRange",T,C,O,A,b,F,N);const v=w(A),Q=v||w(b),Z=Q||w(F),re=Z;return O==="="&&re&&(O=""),N=S.includePrerelease?"-0":"",v?O===">"||O==="<"?C="<0.0.0-0":C="*":O&&re?(Q&&(b=0),F=0,O===">"?(O=">=",Q?(A=+A+1,b=0,F=0):(b=+b+1,F=0)):O==="<="&&(O="<",Q?A=+A+1:b=+b+1),O==="<"&&(N="-0"),C=`${O+A}.${b}.${F}${N}`):Q?C=`>=${A}.0.0${N} <${+A+1}.0.0-0`:Z&&(C=`>=${A}.${b}.0${N} <${A}.${+b+1}.0-0`),s("xRange return",C),C})},j=(T,S)=>(s("replaceStars",T,S),T.trim().replace(l[u.STAR],"")),L=(T,S)=>(s("replaceGTE0",T,S),T.trim().replace(l[S.includePrerelease?u.GTE0PRE:u.GTE0],"")),V=T=>(S,$,C,O,A,b,F,N,v,Q,Z,re)=>(w(C)?$="":w(O)?$=`>=${C}.0.0${T?"-0":""}`:w(A)?$=`>=${C}.${O}.0${T?"-0":""}`:b?$=`>=${$}`:$=`>=${$}${T?"-0":""}`,w(v)?N="":w(Q)?N=`<${+v+1}.0.0-0`:w(Z)?N=`<${v}.${+Q+1}.0-0`:re?N=`<=${v}.${Q}.${Z}-${re}`:T?N=`<${v}.${Q}.${+Z+1}-0`:N=`<=${N}`,`${$} ${N}`.trim()),oe=(T,S,$)=>{for(let C=0;C<T.length;C++)if(!T[C].test(S))return!1;if(S.prerelease.length&&!$.includePrerelease){for(let C=0;C<T.length;C++)if(s(T[C].semver),T[C].semver!==a.ANY&&T[C].semver.prerelease.length>0){const O=T[C].semver;if(O.major===S.major&&O.minor===S.minor&&O.patch===S.patch)return!0}return!1}return!0};return yp}var wp,S0;function Vf(){if(S0)return wp;S0=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(c,d){if(d=t(d),c instanceof e){if(c.loose===!!d.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),s("comparator",c,d),this.options=d,this.loose=!!d.loose,this.parse(c),this.semver===n?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}parse(c){const d=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],f=c.match(d);if(!f)throw new TypeError(`Invalid comparator: ${c}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=n}toString(){return this.value}test(c){if(s("Comparator.test",c,this.options.loose),this.semver===n||c===n)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return a(c,this.operator,this.semver,this.options)}intersects(c,d){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(c.value,d).test(this.value):c.operator===""?c.value===""?!0:new l(this.value,d).test(c.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||a(this.semver,"<",c.semver,d)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||a(this.semver,">",c.semver,d)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}wp=e;const t=Hw,{safeRe:r,t:i}=Ru,a=iA,s=Bf,o=Kt,l=vr();return wp}const XU=vr(),QU=(n,e,t)=>{try{e=new XU(e,t)}catch{return!1}return e.test(n)};var qf=QU;const YU=vr(),e4=(n,e)=>new YU(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));var t4=e4;const n4=Kt,r4=vr(),i4=(n,e,t)=>{let r=null,i=null,a=null;try{a=new r4(e,t)}catch{return null}return n.forEach(s=>{a.test(s)&&(!r||i.compare(s)===-1)&&(r=s,i=new n4(r,t))}),r};var a4=i4;const s4=Kt,o4=vr(),l4=(n,e,t)=>{let r=null,i=null,a=null;try{a=new o4(e,t)}catch{return null}return n.forEach(s=>{a.test(s)&&(!r||i.compare(s)===1)&&(r=s,i=new s4(r,t))}),r};var u4=l4;const _p=Kt,c4=vr(),O0=Hf,d4=(n,e)=>{n=new c4(n,e);let t=new _p("0.0.0");if(n.test(t)||(t=new _p("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){const i=n.set[r];let a=null;i.forEach(s=>{const o=new _p(s.semver.version);switch(s.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!a||O0(o,a))&&(a=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),a&&(!t||O0(t,a))&&(t=a)}return t&&n.test(t)?t:null};var f4=d4;const h4=vr(),p4=(n,e)=>{try{return new h4(n,e).range||"*"}catch{return null}};var m4=p4;const g4=Kt,aA=Vf(),{ANY:y4}=aA,w4=vr(),_4=qf,A0=Hf,P0=qw,b4=Ww,v4=Gw,x4=(n,e,t,r)=>{n=new g4(n,r),e=new w4(e,r);let i,a,s,o,l;switch(t){case">":i=A0,a=b4,s=P0,o=">",l=">=";break;case"<":i=P0,a=v4,s=A0,o="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(_4(n,e,r))return!1;for(let u=0;u<e.set.length;++u){const c=e.set[u];let d=null,f=null;if(c.forEach(h=>{h.semver===y4&&(h=new aA(">=0.0.0")),d=d||h,f=f||h,i(h.semver,d.semver,r)?d=h:s(h.semver,f.semver,r)&&(f=h)}),d.operator===o||d.operator===l||(!f.operator||f.operator===o)&&a(n,f.semver))return!1;if(f.operator===l&&s(n,f.semver))return!1}return!0};var Kw=x4;const E4=Kw,k4=(n,e,t)=>E4(n,e,">",t);var S4=k4;const O4=Kw,A4=(n,e,t)=>O4(n,e,"<",t);var P4=A4;const T0=vr(),T4=(n,e,t)=>(n=new T0(n,t),e=new T0(e,t),n.intersects(e,t));var I4=T4;const C4=qf,R4=br;var $4=(n,e,t)=>{const r=[];let i=null,a=null;const s=n.sort((c,d)=>R4(c,d,t));for(const c of s)C4(c,e,t)?(a=c,i||(i=c)):(a&&r.push([i,a]),a=null,i=null);i&&r.push([i,null]);const o=[];for(const[c,d]of r)c===d?o.push(c):!d&&c===s[0]?o.push("*"):d?c===s[0]?o.push(`<=${d}`):o.push(`${c} - ${d}`):o.push(`>=${c}`);const l=o.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return l.length<u.length?l:e};const I0=vr(),Jw=Vf(),{ANY:bp}=Jw,zo=qf,Zw=br,N4=(n,e,t={})=>{if(n===e)return!0;n=new I0(n,t),e=new I0(e,t);let r=!1;e:for(const i of n.set){for(const a of e.set){const s=L4(i,a,t);if(r=r||s!==null,s)continue e}if(r)return!1}return!0},j4=[new Jw(">=0.0.0-0")],C0=[new Jw(">=0.0.0")],L4=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===bp){if(e.length===1&&e[0].semver===bp)return!0;t.includePrerelease?n=j4:n=C0}if(e.length===1&&e[0].semver===bp){if(t.includePrerelease)return!0;e=C0}const r=new Set;let i,a;for(const h of n)h.operator===">"||h.operator===">="?i=R0(i,h,t):h.operator==="<"||h.operator==="<="?a=$0(a,h,t):r.add(h.semver);if(r.size>1)return null;let s;if(i&&a){if(s=Zw(i.semver,a.semver,t),s>0)return null;if(s===0&&(i.operator!==">="||a.operator!=="<="))return null}for(const h of r){if(i&&!zo(h,String(i),t)||a&&!zo(h,String(a),t))return null;for(const p of e)if(!zo(h,String(p),t))return!1;return!0}let o,l,u,c,d=a&&!t.includePrerelease&&a.semver.prerelease.length?a.semver:!1,f=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1;d&&d.prerelease.length===1&&a.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(const h of e){if(c=c||h.operator===">"||h.operator===">=",u=u||h.operator==="<"||h.operator==="<=",i){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator===">"||h.operator===">="){if(o=R0(i,h,t),o===h&&o!==i)return!1}else if(i.operator===">="&&!zo(i.semver,String(h),t))return!1}if(a){if(d&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1),h.operator==="<"||h.operator==="<="){if(l=$0(a,h,t),l===h&&l!==a)return!1}else if(a.operator==="<="&&!zo(a.semver,String(h),t))return!1}if(!h.operator&&(a||i)&&s!==0)return!1}return!(i&&u&&!a&&s!==0||a&&c&&!i&&s!==0||f||d)},R0=(n,e,t)=>{if(!n)return e;const r=Zw(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},$0=(n,e,t)=>{if(!n)return e;const r=Zw(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};var D4=N4;const vp=Ru,N0=zf,F4=Kt,j0=tA,M4=vo,U4=GM,z4=JM,B4=XM,H4=YM,V4=nU,q4=aU,G4=lU,W4=dU,K4=br,J4=mU,Z4=wU,X4=Vw,Q4=xU,Y4=SU,ez=Hf,tz=qw,nz=nA,rz=rA,iz=Gw,az=Ww,sz=iA,oz=KU,lz=Vf(),uz=vr(),cz=qf,dz=t4,fz=a4,hz=u4,pz=f4,mz=m4,gz=Kw,yz=S4,wz=P4,_z=I4,bz=$4,vz=D4;var L0={parse:M4,valid:U4,clean:z4,inc:B4,diff:H4,major:V4,minor:q4,patch:G4,prerelease:W4,compare:K4,rcompare:J4,compareLoose:Z4,compareBuild:X4,sort:Q4,rsort:Y4,gt:ez,lt:tz,eq:nz,neq:rz,gte:iz,lte:az,cmp:sz,coerce:oz,Comparator:lz,Range:uz,satisfies:cz,toComparators:dz,maxSatisfying:fz,minSatisfying:hz,minVersion:pz,validRange:mz,outside:gz,gtr:yz,ltr:wz,intersects:_z,simplifyRange:bz,subset:vz,SemVer:F4,re:vp.re,src:vp.src,tokens:vp.t,SEMVER_SPEC_VERSION:N0.SEMVER_SPEC_VERSION,RELEASE_TYPES:N0.RELEASE_TYPES,compareIdentifiers:j0.compareIdentifiers,rcompareIdentifiers:j0.rcompareIdentifiers};function xz(n,e){const t=L0.parse(n),r=L0.parse(e);if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}function _i(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[i,a]=e.split("/",2);if(!i||!a)throw new Error(`Invalid identifier format: ${n}`);return[i,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}let Ez=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}};async function we(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const i=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new Ez(i):new Error(i)}var D0="[...]",kz={result:"[Circular]"},qd=[],Os=[];function Sz(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function ds(n,e,t,r){var s;try{return JSON.stringify(n,e,t)}catch(o){if(!((s=o.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=Sz()),Eg(n,"",0,[],void 0,0,r);var i;try{Os.length===0?i=JSON.stringify(n,e,t):i=JSON.stringify(n,Oz(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;qd.length!==0;){var a=qd.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return i}}function xp(n,e,t,r){var i=Object.getOwnPropertyDescriptor(r,t);i.get!==void 0?i.configurable?(Object.defineProperty(r,t,{value:n}),qd.push([r,t,e,i])):Os.push([e,t,n]):(r[t]=n,qd.push([r,t,e]))}function Eg(n,e,t,r,i,a,s){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){xp(kz,n,e,i);return}if(typeof s.depthLimit<"u"&&a>s.depthLimit){xp(D0,n,e,i);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){xp(D0,n,e,i);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)Eg(n[o],o,o,r,n,a,s);else{var l=Object.keys(n);for(o=0;o<l.length;o++){var u=l[o];Eg(n[u],u,o,r,n,a,s)}}r.pop()}}function Oz(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Os.length>0)for(var r=0;r<Os.length;r++){var i=Os[r];if(i[1]===e&&i[0]===t){t=i[2],Os.splice(r,1);break}}return n.call(this,e,t)}}function F0(n){const e=OM(),t=AM(),r=n.extra??{},i=r.metadata;return n.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...i}},n}const Az=()=>{const n=cs("TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},Pz=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function Tz(n){const e=[];for await(const t of n)e.push(t);return e}function Ep(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const Iz=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class Cz{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(a=>{t=a}),i=ds(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop(e){var i;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(((i=this.peek())==null?void 0:i.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(t.push(a),r+=a.size,this.sizeBytes-=a.size)}if(t.length===0&&this.items.length>0){const a=this.items.shift();t.push(a),r+=a.size,this.sizeBytes-=a.size}return[t.map(a=>({action:a.action,item:a.payload})),()=>t.forEach(a=>a.itemPromiseResolve())]}}const Rz=20971520,$z=1e3;let Nz=class kg{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Cz}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=kg.getDefaultClientConfig();this.tracingSampleRate=Az(),this.apiUrl=Ep(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Ep(e.apiKey??t.apiKey),this.webUrl=Ep(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new d0(e.callerOptions??{}),this.batchIngestCaller=new d0({...e.callerOptions??{},onFailedResponseHook:Iz}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=cs("API_KEY"),t=cs("ENDPOINT")??"https://api.smith.langchain.com",r=cs("HIDE_INPUTS")==="true",i=cs("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:Pz(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${sA}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",i=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(te(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(a));const s=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(te(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(o,`Failed to fetch ${e}`);const l=r?r(await o.json()):await o.json();if(l.length===0||(yield l,l.length<a))break;i+=l.length}}async*_getCursorPaginatedList(e,t=null,r="POST",i="runs"){const a=t?{...t}:{};for(;;){const o=await(await this.caller.call(te(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[i])break;yield o[i];const l=o.cursors;if(!l||!l.next)break;a.cursor=l.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):r.push(i);return r}else{const r=[];for(const i of e)i.id!==i.trace_id&&!this.filteredPostUuids.has(i.trace_id)||Math.random()<this.tracingSampleRate?r.push(i):this.filteredPostUuids.add(i.id);return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??Rz}async drainAutoBatchQueue(){var e;for(;this.autoBatchQueue.items.length>=0;){const[t,r]=this.autoBatchQueue.pop(await this._getBatchSizeLimitBytes());if(!t.length){r();return}try{const i={runCreates:t.filter(s=>s.action==="create").map(s=>s.item),runUpdates:t.filter(s=>s.action==="update").map(s=>s.item)},a=await this._ensureServerInfo();(e=a==null?void 0:a.batch_ingest_config)!=null&&e.use_multipart_endpoint?await this.multipartIngestRuns(i):await this.batchIngestRuns(i)}finally{r()}}}async processRunOperation(e,t){const r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=F0(e.item));const i=this.autoBatchQueue.push(e),a=await this._getBatchSizeLimitBytes();return(t||this.autoBatchQueue.sizeBytes>a)&&await this.drainAutoBatchQueue().catch(console.error),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),i}async _getServerInfo(){const e=await te()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout($z),...this.fetchOptions});return await we(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const i=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}const a=F0(i),s=await this.caller.call(te(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:ds(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(s,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(l=>this.prepareRunCreateOrUpdateInputs(l)))??[],i=(t==null?void 0:t.map(l=>this.prepareRunCreateOrUpdateInputs(l)))??[];if(r.length>0&&i.length>0){const l=r.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),u=[];for(const c of i)c.id!==void 0&&l[c.id]?l[c.id]={...l[c.id],...c}:u.push(c);r=Object.values(l),i=u}const a={post:this._filterForSampling(r),patch:this._filterForSampling(i,!0)};if(!a.post.length&&!a.patch.length)return;if((await this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(const l of a.post)await this.createRun(l);for(const l of a.patch)l.id!==void 0&&await this.updateRun(l.id,l);return}const o={post:[],patch:[]};for(const l of["post","patch"]){const u=l,c=a[u].reverse();let d=c.pop();for(;d!==void 0;)o[u].push(d),d=c.pop()}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(ds(o))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(te(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const r={};let i=[];for(const c of e??[]){const d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,i.push(d)}let a=[];for(const c of t??[])a.push(this.prepareRunCreateOrUpdateInputs(c));if(i.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){const c=i.reduce((f,h)=>(h.id&&(f[h.id]=h),f),{}),d=[];for(const f of a)f.id!==void 0&&c[f.id]?c[f.id]={...c[f.id],...f}:d.push(f);i=Object.values(c),a=d}if(i.length===0&&a.length===0)return;const l=[],u=[];for(const[c,d]of[["post",i],["patch",a]])for(const f of d){const{inputs:h,outputs:p,events:m,..._}=f,g={inputs:h,outputs:p,events:m},y=ds(_);u.push({name:`${c}.${_.id}`,payload:new Blob([y],{type:`application/json; length=${y.length}`})});for(const[w,x]of Object.entries(g)){if(x===void 0)continue;const k=ds(x);u.push({name:`${c}.${_.id}.${w}`,payload:new Blob([k],{type:`application/json; length=${k.length}`})})}if(_.id!==void 0){const w=r[_.id];if(w){delete r[_.id];for(const[x,[k,E]]of Object.entries(w))u.push({name:`attachment.${_.id}.${x}`,payload:new Blob([E],{type:`${k}; length=${E.length}`})})}}l.push(`trace=${_.trace_id},id=${_.id}`)}await this._sendMultipartRequest(u,l.join("; "))}async _sendMultipartRequest(e,t){try{const r=new FormData;for(const i of e)r.append(i.name,i.payload);await this.batchIngestCaller.call(te(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers},body:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})}catch(r){let i="Failed to multipart ingest runs";r instanceof Error?i+=`: ${r.stack||r.message}`:i+=`: ${String(r)}`,console.warn(`${i.trim()}

Context: ${t}`)}}async updateRun(e,t){be(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(te(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:ds(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){be(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let i;t.session_id?i=t.session_id:r!=null&&r.projectName?i=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?i=r==null?void 0:r.projectId:i=(await this.readProject({projectName:cs("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${i}/r/${t.id}?poll=true`}else if(e!==void 0){const i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await Tz(this.listRuns({id:e.child_run_ids})),r={},i={};t.sort((a,s)=>((a==null?void 0:a.dotted_order)??"").localeCompare((s==null?void 0:s.dotted_order)??""));for(const a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),i[a.id]=a}e.child_runs=r[e.id]||[];for(const a in r)a!==e.id&&(i[a].child_runs=r[a]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:i,traceId:a,referenceExampleId:s,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:f,query:h,filter:p,traceFilter:m,treeFilter:_,limit:g,select:y}=e;let w=[];if(t&&(w=Array.isArray(t)?t:[t]),r){const P=Array.isArray(r)?r:[r],R=await Promise.all(P.map(H=>this.readProject({projectName:H}).then(j=>j.id)));w.push(...R)}const x=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],k={session:w.length?w:null,run_type:c,reference_example:s,query:h,filter:p,trace_filter:m,tree_filter:_,execution_order:l,parent_run:i,start_time:o?o.toISOString():null,error:d,id:f,limit:g,trace:a,select:y||x,is_root:u};let E=0;for await(const P of this._getCursorPaginatedList("/runs/query",k))if(g){if(E>=g)break;if(P.length+E>g){yield*P.slice(0,g-E);break}E+=P.length,yield*P}else yield*P}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:a,projectIds:s,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:f,traceFilter:h,treeFilter:p,isRoot:m,dataSourceType:_}){let g=s||[];a&&(g=[...s||[],...await Promise.all(a.map(E=>this.readProject({projectName:E}).then(P=>P.id)))]);const w=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:g,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:f,trace_filter:h,tree_filter:p,is_root:m,data_source_type:_}).filter(([E,P])=>P!==void 0));return await(await this.caller.call(te(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||Et()};be(e);const a=await(await this.caller.call(te(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){be(e);const t=await this.caller.call(te(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(t,"unshare run",!0)}async readRunSharedLink(e){be(e);const r=await(await this.caller.call(te(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const s of t)r.append("id",s);return be(e),await(await this.caller.call(te(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),be(e);const i=await(await this.caller.call(te(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};be(e);const a=await(await this.caller.call(te(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){be(e);const t=await this.caller.call(te(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(t,"unshare dataset",!0)}async readSharedDataset(e){return be(e),await(await this.caller.call(te(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const i=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>i.append(o,u)):i.append(o,l)});const a=await this.caller.call(te(),`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await a.json();if(!a.ok)throw"detail"in s?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${s.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return s.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:a=null,referenceDatasetId:s=null}){const o=i?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=a||{};r&&(u.metadata=r);const c={name:e,extra:u,description:t};s!==null&&(c.reference_dataset_id=s);const d=await this.caller.call(te(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:a=null,endTime:s=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=a;i&&(l={...l||{},metadata:i});const u={name:t,extra:l,description:r,end_time:s?new Date(s).toISOString():null},c=await this.caller.call(te(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)be(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(te(),`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const s=await a.json();return a.ok?Array.isArray(s)?s.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)be(e),i+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const s=await this._get(i,a);let o;if(Array.isArray(s)){if(s.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=s[0]}else o=s;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:a,referenceFree:s,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const u of e)l.append("id",u);if(t!==void 0&&l.append("name",t),r!==void 0&&l.append("name_contains",r),i!==void 0)l.append("reference_dataset",i);else if(a!==void 0){const u=await this.readDataset({datasetName:a});l.append("reference_dataset",u.id)}s!==void 0&&l.append("reference_free",s.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const u of this._getPaginated("/sessions",l))yield*u}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,be(r);const i=await this.caller.call(te(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(i,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:a,dataType:s,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(f=>{u.append("input_keys",f)}),i.forEach(f=>{u.append("output_keys",f)}),a&&u.append("description",a),s&&u.append("data_type",s),o&&u.append("name",o);const c=await this.caller.call(te(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:a,metadata:s}={}){const o={name:e,description:t,extra:s?{metadata:s}:void 0};r&&(o.data_type=r),i&&(o.inputs_schema_definition=i),a&&(o.outputs_schema_definition=a);const l=await this.caller.call(te(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const i=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)be(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,i);let s;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=a[0]}else s=a;return s}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const s=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:a,metadata:s}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const u of r)l.append("id",u);i!==void 0&&l.append("name",i),a!==void 0&&l.append("name_contains",a),s!==void 0&&l.append("metadata",JSON.stringify(s));for await(const u of this._getPaginated(o,l))yield*u}async updateDataset(e){const{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:r})).id;be(a);const s=await this.caller.call(te(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(s,"update dataset"),await s.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(i=(await this.readDataset({datasetName:t})).id),i!==void 0)be(i),r+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(te(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(!i&&!t)throw new Error("Must provide either datasetName or datasetId");if(i&&t)throw new Error("Must provide either datasetName or datasetId, not both");i||(i=(await this.readDataset({datasetName:t})).id),be(i);const a={tag:r},s=await this.caller.call(te(),`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(s,"index dataset"),await s.json()}async similarExamples(e,t,r,{filter:i}={}){const a={limit:r,inputs:e};i!==void 0&&(a.filter=i),be(t);const s=await this.caller.call(te(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(s,"fetch similar examples"),(await s.json()).examples}async createExample(e,t,{datasetId:r,datasetName:i,createdAt:a,exampleId:s,metadata:o,split:l,sourceRunId:u}){let c=r;if(c===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:i})).id);const d=a||new Date,f={dataset_id:c,inputs:e,outputs:t,created_at:d==null?void 0:d.toISOString(),id:s,metadata:o,split:l,source_run_id:u},h=await this.caller.call(te(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(h,"create example"),await h.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:i,sourceRunIds:a,exampleIds:s,datasetId:o,datasetName:l}=e;let u=o;if(u===void 0&&l===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&l!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:l})).id);const c=t.map((h,p)=>({dataset_id:u,inputs:h,outputs:r?r[p]:void 0,metadata:i?i[p]:void 0,split:e.splits?e.splits[p]:void 0,id:s?s[p]:void 0,source_run_id:a?a[p]:void 0})),d=await this.caller.call(te(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const i=e.map(s=>f0(s)?h0(s):s),a=f0(t)?h0(t):t;return this.createExample({input:i},{output:a},r)}async readExample(e){be(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:a,inlineS3Urls:s,metadata:o,limit:l,offset:u,filter:c}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:d}),h=i?typeof i=="string"?i:i==null?void 0:i.toISOString():void 0;h&&f.append("as_of",h);const p=s??!0;if(f.append("inline_s3_urls",p.toString()),r!==void 0)for(const _ of r)f.append("id",_);if(a!==void 0)for(const _ of a)f.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);f.append("metadata",_)}l!==void 0&&f.append("limit",l.toString()),u!==void 0&&f.append("offset",u.toString()),c!==void 0&&f.append("filter",c);let m=0;for await(const _ of this._getPaginated("/examples",f)){for(const g of _)yield g,m++;if(l!==void 0&&m>=l)break}}async deleteExample(e){be(e);const t=`/examples/${e}`,r=await this.caller.call(te(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(r,`delete ${t}`),await r.json()}async updateExample(e,t){be(e);const r=await this.caller.call(te(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(r,"update example"),await r.json()}async updateExamples(e){const t=await this.caller.call(te(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(t,"update examples"),await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,be(i);const a=new URLSearchParams,s=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return s&&a.append("as_of",s),await this._get(`/datasets/${i}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:a=!1}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,be(s);const o={split_name:r,examples:i.map(u=>(be(u),u)),remove:a},l=await this.caller.call(te(),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:a}={loadChildRuns:!1}){IM("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let s;if(typeof e=="string")s=await this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)s=e;else throw new Error(`Invalid run type: ${typeof e}`);s.reference_example_id!==null&&s.reference_example_id!==void 0&&(a=await this.readExample(s.reference_example_id));const o=await t.evaluateRun(s,a),[l,u]=await this._logEvaluationFeedback(o,s,r);return u[0]}async createFeedback(e,t,{score:r,value:i,correction:a,comment:s,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:h}){var y;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};u!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:u}),(p==null?void 0:p.metadata)!==void 0&&((y=p.metadata.__run)==null?void 0:y.run_id)!==void 0&&be(p.metadata.__run.run_id);const m={id:c??Et(),run_id:e,key:t,score:r,value:i,correction:a,comment:s,feedback_source:p,comparative_experiment_id:h,feedbackConfig:d,session_id:f},_=`${this.apiUrl}/feedback`,g=await this.caller.call(te(),_,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(g,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:i,comment:a}){const s={};t!=null&&(s.score=t),r!=null&&(s.value=r),i!=null&&(s.correction=i),a!=null&&(s.comment=a),be(e);const o=await this.caller.call(te(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(o,"update feedback",!0)}async readFeedback(e){be(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){be(e);const t=`/feedback/${e}`,r=await this.caller.call(te(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const i=new URLSearchParams;if(e&&i.append("run",e.join(",")),t)for(const a of t)i.append("key",a);if(r)for(const a of r)i.append("source",a);for await(const a of this._getPaginated("/feedback",i))yield*a}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){const a={run_id:e,feedback_key:t,feedback_config:i};return r?typeof r=="string"?a.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(te(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:a,metadata:s,id:o}){var c;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(c=i??new Date)==null?void 0:c.toISOString(),extra:{}};return s&&(l.extra.metadata=s),await(await this.caller.call(te(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){be(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){const i=this._selectEvalResults(e),a=[];for(const s of i){let o=r||{};s.evaluatorInfo&&(o={...s.evaluatorInfo,...o});let l=null;s.targetRunId?l=s.targetRunId:t&&(l=t.id),a.push(await this.createFeedback(l,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[i,a]}async logEvaluationFeedback(e,t,r){const[i]=await this._logEvaluationFeedback(e,t,r);return i}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:i,limit:a}=e,s=new URLSearchParams;t&&t.forEach((l,u)=>{be(l,`queueIds[${u}]`),s.append("ids",l)}),r&&s.append("name",r),i&&s.append("name_contains",i),s.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",s))if(yield*l,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:i}=e,a={name:t,description:r,id:i||Et()},s=await this.caller.call(te(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([l,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(s,"create annotation queue"),await s.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:r,description:i}=t,a=await this.caller.call(te(),`${this.apiUrl}/annotation-queues/${be(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(a,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(te(),`${this.apiUrl}/annotation-queues/${be(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(te(),`${this.apiUrl}/annotation-queues/${be(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((i,a)=>be(i,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${be(e,"queueId")}/run`,i=await this.caller.call(te(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(i,"get run from annotation queue"),await i.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(te(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const i=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${i}`);throw a.statusCode=t.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,i,a]=_i(e),s=await this.caller.call(te(),`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(s,`${t?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(e){const[t,r,i]=_i(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,i=>i.repos))yield*r}async getPrompt(e){const[t,r,i]=_i(e),a=await this.caller.call(te(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await we(a,"get prompt");const s=await a.json();return s.repo?s.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[i,a,s]=_i(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);const o={repo_handle:a,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=await this.caller.call(te(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(l,"create prompt");const{repo:u}=await l.json();return u}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[i,a,s]=_i(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${i}/${a}`):r==null?void 0:r.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call(te(),`${this.apiUrl}/commits/${i}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(u,"create commit");const c=await u.json();return this._getPromptUrl(`${i}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,i]=_i(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if((t==null?void 0:t.description)!==void 0&&(a.description=t.description),(t==null?void 0:t.readme)!==void 0&&(a.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(a.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(a.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const s=await this.caller.call(te(),`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await we(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,i]=_i(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(te(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,i,a]=_i(e),s=await this._getServerInfo(),o=xz(s.version,"0.5.23");let l=a;if(!o&&a==="latest"){const d=await this._getLatestCommitHash(`${r}/${i}`);if(d)l=d;else throw new Error("No commits found")}const u=await this.caller.call(te(),`${this.apiUrl}/commits/${r}/${i}/${l}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await we(u,"pull prompt commit");const c=await u.json();return{owner:r,repo:i,commit_hash:c.commit_hash,manifest:c.manifest,examples:c.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(i=>i!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[a,s]=this.parseTokenOrUrl(e,r),o=new kg({apiUrl:a,apiKey:"placeholder"}),l=await o.readSharedDataset(s),u=i||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const c=await o.listSharedExamples(s),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(f=>f.inputs),outputs:c.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return be(e),[t,e]}catch{}try{const s=new URL(e).pathname.split("/").filter(o=>o!=="");if(s.length>=r){const o=s[s.length-r];return[t,o]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}};const sA="0.1.68";let jz=class extends Uf{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:i}=e;this.projectName=r??Ze("LANGCHAIN_PROJECT")??Ze("LANGCHAIN_SESSION"),this.exampleId=t,this.client=i??new Nz({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await nD()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}};async function Lz(){return new jz}let kp;function Dz(){const n="default"in gt?gt.default:gt;return new n({autoStart:!0,concurrency:1})}async function kt(n,e){e===!0?await n():(typeof kp>"u"&&(kp=Dz()),kp.add(n))}let Fz=class{setHandler(e){return this.setHandlers([e])}},Gf=class{constructor(e,t,r,i,a,s,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}async handleText(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleText: ${i}`)}},t.awaitHandlers)))}},Mz=class extends Gf{getChild(e){const t=new zr(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch{console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${i}`)}},t.awaitHandlers)))}},M0=class extends Gf{async handleLLMNewToken(e,t,r,i,a,s){await Promise.all(this.handlers.map(o=>kt(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(u){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${i}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${i}`)}},t.awaitHandlers)))}},Uz=class extends Gf{getChild(e){const t=new zr(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,a){await Promise.all(this.handlers.map(s=>kt(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(l){console.error(`Error in handler ${s.constructor.name}, handleChainError: ${l}`)}},s.awaitHandlers)))}async handleChainEnd(e,t,r,i,a){await Promise.all(this.handlers.map(s=>kt(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(l){console.error(`Error in handler ${s.constructor.name}, handleChainEnd: ${l}`)}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${i}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${i}`)}},t.awaitHandlers)))}},zz=class extends Gf{getChild(e){const t=new zr(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${i}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>kt(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${i}`)}},t.awaitHandlers)))}},zr=class ed extends Fz{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&r?r:Oi();return await Promise.all(this.handlers.map(f=>kt(async()=>{var h;if(!f.ignoreLLM)try{await((h=f.handleLLMStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l))}catch(p){console.error(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`)}},f.awaitHandlers))),new M0(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&r?r:Oi();return await Promise.all(this.handlers.map(f=>kt(async()=>{var h,p;if(!f.ignoreLLM)try{if(f.handleChatModelStart)await((h=f.handleChatModelStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l));else if(f.handleLLMStart){const m=OO(u);await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[m],d,this._parentRunId,a,this.tags,this.metadata,l))}}catch(m){console.error(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`)}},f.awaitHandlers))),new M0(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Oi(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>kt(async()=>{var u;if(!l.ignoreChain)try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,i,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`)}},l.awaitHandlers))),new Uz(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Oi(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>kt(async()=>{var u;if(!l.ignoreAgent)try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`)}},l.awaitHandlers))),new zz(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=Oi(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>kt(async()=>{var u;if(!l.ignoreRetriever)try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`)}},l.awaitHandlers))),new Mz(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new ed(this._parentRunId);for(const i of this.handlers){const a=this.inheritableHandlers.includes(i);r.addHandler(i,a)}for(const i of this.tags){const a=this.inheritableTags.includes(i);r.addTags([i],a)}for(const i of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(i);r.addMetadata({[i]:this.metadata[i]},a)}for(const i of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends zw{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Oi()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,i,a,s,o){let l;(e||t)&&(Array.isArray(e)||!e?(l=new ed,l.setHandlers((e==null?void 0:e.map(Gd))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(Gd):t==null?void 0:t.handlers,!1));const u=Ze("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=Ze("LANGCHAIN_TRACING_V2")==="true",d=c||(Ze("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new ed),u&&!l.handlers.some(f=>f.name===u0.prototype.name)){const f=new u0;l.addHandler(f,!0)}d&&!l.handlers.some(f=>f.name==="langchain_tracer")&&c&&l.addHandler(await Lz(),!0)}return(r||i)&&l&&(l.addTags(r??[]),l.addTags(i??[],!1)),(a||s)&&l&&(l.addMetadata(a??{}),l.addMetadata(s??{},!1)),l}};function Gd(n){return"name"in n?n:zw.fromMethods(n)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const Bz=Object.prototype.hasOwnProperty;function Hz(n,e){return Bz.call(n,e)}function Vz(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)Hz(n,t)&&e.push(t);return e}function io(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Sg(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function qz(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function Og(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Og(n[t]))return!0}else if(typeof n=="object"){const t=Vz(n),r=t.length;for(var e=0;e<r;e++)if(Og(n[t[e]]))return!0}}return!1}function U0(n,e){const t=[n];for(const r in e){const i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(`${r}: ${i}`)}return t.join(`
`)}let Gz=class extends Error{constructor(e,t,r,i,a){super(U0(e,{name:t,index:r,operation:i,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=U0(e,{name:t,index:r,operation:i,tree:a})}};const tt=Gz,As={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Ag(t,this.path);r&&(r=io(r));const i=vl(t,{op:"remove",path:this.from}).removed;return vl(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=Ag(t,this.from);return vl(t,{op:"add",path:this.path,value:io(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Kd(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var Wz={add:function(n,e,t){return Sg(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:As.move,copy:As.copy,test:As.test,_get:As._get};function Ag(n,e){if(e=="")return n;var t={op:"_get",path:e};return vl(n,t),t.value}function vl(n,e,t=!1,r=!0,i=!0,a=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):Pg(e,0)),e.path===""){let s={newDocument:n};if(e.op==="add")return s.newDocument=e.value,s;if(e.op==="replace")return s.newDocument=e.value,s.removed=n,s;if(e.op==="move"||e.op==="copy")return s.newDocument=Ag(n,e.from),e.op==="move"&&(s.removed=n),s;if(e.op==="test"){if(s.test=Kd(n,e.value),s.test===!1)throw new tt("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return s.newDocument=n,s}else{if(e.op==="remove")return s.removed=n,s.newDocument=null,s;if(e.op==="_get")return e.value=n,s;if(t)throw new tt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,n);return s}}else{r||(n=io(n));const o=(e.path||"").split("/");let l=n,u=1,c=o.length,d,f,h;for(typeof t=="function"?h=t:h=Pg;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=qz(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[f]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&h(e,0,n,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(t&&!Sg(f))throw new tt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,n);Sg(f)&&(f=~~f)}if(u>=c){if(t&&e.op==="add"&&f>l.length)throw new tt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,n);const p=Wz[e.op].call(e,l,f,n);if(p.test===!1)throw new tt("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return p}}else if(u>=c){const p=As[e.op].call(e,l,f,n);if(p.test===!1)throw new tt("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return p}if(l=l[f],t&&u<c&&(!l||typeof l!="object"))throw new tt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,n)}}}function Wd(n,e,t,r=!0,i=!0){if(t&&!Array.isArray(e))throw new tt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=io(n));const a=new Array(e.length);for(let s=0,o=e.length;s<o;s++)a[s]=vl(n,e[s],t,!0,i,s),n=a[s].newDocument;return a.newDocument=n,a}function Pg(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new tt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(As[n.op]){if(typeof n.path!="string")throw new tt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new tt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new tt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new tt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&Og(n.value))throw new tt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new tt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new tt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var s={op:"_get",path:n.from,value:void 0},o=Kz([s],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new tt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new tt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function Kz(n,e,t){try{if(!Array.isArray(n))throw new tt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Wd(io(e),io(n),t||!0);else{t=t||Pg;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof tt)return i;throw i}}function Kd(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,a,s;if(t&&r){if(a=n.length,a!=e.length)return!1;for(i=a;i--!==0;)if(!Kd(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(a=o.length,a!==Object.keys(e).length)return!1;for(i=a;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=a;i--!==0;)if(s=o[i],!Kd(n[s],e[s]))return!1;return!0}return n!==n&&e!==e}let Wa=class Tg extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new Tg({start(r){return i();function i(){return t.read().then(({done:a,value:s})=>{if(a){r.close();return}return r.enqueue(s),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new Tg({async pull(t){const{value:r,done:i}=await e.next();i&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}};function oA(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(i){for(;;)if(i.length===0){const a=await n.next();for(const s of t)s.push(a)}else{if(i[0].done)return;yield i.shift().value}})}function Vi(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,i]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Vi(t[r],i):t[r]=i;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}let xo=class{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise((r,i)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(r,i):this.firstResult.then(a=>r(void 0),i)})}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}};async function Jz(n,e,t,...r){const i=new xo(e,t),a=await i.setup;return{output:n(i,a,...r),setup:a}}let Ai=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=Wd({},t);return new lA({ops:t,state:r[r.length-1].newDocument})}},lA=class Ig extends Ai{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=Wd(this.state,e.ops);return new Ig({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=Wd({},e.ops);return new Ig({ops:e.ops,state:t[t.length-1].newDocument})}};async function z0(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function B0(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function Zz(n){return n!==void 0&&n.message!==void 0}let H0=class extends Uf{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Wa.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const i=this.keyMapByRunId[e];i&&await this.writer.write(new Ai({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var i;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Ai({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await z0(e,this._schemaFormat)),await this.writer.write(new Ai({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await z0(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await B0(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const i=new Ai({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){const t=new Ai({ops:[{op:"replace",path:"/final_output",value:await B0(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const i=this.keyMapByRunId[e.id];if(i===void 0)return;const a=e.inputs.messages!==void 0;let s;a?Zz(r==null?void 0:r.chunk)?s=r==null?void 0:r.chunk:s=new xO(t):s=t;const o=new Ai({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:s}]});await this.writer.write(o)}},Xz=class{getStore(){}run(e,t){return t()}},Qz=class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new Xz}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}};const du=new Qz,Sp=25;async function Ia(n){return zr.configure(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function V0(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const i=e[r]??[];e[r]=[...new Set(i.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="callbacks"){const i=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!i)e.callbacks=a;else if(Array.isArray(i))e.callbacks=i.concat(a);else{const s=i.copy();for(const o of a)s.addHandler(Gd(o),!0);e.callbacks=s}else if(a)if(!i)e.callbacks=a;else if(Array.isArray(i)){const s=a.copy();for(const o of i)s.addHandler(Gd(o),!0);e.callbacks=s}else e.callbacks=new zr(a._parentRunId,{handlers:i.handlers.concat(a.handlers),inheritableHandlers:i.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(a.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(a.inheritableTags))),metadata:{...i.metadata,...a.metadata}})}else{const i=r;e[i]=t[i]??e[i]}return e}const Yz=new Set(["string","number","boolean"]);function Je(n){var r;const e=n??du.getInstance().getStore();let t={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(e&&(t={...t,...e}),e!=null&&e.configurable)for(const i of Object.keys(e.configurable))Yz.has(typeof e.configurable[i])&&!((r=t.metadata)!=null&&r[i])&&(t.metadata||(t.metadata={}),t.metadata[i]=e.configurable[i]);return t}function an(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:i,configurable:a,runId:s}={}){const o=Je(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),i!==void 0&&(o.runName=i),a!==void 0&&(o.configurable={...o.configurable,...a}),s!==void 0&&delete o.runId,o}let uA=class extends Uf{constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}};function cA(n){return n?n.lc_runnable:!1}let e3=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const i=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||i.some(a=>{var s;return(s=this.includeTags)==null?void 0:s.includes(a)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&i.every(a=>{var s;return!((s=this.excludeTags)!=null&&s.includes(a))})),r}};const t3=Symbol("Let zodToJsonSchema decide on which parser to use"),n3={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},r3=n=>({...n3,...n}),i3=n=>{const e=r3(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function dA(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Ce(n,e,t,r,i){n[e]=t,dA(n,e,r,i)}function a3(){return{}}function s3(n,e){var r,i,a;const t={type:"array"};return(r=n.type)!=null&&r._def&&((a=(i=n.type)==null?void 0:i._def)==null?void 0:a.typeName)!==B.ZodAny&&(t.items=Pe(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Ce(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Ce(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Ce(t,"minItems",n.exactLength.value,n.exactLength.message,e),Ce(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function o3(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Ce(t,"minimum",r.value,r.message,e):Ce(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ce(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ce(t,"maximum",r.value,r.message,e):Ce(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ce(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ce(t,"multipleOf",r.value,r.message,e);break}return t}function l3(){return{type:"boolean"}}function fA(n,e){return Pe(n.type._def,e)}const u3=(n,e)=>Pe(n.innerType._def,e);function hA(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,a)=>hA(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return c3(n,e)}}const c3=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":Ce(t,"minimum",r.value,r.message,e);break;case"max":Ce(t,"maximum",r.value,r.message,e);break}return t};function d3(n,e){return{...Pe(n.innerType._def,e),default:n.defaultValue()}}function f3(n,e){return e.effectStrategy==="input"?Pe(n.schema._def,e):{}}function h3(n){return{type:"string",enum:Array.from(n.values)}}const p3=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function m3(n,e){const t=[Pe(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Pe(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return t.forEach(a=>{if(p3(a))i.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let s=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...l}=a;s=l}else r=void 0;i.push(s)}}),i.length?{allOf:i,...r}:void 0}function g3(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let Op;const Yn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Op===void 0&&(Op=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Op),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function pA(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":Ce(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":Ce(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":er(t,"email",r.message,e);break;case"format:idn-email":er(t,"idn-email",r.message,e);break;case"pattern:zod":zt(t,Yn.email,r.message,e);break}break;case"url":er(t,"uri",r.message,e);break;case"uuid":er(t,"uuid",r.message,e);break;case"regex":zt(t,r.regex,r.message,e);break;case"cuid":zt(t,Yn.cuid,r.message,e);break;case"cuid2":zt(t,Yn.cuid2,r.message,e);break;case"startsWith":zt(t,RegExp(`^${Ap(r.value,e)}`),r.message,e);break;case"endsWith":zt(t,RegExp(`${Ap(r.value,e)}$`),r.message,e);break;case"datetime":er(t,"date-time",r.message,e);break;case"date":er(t,"date",r.message,e);break;case"time":er(t,"time",r.message,e);break;case"duration":er(t,"duration",r.message,e);break;case"length":Ce(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),Ce(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{zt(t,RegExp(Ap(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&er(t,"ipv4",r.message,e),r.version!=="v4"&&er(t,"ipv6",r.message,e);break}case"base64url":zt(t,Yn.base64url,r.message,e);break;case"jwt":zt(t,Yn.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&zt(t,Yn.ipv4Cidr,r.message,e),r.version!=="v4"&&zt(t,Yn.ipv6Cidr,r.message,e);break}case"emoji":zt(t,Yn.emoji(),r.message,e);break;case"ulid":{zt(t,Yn.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{er(t,"binary",r.message,e);break}case"contentEncoding:base64":{Ce(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{zt(t,Yn.base64,r.message,e);break}}break}case"nanoid":zt(t,Yn.nanoid,r.message,e)}return t}function Ap(n,e){return e.patternStrategy==="escape"?w3(n):n}const y3=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function w3(n){let e="";for(let t=0;t<n.length;t++)y3.has(n[t])||(e+="\\"),e+=n[t];return e}function er(n,e,t,r){var i;n.format||(i=n.anyOf)!=null&&i.some(a=>a.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Ce(n,"format",e,t,r)}function zt(n,e,t,r){var i;n.pattern||(i=n.allOf)!=null&&i.some(a=>a.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:q0(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Ce(n,"pattern",q0(e,r),t,r)}function q0(n,e){var l;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let i="",a=!1,s=!1,o=!1;for(let u=0;u<r.length;u++){if(a){i+=r[u],a=!1;continue}if(t.i){if(s){if(r[u].match(/[a-z]/)){o?(i+=r[u],i+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((l=r[u+2])!=null&&l.match(/[a-z]/))?(i+=r[u],o=!0):i+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){i+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(t.m){if(r[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&r[u]==="."){i+=s?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}i+=r[u],r[u]==="\\"?a=!0:s&&r[u]==="]"?s=!1:!s&&r[u]==="["&&(s=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return i}function mA(n,e){var r,i,a,s,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===B.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((u,c)=>({...u,[c]:Pe(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:Pe(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((i=n.keyType)==null?void 0:i._def.typeName)===B.ZodString&&((a=n.keyType._def.checks)!=null&&a.length)){const{type:u,...c}=pA(n.keyType._def,e);return{...t,propertyNames:c}}else{if(((s=n.keyType)==null?void 0:s._def.typeName)===B.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===B.ZodBranded&&n.keyType._def.type._def.typeName===B.ZodString&&((l=n.keyType._def.type._def.checks)!=null&&l.length)){const{type:u,...c}=fA(n.keyType._def,e);return{...t,propertyNames:c}}}return t}function _3(n,e){if(e.mapStrategy==="record")return mA(n,e);const t=Pe(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=Pe(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function b3(n){const e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),i=Array.from(new Set(r.map(a=>typeof a)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function v3(){return{not:{}}}function x3(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Jd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function E3(n,e){if(e.target==="openApi3")return G0(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Jd&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((i,a)=>{const s=Jd[a._def.typeName];return s&&!i.includes(s)?[...i,s]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((i,a)=>{const s=typeof a._def.value;switch(s){case"string":case"number":case"boolean":return[...i,s];case"bigint":return[...i,"integer"];case"object":if(a._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){const i=r.filter((a,s,o)=>o.indexOf(a)===s);return{type:i.length>1?i:i[0],enum:t.reduce((a,s)=>a.includes(s._def.value)?a:[...a,s._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(a=>!r.includes(a))],[])};return G0(n,e)}const G0=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>Pe(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function k3(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:Jd[n.innerType._def.typeName],nullable:!0}:{type:[Jd[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=Pe(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=Pe(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function S3(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",dA(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Ce(t,"minimum",r.value,r.message,e):Ce(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ce(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ce(t,"maximum",r.value,r.message,e):Ce(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ce(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ce(t,"multipleOf",r.value,r.message,e);break}return t}function O3(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":Pe(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":Pe(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function A3(n,e){const t=e.target==="openAi",r={type:"object",...Object.entries(n.shape()).reduce((i,[a,s])=>{if(s===void 0||s._def===void 0)return i;let o=s.isOptional();o&&t&&(s instanceof hr&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);const l=Pe(s._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});return l===void 0?i:{properties:{...i.properties,[a]:l},required:o?i.required:[...i.required,a]}},{properties:{},required:[]}),additionalProperties:O3(n,e)};return r.required.length||delete r.required,r}const P3=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return Pe(n.innerType._def,e);const t=Pe(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},T3=(n,e)=>{if(e.pipeStrategy==="input")return Pe(n.in._def,e);if(e.pipeStrategy==="output")return Pe(n.out._def,e);const t=Pe(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=Pe(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(i=>i!==void 0)}};function I3(n,e){return Pe(n.type._def,e)}function C3(n,e){const r={type:"array",uniqueItems:!0,items:Pe(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Ce(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Ce(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function R3(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>Pe(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:Pe(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>Pe(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function $3(){return{not:{}}}function N3(){return{}}const j3=(n,e)=>Pe(n.innerType._def,e);function Pe(n,e,t=!1){var s;const r=e.seen.get(n);if(e.override){const o=(s=e.override)==null?void 0:s.call(e,n,e,r,t);if(o!==t3)return o}if(r&&!t){const o=L3(r,e);if(o!==void 0)return o}const i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);const a=F3(n,n.typeName,e);return a&&M3(n,e,a),i.jsonSchema=a,a}const L3=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:D3(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},D3=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},F3=(n,e,t)=>{switch(e){case B.ZodString:return pA(n,t);case B.ZodNumber:return S3(n,t);case B.ZodObject:return A3(n,t);case B.ZodBigInt:return o3(n,t);case B.ZodBoolean:return l3();case B.ZodDate:return hA(n,t);case B.ZodUndefined:return $3();case B.ZodNull:return x3(t);case B.ZodArray:return s3(n,t);case B.ZodUnion:case B.ZodDiscriminatedUnion:return E3(n,t);case B.ZodIntersection:return m3(n,t);case B.ZodTuple:return R3(n,t);case B.ZodRecord:return mA(n,t);case B.ZodLiteral:return g3(n,t);case B.ZodEnum:return h3(n);case B.ZodNativeEnum:return b3(n);case B.ZodNullable:return k3(n,t);case B.ZodOptional:return P3(n,t);case B.ZodMap:return _3(n,t);case B.ZodSet:return C3(n,t);case B.ZodLazy:return Pe(n.getter()._def,t);case B.ZodPromise:return I3(n,t);case B.ZodNaN:case B.ZodNever:return v3();case B.ZodEffects:return f3(n,t);case B.ZodAny:return a3();case B.ZodUnknown:return N3();case B.ZodDefault:return d3(n,t);case B.ZodBranded:return fA(n,t);case B.ZodReadonly:return j3(n,t);case B.ZodCatch:return u3(n,t);case B.ZodPipeline:return T3(n,t);case B.ZodFunction:case B.ZodVoid:case B.ZodSymbol:return;default:return(r=>{})()}},M3=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),Xw=(n,e)=>{const t=i3(e),r=void 0,i=e==null?void 0:e.name,a=Pe(n._def,t,!1)??{},s=i===void 0?r?{...a,[t.definitionPath]:r}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:{...r,[i]:a}};return t.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in s||"oneOf"in s||"allOf"in s||"type"in s&&Array.isArray(s.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),s};function U3(n){return cA(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...Xw(n.data.schema),title:n.data.name}}}let gA=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=aM(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...U3(t)})),edges:this.edges.map(t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const r=t||Oi(),i={id:r,data:e};return this.nodes[r]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:r};return this.edges.push(i),i}firstNode(){const e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){const e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e){Object.entries(e.nodes).forEach(([t,r])=>{this.nodes[t]=r}),this.edges=[...this.edges,...e.edges]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}};function z3(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const i of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return Wa.fromReadableStream(t)}function W0(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}function K0(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*J0(n,e){const t=du.getInstance();for(;;){const{value:r,done:i}=t.run(n,e.next.bind(e));if(i)break;yield r}}async function*Z0(n,e){const t=du.getInstance(),r=e[Symbol.asyncIterator]();for(;;){const{value:i,done:a}=await t.run(n,r.next.bind(e));if(a)break;yield i}}function Rt(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}let dn=class extends Xl{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new td({bound:this,kwargs:e,config:{}})}map(){return new B3({bound:this})}withRetry(e){return new H3({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new td({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new G3({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Je);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,a)=>Je(a===0?e:r))}return Array.from({length:t},()=>Je(e))}async batch(e,t,r){var l;const i=this._getOptionsList(t??{},e.length),a=((l=i[0])==null?void 0:l.maxConcurrency)??(r==null?void 0:r.maxConcurrency),s=new Lf({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>s.call(async()=>{try{return await this.invoke(u,i[c])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=new xo(this._streamIterator(e,Je(t)));return await r.setup,Wa.fromAsyncGenerator(r)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Je(e):t=Je({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,[t,r]}async _callWithConfig(e,t,r){const i=Je(r),a=await Ia(i),s=await(a==null?void 0:a.handleChainStart(this.toJSON(),Rt(t,"input"),i.runId,i==null?void 0:i.runType,void 0,void 0,(i==null?void 0:i.runName)??this.getName()));delete i.runId;let o;try{o=await e.call(this,t,i,s)}catch(l){throw await(s==null?void 0:s.handleChainError(l)),l}return await(s==null?void 0:s.handleChainEnd(Rt(o,"output"))),o}async _batchWithConfig(e,t,r,i){const a=this._getOptionsList(r??{},t.length),s=await Promise.all(a.map(Ia)),o=await Promise.all(s.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),Rt(t[c],"input"),a[c].runId,a[c].runType,void 0,void 0,a[c].runName??this.getName()));return delete a[c].runId,d}));let l;try{l=await e.call(this,t,a,o,i)}catch(u){throw await Promise.all(o.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(Rt(l,"output")))),l}async*_transformStreamWithConfig(e,t,r){let i,a=!0,s,o=!0;const l=Je(r),u=await Ia(l);async function*c(){for await(const f of e){if(a)if(i===void 0)i=f;else try{i=Vi(i,f)}catch{i=void 0,a=!1}yield f}}let d;try{const f=await Jz(t.bind(this),c(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),l);delete l.runId,d=f.setup;const h=_=>_.name==="log_stream_tracer",p=d==null?void 0:d.handlers.find(h);let m=f.output;p!==void 0&&d!==void 0&&(m=await p.tapOutputIterable(d.runId,f.output));for await(const _ of m)if(yield _,o)if(s===void 0)s=_;else try{s=Vi(s,_)}catch{s=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:Rt(i,"input")})),f}await(d==null?void 0:d.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:Rt(i,"input")}))}getGraph(e){const t=new gA,r=t.addNode({name:`${this.getName()}Input`,schema:Ta.any()}),i=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:Ta.any()});return t.addEdge(r,i),t.addEdge(i,a),t}pipe(e){return new V3({first:this,last:Ea(e)})}pick(e){return this.pipe(new K3(e))}assign(e){return this.pipe(new W3(new Qw({steps:e})))}async*transform(e,t){let r;for await(const i of e)r===void 0?r=i:r=Vi(r,i);yield*this._streamIterator(r,Je(t))}async*streamLog(e,t,r){const i=new H0({...r,autoClose:!1,_schemaFormat:"original"}),a=Je(t);yield*this._streamLog(e,i,a)}async*_streamLog(e,t,r){const{callbacks:i}=r;if(i===void 0)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{const l=i.copy();l.inheritableHandlers.push(t),r.callbacks=l}const a=this.stream(e,r);async function s(){try{const l=await a;for await(const u of l){const c=new Ai({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(c)}}finally{await t.writer.close()}}const o=s();try{for await(const l of t)yield l}finally{await o}}async*streamEvents(e,t,r){if(t.encoding==="text/event-stream"){const i=await this._streamEvents(e,t,r);yield*z3(i)}else yield*this._streamEvents(e,t,r)}async*_streamEvents(e,t,r){if(t.version!=="v1")throw new Error('Only version "v1" of the events schema is currently supported.');let i,a=!1;const s=Je(t),o=s.tags??[],l=s.metadata??{},u=s.runName??this.getName(),c=new H0({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new e3({...r}),f=this._streamLog(e,c,s);for await(const p of f){if(i?i=i.concat(p):i=lA.fromRunLogPatch(p),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const y={...i.state},w={run_id:y.id,event:`on_${y.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(w,y.type)&&(yield w)}const m=p.ops.filter(y=>y.path.startsWith("/logs/")).map(y=>y.path.split("/")[2]),_=[...new Set(m)];for(const y of _){let w,x={};const k=i.state.logs[y];if(k.end_time===void 0?k.streamed_output.length>0?w="stream":w="start":w="end",w==="start")k.inputs!==void 0&&(x.input=k.inputs);else if(w==="end")k.inputs!==void 0&&(x.input=k.inputs),x.output=k.final_output;else if(w==="stream"){const E=k.streamed_output.length;if(E!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${E} instead. Encountered in: "${k.name}"`);x={chunk:k.streamed_output[0]},k.streamed_output=[]}yield{event:`on_${k.type}_${w}`,name:k.name,run_id:k.id,tags:k.tags,metadata:k.metadata,data:x}}const{state:g}=i;if(g.streamed_output.length>0){const y=g.streamed_output.length;if(y!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${y} instead. Encountered in: "${g.name}"`);const w={chunk:g.streamed_output[0]};g.streamed_output=[];const x={event:`on_${g.type}_stream`,run_id:g.id,tags:o,metadata:l,name:u,data:w};d.includeEvent(x,g.type)&&(yield x)}}const h=i==null?void 0:i.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:u,run_id:h.id,tags:o,metadata:l,data:{output:h.final_output}};d.includeEvent(p,h.type)&&(yield p)}}static isRunnable(e){return cA(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new td({bound:this,config:{},configFactories:[i=>({callbacks:[new uA({config:i,onStart:e,onEnd:t,onError:r})]})]})}},td=class yA extends dn{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=V0(this.config,...e);return V0(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Je(t),this.kwargs))}async batch(e,t,r){const i=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(Je(a),this.kwargs))):await this._mergeConfig(Je(t),this.kwargs);return this.bound.batch(e,i,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Je(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Je(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Je(t),this.kwargs))}async*streamEvents(e,t,r){yield*this.bound.streamEvents(e,{...await this._mergeConfig(Je(t),this.kwargs),version:t.version},r)}static isRunnableBinding(e){return e.bound&&dn.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new yA({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new uA({config:i,onStart:e,onEnd:t,onError:r})]})]})}},B3=class Cg extends dn{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Cg({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,an(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new Cg({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}},H3=class extends td{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const i=e>1?`retry:attempt:${e}`:void 0;return an(t,{callbacks:r==null?void 0:r.getChild(i)})}async _invoke(e,t,r){return Ki(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,i){const a={};try{await Ki(async s=>{const o=e.map((f,h)=>h).filter(f=>a[f.toString()]===void 0||a[f.toString()]instanceof Error),l=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(s,t==null?void 0:t[f],r==null?void 0:r[f])),c=await super.batch(l,u,{...i,returnExceptions:!0});let d;for(let f=0;f<c.length;f+=1){const h=c[f],p=o[f];h instanceof Error&&d===void 0&&(d=h,d.input=l[f]),a[p.toString()]=h}if(d)throw d;return c},{onFailedAttempt:s=>this.onFailedAttempt(s,s.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if((i==null?void 0:i.returnExceptions)!==!0)throw s}return Object.keys(a).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>a[parseInt(s,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}},V3=class il extends dn{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=Je(t),i=await Ia(r),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),Rt(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let s=e,o;try{const l=[this.first,...this.middle];for(let u=0;u<l.length;u+=1)s=await l[u].invoke(s,an(r,{callbacks:a==null?void 0:a.getChild(`seq:step:${u+1}`)}));o=await this.last.invoke(s,an(r,{callbacks:a==null?void 0:a.getChild(`seq:step:${this.steps.length}`)}))}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(Rt(o,"output"))),o}async batch(e,t,r){const i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map(Ia)),s=await Promise.all(a.map(async(l,u)=>{const c=await(l==null?void 0:l.handleChainStart(this.toJSON(),Rt(e[u],"input"),i[u].runId,void 0,void 0,void 0,i[u].runName));return delete i[u].runId,c}));let o=e;try{for(let l=0;l<this.steps.length;l+=1)o=await this.steps[l].batch(o,s.map((c,d)=>{const f=c==null?void 0:c.getChild(`seq:step:${l+1}`);return an(i[d],{callbacks:f})}),r)}catch(l){throw await Promise.all(s.map(u=>u==null?void 0:u.handleChainError(l))),l}return await Promise.all(s.map(l=>l==null?void 0:l.handleChainEnd(Rt(o,"output")))),o}async*_streamIterator(e,t){const r=await Ia(t),{runId:i,...a}=t??{},s=await(r==null?void 0:r.handleChainStart(this.toJSON(),Rt(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*c(){yield e}try{let d=o[0].transform(c(),an(a,{callbacks:s==null?void 0:s.getChild("seq:step:1")}));for(let f=1;f<o.length;f+=1)d=await o[f].transform(d,an(a,{callbacks:s==null?void 0:s.getChild(`seq:step:${f+1}`)}));for await(const f of d)if(yield f,l)if(u===void 0)u=f;else try{u=Vi(u,f)}catch{u=void 0,l=!1}}catch(d){throw await(s==null?void 0:s.handleChainError(d)),d}await(s==null?void 0:s.handleChainEnd(Rt(u,"output")))}getGraph(e){const t=new gA;let r=null;return this.steps.forEach((i,a)=>{const s=i.getGraph(e);a!==0&&s.trimFirstNode(),a!==this.steps.length-1&&s.trimLastNode(),t.extend(s);const o=s.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,o),r=s.lastNode()}),t}pipe(e){return il.isRunnableSequence(e)?new il({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new il({first:this.first,middle:[...this.middle,this.last],last:Ea(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&dn.isRunnable(e)}static from([e,...t],r){return new il({first:Ea(e),middle:t.slice(0,-1).map(Ea),last:Ea(t[t.length-1]),name:r})}},Qw=class wA extends dn{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Ea(r)}static from(e){return new wA({steps:e})}async invoke(e,t){const r=Je(t),i=await Ia(r),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const s={};try{await Promise.all(Object.entries(this.steps).map(async([o,l])=>{s[o]=await l.invoke(e,an(r,{callbacks:a==null?void 0:a.getChild(`map:key:${o}`)}))}))}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(s)),s}async*_transform(e,t,r){const i={...this.steps},a=oA(e,Object.keys(i).length),s=new Map(Object.entries(i).map(([o,l],u)=>{const c=l.transform(a[u],an(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;s.size;){const{key:o,result:l,gen:u}=await Promise.race(s.values());s.delete(o),l.done||(yield{[o]:l.value},s.set(o,u.next().then(c=>({key:o,gen:u,result:c}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=new xo(this.transform(r(),t));return await i.setup,Wa.fromAsyncGenerator(i)}},q3=class _A extends dn{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new _A({func:e})}async _invoke(e,t,r){return new Promise((i,a)=>{const s=an(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??Sp)-1});du.getInstance().run(s,async()=>{try{let o=await this.func(e,{...s,config:s});if(o&&dn.isRunnable(o)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...s,recursionLimit:(s.recursionLimit??Sp)-1})}else if(K0(o)){let l;for await(const u of Z0(s,o))if(l===void 0)l=u;else try{l=Vi(l,u)}catch{l=u}o=l}else if(W0(o)){let l;for(const u of J0(s,o))if(l===void 0)l=u;else try{l=Vi(l,u)}catch{l=u}o=l}i(o)}catch(o){a(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let i;for await(const s of e)if(i===void 0)i=s;else try{i=Vi(i,s)}catch{i=s}const a=await new Promise((s,o)=>{du.getInstance().run(r,async()=>{try{const l=await this.func(i,{...r,config:r});s(l)}catch(l){o(l)}})});if(a&&dn.isRunnable(a)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const s=await a.stream(i,an(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??Sp)-1}));for await(const o of s)yield o}else if(K0(a))for await(const s of Z0(r,a))yield s;else if(W0(a))for(const s of J0(r,a))yield s;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=new xo(this.transform(r(),t));return await i.setup,Wa.fromAsyncGenerator(i)}},G3=class extends dn{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await zr.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),{runId:i,...a}=t??{},s=await(r==null?void 0:r.handleChainStart(this.toJSON(),Rt(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let o;for(const l of this.runnables())try{const u=await l.invoke(e,an(a,{callbacks:s==null?void 0:s.getChild()}));return await(s==null?void 0:s.handleChainEnd(Rt(u,"output"))),u}catch(u){o===void 0&&(o=u)}throw o===void 0?new Error("No error stored at end of fallback."):(await(s==null?void 0:s.handleChainError(o)),o)}async batch(e,t,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map(l=>zr.configure(l==null?void 0:l.callbacks,void 0,l==null?void 0:l.tags,void 0,l==null?void 0:l.metadata))),s=await Promise.all(a.map(async(l,u)=>{const c=await(l==null?void 0:l.handleChainStart(this.toJSON(),Rt(e[u],"input"),i[u].runId,void 0,void 0,void 0,i[u].runName));return delete i[u].runId,c}));let o;for(const l of this.runnables())try{const u=await l.batch(e,s.map((c,d)=>an(i[d],{callbacks:c==null?void 0:c.getChild()})),r);return await Promise.all(s.map((c,d)=>c==null?void 0:c.handleChainEnd(Rt(u[d],"output")))),u}catch(u){o===void 0&&(o=u)}throw o?(await Promise.all(s.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function Ea(n){if(typeof n=="function")return new q3({func:n});if(dn.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Ea(r);return new Qw({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}let W3=class extends dn{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Qw&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const i=this.mapper.getStepsKeys(),[a,s]=oA(e),o=this.mapper.transform(s,an(r,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const u of a){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!i.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=new xo(this.transform(r(),t));return await i.setup,Wa.fromAsyncGenerator(i)}},K3=class extends dn{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=new xo(this.transform(r(),t));return await i.setup,Wa.fromAsyncGenerator(i)}};const J3=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n,Z3=()=>!1;let X3=class extends dn{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??Z3(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},Q3=class extends X3{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=lD.global():this.cache=void 0,this.caller=new Lf(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await WD("modelName"in this?J3(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new uD(e):Array.isArray(e)?new cD(e.map(tl)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([s,o])=>o!==void 0).map(([s,o])=>`${s}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};class ga extends Q3{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=ga._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===ga.prototype._streamResponseChunks)yield this.invoke(e,t);else{const i=ga._convertInputToPromptValue(e).toChatMessages(),[a,s]=this._separateRunnableConfigFromCallOptions(t),o=await zr.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},u=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),[i],a.runId,void 0,l,void 0,void 0,a.runName));let c;try{for await(const d of this._streamResponseChunks(i,s,u==null?void 0:u[0]))d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},yield d.message,c?c=c.concat(d):c=d}catch(d){throw await Promise.all((u??[]).map(f=>f==null?void 0:f.handleLLMError(d))),d}await Promise.all((u??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[c]]})))}}async _generateUncached(e,t,r){var f;const i=e.map(h=>h.map(tl)),a=await zr.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),s={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1},o=await(a==null?void 0:a.handleChatModelStart(this.toJSON(),i,r.runId,void 0,s,void 0,void 0,r.runName)),l=await Promise.allSettled(i.map((h,p)=>this._generate(h,{...t,promptIndex:p},o==null?void 0:o[p]))),u=[],c=[];await Promise.all(l.map(async(h,p)=>{var m,_;if(h.status==="fulfilled"){const g=h.value;for(const y of g.generations)y.message.response_metadata={...y.generationInfo,...y.message.response_metadata};return g.generations.length===1&&(g.generations[0].message.response_metadata={...g.llmOutput,...g.generations[0].message.response_metadata}),u[p]=g.generations,c[p]=g.llmOutput,(m=o==null?void 0:o[p])==null?void 0:m.handleLLMEnd({generations:[g.generations],llmOutput:g.llmOutput})}else return await((_=o==null?void 0:o[p])==null?void 0:_.handleLLMError(h.reason)),Promise.reject(h.reason)}));const d={generations:u,llmOutput:c.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...c):void 0};return Object.defineProperty(d,i0,{value:o?{runIds:o==null?void 0:o.map(h=>h.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:a}){const s=e.map(m=>m.map(tl)),o=await zr.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1,cached:!0},u=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),s,a.runId,void 0,l,void 0,void 0,a.runName)),c=[],f=(await Promise.allSettled(s.map(async(m,_)=>{const g=ga._convertInputToPromptValue(m).toString(),y=await t.lookup(g,r);return y==null&&c.push(_),y}))).map((m,_)=>({result:m,runManager:u==null?void 0:u[_]})).filter(({result:m})=>m.status==="fulfilled"&&m.value!=null||m.status==="rejected"),h=[];await Promise.all(f.map(async({result:m,runManager:_},g)=>{if(m.status==="fulfilled"){const y=m.value;return h[g]=y,y.length&&await(_==null?void 0:_.handleLLMNewToken(y[0].text)),_==null?void 0:_.handleLLMEnd({generations:[y]})}else return await(_==null?void 0:_.handleLLMError(m.reason)),Promise.reject(m.reason)}));const p={generations:h,missingPromptIndices:c};return Object.defineProperty(p,i0,{value:u?{runIds:u==null?void 0:u.map(m=>m.runId)}:void 0,configurable:!0}),p}async generate(e,t,r){let i;Array.isArray(t)?i={stop:t}:i=t;const a=e.map(h=>h.map(tl)),[s,o]=this._separateRunnableConfigFromCallOptions(i);if(s.callbacks=s.callbacks??r,!this.cache)return this._generateUncached(a,o,s);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:s});let f={};if(d.length>0){const h=await this._generateUncached(d.map(p=>a[p]),o,s);await Promise.all(h.generations.map(async(p,m)=>{const _=d[m];c[_]=p;const g=ga._convertInputToPromptValue(a[_]).toString();return l.update(g,u,p)})),f=h.llmOutput??{}}return{generations:c,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const i=e.map(a=>a.toChatMessages());return this.generate(i,t,r)}async call(e,t,r){return(await this.generate([e.map(tl)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const i=e.toChatMessages();return this.call(i,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const i=new Dd(e),a=await this.call([i],t,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}}function Y3(n){return{name:n.name,description:n.description,parameters:Xw(n.schema)}}function eB(n){return tB(n)?{type:"function",function:Y3(n)}:n}function tB(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function bA(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:i,baseURL:a}=n;if(r&&i&&e)return`${i}/${e}`;if(r){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}function vA(n){let e;return n.constructor.name===If.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===zn.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}function nB(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function rB(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(xA(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function xA(n,e){var r;const t=[];for(const[i,a]of Object.entries(n.properties??{}))a.description&&e<2&&t.push(`// ${a.description}`),(r=n.required)!=null&&r.includes(i)?t.push(`${i}: ${Zd(a,e)},`):t.push(`${i}?: ${Zd(a,e)},`);return t.map(i=>" ".repeat(e)+i).join(`
`)}function Zd(n,e){if(nB(n))return n.anyOf.map(t=>Zd(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",xA(n,e+2),"}"].join(`
`);case"array":return n.items?`${Zd(n.items,e)}[]`:"any[]";default:return""}}function iB(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function EA(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!kO.isInstance(n))throw new Error("Invalid generic chat message");return iB(n)}default:throw new Error(`Unknown message type: ${e}`)}}function aB(n){switch(n.role){case"assistant":return new vO(n.content||"",{function_call:n.function_call,tool_calls:n.tool_calls});default:return new kO(n.content||"",n.role??"unknown")}}function sB(n,e){const t=n.role??e,r=n.content??"";let i;return n.function_call?i={function_call:n.function_call}:n.tool_calls?i={tool_calls:n.tool_calls}:i={},t==="user"?new Nw({content:r}):t==="assistant"?new xO({content:r,additional_kwargs:i}):t==="system"?new jw({content:r}):t==="function"?new $w({content:r,additional_kwargs:i,name:n.name}):t==="tool"?new Cw({content:r,additional_kwargs:i,tool_call_id:n.tool_call_id}):new Rw({content:r,role:t})}function X0(n){return n.map(e=>({role:EA(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id}))}class oB extends ga{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,i,a,s,o,l,u,c;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??Ze("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??Ze("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??Ze("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??Ze("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??Ze("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??Ze("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??Ze("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((i=e==null?void 0:e.configuration)==null?void 0:i.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((a=t==null?void 0:t.baseOptions)==null?void 0:a.headers)??((o=(s=e==null?void 0:e.configuration)==null?void 0:s.baseOptions)==null?void 0:o.headers),defaultQuery:((l=t==null?void 0:t.baseOptions)==null?void 0:l.params)??((c=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:c.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){function t(i){return i!==void 0&&i.every(a=>Array.isArray(a.lc_namespace))}return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:t(e==null?void 0:e.tools)?e==null?void 0:e.tools.map(eB):e==null?void 0:e.tools,tool_choice:e==null?void 0:e.tool_choice,response_format:e==null?void 0:e.response_format,seed:e==null?void 0:e.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var l;const i=X0(e),a={...this.invocationParams(t),messages:i,stream:!0};let s;const o=await this.completionWithRetry(a,t);for await(const u of o){const c=u==null?void 0:u.choices[0];if(!c)continue;const{delta:d}=c;if(!d)continue;const f=sB(d,s);s=d.role??s;const h={prompt:t.promptIndex??0,completion:c.index??0};if(typeof f.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const p=new Lw({message:f,text:f.content,generationInfo:h});yield p,r==null||r.handleLLMNewToken(p.text??"",h,void 0,void 0,void 0,{chunk:p})}if((l=t.signal)!=null&&l.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,l;const i={},a=this.invocationParams(t),s=X0(e);if(a.stream){const u=this._streamResponseChunks(e,t,r),c={};for await(const _ of u){const g=((o=_.generationInfo)==null?void 0:o.completion)??0;c[g]===void 0?c[g]=_:c[g]=c[g].concat(_)}const d=Object.entries(c).sort(([_],[g])=>parseInt(_,10)-parseInt(g,10)).map(([_,g])=>g),{functions:f,function_call:h}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,f,h),m=await this.getNumTokensFromGenerations(d);return i.promptTokens=p,i.completionTokens=m,i.totalTokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:i}}}else{const u=await this.completionWithRetry({...a,stream:!1,messages:s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:c,prompt_tokens:d,total_tokens:f}=(u==null?void 0:u.usage)??{};c&&(i.completionTokens=(i.completionTokens??0)+c),d&&(i.promptTokens=(i.promptTokens??0)+d),f&&(i.totalTokens=(i.totalTokens??0)+f);const h=[];for(const p of(u==null?void 0:u.choices)??[]){const _={text:((l=p.message)==null?void 0:l.content)??"",message:aB(p.message??{role:"assistant"})};_.generationInfo={...p.finish_reason?{finish_reason:p.finish_reason}:{},...p.logprobs?{logprobs:p.logprobs}:{}},h.push(_)}return{generations:h,llmOutput:{tokenUsage:i}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let i=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const a=rB(t);i+=await this.getNumTokens(a),i+=9}return t&&e.find(a=>a._getType()==="system")&&(i-=4),r==="none"?i+=1:typeof r=="object"&&(i+=await this.getNumTokens(r.name)+4),i}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var i;return(i=r.message.additional_kwargs)!=null&&i.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,i)=>r+i,0)}async getNumTokensFromMessages(e){let t=0,r=0,i=0;this.modelName==="gpt-3.5-turbo-0301"?(r=4,i=-1):(r=3,i=1);const a=await Promise.all(e.map(async s=>{var f,h,p,m,_;const o=await this.getNumTokens(s.content),l=await this.getNumTokens(EA(s)),u=s.name!==void 0?i+await this.getNumTokens(s.name):0;let c=o+r+l+u;const d=s;return d._getType()==="function"&&(c-=2),(f=d.additional_kwargs)!=null&&f.function_call&&(c+=3),(h=d==null?void 0:d.additional_kwargs.function_call)!=null&&h.name&&(c+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments&&(c+=await this.getNumTokens(JSON.stringify(JSON.parse((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)))),t+=c,c}));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(i){throw vA(i)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},i=bA(r),a={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new Ee(a)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}const lB=(n,e)=>n.reduce((t,r,i)=>{const a=Math.floor(i/e),s=t[a]||[];return t[a]=s.concat([r]),t},[]);class uB{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Lf(e??{})}}class cB extends uB{constructor(e,t){var u,c,d;const r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"dimensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let i=(r==null?void 0:r.openAIApiKey)??Ze("OPENAI_API_KEY");const a=(r==null?void 0:r.azureOpenAIApiKey)??Ze("AZURE_OPENAI_API_KEY");if(!a&&!i)throw new Error("OpenAI or Azure OpenAI API key not found");const s=(r==null?void 0:r.azureOpenAIApiInstanceName)??Ze("AZURE_OPENAI_API_INSTANCE_NAME"),o=((r==null?void 0:r.azureOpenAIApiEmbeddingsDeploymentName)||(r==null?void 0:r.azureOpenAIApiDeploymentName))??(Ze("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||Ze("AZURE_OPENAI_API_DEPLOYMENT_NAME")),l=(r==null?void 0:r.azureOpenAIApiVersion)??Ze("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(r==null?void 0:r.azureOpenAIBasePath)??Ze("AZURE_OPENAI_BASE_PATH"),this.organization=((u=r==null?void 0:r.configuration)==null?void 0:u.organization)??Ze("OPENAI_ORGANIZATION"),this.modelName=(r==null?void 0:r.modelName)??this.modelName,this.batchSize=(r==null?void 0:r.batchSize)??(a?1:this.batchSize),this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.dimensions=r==null?void 0:r.dimensions,this.azureOpenAIApiVersion=l,this.azureOpenAIApiKey=a,this.azureOpenAIApiInstanceName=s,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");i=i??""}this.clientConfig={apiKey:i,organization:this.organization,baseURL:t==null?void 0:t.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(c=t==null?void 0:t.baseOptions)==null?void 0:c.headers,defaultQuery:(d=t==null?void 0:t.baseOptions)==null?void 0:d.params,...t,...e==null?void 0:e.configuration}}async embedDocuments(e){const t=lB(this.stripNewLines?e.map(s=>s.replace(/\n/g," ")):e,this.batchSize),r=t.map(s=>{const o={model:this.modelName,input:s};return this.dimensions&&(o.dimensions=this.dimensions),this.embeddingWithRetry(o)}),i=await Promise.all(r),a=[];for(let s=0;s<i.length;s+=1){const o=t[s],{data:l}=i[s];for(let u=0;u<o.length;u+=1)a.push(l[u].embedding)}return a}async embedQuery(e){const t={model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e};this.dimensions&&(t.dimensions=this.dimensions);const{data:r}=await this.embeddingWithRetry(t);return r[0].embedding}async embeddingWithRetry(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},i=bA(r),a={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new Ee(a)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(r){throw vA(r)}})}}const dB="modulepreload",fB=function(n){return"/"+n},Q0={},xt=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=fB(l),l in Q0)return;Q0[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":dB,u||(d.as="script"),d.crossOrigin="",d.href=l,o&&d.setAttribute("nonce",o),document.head.appendChild(d),u)return new Promise((f,h)=>{d.addEventListener("load",f),d.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&a(o.reason);return e().catch(a)})},hB="__run";class Xd{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Xd({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}function pB(n,e){return(e==null?void 0:e[n])||hO(n)}function mB(n,e,t){const r={};for(const i in n)Object.hasOwn(n,i)&&(r[e(i,t)]=n[i]);return r}function Y0(n){return Array.isArray(n)?[...n]:{...n}}function gB(n,e){const t=Y0(n);for(const[r,i]of Object.entries(e)){const[a,...s]=r.split(".").reverse();let o=t;for(const l of s.reverse()){if(o[l]===void 0)break;o[l]=Y0(o[l]),o=o[l]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[i]})}return t}function kA(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class Ba{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,kA(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Ba||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((i,a)=>(i[a]=a in this?this[a]:this.lc_kwargs[a],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(r,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let a=this,s=r;const[o,...l]=i.split(".").reverse();for(const u of l.reverse()){if(!(u in a)||a[u]===void 0)return;(!(u in s)||s[u]===void 0)&&(typeof a[u]=="object"&&a[u]!=null?s[u]={}:Array.isArray(a[u])&&(s[u]=[])),a=a[u],s=s[u]}o in a&&a[o]!==void 0&&(s[o]=s[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:mB(Object.keys(t).length?gB(r,t):r,pB,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}var Pp={};const yB=()=>typeof window<"u"&&typeof window.document<"u",wB=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",_B=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Yw=()=>typeof Deno<"u",bB=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Yw(),vB=()=>{let n;return yB()?n="browser":bB()?n="node":wB()?n="webworker":_B()?n="jsdom":Yw()?n="deno":n="other",n};let Tp;async function xB(){return Tp===void 0&&(Tp={library:"langchain-js",runtime:vB()}),Tp}function qi(n){try{return typeof process<"u"?Pp==null?void 0:Pp[n]:Yw()?Deno==null?void 0:Deno.env.get(n):void 0}catch{return}}class EB{}class $u extends EB{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,kA(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:qi("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Ba.prototype.toJSON.call(this)}toJSONNotImplemented(){return Ba.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends $u{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Et()}),Object.assign(this,e)}}return new t}}const kB=n=>{const e=n;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function Ip(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function SB(n){return n.replace(/[-:.]/g,"")}function OB(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return SB(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Bo(n){return typeof n._addRunToRunMap=="function"}class Nu extends $u{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=OB(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const i=this.runMap.get(r.parent_run_id);i&&(this._addChildRun(i,r),i.child_execution_order=Math.max(i.child_execution_order,r.child_execution_order),r.trace_id=i.trace_id,i.dotted_order!==void 0&&(r.dotted_order=[i.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,a,s,o,l){const u=this._getExecutionOrder(i),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:s||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,r,i,a,s,o,l){var c,d;const u=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,i,a,s,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}_createRunForChatModelStart(e,t,r,i,a,s,o,l){const u=this._getExecutionOrder(i),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:s||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,r,i,a,s,o,l){var c,d;const u=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,i,a,s,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}async handleLLMEnd(e,t,r,i,a){var o;const s=this.runMap.get(t);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=e,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleLLMError(e,t,r,i,a){var o;const s=this.runMap.get(t);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForChainStart(e,t,r,i,a,s,o,l){const u=this._getExecutionOrder(i),c=Date.now(),d={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,r,i,a,s,o,l){var c,d;const u=this.runMap.get(r)??this._createRunForChainStart(e,t,r,i,a,s,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onChainStart)==null?void 0:d.call(this,u)),u}async handleChainEnd(e,t,r,i,a){var o;const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=Ip(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(s.inputs=Ip(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleChainError(e,t,r,i,a){var o;const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(s.inputs=Ip(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForToolStart(e,t,r,i,a,s,o){const l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,r,i,a,s,o){var u,c;const l=this.runMap.get(r)??this._createRunForToolStart(e,t,r,i,a,s,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onToolStart)==null?void 0:c.call(this,l)),l}async handleToolEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onToolEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onToolError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var a;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const i=r;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,r))}async handleAgentEnd(e,t){var i;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentEnd)==null?void 0:i.call(this,r)))}_createRunForRetrieverStart(e,t,r,i,a,s,o){const l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,r,i,a,s,o){var u,c;const l=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,i,a,s,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onRetrieverStart)==null?void 0:c.call(this,l)),l}async handleRetrieverEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var i;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((i=this.onText)==null?void 0:i.call(this,r)))}async handleLLMNewToken(e,t,r,i,a,s){var l;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s==null?void 0:s.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:s==null?void 0:s.chunk})),o}}function Bt(n,e){return`${n.open}${e}${n.close}`}function jn(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function ex(n){return typeof n=="string"?n.trim():n==null?n:jn(n,n.toString())}function bi(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Qt}=Mf;class tx extends Nu{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const i=this.runMap.get(r.parent_run_id);if(i)t.push(i),r=i;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((i,a,s)=>{const o=`${i.execution_order}:${i.run_type}:${i.name}`;return a===s.length-1?Bt(Mf.bold,o):o}).join(" > ");return Bt(Qt.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${jn(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.cyan,"[chain/end]")} [${t}] [${bi(e)}] Exiting Chain run with output: ${jn(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.red,"[chain/error]")} [${t}] [${bi(e)}] Chain run errored with error: ${jn(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${Bt(Qt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${jn(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.cyan,"[llm/end]")} [${t}] [${bi(e)}] Exiting LLM run with output: ${jn(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.red,"[llm/error]")} [${t}] [${bi(e)}] LLM run errored with error: ${jn(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${ex(e.inputs.input)}"`)}onToolEnd(e){var r;const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.cyan,"[tool/end]")} [${t}] [${bi(e)}] Exiting Tool run with output: "${ex((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.red,"[tool/error]")} [${t}] [${bi(e)}] Tool run errored with error: ${jn(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${jn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.cyan,"[retriever/end]")} [${t}] [${bi(e)}] Exiting Retriever run with output: ${jn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Bt(Qt.red,"[retriever/error]")} [${t}] [${bi(e)}] Retriever run errored with error: ${jn(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${Bt(Qt.blue,"[agent/action]")} [${r}] Agent selected action: ${jn(t.actions[t.actions.length-1],"[action]")}`)}}function e_(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function SA(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}class AB extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function PB(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,i=!1;for(let a of n){if(r)a==='"'&&!i?r=!1:a===`
`&&!i?a="\\n":a==="\\"?i=!i:i=!1;else if(a==='"')r=!0,i=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}r&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}function TB(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?t_(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function IB(n,e){function t(r,i){if(typeof r!="object"||r===null||r===void 0)return r;if(i>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(s=>t(s,i+1));const a={};for(const s of Object.keys(r))a[s]=t(r[s],i+1);return a}return JSON.stringify(t(n,0),null,2)}class ai extends Ba{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=IB(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function Qd(n,e){const t={...n};for(const[r,i]of Object.entries(e))if(t[r]==null)t[r]=i;else{if(i==null)continue;if(typeof t[r]!=typeof i||Array.isArray(t[r])!==Array.isArray(i))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=i}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=Qd(t[r],i);else if(Array.isArray(t[r]))t[r]=t_(t[r],i);else{if(t[r]===i)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function t_(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const i=t.findIndex(a=>a.index===r.index);i!==-1?t[i]=Qd(t[i],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}class CB extends ai{}function RB(n){return typeof n.role=="string"}function OA(n){return typeof(n==null?void 0:n._getType)=="function"}class $B extends ai{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function NB(n){const e=[],t=[];for(const r of n)if(r.function){const i=r.function.name;try{const a=JSON.parse(r.function.arguments),s={name:i||"",args:a||{},id:r.id};e.push(s)}catch{t.push({name:i,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}class Rg extends ai{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var i;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const a=(i=r.additional_kwargs)==null?void 0:i.tool_calls,s=r.tool_calls;a!=null&&a.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&s===void 0){const[o,l]=NB(a);r.tool_calls=o??[],r.invalid_tool_calls=l??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}class Wf extends CB{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=[],i=[];for(const a of e.tool_call_chunks){let s={};try{if(s=PB(a.args||"{}"),s===null||typeof s!="object"||Array.isArray(s))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:s,id:a.id,type:"tool_call"})}catch{i.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:i,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,i,a,s,o,l,u,c,d,f,h,p,m,_,g,y,w,x,k,E,P,R,H,j,L,V,oe,T,S,$,C,O,A,b,F,N,v,Q,Z,re;const t={content:TB(this.content,e.content),additional_kwargs:Qd(this.additional_kwargs,e.additional_kwargs),response_metadata:Qd(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const Ye=t_(this.tool_call_chunks,e.tool_call_chunks);Ye!==void 0&&Ye.length>0&&(t.tool_call_chunks=Ye)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const Ye={...(((i=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:i.audio)!==void 0||((s=(a=e.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:s.audio)!==void 0)&&{audio:(((l=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:l.audio)??0)+(((c=(u=e.usage_metadata)==null?void 0:u.input_token_details)==null?void 0:c.audio)??0)},...(((f=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:f.cache_read)!==void 0||((p=(h=e.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((_=(m=this.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:_.cache_read)??0)+(((y=(g=e.usage_metadata)==null?void 0:g.input_token_details)==null?void 0:y.cache_read)??0)},...(((x=(w=this.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:x.cache_creation)!==void 0||((E=(k=e.usage_metadata)==null?void 0:k.input_token_details)==null?void 0:E.cache_creation)!==void 0)&&{cache_creation:(((R=(P=this.usage_metadata)==null?void 0:P.input_token_details)==null?void 0:R.cache_creation)??0)+(((j=(H=e.usage_metadata)==null?void 0:H.input_token_details)==null?void 0:j.cache_creation)??0)}},Zt={...(((V=(L=this.usage_metadata)==null?void 0:L.output_token_details)==null?void 0:V.audio)!==void 0||((T=(oe=e.usage_metadata)==null?void 0:oe.output_token_details)==null?void 0:T.audio)!==void 0)&&{audio:((($=(S=this.usage_metadata)==null?void 0:S.output_token_details)==null?void 0:$.audio)??0)+(((O=(C=e.usage_metadata)==null?void 0:C.output_token_details)==null?void 0:O.audio)??0)},...(((b=(A=this.usage_metadata)==null?void 0:A.output_token_details)==null?void 0:b.reasoning)!==void 0||((N=(F=e.usage_metadata)==null?void 0:F.output_token_details)==null?void 0:N.reasoning)!==void 0)&&{reasoning:(((Q=(v=this.usage_metadata)==null?void 0:v.output_token_details)==null?void 0:Q.reasoning)??0)+(((re=(Z=e.usage_metadata)==null?void 0:Z.output_token_details)==null?void 0:re.reasoning)??0)}},gn=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Ft=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Kn={input_tokens:gn.input_tokens+Ft.input_tokens,output_tokens:gn.output_tokens+Ft.output_tokens,total_tokens:gn.total_tokens+Ft.total_tokens,...Object.keys(Ye).length>0&&{input_token_details:Ye},...Object.keys(Zt).length>0&&{output_token_details:Zt}};t.usage_metadata=Kn}return new Wf(t)}}class Kf extends ai{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Kf}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class ju extends ai{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class $g extends ai{static lc_name(){return"SystemMessage"}_getType(){return"system"}}function jB(n){return SA(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function LB(n){return typeof n=="object"&&n!=null&&n.lc===1&&Array.isArray(n.id)&&n.kwargs!=null&&typeof n.kwargs=="object"}function Cp(n){let e,t;if(LB(n)){const r=n.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":e="unknown",t=n.kwargs}else{const{type:r,...i}=n;e=r,t=i}if(e==="human"||e==="user")return new ju(t);if(e==="ai"||e==="assistant"){const{tool_calls:r,...i}=t;if(!Array.isArray(r))return new Rg(t);const a=r.map(jB);return new Rg({...i,tool_calls:a})}else{if(e==="system")return new $g(t);if(e==="developer")return new $g({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new $B({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw e_(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(n,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Yd(n){if(typeof n=="string")return new ju(n);if(OA(n))return n;if(Array.isArray(n)){const[e,t]=n;return Cp({type:e,content:t})}else if(RB(n)){const{role:e,...t}=n;return Cp({...t,type:e})}else return Cp(n)}function AA(n,e="Human",t="AI"){const r=[];for(const i of n){let a;if(i._getType()==="human")a=e;else if(i._getType()==="ai")a=t;else if(i._getType()==="system")a="System";else if(i._getType()==="function")a="Function";else if(i._getType()==="tool")a="Tool";else if(i._getType()==="generic")a=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);const s=i.name?`${i.name}, `:"",o=typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2);r.push(`${a}: ${s}${o}`)}return r.join(`
`)}const DB=(...n)=>fetch(...n),FB=Symbol.for("ls:fetch_implementation"),X=()=>globalThis[FB]??DB,MB=[400,401,403,404,405,406,407,408],UB=[409];let nx=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in gt?this.queue=new gt.default({concurrency:this.maxConcurrency}):this.queue=new gt({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>Ki(()=>e(...t).catch(i=>{throw i instanceof Error?i:new Error(i)}),{async onFailedAttempt(i){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||(i==null?void 0:i.code)==="ECONNABORTED")throw i;const a=i==null?void 0:i.response,s=a==null?void 0:a.status;if(s){if(MB.includes(+s))throw i;if(UB.includes(+s))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,a)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>X()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function rx(n){return typeof(n==null?void 0:n._getType)=="function"}function ix(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}function fe(n,e){if(!Vs(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const ax={};function PA(n){ax[n]||(console.warn(n),ax[n]=!0)}var Ng={exports:{}};const zB="2.0.0",TA=256,BB=Number.MAX_SAFE_INTEGER||9007199254740991,HB=16,VB=TA-6,qB=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Jf={MAX_LENGTH:TA,MAX_SAFE_COMPONENT_LENGTH:HB,MAX_SAFE_BUILD_LENGTH:VB,MAX_SAFE_INTEGER:BB,RELEASE_TYPES:qB,SEMVER_SPEC_VERSION:zB,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Rp={};const GB=typeof process=="object"&&Rp&&Rp.NODE_DEBUG&&/\bsemver\b/i.test(Rp.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};var Zf=GB;(function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=Jf,a=Zf;e=n.exports={};const s=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],c=e.t={};let d=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[f,r]],p=_=>{for(const[g,y]of h)_=_.split(`${g}*`).join(`${g}{0,${y}}`).split(`${g}+`).join(`${g}{1,${y}}`);return _},m=(_,g,y)=>{const w=p(g),x=d++;a(_,x,g),c[_]=x,l[x]=g,u[x]=w,s[x]=new RegExp(g,y?"g":void 0),o[x]=new RegExp(w,y?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),m("FULL",`^${l[c.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),m("LOOSE",`^${l[c.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),m("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[c.COERCE],!0),m("COERCERTLFULL",l[c.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Ng,Ng.exports);var Lu=Ng.exports;const WB=Object.freeze({loose:!0}),KB=Object.freeze({}),JB=n=>n?typeof n!="object"?WB:n:KB;var n_=JB;const sx=/^[0-9]+$/,IA=(n,e)=>{const t=sx.test(n),r=sx.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},ZB=(n,e)=>IA(e,n);var CA={compareIdentifiers:IA,rcompareIdentifiers:ZB};const Sc=Zf,{MAX_LENGTH:ox,MAX_SAFE_INTEGER:Oc}=Jf,{safeRe:lx,safeSrc:ux,t:Ac}=Lu,XB=n_,{compareIdentifiers:ns}=CA;let QB=class Tr{constructor(e,t){if(t=XB(t),e instanceof Tr){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>ox)throw new TypeError(`version is longer than ${ox} characters`);Sc("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?lx[Ac.LOOSE]:lx[Ac.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Oc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Oc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Oc||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const a=+i;if(a>=0&&a<Oc)return a}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Sc("SemVer.compare",this.version,this.options,e),!(e instanceof Tr)){if(typeof e=="string"&&e===this.version)return 0;e=new Tr(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Tr||(e=new Tr(e,this.options)),ns(this.major,e.major)||ns(this.minor,e.minor)||ns(this.patch,e.patch)}comparePre(e){if(e instanceof Tr||(e=new Tr(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],i=e.prerelease[t];if(Sc("prerelease compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return ns(r,i)}while(++t)}compareBuild(e){e instanceof Tr||(e=new Tr(e,this.options));let t=0;do{const r=this.build[t],i=e.build[t];if(Sc("build compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return ns(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){const i=new RegExp(`^${this.options.loose?ux[Ac.PRERELEASELOOSE]:ux[Ac.PRERELEASE]}$`),a=`-${t}`.match(i);if(!a||a[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let a=[t,i];r===!1&&(a=[t]),ns(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var r_=QB;const cx=r_,YB=(n,e,t)=>new cx(n,t).compare(new cx(e,t));var Eo=YB;const e9=Eo,t9=(n,e,t)=>e9(n,e,t)>0;var n9=t9;const r9=Eo,i9=(n,e,t)=>r9(n,e,t)<0;var a9=i9;const s9=Eo,o9=(n,e,t)=>s9(n,e,t)===0;var l9=o9;const u9=Eo,c9=(n,e,t)=>u9(n,e,t)!==0;var d9=c9;const f9=Eo,h9=(n,e,t)=>f9(n,e,t)>=0;var p9=h9;const m9=Eo,g9=(n,e,t)=>m9(n,e,t)<=0;var y9=g9;const w9=l9,_9=d9,b9=n9,v9=p9,x9=a9,E9=y9,k9=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return w9(n,t,r);case"!=":return _9(n,t,r);case">":return b9(n,t,r);case">=":return v9(n,t,r);case"<":return x9(n,t,r);case"<=":return E9(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};var S9=k9;const{safeRe:vG,t:xG}=Lu;class O9{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}}var A9=O9,$p,dx;function xr(){if(dx)return $p;dx=1;const n=/\s+/g;class e{constructor(S,$){if($=i($),S instanceof e)return S.loose===!!$.loose&&S.includePrerelease===!!$.includePrerelease?S:new e(S.raw,$);if(S instanceof a)return this.raw=S.value,this.set=[[S]],this.formatted=void 0,this;if(this.options=$,this.loose=!!$.loose,this.includePrerelease=!!$.includePrerelease,this.raw=S.trim().replace(n," "),this.set=this.raw.split("||").map(C=>this.parseRange(C.trim())).filter(C=>C.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const C=this.set[0];if(this.set=this.set.filter(O=>!m(O[0])),this.set.length===0)this.set=[C];else if(this.set.length>1){for(const O of this.set)if(O.length===1&&_(O[0])){this.set=[O];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let S=0;S<this.set.length;S++){S>0&&(this.formatted+="||");const $=this.set[S];for(let C=0;C<$.length;C++)C>0&&(this.formatted+=" "),this.formatted+=$[C].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(S){const C=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+S,O=r.get(C);if(O)return O;const A=this.options.loose,b=A?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];S=S.replace(b,V(this.options.includePrerelease)),s("hyphen replace",S),S=S.replace(l[u.COMPARATORTRIM],c),s("comparator trim",S),S=S.replace(l[u.TILDETRIM],d),s("tilde trim",S),S=S.replace(l[u.CARETTRIM],f),s("caret trim",S);let F=S.split(" ").map(Z=>y(Z,this.options)).join(" ").split(/\s+/).map(Z=>L(Z,this.options));A&&(F=F.filter(Z=>(s("loose invalid filter",Z,this.options),!!Z.match(l[u.COMPARATORLOOSE])))),s("range list",F);const N=new Map,v=F.map(Z=>new a(Z,this.options));for(const Z of v){if(m(Z))return[Z];N.set(Z.value,Z)}N.size>1&&N.has("")&&N.delete("");const Q=[...N.values()];return r.set(C,Q),Q}intersects(S,$){if(!(S instanceof e))throw new TypeError("a Range is required");return this.set.some(C=>g(C,$)&&S.set.some(O=>g(O,$)&&C.every(A=>O.every(b=>A.intersects(b,$)))))}test(S){if(!S)return!1;if(typeof S=="string")try{S=new o(S,this.options)}catch{return!1}for(let $=0;$<this.set.length;$++)if(oe(this.set[$],S,this.options))return!0;return!1}}$p=e;const t=A9,r=new t,i=n_,a=Xf(),s=Zf,o=r_,{safeRe:l,t:u,comparatorTrimReplace:c,tildeTrimReplace:d,caretTrimReplace:f}=Lu,{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=Jf,m=T=>T.value==="<0.0.0-0",_=T=>T.value==="",g=(T,S)=>{let $=!0;const C=T.slice();let O=C.pop();for(;$&&C.length;)$=C.every(A=>O.intersects(A,S)),O=C.pop();return $},y=(T,S)=>(s("comp",T,S),T=E(T,S),s("caret",T),T=x(T,S),s("tildes",T),T=R(T,S),s("xrange",T),T=j(T,S),s("stars",T),T),w=T=>!T||T.toLowerCase()==="x"||T==="*",x=(T,S)=>T.trim().split(/\s+/).map($=>k($,S)).join(" "),k=(T,S)=>{const $=S.loose?l[u.TILDELOOSE]:l[u.TILDE];return T.replace($,(C,O,A,b,F)=>{s("tilde",T,C,O,A,b,F);let N;return w(O)?N="":w(A)?N=`>=${O}.0.0 <${+O+1}.0.0-0`:w(b)?N=`>=${O}.${A}.0 <${O}.${+A+1}.0-0`:F?(s("replaceTilde pr",F),N=`>=${O}.${A}.${b}-${F} <${O}.${+A+1}.0-0`):N=`>=${O}.${A}.${b} <${O}.${+A+1}.0-0`,s("tilde return",N),N})},E=(T,S)=>T.trim().split(/\s+/).map($=>P($,S)).join(" "),P=(T,S)=>{s("caret",T,S);const $=S.loose?l[u.CARETLOOSE]:l[u.CARET],C=S.includePrerelease?"-0":"";return T.replace($,(O,A,b,F,N)=>{s("caret",T,O,A,b,F,N);let v;return w(A)?v="":w(b)?v=`>=${A}.0.0${C} <${+A+1}.0.0-0`:w(F)?A==="0"?v=`>=${A}.${b}.0${C} <${A}.${+b+1}.0-0`:v=`>=${A}.${b}.0${C} <${+A+1}.0.0-0`:N?(s("replaceCaret pr",N),A==="0"?b==="0"?v=`>=${A}.${b}.${F}-${N} <${A}.${b}.${+F+1}-0`:v=`>=${A}.${b}.${F}-${N} <${A}.${+b+1}.0-0`:v=`>=${A}.${b}.${F}-${N} <${+A+1}.0.0-0`):(s("no pr"),A==="0"?b==="0"?v=`>=${A}.${b}.${F}${C} <${A}.${b}.${+F+1}-0`:v=`>=${A}.${b}.${F}${C} <${A}.${+b+1}.0-0`:v=`>=${A}.${b}.${F} <${+A+1}.0.0-0`),s("caret return",v),v})},R=(T,S)=>(s("replaceXRanges",T,S),T.split(/\s+/).map($=>H($,S)).join(" ")),H=(T,S)=>{T=T.trim();const $=S.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return T.replace($,(C,O,A,b,F,N)=>{s("xRange",T,C,O,A,b,F,N);const v=w(A),Q=v||w(b),Z=Q||w(F),re=Z;return O==="="&&re&&(O=""),N=S.includePrerelease?"-0":"",v?O===">"||O==="<"?C="<0.0.0-0":C="*":O&&re?(Q&&(b=0),F=0,O===">"?(O=">=",Q?(A=+A+1,b=0,F=0):(b=+b+1,F=0)):O==="<="&&(O="<",Q?A=+A+1:b=+b+1),O==="<"&&(N="-0"),C=`${O+A}.${b}.${F}${N}`):Q?C=`>=${A}.0.0${N} <${+A+1}.0.0-0`:Z&&(C=`>=${A}.${b}.0${N} <${A}.${+b+1}.0-0`),s("xRange return",C),C})},j=(T,S)=>(s("replaceStars",T,S),T.trim().replace(l[u.STAR],"")),L=(T,S)=>(s("replaceGTE0",T,S),T.trim().replace(l[S.includePrerelease?u.GTE0PRE:u.GTE0],"")),V=T=>(S,$,C,O,A,b,F,N,v,Q,Z,re)=>(w(C)?$="":w(O)?$=`>=${C}.0.0${T?"-0":""}`:w(A)?$=`>=${C}.${O}.0${T?"-0":""}`:b?$=`>=${$}`:$=`>=${$}${T?"-0":""}`,w(v)?N="":w(Q)?N=`<${+v+1}.0.0-0`:w(Z)?N=`<${v}.${+Q+1}.0-0`:re?N=`<=${v}.${Q}.${Z}-${re}`:T?N=`<${v}.${Q}.${+Z+1}-0`:N=`<=${N}`,`${$} ${N}`.trim()),oe=(T,S,$)=>{for(let C=0;C<T.length;C++)if(!T[C].test(S))return!1;if(S.prerelease.length&&!$.includePrerelease){for(let C=0;C<T.length;C++)if(s(T[C].semver),T[C].semver!==a.ANY&&T[C].semver.prerelease.length>0){const O=T[C].semver;if(O.major===S.major&&O.minor===S.minor&&O.patch===S.patch)return!0}return!1}return!0};return $p}var Np,fx;function Xf(){if(fx)return Np;fx=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(c,d){if(d=t(d),c instanceof e){if(c.loose===!!d.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),s("comparator",c,d),this.options=d,this.loose=!!d.loose,this.parse(c),this.semver===n?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}parse(c){const d=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],f=c.match(d);if(!f)throw new TypeError(`Invalid comparator: ${c}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=n}toString(){return this.value}test(c){if(s("Comparator.test",c,this.options.loose),this.semver===n||c===n)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return a(c,this.operator,this.semver,this.options)}intersects(c,d){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(c.value,d).test(this.value):c.operator===""?c.value===""?!0:new l(this.value,d).test(c.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||a(this.semver,"<",c.semver,d)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||a(this.semver,">",c.semver,d)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}Np=e;const t=n_,{safeRe:r,t:i}=Lu,a=S9,s=Zf,o=r_,l=xr();return Np}xr();xr();xr();xr();xr();xr();const P9=Xf(),{ANY:EG}=P9;xr();xr();xr();const i_=Xf(),{ANY:kG}=i_;new i_(">=0.0.0-0");new i_(">=0.0.0");const jp=Lu,hx=Jf,px=CA;Xf();xr();jp.re,jp.src,jp.t,hx.SEMVER_SPEC_VERSION,hx.RELEASE_TYPES,px.compareIdentifiers,px.rcompareIdentifiers;function vi(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[i,a]=e.split("/",2);if(!i||!a)throw new Error(`Invalid identifier format: ${n}`);return[i,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class T9 extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function le(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const i=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new T9(i):new Error(i)}var mx="[...]",I9={result:"[Circular]"},ef=[],Ps=[];function C9(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function vn(n,e,t,r){var s;try{return JSON.stringify(n,e,t)}catch(o){if(!((s=o.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=C9()),jg(n,"",0,[],void 0,0,r);var i;try{Ps.length===0?i=JSON.stringify(n,e,t):i=JSON.stringify(n,R9(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ef.length!==0;){var a=ef.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return i}}function Lp(n,e,t,r){var i=Object.getOwnPropertyDescriptor(r,t);i.get!==void 0?i.configurable?(Object.defineProperty(r,t,{value:n}),ef.push([r,t,e,i])):Ps.push([e,t,n]):(r[t]=n,ef.push([r,t,e]))}function jg(n,e,t,r,i,a,s){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){Lp(I9,n,e,i);return}if(typeof s.depthLimit<"u"&&a>s.depthLimit){Lp(mx,n,e,i);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){Lp(mx,n,e,i);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)jg(n[o],o,o,r,n,a,s);else{var l=Object.keys(n);for(o=0;o<l.length;o++){var u=l[o];jg(n[u],u,o,r,n,a,s)}}r.pop()}}function R9(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Ps.length>0)for(var r=0;r<Ps.length;r++){var i=Ps[r];if(i[1]===e&&i[0]===t){t=i[2],Ps.splice(r,1);break}}return n.call(this,e,t)}}function gx(n){const e=NA(),t=q9(),r=n.extra??{},i=r.metadata;return n.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...i}},n}const $9=()=>{const n=Ri("TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},N9=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function j9(n){const e=[];for await(const t of n)e.push(t);return e}function Dp(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const L9=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class D9{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(a=>{t=a}),i=vn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop(e){var i;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(((i=this.peek())==null?void 0:i.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(t.push(a),r+=a.size,this.sizeBytes-=a.size)}if(t.length===0&&this.items.length>0){const a=this.items.shift();t.push(a),r+=a.size,this.sizeBytes-=a.size}return[t.map(a=>({action:a.action,item:a.payload})),()=>t.forEach(a=>a.itemPromiseResolve())]}}const F9=20971520,M9=2500;class fu{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new D9}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Ca("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=fu.getDefaultClientConfig();if(this.tracingSampleRate=$9(),this.apiUrl=Dp(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Dp(e.apiKey??t.apiKey),this.webUrl=Dp(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new nx(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new nx({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:L9}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Ri("API_KEY"),t=Ri("ENDPOINT")??"https://api.smith.langchain.com",r=Ri("HIDE_INPUTS")==="true",i=Ri("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:N9(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${RA}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",i=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(X(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(a));const s=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(X(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(o,`Failed to fetch ${e}`);const l=r?r(await o.json()):await o.json();if(l.length===0||(yield l,l.length<a))break;i+=l.length}}async*_getCursorPaginatedList(e,t=null,r="POST",i="runs"){const a=t?{...t}:{};for(;;){const o=await(await this.caller.call(X(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[i])break;yield o[i];const l=o.cursors;if(!l||!l.next)break;a.cursor=l.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):r.push(i);return r}else{const r=[];for(const i of e)i.id!==i.trace_id&&!this.filteredPostUuids.has(i.trace_id)||Math.random()<this.tracingSampleRate?r.push(i):this.filteredPostUuids.add(i.id);return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??F9}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[r,i]=this.autoBatchQueue.pop(e);if(!r.length){i();break}const a=this._processBatch(r,i).catch(console.error);t.push(a)}return Promise.all(t)}async _processBatch(e,t){var r;if(!e.length){t();return}try{const i={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)},a=await this._ensureServerInfo();(r=a==null?void 0:a.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(i):await this.batchIngestRuns(i)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=gx(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await X()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(M9),...this.fetchOptions});return await le(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const i=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}const a=gx(i),s=await this.caller.call(X(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:vn(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(s,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],i=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(r.length>0&&i.length>0){const o=r.reduce((u,c)=>(c.id&&(u[c.id]=c),u),{}),l=[];for(const u of i)u.id!==void 0&&o[u.id]?o[u.id]={...o[u.id],...u}:l.push(u);r=Object.values(o),i=l}const a={post:this._filterForSampling(r),patch:this._filterForSampling(i,!0)};if(!a.post.length&&!a.patch.length)return;const s={post:[],patch:[]};for(const o of["post","patch"]){const l=o,u=a[l].reverse();let c=u.pop();for(;c!==void 0;)s[l].push(c),c=u.pop()}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(vn(s))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(X(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const r={};let i=[];for(const c of e??[]){const d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,i.push(d)}let a=[];for(const c of t??[])a.push(this.prepareRunCreateOrUpdateInputs(c));if(i.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){const c=i.reduce((f,h)=>(h.id&&(f[h.id]=h),f),{}),d=[];for(const f of a)f.id!==void 0&&c[f.id]?c[f.id]={...c[f.id],...f}:d.push(f);i=Object.values(c),a=d}if(i.length===0&&a.length===0)return;const l=[],u=[];for(const[c,d]of[["post",i],["patch",a]])for(const f of d){const{inputs:h,outputs:p,events:m,attachments:_,...g}=f,y={inputs:h,outputs:p,events:m},w=vn(g);u.push({name:`${c}.${g.id}`,payload:new Blob([w],{type:`application/json; length=${w.length}`})});for(const[x,k]of Object.entries(y)){if(k===void 0)continue;const E=vn(k);u.push({name:`${c}.${g.id}.${x}`,payload:new Blob([E],{type:`application/json; length=${E.length}`})})}if(g.id!==void 0){const x=r[g.id];if(x){delete r[g.id];for(const[k,E]of Object.entries(x)){let P,R;if(Array.isArray(E)?[P,R]=E:(P=E.mimeType,R=E.data),k.includes(".")){console.warn(`Skipping attachment '${k}' for run ${g.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}u.push({name:`attachment.${g.id}.${k}`,payload:new Blob([R],{type:`${P}; length=${R.byteLength}`})})}}}l.push(`trace=${g.trace_id},id=${g.id}`)}await this._sendMultipartRequest(u,l.join("; "))}async _sendMultipartRequest(e,t){try{const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=[];for(const l of e)i.push(new Blob([`--${r}\r
`])),i.push(new Blob([`Content-Disposition: form-data; name="${l.name}"\r
`,`Content-Type: ${l.payload.type}\r
\r
`])),i.push(l.payload),i.push(new Blob([`\r
`]));i.push(new Blob([`--${r}--\r
`]));const s=await new Blob(i).arrayBuffer(),o=await this.batchIngestCaller.call(X(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:s,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(o,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${t}`)}}async updateRun(e,t){fe(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(X(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:vn(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){fe(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let i;t.session_id?i=t.session_id:r!=null&&r.projectName?i=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?i=r==null?void 0:r.projectId:i=(await this.readProject({projectName:Ri("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${i}/r/${t.id}?poll=true`}else if(e!==void 0){const i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await j9(this.listRuns({id:e.child_run_ids})),r={},i={};t.sort((a,s)=>((a==null?void 0:a.dotted_order)??"").localeCompare((s==null?void 0:s.dotted_order)??""));for(const a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),i[a.id]=a}e.child_runs=r[e.id]||[];for(const a in r)a!==e.id&&(i[a].child_runs=r[a]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:i,traceId:a,referenceExampleId:s,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:f,query:h,filter:p,traceFilter:m,treeFilter:_,limit:g,select:y}=e;let w=[];if(t&&(w=Array.isArray(t)?t:[t]),r){const P=Array.isArray(r)?r:[r],R=await Promise.all(P.map(H=>this.readProject({projectName:H}).then(j=>j.id)));w.push(...R)}const x=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],k={session:w.length?w:null,run_type:c,reference_example:s,query:h,filter:p,trace_filter:m,tree_filter:_,execution_order:l,parent_run:i,start_time:o?o.toISOString():null,error:d,id:f,limit:g,trace:a,select:y||x,is_root:u};let E=0;for await(const P of this._getCursorPaginatedList("/runs/query",k))if(g){if(E>=g)break;if(P.length+E>g){yield*P.slice(0,g-E);break}E+=P.length,yield*P}else yield*P}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:a,projectIds:s,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:f,traceFilter:h,treeFilter:p,isRoot:m,dataSourceType:_}){let g=s||[];a&&(g=[...s||[],...await Promise.all(a.map(E=>this.readProject({projectName:E}).then(P=>P.id)))]);const w=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:g,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:f,trace_filter:h,tree_filter:p,is_root:m,data_source_type:_}).filter(([E,P])=>P!==void 0));return await(await this.caller.call(X(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||Et()};fe(e);const a=await(await this.caller.call(X(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){fe(e);const t=await this.caller.call(X(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(t,"unshare run",!0)}async readRunSharedLink(e){fe(e);const r=await(await this.caller.call(X(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const s of t)r.append("id",s);return fe(e),await(await this.caller.call(X(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),fe(e);const i=await(await this.caller.call(X(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};fe(e);const a=await(await this.caller.call(X(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){fe(e);const t=await this.caller.call(X(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(t,"unshare dataset",!0)}async readSharedDataset(e){return fe(e),await(await this.caller.call(X(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const i=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>i.append(o,u)):i.append(o,l)});const a=await this.caller.call(X(),`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await a.json();if(!a.ok)throw"detail"in s?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${s.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return s.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:a=null,referenceDatasetId:s=null}){const o=i?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=a||{};r&&(u.metadata=r);const c={name:e,extra:u,description:t};s!==null&&(c.reference_dataset_id=s);const d=await this.caller.call(X(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:a=null,endTime:s=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=a;i&&(l={...l||{},metadata:i});const u={name:t,extra:l,description:r,end_time:s?new Date(s).toISOString():null},c=await this.caller.call(X(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)fe(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(X(),`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const s=await a.json();return a.ok?Array.isArray(s)?s.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)fe(e),i+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const s=await this._get(i,a);let o;if(Array.isArray(s)){if(s.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=s[0]}else o=s;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:a,referenceFree:s,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const u of e)l.append("id",u);if(t!==void 0&&l.append("name",t),r!==void 0&&l.append("name_contains",r),i!==void 0)l.append("reference_dataset",i);else if(a!==void 0){const u=await this.readDataset({datasetName:a});l.append("reference_dataset",u.id)}s!==void 0&&l.append("reference_free",s.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const u of this._getPaginated("/sessions",l))yield*u}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,fe(r);const i=await this.caller.call(X(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(i,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:a,dataType:s,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(f=>{u.append("input_keys",f)}),i.forEach(f=>{u.append("output_keys",f)}),a&&u.append("description",a),s&&u.append("data_type",s),o&&u.append("name",o);const c=await this.caller.call(X(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:a,metadata:s}={}){const o={name:e,description:t,extra:s?{metadata:s}:void 0};r&&(o.data_type=r),i&&(o.inputs_schema_definition=i),a&&(o.outputs_schema_definition=a);const l=await this.caller.call(X(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const i=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)fe(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,i);let s;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=a[0]}else s=a;return s}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const s=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:a,metadata:s}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const u of r)l.append("id",u);i!==void 0&&l.append("name",i),a!==void 0&&l.append("name_contains",a),s!==void 0&&l.append("metadata",JSON.stringify(s));for await(const u of this._getPaginated(o,l))yield*u}async updateDataset(e){const{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:r})).id;fe(a);const s=await this.caller.call(X(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"update dataset"),await s.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:i,tag:a}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const s=t??(await this.readDataset({datasetName:r})).id;fe(s);const o=await this.caller.call(X(),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof i=="string"?i:i.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(i=(await this.readDataset({datasetName:t})).id),i!==void 0)fe(i),r+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(X(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(!i&&!t)throw new Error("Must provide either datasetName or datasetId");if(i&&t)throw new Error("Must provide either datasetName or datasetId, not both");i||(i=(await this.readDataset({datasetName:t})).id),fe(i);const a={tag:r},s=await this.caller.call(X(),`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(s,"index dataset"),await s.json()}async similarExamples(e,t,r,{filter:i}={}){const a={limit:r,inputs:e};i!==void 0&&(a.filter=i),fe(t);const s=await this.caller.call(X(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"fetch similar examples"),(await s.json()).examples}async createExample(e,t,{datasetId:r,datasetName:i,createdAt:a,exampleId:s,metadata:o,split:l,sourceRunId:u}){let c=r;if(c===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:i})).id);const d=a||new Date,f={dataset_id:c,inputs:e,outputs:t,created_at:d==null?void 0:d.toISOString(),id:s,metadata:o,split:l,source_run_id:u},h=await this.caller.call(X(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(h,"create example"),await h.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:i,sourceRunIds:a,exampleIds:s,datasetId:o,datasetName:l}=e;let u=o;if(u===void 0&&l===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&l!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:l})).id);const c=t.map((h,p)=>({dataset_id:u,inputs:h,outputs:r?r[p]:void 0,metadata:i?i[p]:void 0,split:e.splits?e.splits[p]:void 0,id:s?s[p]:void 0,source_run_id:a?a[p]:void 0})),d=await this.caller.call(X(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const i=e.map(s=>rx(s)?ix(s):s),a=rx(t)?ix(t):t;return this.createExample({input:i},{output:a},r)}async readExample(e){fe(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:i,...a}=r,s=a;return i&&(s.attachments=Object.entries(i).reduce((o,[l,u])=>(o[l.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),s}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:a,inlineS3Urls:s,metadata:o,limit:l,offset:u,filter:c,includeAttachments:d}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const h=new URLSearchParams({dataset:f}),p=i?typeof i=="string"?i:i==null?void 0:i.toISOString():void 0;p&&h.append("as_of",p);const m=s??!0;if(h.append("inline_s3_urls",m.toString()),r!==void 0)for(const g of r)h.append("id",g);if(a!==void 0)for(const g of a)h.append("splits",g);if(o!==void 0){const g=JSON.stringify(o);h.append("metadata",g)}l!==void 0&&h.append("limit",l.toString()),u!==void 0&&h.append("offset",u.toString()),c!==void 0&&h.append("filter",c),d===!0&&["attachment_urls","outputs","metadata"].forEach(g=>h.append("select",g));let _=0;for await(const g of this._getPaginated("/examples",h)){for(const y of g){const{attachment_urls:w,...x}=y,k=x;w&&(k.attachments=Object.entries(w).reduce((E,[P,R])=>(E[P.slice(11)]={presigned_url:R.presigned_url,mime_type:R.mime_type||void 0},E),{})),yield k,_++}if(l!==void 0&&_>=l)break}}async deleteExample(e){fe(e);const t=`/examples/${e}`,r=await this.caller.call(X(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(r,`delete ${t}`),await r.json()}async updateExample(e,t){fe(e);const r=await this.caller.call(X(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(r,"update example"),await r.json()}async updateExamples(e){const t=await this.caller.call(X(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(t,"update examples"),await t.json()}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:i}){let a;if(e?a=e:a=(await this.readDataset({datasetName:t})).id,fe(a),r&&i||!r&&!i)throw new Error("Exactly one of asOf and tag must be specified.");const s=new URLSearchParams;r!==void 0&&s.append("as_of",typeof r=="string"?r:r.toISOString()),i!==void 0&&s.append("tag",i);const o=await this.caller.call(X(),`${this.apiUrl}/datasets/${a}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,fe(i);const a=new URLSearchParams,s=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return s&&a.append("as_of",s),await this._get(`/datasets/${i}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:a=!1}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,fe(s);const o={split_name:r,examples:i.map(u=>(fe(u),u)),remove:a},l=await this.caller.call(X(),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:a}={loadChildRuns:!1}){PA("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let s;if(typeof e=="string")s=await this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)s=e;else throw new Error(`Invalid run type: ${typeof e}`);s.reference_example_id!==null&&s.reference_example_id!==void 0&&(a=await this.readExample(s.reference_example_id));const o=await t.evaluateRun(s,a),[l,u]=await this._logEvaluationFeedback(o,s,r);return u[0]}async createFeedback(e,t,{score:r,value:i,correction:a,comment:s,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:h}){var y;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};u!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:u}),(p==null?void 0:p.metadata)!==void 0&&((y=p.metadata.__run)==null?void 0:y.run_id)!==void 0&&fe(p.metadata.__run.run_id);const m={id:c??Et(),run_id:e,key:t,score:r,value:i,correction:a,comment:s,feedback_source:p,comparative_experiment_id:h,feedbackConfig:d,session_id:f},_=`${this.apiUrl}/feedback`,g=await this.caller.call(X(),_,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(g,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:i,comment:a}){const s={};t!=null&&(s.score=t),r!=null&&(s.value=r),i!=null&&(s.correction=i),a!=null&&(s.comment=a),fe(e);const o=await this.caller.call(X(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(o,"update feedback",!0)}async readFeedback(e){fe(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){fe(e);const t=`/feedback/${e}`,r=await this.caller.call(X(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const i=new URLSearchParams;if(e&&i.append("run",e.join(",")),t)for(const a of t)i.append("key",a);if(r)for(const a of r)i.append("source",a);for await(const a of this._getPaginated("/feedback",i))yield*a}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){const a={run_id:e,feedback_key:t,feedback_config:i};return r?typeof r=="string"?a.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(X(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:a,metadata:s,id:o}){var c;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(c=i??new Date)==null?void 0:c.toISOString(),extra:{}};return s&&(l.extra.metadata=s),await(await this.caller.call(X(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){fe(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){const i=this._selectEvalResults(e),a=[];for(const s of i){let o=r||{};s.evaluatorInfo&&(o={...s.evaluatorInfo,...o});let l=null;s.targetRunId?l=s.targetRunId:t&&(l=t.id),a.push(await this.createFeedback(l,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[i,a]}async logEvaluationFeedback(e,t,r){const[i]=await this._logEvaluationFeedback(e,t,r);return i}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:i,limit:a}=e,s=new URLSearchParams;t&&t.forEach((l,u)=>{fe(l,`queueIds[${u}]`),s.append("ids",l)}),r&&s.append("name",r),i&&s.append("name_contains",i),s.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",s))if(yield*l,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:i}=e,a={name:t,description:r,id:i||Et()},s=await this.caller.call(X(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([l,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"create annotation queue"),await s.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:r,description:i}=t,a=await this.caller.call(X(),`${this.apiUrl}/annotation-queues/${fe(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(a,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(X(),`${this.apiUrl}/annotation-queues/${fe(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(X(),`${this.apiUrl}/annotation-queues/${fe(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((i,a)=>fe(i,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${fe(e,"queueId")}/run`,i=await this.caller.call(X(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(i,"get run from annotation queue"),await i.json()}async deleteRunFromAnnotationQueue(e,t){const r=await this.caller.call(X(),`${this.apiUrl}/annotation-queues/${fe(e,"queueId")}/runs/${fe(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(X(),`${this.apiUrl}/annotation-queues/${fe(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(X(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const i=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${i}`);throw a.statusCode=t.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,i,a]=vi(e),s=await this.caller.call(X(),`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,`${t?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(e){const[t,r,i]=vi(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,i=>i.repos))yield*r}async getPrompt(e){const[t,r,i]=vi(e),a=await this.caller.call(X(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await le(a,"get prompt");const s=await a.json();return s.repo?s.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[i,a,s]=vi(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);const o={repo_handle:a,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=await this.caller.call(X(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(l,"create prompt");const{repo:u}=await l.json();return u}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[i,a,s]=vi(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${i}/${a}`):r==null?void 0:r.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call(X(),`${this.apiUrl}/commits/${i}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(u,"create commit");const c=await u.json();return this._getPromptUrl(`${i}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const s of t){const o=s.id,l={...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split}},u=vn(l),c=new Blob([u],{type:"application/json"});if(r.append(o,c),s.inputs){const d=vn(s.inputs),f=new Blob([d],{type:"application/json"});r.append(`${o}.inputs`,f)}if(s.outputs){const d=vn(s.outputs),f=new Blob([d],{type:"application/json"});r.append(`${o}.outputs`,f)}if(s.attachments)for(const[d,f]of Object.entries(s.attachments)){let h,p;Array.isArray(f)?[h,p]=f:(h=f.mimeType,p=f.data);const m=new Blob([p],{type:`${h}; length=${p.byteLength}`});r.append(`${o}.attachment.${d}`,m)}if(s.attachments_operations){const d=vn(s.attachments_operations),f=new Blob([d],{type:"application/json"});r.append(`${o}.attachments_operations`,f)}}return await(await this.caller.call(X(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const s of t){const o=(s.id??Et()).toString(),l={created_at:s.created_at,...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split}},u=vn(l),c=new Blob([u],{type:"application/json"});r.append(o,c);const d=vn(s.inputs),f=new Blob([d],{type:"application/json"});if(r.append(`${o}.inputs`,f),s.outputs){const h=vn(s.outputs),p=new Blob([h],{type:"application/json"});r.append(`${o}.outputs`,p)}if(s.attachments)for(const[h,p]of Object.entries(s.attachments)){let m,_;Array.isArray(p)?[m,_]=p:(m=p.mimeType,_=p.data);const g=new Blob([_],{type:`${m}; length=${_.byteLength}`});r.append(`${o}.attachment.${h}`,g)}}return await(await this.caller.call(X(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,i]=vi(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if((t==null?void 0:t.description)!==void 0&&(a.description=t.description),(t==null?void 0:t.readme)!==void 0&&(a.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(a.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(a.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const s=await this.caller.call(X(),`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,i]=vi(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(X(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,i,a]=vi(e),s=await this.caller.call(X(),`${this.apiUrl}/commits/${r}/${i}/${a}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await le(s,"pull prompt commit");const o=await s.json();return{owner:r,repo:i,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(i=>i!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[a,s]=this.parseTokenOrUrl(e,r),o=new fu({apiUrl:a,apiKey:"placeholder"}),l=await o.readSharedDataset(s),u=i||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const c=await o.listSharedExamples(s),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(f=>f.inputs),outputs:c.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return fe(e),[t,e]}catch{}try{const s=new URL(e).pathname.split("/").filter(o=>o!=="");if(s.length>=r){const o=s[s.length-r];return[t,o]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}const RA="0.3.4";var xl={};let Jr;const U9=()=>typeof window<"u"&&typeof window.document<"u",z9=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",B9=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),$A=()=>typeof Deno<"u",H9=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!$A(),V9=()=>Jr||(U9()?Jr="browser":H9()?Jr="node":z9()?Jr="webworker":B9()?Jr="jsdom":$A()?Jr="deno":Jr="other",Jr);let Fp;function NA(){if(Fp===void 0){const n=V9(),e=W9();Fp={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:RA,...e}}return Fp}function q9(){const n=G9()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,i]of Object.entries(n))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof i=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[r]=i);return e}function G9(){try{return typeof process<"u"&&xl?Object.entries(xl).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Ca(n){try{return typeof process<"u"?xl==null?void 0:xl[n]:void 0}catch{return}}function Ri(n){return Ca(`LANGSMITH_${n}`)||Ca(`LANGCHAIN_${n}`)}let Mp;function W9(){if(Mp!==void 0)return Mp;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Ca(t);r!==void 0&&(e[t]=r)}return Mp=e,e}const K9=n=>!!["TRACING_V2","TRACING"].find(t=>Ri(t)==="true"),Up=Symbol.for("lc:context_variables");function J9(n){return n.replace(/[-:.]/g,"")}function Z9(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return J9(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class tf{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let r={},i=[];for(const a of t){const[s,o]=a.split("="),l=decodeURIComponent(o);s==="langsmith-metadata"?r=JSON.parse(l):s==="langsmith-tags"&&(i=l.split(","))}return new tf(r,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class kn{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),jA(e)){Object.assign(this,{...e});return}const t=kn.getDefaultConfig(),{metadata:r,...i}=e,a=i.client??kn.getSharedClient(),s={...r,...(o=i==null?void 0:i.extra)==null?void 0:o.metadata};if(i.extra={...i.extra,metadata:s},Object.assign(this,{...t,...i,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=Z9(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}static getDefaultConfig(){return{id:Et(),run_type:"chain",project_name:Ri("PROJECT")??Ca("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Ca("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Ca("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return kn.sharedClient||(kn.sharedClient=new fu),kn.sharedClient}createChild(e){var l,u,c,d,f,h;const t=this.child_execution_order+1,r=new kn({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});Up in this&&(r[Up]=this[Up]);const i=Symbol.for("lc:child_config"),a=((l=e.extra)==null?void 0:l[i])??this.extra[i];if(Q9(a)){const p={...a},m=X9(p.callbacks)?(c=(u=p.callbacks).copy)==null?void 0:c.call(u):void 0;m&&(Object.assign(m,{_parentRunId:r.id}),(h=(f=(d=m.handlers)==null?void 0:d.find(LA))==null?void 0:f.updateFromRunTree)==null||h.call(f,r),p.callbacks=m),r.extra[i]=p}const s=new Set;let o=this;for(;o!=null&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,t,r=!0){var l;const i=e.extra??{};if(i.runtime||(i.runtime={}),t)for(const[u,c]of Object.entries(t))i.runtime[u]||(i.runtime[u]=c);let a,s;return r?(s=(l=e.parent_run)==null?void 0:l.id,a=[]):(a=e.child_runs.map(u=>this._convertToCreate(u,t,r)),s=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=NA(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){PA("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const i of this.child_runs)await i.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){var u,c,d,f;const r=e==null?void 0:e.callbacks;let i,a,s,o=K9();if(r){const h=((u=r==null?void 0:r.getParentRunId)==null?void 0:u.call(r))??"",p=(c=r==null?void 0:r.handlers)==null?void 0:c.find(m=>(m==null?void 0:m.name)=="langchain_tracer");i=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,h),a=p==null?void 0:p.projectName,s=p==null?void 0:p.client,o=o||!!p}return i?new kn({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:s,tracingEnabled:o,project_name:a,tags:[...new Set(((i==null?void 0:i.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(f=i==null?void 0:i.extra)==null?void 0:f.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new kn({...t,client:s,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var u;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||typeof i!="string")return;const a=i.trim(),s=a.split(".").map(c=>{const[d,f]=c.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:f}}),o=s[0].uuid,l={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(u=s.at(-1))==null?void 0:u.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){const c=tf.fromHeader(r.baggage);l.metadata=c.metadata,l.tags=c.tags}return new kn(l)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new tf((r=this.extra)==null?void 0:r.metadata,this.tags).toHeader()};if(e)for(const[i,a]of Object.entries(t))e.set(i,a);return t}}Object.defineProperty(kn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function jA(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function LA(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function yx(n){return Array.isArray(n)&&n.some(e=>LA(e))}function X9(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function Q9(n){var e;return n!==void 0&&typeof n.callbacks=="object"&&(yx((e=n.callbacks)==null?void 0:e.handlers)||yx(n.callbacks))}let Y9=class{getStore(){}run(e,t){return t()}};const zp=Symbol.for("ls:tracing_async_local_storage"),eH=new Y9;let tH=class{getInstance(){return globalThis[zp]??eH}initializeGlobalInstance(e){globalThis[zp]===void 0&&(globalThis[zp]=e)}};const nH=new tH,rH=()=>{const n=nH.getInstance().getStore();if(!jA(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return n};function a_(n){return typeof n=="function"&&"langsmith:traceable"in n}let Bp;const iH=()=>{if(Bp===void 0){const n=qi("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Bp=new fu(n)}return Bp};class El extends Nu{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:i}=e;this.projectName=r??qi("LANGCHAIN_PROJECT")??qi("LANGCHAIN_SESSION"),this.exampleId=t,this.client=i??iH();const a=El.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await xB()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const i=[t];for(;i.length>0;){const a=i.shift();!a||r.has(a.id)||(r.add(a.id),this.runMap.set(a.id,a),a.child_runs&&i.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},r=[];for(const[i,a]of this.runMap){const s=new kn({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[i]=s,r.push([i,a.dotted_order])}r.sort((i,a)=>!i[1]||!a[1]?0:i[1].localeCompare(a[1]));for(const[i]of r){const a=this.runMap.get(i),s=t[i];if(!(!a||!s)&&a.parent_run_id){const o=t[a.parent_run_id];o&&(o.child_runs.push(s),s.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return rH()}catch{return}}}const DA=Symbol.for("ls:tracing_async_local_storage"),nd=Symbol.for("lc:context_variables"),aH=n=>{globalThis[DA]=n},hu=()=>globalThis[DA];let kl;function sH(){const n="default"in gt?gt.default:gt;return new n({autoStart:!0,concurrency:1})}function oH(){return typeof kl>"u"&&(kl=sH()),kl}async function ot(n,e){if(e===!0){const t=hu();t!==void 0?await t.run(void 0,async()=>n()):await n()}else kl=oH(),kl.add(async()=>{const t=hu();t!==void 0?await t.run(void 0,async()=>n()):await n()})}const lH=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>qi(t)==="true");function FA(n){var r;const e=hu();if(e===void 0)return;const t=e.getStore();return(r=t==null?void 0:t[nd])==null?void 0:r[n]}const uH=Symbol("lc:configure_hooks"),cH=()=>FA(uH)||[];function dH(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class fH{setHandler(e){return this.setHandlers([e])}}class Qf{constructor(e,t,r,i,a,s,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>ot(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ot(async()=>{var o;try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,t,this.runId,this.tags,this.metadata))}catch(l){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${l}`),s.raiseError)throw l}},s.awaitHandlers)))}}class hH extends Qf{getChild(e){const t=new Bn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>ot(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw i}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>ot(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${i}`),t.raiseError)throw e}},t.awaitHandlers)))}}class wx extends Qf{async handleLLMNewToken(e,t,r,i,a,s){await Promise.all(this.handlers.map(o=>ot(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ot(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMError: ${l}`),s.raiseError)throw l}},s.awaitHandlers)))}async handleLLMEnd(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ot(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMEnd: ${l}`),s.raiseError)throw l}},s.awaitHandlers)))}}class pH extends Qf{getChild(e){const t=new Bn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ot(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainError: ${l}`),s.raiseError)throw l}},s.awaitHandlers)))}async handleChainEnd(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ot(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainEnd: ${l}`),s.raiseError)throw l}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>ot(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>ot(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class mH extends Qf{getChild(e){const t=new Bn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>ot(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>ot(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class Bn extends fH{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&r?r:Et();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Bo(f)&&f._createRunForLLMStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),ot(async()=>{var h;try{await((h=f.handleLLMStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l))}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new wx(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&r?r:Et();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Bo(f)&&f._createRunForChatModelStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),ot(async()=>{var h,p;try{if(f.handleChatModelStart)await((h=f.handleChatModelStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l));else if(f.handleLLMStart){const m=AA(u);await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[m],d,this._parentRunId,a,this.tags,this.metadata,l))}}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new wx(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Et(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return Bo(l)&&l._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,o),ot(async()=>{var u;try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,i,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new pH(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Et(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return Bo(l)&&l._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),ot(async()=>{var u;try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new mH(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=Et(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return Bo(l)&&l._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),ot(async()=>{var u;try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new hH(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ot(async()=>{var o;if(!s.ignoreCustomEvent)try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,t,r,this.tags,this.metadata))}catch(l){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${l}`),s.raiseError)throw l}},s.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new Bn(this._parentRunId);for(const i of this.handlers){const a=this.inheritableHandlers.includes(i);r.addHandler(i,a)}for(const i of this.tags){const a=this.inheritableTags.includes(i);r.addTags([i],a)}for(const i of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(i);r.addMetadata({[i]:this.metadata[i]},a)}for(const i of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends $u{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Et()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static configure(e,t,r,i,a,s,o){return this._configureSync(e,t,r,i,a,s,o)}static _configureSync(e,t,r,i,a,s,o){var f,h;let l;(e||t)&&(Array.isArray(e)||!e?(l=new Bn,l.setHandlers((e==null?void 0:e.map(nf))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(nf):t==null?void 0:t.handlers,!1));const u=qi("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=((f=El.getTraceableRunTree())==null?void 0:f.tracingEnabled)||lH(),d=c||(qi("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new Bn),u&&!l.handlers.some(p=>p.name===tx.prototype.name)){const p=new tx;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&c){const p=new El;l.addHandler(p,!0),l._parentRunId=((h=El.getTraceableRunTree())==null?void 0:h.id)??l._parentRunId}}for(const{contextVar:p,inheritable:m=!0,handlerClass:_,envVar:g}of cH()){const y=g&&qi(g)==="true"&&_;let w;const x=p!==void 0?FA(p):void 0;x&&kB(x)?w=x:y&&(w=new _({})),w!==void 0&&(l||(l=new Bn),l.handlers.some(k=>k.name===w.name)||l.addHandler(w,m))}return(r||i)&&l&&(l.addTags(r??[]),l.addTags(i??[],!1)),(a||s)&&l&&(l.addMetadata(a??{}),l.addMetadata(s??{},!1)),l}}function nf(n){return"name"in n?n:$u.fromMethods(n)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const gH=Object.prototype.hasOwnProperty;function yH(n,e){return gH.call(n,e)}function wH(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)yH(n,t)&&e.push(t);return e}function ao(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Lg(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function _H(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function Dg(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Dg(n[t]))return!0}else if(typeof n=="object"){const t=wH(n),r=t.length;for(var e=0;e<r;e++)if(Dg(n[t[e]]))return!0}}return!1}function _x(n,e){const t=[n];for(const r in e){const i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(`${r}: ${i}`)}return t.join(`
`)}class bH extends Error{constructor(e,t,r,i,a){super(_x(e,{name:t,index:r,operation:i,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=_x(e,{name:t,index:r,operation:i,tree:a})}}const nt=bH,Ts={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Fg(t,this.path);r&&(r=ao(r));const i=Sl(t,{op:"remove",path:this.from}).removed;return Sl(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=Fg(t,this.from);return Sl(t,{op:"add",path:this.path,value:ao(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:af(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var vH={add:function(n,e,t){return Lg(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Ts.move,copy:Ts.copy,test:Ts.test,_get:Ts._get};function Fg(n,e){if(e=="")return n;var t={op:"_get",path:e};return Sl(n,t),t.value}function Sl(n,e,t=!1,r=!0,i=!0,a=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):Mg(e,0)),e.path===""){let s={newDocument:n};if(e.op==="add")return s.newDocument=e.value,s;if(e.op==="replace")return s.newDocument=e.value,s.removed=n,s;if(e.op==="move"||e.op==="copy")return s.newDocument=Fg(n,e.from),e.op==="move"&&(s.removed=n),s;if(e.op==="test"){if(s.test=af(n,e.value),s.test===!1)throw new nt("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return s.newDocument=n,s}else{if(e.op==="remove")return s.removed=n,s.newDocument=null,s;if(e.op==="_get")return e.value=n,s;if(t)throw new nt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,n);return s}}else{r||(n=ao(n));const o=(e.path||"").split("/");let l=n,u=1,c=o.length,d,f,h;for(typeof t=="function"?h=t:h=Mg;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=_H(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[f]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&h(e,0,n,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(t&&!Lg(f))throw new nt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,n);Lg(f)&&(f=~~f)}if(u>=c){if(t&&e.op==="add"&&f>l.length)throw new nt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,n);const p=vH[e.op].call(e,l,f,n);if(p.test===!1)throw new nt("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return p}}else if(u>=c){const p=Ts[e.op].call(e,l,f,n);if(p.test===!1)throw new nt("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return p}if(l=l[f],t&&u<c&&(!l||typeof l!="object"))throw new nt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,n)}}}function rf(n,e,t,r=!0,i=!0){if(t&&!Array.isArray(e))throw new nt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=ao(n));const a=new Array(e.length);for(let s=0,o=e.length;s<o;s++)a[s]=Sl(n,e[s],t,!0,i,s),n=a[s].newDocument;return a.newDocument=n,a}function Mg(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new nt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Ts[n.op]){if(typeof n.path!="string")throw new nt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new nt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new nt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new nt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&Dg(n.value))throw new nt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new nt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new nt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var s={op:"_get",path:n.from,value:void 0},o=xH([s],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new nt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new nt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function xH(n,e,t){try{if(!Array.isArray(n))throw new nt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)rf(ao(e),ao(n),t||!0);else{t=t||Mg;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof nt)return i;throw i}}function af(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,a,s;if(t&&r){if(a=n.length,a!=e.length)return!1;for(i=a;i--!==0;)if(!af(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(a=o.length,a!==Object.keys(e).length)return!1;for(i=a;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=a;i--!==0;)if(s=o[i],!af(n[s],e[s]))return!1;return!0}return n!==n&&e!==e}class EH{getStore(){}run(e,t){return t()}enterWith(e){}}const kH=new EH,bx=Symbol.for("lc:child_config");class SH{getInstance(){return hu()??kH}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[bx]}runWithConfig(e,t,r){var c;const i=Bn._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),a=this.getInstance(),s=a.getStore(),o=i==null?void 0:i.getParentRunId(),l=(c=i==null?void 0:i.handlers)==null?void 0:c.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let u;return l&&o?u=l.convertToRunTree(o):r||(u=new kn({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[bx]:e}),s!==void 0&&s[nd]!==void 0&&(u[nd]=s[nd]),a.run(u,t)}initializeGlobalInstance(e){hu()===void 0&&aH(e)}}const Yi=new SH,Hp=25;async function pr(n){return Bn._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function vx(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const i=e[r]??[];e[r]=[...new Set(i.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){const i=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!i)e.callbacks=a;else if(Array.isArray(i))e.callbacks=i.concat(a);else{const s=i.copy();for(const o of a)s.addHandler(nf(o),!0);e.callbacks=s}else if(a)if(!i)e.callbacks=a;else if(Array.isArray(i)){const s=a.copy();for(const o of i)s.addHandler(nf(o),!0);e.callbacks=s}else e.callbacks=new Bn(a._parentRunId,{handlers:i.handlers.concat(a.handlers),inheritableHandlers:i.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(a.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(a.inheritableTags))),metadata:{...i.metadata,...a.metadata}})}else{const i=r;e[i]=t[i]??e[i]}return e}const OH=new Set(["string","number","boolean"]);function Ie(n){var r;const e=Yi.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:i,runName:a,...s}=e;t=Object.entries(s).reduce((o,[l,u])=>(u!==void 0&&(o[l]=u),o),t)}if(n&&(t=Object.entries(n).reduce((i,[a,s])=>(s!==void 0&&(i[a]=s),i),t)),t!=null&&t.configurable)for(const i of Object.keys(t.configurable))OH.has(typeof t.configurable[i])&&!((r=t.metadata)!=null&&r[i])&&(t.metadata||(t.metadata={}),t.metadata[i]=t.configurable[i]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const i=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,i])):t.signal=i,delete t.timeout}return t}function $t(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:i,configurable:a,runId:s}={}){const o=Ie(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),i!==void 0&&(o.runName=i),a!==void 0&&(o.configurable={...o.configurable,...a}),s!==void 0&&delete o.runId,o}function so(n){return n?{configurable:n.configurable,recursionLimit:n.recursionLimit,callbacks:n.callbacks,tags:n.tags,metadata:n.metadata,maxConcurrency:n.maxConcurrency,timeout:n.timeout,signal:n.signal}:void 0}async function ea(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,i)=>{t=()=>{i(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&i(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class Rn extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new Rn({start(r){return i();function i(){return t.read().then(({done:a,value:s})=>{if(a){r.close();return}return r.enqueue(s),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new Rn({async pull(t){const{value:r,done:i}=await e.next();i&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function MA(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(i){for(;;)if(i.length===0){const a=await n.next();for(const s of t)s.push(a)}else{if(i[0].done)return;yield i.shift().value}})}function si(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,i]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=si(t[r],i):t[r]=i;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class ko{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((r,i)=>{Yi.runWithConfig(so(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,i):this.firstResult.then(a=>r(void 0),i)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Yi.runWithConfig(so(this.config),this.signal?async()=>ea(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function AH(n,e,t,r,...i){const a=new ko({generator:e,startSetup:t,signal:r}),s=await a.setup;return{output:n(a,s,...i),setup:s}}class Pi{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=rf({},t);return new pu({ops:t,state:r[r.length-1].newDocument})}}class pu extends Pi{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=rf(this.state,e.ops);return new pu({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=rf({},e.ops);return new pu({ops:e.ops,state:t[t.length-1].newDocument})}}const PH=n=>n.name==="log_stream_tracer";async function xx(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Ex(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function TH(n){return n!==void 0&&n.message!==void 0}class kx extends Nu{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Rn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const i=this.keyMapByRunId[e];i&&await this.writer.write(new Pi({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var i;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Pi({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await xx(e,this._schemaFormat)),await this.writer.write(new Pi({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await xx(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Ex(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const i=new Pi({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){const t=new Pi({ops:[{op:"replace",path:"/final_output",value:await Ex(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const i=this.keyMapByRunId[e.id];if(i===void 0)return;const a=e.inputs.messages!==void 0;let s;a?TH(r==null?void 0:r.chunk)?s=r==null?void 0:r.chunk:s=new Wf({id:`run-${e.id}`,content:t}):s=t;const o=new Pi({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:s}]});await this.writer.write(o)}}function Pc({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const IH=n=>n.name==="event_stream_tracer";class CH extends Nu{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Rn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const i=this.runInfoMap.get(e);if(i===void 0){yield r.value;return}function a(o,l){return o==="llm"&&typeof l=="string"?new Xd({text:l}):l}let s=this.tappedPromises.get(e);if(s===void 0){let o;s=new Promise(l=>{o=l}),this.tappedPromises.set(e,s);try{const l={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};await this.send({...l,data:{chunk:a(i.runType,r.value)}},i),yield r.value;for await(const u of t)i.runType!=="tool"&&i.runType!=="retriever"&&await this.send({...l,data:{chunk:a(i.runType,u)}},i),yield u}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var s,o;const t=Pc(e),r=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);const a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onLLMNewToken(e,t,r){const i=this.runInfoMap.get(e.id);let a,s;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")s="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?a=new Wf({content:t,id:`run-${e.id}`}):a=r.chunk.message;else if(i.runType==="llm")s="on_llm_stream",(r==null?void 0:r.chunk)===void 0?a=new Xd({text:t}):a=r.chunk;else throw new Error(`Unexpected run type ${i.runType}`);await this.send({event:s,data:{chunk:a},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}}async onLLMEnd(e){var s,o,l;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const i=(s=e.outputs)==null?void 0:s.generations;let a;if(t.runType==="chat_model"){for(const u of i??[]){if(a!==void 0)break;a=(o=u[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")a={generations:i==null?void 0:i.map(u=>u.map(c=>({text:c.text,generationInfo:c.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var s,o;const t=Pc(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},i.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,i.inputs=e.inputs.input):(a.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${r}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},s={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(s.input=i.input,t.inputs=i.input),await this.sendEndEvent({event:r,data:s,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var i,a;const t=Pc(e),r={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},r)}async onToolEnd(e){var i;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((i=e.outputs)==null?void 0:i.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var a,s;const t=Pc(e),i={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},i)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const i=this.runInfoMap.get(r);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const RH=[400,401,402,403,404,405,406,407,409],$H=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&RH.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const i=new Error(n==null?void 0:n.message);throw i.name="InsufficientQuotaError",i}};class s_{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??$H;const t="default"in gt?gt.default:gt;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Ki(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,a)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class UA extends Nu{constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function o_(n){return n?n.lc_runnable:!1}class NH{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const i=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||i.some(a=>{var s;return(s=this.includeTags)==null?void 0:s.includes(a)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&i.every(a=>{var s;return!((s=this.excludeTags)!=null&&s.includes(a))})),r}}function Vp(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}const jH=["*","_","`"];function LH(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t} ${r};
`;return e}function DH(n,e,t){const{firstNode:r,lastNode:i,nodeColors:a,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{};let u=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(s){const h="default",p={[h]:"{0}({1})"};r!==void 0&&(p[r]="{0}([{1}]):::first"),i!==void 0&&(p[i]="{0}([{1}]):::last");for(const[m,_]of Object.entries(n)){const g=_.name.split(":").pop()??"";let w=jH.some(k=>g.startsWith(k)&&g.endsWith(k))?`<p>${g}</p>`:g;Object.keys(_.metadata??{}).length&&(w+=`<hr/><small><em>${Object.entries(_.metadata??{}).map(([k,E])=>`${k} = ${E}`).join(`
`)}</em></small>`);const x=(p[m]??p[h]).replace("{0}",Vp(m)).replace("{1}",w);u+=`	${x}
`}}const c={};for(const h of e){const p=h.source.split(":"),m=h.target.split(":"),_=p.filter((g,y)=>g===m[y]).join(":");c[_]||(c[_]=[]),c[_].push(h)}const d=new Set;function f(h,p){const m=h.length===1&&h[0].source===h[0].target;if(p&&!m){const _=p.split(":").pop();if(d.has(_))throw new Error(`Found duplicate subgraph '${_}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(_),u+=`	subgraph ${_}
`}for(const _ of h){const{source:g,target:y,data:w,conditional:x}=_;let k="";if(w!==void 0){let E=w;const P=E.split(" ");P.length>l&&(E=Array.from({length:Math.ceil(P.length/l)},(R,H)=>P.slice(H*l,(H+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),k=x?` -. &nbsp;${E}&nbsp; .-> `:` -- &nbsp;${E}&nbsp; --> `}else k=x?" -.-> ":" --> ";u+=`	${Vp(g)}${k}${Vp(y)};
`}for(const _ in c)_.startsWith(`${p}:`)&&_!==p&&f(c[_],_);p&&!m&&(u+=`	end
`)}f(c[""]??[],"");for(const h in c)!h.includes(":")&&h!==""&&f(c[h],h);return s&&(u+=LH(a??{})),u}async function FH(n,e){let{backgroundColor:t="white"}=e??{};const r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const i=`https://mermaid.ink/img/${r}?bgColor=${t}`,a=await fetch(i);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function MH(n,e){if(n!==void 0&&!Vs(n))return n;if(o_(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function UH(n){return o_(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...Xw(n.data.schema),title:n.data.name}}}class Yf{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=Vs(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...UH(t)})),edges:this.edges.map(t=>{const r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const i=t??Et(),a={id:i,data:e,name:MH(t,e),metadata:r};return this.nodes[i]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const a={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(a),a}firstNode(){return Sx(this)}lastNode(){return Ox(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(u=>u.id).every(Vs)&&(r="");const a=u=>r?`${r}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[a(u)]={...c,id:a(u)}});const s=e.edges.map(u=>({...u,source:a(u.source),target:a(u.target)}));this.edges=[...this.edges,...s];const o=e.firstNode(),l=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,l?{id:a(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Sx(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Ox(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(i=>[i.id,i.name])),t=new Map;Object.values(e).forEach(i=>{t.set(i,(t.get(i)||0)+1)});const r=i=>{const a=e[i];return Vs(i)&&t.get(a)===1?a:i};return new Yf({nodes:Object.fromEntries(Object.entries(this.nodes).map(([i,a])=>[r(i),{...a,id:r(i)}])),edges:this.edges.map(i=>({...i,source:r(i.source),target:r(i.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},s=this.reid(),o=s.firstNode(),l=s.lastNode();return DH(s.nodes,s.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:a})}async drawMermaidPng(e){const t=this.drawMermaid(e);return FH(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function Sx(n,e=[]){const t=new Set(n.edges.filter(i=>!e.includes(i.source)).map(i=>i.target)),r=[];for(const i of Object.values(n.nodes))!e.includes(i.id)&&!t.has(i.id)&&r.push(i);return r.length===1?r[0]:void 0}function Ox(n,e=[]){const t=new Set(n.edges.filter(i=>!e.includes(i.target)).map(i=>i.source)),r=[];for(const i of Object.values(n.nodes))!e.includes(i.id)&&!t.has(i.id)&&r.push(i);return r.length===1?r[0]:void 0}function zH(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const i of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return Rn.fromReadableStream(t)}function Ax(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const BH=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function Ug(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*Px(n,e){for(;;){const{value:t,done:r}=Yi.runWithConfig(so(n),e.next.bind(e),!0);if(r)break;yield t}}async function*zg(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:i}=await Yi.runWithConfig(so(n),t.next.bind(e),!0);if(i)break;yield r}}function pt(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class Qe extends Ba{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Ra({bound:this,kwargs:e,config:{}})}map(){return new sf({bound:this})}withRetry(e){return new HH({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Ra({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new qH({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Ie);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,a)=>Ie(a===0?e:r))}return Array.from({length:t},()=>Ie(e))}async batch(e,t,r){var l;const i=this._getOptionsList(t??{},e.length),a=((l=i[0])==null?void 0:l.maxConcurrency)??(r==null?void 0:r.maxConcurrency),s=new s_({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>s.call(async()=>{try{return await this.invoke(u,i[c])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=Ie(t),i=new ko({generator:this._streamIterator(e,r),config:r});return await i.setup,Rn.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Ie(e):t=Ie({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const i=Ie(r),a=await pr(i),s=await(a==null?void 0:a.handleChainStart(this.toJSON(),pt(t,"input"),i.runId,i==null?void 0:i.runType,void 0,void 0,(i==null?void 0:i.runName)??this.getName()));delete i.runId;let o;try{const l=e.call(this,t,i,s);o=await ea(l,r==null?void 0:r.signal)}catch(l){throw await(s==null?void 0:s.handleChainError(l)),l}return await(s==null?void 0:s.handleChainEnd(pt(o,"output"))),o}async _batchWithConfig(e,t,r,i){var u;const a=this._getOptionsList(r??{},t.length),s=await Promise.all(a.map(pr)),o=await Promise.all(s.map(async(c,d)=>{const f=await(c==null?void 0:c.handleChainStart(this.toJSON(),pt(t[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,f}));let l;try{const c=e.call(this,t,a,o,i);l=await ea(c,(u=a==null?void 0:a[0])==null?void 0:u.signal)}catch(c){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(pt(l,"output")))),l}async*_transformStreamWithConfig(e,t,r){let i,a=!0,s,o=!0;const l=Ie(r),u=await pr(l);async function*c(){for await(const f of e){if(a)if(i===void 0)i=f;else try{i=si(i,f)}catch{i=void 0,a=!1}yield f}}let d;try{const f=await AH(t.bind(this),c(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r==null?void 0:r.signal,l);delete l.runId,d=f.setup;const h=d==null?void 0:d.handlers.find(IH);let p=f.output;h!==void 0&&d!==void 0&&(p=h.tapOutputIterable(d.runId,p));const m=d==null?void 0:d.handlers.find(PH);m!==void 0&&d!==void 0&&(p=m.tapOutputIterable(d.runId,p));for await(const _ of p)if(yield _,o)if(s===void 0)s=_;else try{s=si(s,_)}catch{s=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:pt(i,"input")})),f}await(d==null?void 0:d.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:pt(i,"input")}))}getGraph(e){const t=new Yf,r=t.addNode({name:`${this.getName()}Input`,schema:Ta.any()}),i=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:Ta.any()});return t.addEdge(r,i),t.addEdge(i,a),t}pipe(e){return new ka({first:this,last:Sa(e)})}pick(e){return this.pipe(new WH(e))}assign(e){return this.pipe(new GH(new Du({steps:e})))}async*transform(e,t){let r;for await(const i of e)r===void 0?r=i:r=si(r,i);yield*this._streamIterator(r,Ie(t))}async*streamLog(e,t,r){const i=new kx({...r,autoClose:!1,_schemaFormat:"original"}),a=Ie(t);yield*this._streamLog(e,i,a)}async*_streamLog(e,t,r){const{callbacks:i}=r;if(i===void 0)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{const l=i.copy();l.addHandler(t,!0),r.callbacks=l}const a=this.stream(e,r);async function s(){try{const l=await a;for await(const u of l){const c=new Pi({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(c)}}finally{await t.writer.close()}}const o=s();try{for await(const l of t)yield l}finally{await o}}streamEvents(e,t,r){let i;if(t.version==="v1")i=this._streamEventsV1(e,t,r);else if(t.version==="v2")i=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?zH(i):Rn.fromAsyncGenerator(i)}async*_streamEventsV2(e,t,r){var p;const i=new CH({...r,autoClose:!1}),a=Ie(t),s=a.runId??Et();a.runId=s;const o=a.callbacks;if(o===void 0)a.callbacks=[i];else if(Array.isArray(o))a.callbacks=o.concat(i);else{const m=o.copy();m.addHandler(i,!0),a.callbacks=m}const l=new AbortController,u=this;async function c(){try{let m;t!=null&&t.signal?"any"in AbortSignal?m=AbortSignal.any([l.signal,t.signal]):(m=t.signal,t.signal.addEventListener("abort",()=>{l.abort()},{once:!0})):m=l.signal;const _=await u.stream(e,{...a,signal:m}),g=i.tapOutputIterable(s,_);for await(const y of g)if(l.signal.aborted)break}finally{await i.finish()}}const d=c();let f=!1,h;try{for await(const m of i){if(!f){m.data.input=e,f=!0,h=m.run_id,yield m;continue}m.run_id===h&&m.event.endsWith("_end")&&(p=m.data)!=null&&p.input&&delete m.data.input,yield m}}finally{l.abort(),await d}}async*_streamEventsV1(e,t,r){let i,a=!1;const s=Ie(t),o=s.tags??[],l=s.metadata??{},u=s.runName??this.getName(),c=new kx({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new NH({...r}),f=this._streamLog(e,c,s);for await(const p of f){if(i?i=i.concat(p):i=pu.fromRunLogPatch(p),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const y={...i.state},w={run_id:y.id,event:`on_${y.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(w,y.type)&&(yield w)}const m=p.ops.filter(y=>y.path.startsWith("/logs/")).map(y=>y.path.split("/")[2]),_=[...new Set(m)];for(const y of _){let w,x={};const k=i.state.logs[y];if(k.end_time===void 0?k.streamed_output.length>0?w="stream":w="start":w="end",w==="start")k.inputs!==void 0&&(x.input=k.inputs);else if(w==="end")k.inputs!==void 0&&(x.input=k.inputs),x.output=k.final_output;else if(w==="stream"){const E=k.streamed_output.length;if(E!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${E} instead. Encountered in: "${k.name}"`);x={chunk:k.streamed_output[0]},k.streamed_output=[]}yield{event:`on_${k.type}_${w}`,name:k.name,run_id:k.id,tags:k.tags,metadata:k.metadata,data:x}}const{state:g}=i;if(g.streamed_output.length>0){const y=g.streamed_output.length;if(y!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${y} instead. Encountered in: "${g.name}"`);const w={chunk:g.streamed_output[0]};g.streamed_output=[];const x={event:`on_${g.type}_stream`,run_id:g.id,tags:o,metadata:l,name:u,data:w};d.includeEvent(x,g.type)&&(yield x)}}const h=i==null?void 0:i.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:u,run_id:h.id,tags:o,metadata:l,data:{output:h.final_output}};d.includeEvent(p,h.type)&&(yield p)}}static isRunnable(e){return o_(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new Ra({bound:this,config:{},configFactories:[i=>({callbacks:[new UA({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return KH(this,e)}}class Ra extends Qe{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=vx(this.config,...e);return vx(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Ie(t),this.kwargs))}async batch(e,t,r){const i=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(Ie(a),this.kwargs))):await this._mergeConfig(Ie(t),this.kwargs);return this.bound.batch(e,i,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Ie(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Ie(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Ie(t),this.kwargs))}streamEvents(e,t,r){const i=this,a=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(Ie(t),i.kwargs),version:t.version},r)};return Rn.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&Qe.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new Ra({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new UA({config:i,onStart:e,onEnd:t,onError:r})]})]})}}class sf extends Qe{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new sf({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,$t(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new sf({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class HH extends Ra{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const i=e>1?`retry:attempt:${e}`:void 0;return $t(t,{callbacks:r==null?void 0:r.getChild(i)})}async _invoke(e,t,r){return Ki(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,i){const a={};try{await Ki(async s=>{const o=e.map((f,h)=>h).filter(f=>a[f.toString()]===void 0||a[f.toString()]instanceof Error),l=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(s,t==null?void 0:t[f],r==null?void 0:r[f])),c=await super.batch(l,u,{...i,returnExceptions:!0});let d;for(let f=0;f<c.length;f+=1){const h=c[f],p=o[f];h instanceof Error&&d===void 0&&(d=h,d.input=l[f]),a[p.toString()]=h}if(d)throw d;return c},{onFailedAttempt:s=>this.onFailedAttempt(s,s.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if((i==null?void 0:i.returnExceptions)!==!0)throw s}return Object.keys(a).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>a[parseInt(s,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class ka extends Qe{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var l;const r=Ie(t),i=await pr(r),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),pt(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let s=e,o;try{const u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1){const f=u[c].invoke(s,$t(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));s=await ea(f,t==null?void 0:t.signal)}if((l=t==null?void 0:t.signal)!=null&&l.aborted)throw new Error("Aborted");o=await this.last.invoke(s,$t(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return await(a==null?void 0:a.handleChainEnd(pt(o,"output"))),o}async batch(e,t,r){var l;const i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map(pr)),s=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),pt(e[c],"input"),i[c].runId,void 0,void 0,void 0,i[c].runName));return delete i[c].runId,d}));let o=e;try{for(let u=0;u<this.steps.length;u+=1){const d=this.steps[u].batch(o,s.map((f,h)=>{const p=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return $t(i[h],{callbacks:p})}),r);o=await ea(d,(l=i[0])==null?void 0:l.signal)}}catch(u){throw await Promise.all(s.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(s.map(u=>u==null?void 0:u.handleChainEnd(pt(o,"output")))),o}async*_streamIterator(e,t){var d;const r=await pr(t),{runId:i,...a}=t??{},s=await(r==null?void 0:r.handleChainStart(this.toJSON(),pt(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*c(){yield e}try{let f=o[0].transform(c(),$t(a,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let h=1;h<o.length;h+=1)f=await o[h].transform(f,$t(a,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`)}));for await(const h of f)if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),yield h,l)if(u===void 0)u=h;else try{u=si(u,h)}catch{u=void 0,l=!1}}catch(f){throw await(s==null?void 0:s.handleChainError(f)),f}await(s==null?void 0:s.handleChainEnd(pt(u,"output")))}getGraph(e){const t=new Yf;let r=null;return this.steps.forEach((i,a)=>{const s=i.getGraph(e);a!==0&&s.trimFirstNode(),a!==this.steps.length-1&&s.trimLastNode(),t.extend(s);const o=s.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,o),r=s.lastNode()}),t}pipe(e){return ka.isRunnableSequence(e)?new ka({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new ka({first:this.first,middle:[...this.middle,this.last],last:Sa(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Qe.isRunnable(e)}static from([e,...t],r){let i={};return typeof r=="string"?i.name=r:r!==void 0&&(i=r),new ka({...i,first:Sa(e),middle:t.slice(0,-1).map(Sa),last:Sa(t[t.length-1])})}}class Du extends Qe{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Sa(r)}static from(e){return new Du({steps:e})}async invoke(e,t){const r=Ie(t),i=await pr(r),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const s={};try{const o=Object.entries(this.steps).map(async([l,u])=>{s[l]=await u.invoke(e,$t(r,{callbacks:a==null?void 0:a.getChild(`map:key:${l}`)}))});await ea(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(s)),s}async*_transform(e,t,r){const i={...this.steps},a=MA(e,Object.keys(i).length),s=new Map(Object.entries(i).map(([o,l],u)=>{const c=l.transform(a[u],$t(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;s.size;){const o=Promise.race(s.values()),{key:l,result:u,gen:c}=await ea(o,r==null?void 0:r.signal);s.delete(l),u.done||(yield{[l]:u.value},s.set(l,c.next().then(d=>({key:l,gen:c,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Ie(t),a=new ko({generator:this.transform(r(),i),config:i});return await a.setup,Rn.fromAsyncGenerator(a)}}class l_ extends Qe{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!a_(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),i=await pr(r),a=this.func($t(r,{callbacks:i}),e);return ea(a,r==null?void 0:r.signal)}async*_streamIterator(e,t){var a,s;const[r]=this._getOptionsList(t??{},1),i=await this.invoke(e,t);if(Ug(i)){for await(const o of i)(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),yield o;return}if(BH(i)){for(;;){(s=r==null?void 0:r.signal)==null||s.throwIfAborted();const o=i.next();if(o.done)break;yield o.value}return}yield i}static from(e){return new l_({func:e})}}function VH(n){if(a_(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class eh extends Qe{static lc_name(){return"RunnableLambda"}constructor(e){if(a_(e.func))return l_.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),VH(e.func),this.func=e.func}static from(e){return new eh({func:e})}async _invoke(e,t,r){return new Promise((i,a)=>{const s=$t(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??Hp)-1});Yi.runWithConfig(so(s),async()=>{var o,l;try{let u=await this.func(e,{...s});if(u&&Qe.isRunnable(u)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");u=await u.invoke(e,{...s,recursionLimit:(s.recursionLimit??Hp)-1})}else if(Ug(u)){let c;for await(const d of zg(s,u))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),c===void 0)c=d;else try{c=si(c,d)}catch{c=d}u=c}else if(Ax(u)){let c;for(const d of Px(s,u))if((l=t==null?void 0:t.signal)==null||l.throwIfAborted(),c===void 0)c=d;else try{c=si(c,d)}catch{c=d}u=c}i(u)}catch(u){a(u)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){var o,l;let i;for await(const u of e)if(i===void 0)i=u;else try{i=si(i,u)}catch{i=u}const a=$t(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??Hp)-1}),s=await new Promise((u,c)=>{Yi.runWithConfig(so(a),async()=>{try{const d=await this.func(i,{...a,config:a});u(d)}catch(d){c(d)}})});if(s&&Qe.isRunnable(s)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const u=await s.stream(i,a);for await(const c of u)yield c}else if(Ug(s))for await(const u of zg(a,s))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield u;else if(Ax(s))for(const u of Px(a,s))(l=r==null?void 0:r.signal)==null||l.throwIfAborted(),yield u;else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Ie(t),a=new ko({generator:this.transform(r(),i),config:i});return await a.setup,Rn.fromAsyncGenerator(a)}}class qH extends Qe{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=Ie(t),i=await pr(r),{runId:a,...s}=r,o=await(i==null?void 0:i.handleChainStart(this.toJSON(),pt(e,"input"),a,void 0,void 0,void 0,s==null?void 0:s.runName)),l=$t(s,{callbacks:o==null?void 0:o.getChild()});return await Yi.runWithConfig(l,async()=>{var d;let c;for(const f of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();try{const h=await f.invoke(e,l);return await(o==null?void 0:o.handleChainEnd(pt(h,"output"))),h}catch(h){c===void 0&&(c=h)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(c)),c)})}async*_streamIterator(e,t){var d;const r=Ie(t),i=await pr(r),{runId:a,...s}=r,o=await(i==null?void 0:i.handleChainStart(this.toJSON(),pt(e,"input"),a,void 0,void 0,void 0,s==null?void 0:s.runName));let l,u;for(const f of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();const h=$t(s,{callbacks:o==null?void 0:o.getChild()});try{const p=await f.stream(e,h);u=zg(h,p);break}catch(p){l===void 0&&(l=p)}}if(u===void 0){const f=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(f)),f}let c;try{for await(const f of u){yield f;try{c=c===void 0?c:si(c,f)}catch{c=void 0}}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(pt(c,"output")))}async batch(e,t,r){var l;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map(u=>pr(u))),s=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),pt(e[c],"input"),i[c].runId,void 0,void 0,void 0,i[c].runName));return delete i[c].runId,d}));let o;for(const u of this.runnables()){(l=i[0].signal)==null||l.throwIfAborted();try{const c=await u.batch(e,s.map((d,f)=>$t(i[f],{callbacks:d==null?void 0:d.getChild()})),r);return await Promise.all(s.map((d,f)=>d==null?void 0:d.handleChainEnd(pt(c[f],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(s.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Sa(n){if(typeof n=="function")return new eh({func:n});if(Qe.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Sa(r);return new Du({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class GH extends Qe{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Du&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const i=this.mapper.getStepsKeys(),[a,s]=MA(e),o=this.mapper.transform(s,$t(r,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const u of a){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!i.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Ie(t),a=new ko({generator:this.transform(r(),i),config:i});return await a.setup,Rn.fromAsyncGenerator(a)}}class WH extends Qe{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Ie(t),a=new ko({generator:this.transform(r(),i),config:i});return await a.setup,Rn.fromAsyncGenerator(a)}}class Tx extends Ra{constructor(e){const t=ka.from([eh.from(async r=>{let i;if(SA(r))try{i=await this.schema.parseAsync(r.args)}catch{throw new AB("Received tool input did not match expected schema",JSON.stringify(r.args))}else i=r;return i}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function KH(n,e){var i;const t=e.name??n.getName(),r=e.description??((i=e.schema)==null?void 0:i.description);return e.schema.constructor===Ta.ZodString?new Tx({name:t,description:r,schema:Ta.object({input:Ta.string()}).transform(a=>a.input),bound:n}):new Tx({name:t,description:r,schema:e.schema,bound:n})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var JH=typeof window=="object"?window:{},me="0123456789abcdef".split(""),ZH=[-2147483648,8388608,32768,128],tr=[24,16,8,0],ct=[];function wr(n){n?(ct[0]=ct[16]=ct[1]=ct[2]=ct[3]=ct[4]=ct[5]=ct[6]=ct[7]=ct[8]=ct[9]=ct[10]=ct[11]=ct[12]=ct[13]=ct[14]=ct[15]=0,this.blocks=ct):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}wr.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===JH.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,i,a=n.length||0,s=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)for(i=this.start;r<a&&i<64;++r)s[i>>2]|=n[r]<<tr[i++&3];else for(i=this.start;r<a&&i<64;++r)t=n.charCodeAt(r),t<128?s[i>>2]|=t<<tr[i++&3]:t<2048?(s[i>>2]|=(192|t>>6)<<tr[i++&3],s[i>>2]|=(128|t&63)<<tr[i++&3]):t<55296||t>=57344?(s[i>>2]|=(224|t>>12)<<tr[i++&3],s[i>>2]|=(128|t>>6&63)<<tr[i++&3],s[i>>2]|=(128|t&63)<<tr[i++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),s[i>>2]|=(240|t>>18)<<tr[i++&3],s[i>>2]|=(128|t>>12&63)<<tr[i++&3],s[i>>2]|=(128|t>>6&63)<<tr[i++&3],s[i>>2]|=(128|t&63)<<tr[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=s[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};wr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=ZH[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};wr.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a,s,o,l=this.blocks;for(s=16;s<80;++s)o=l[s-3]^l[s-8]^l[s-14]^l[s-16],l[s]=o<<1|o>>>31;for(s=0;s<20;s+=5)a=e&t|~e&r,o=n<<5|n>>>27,i=o+a+i+1518500249+l[s]<<0,e=e<<30|e>>>2,a=n&e|~n&t,o=i<<5|i>>>27,r=o+a+r+1518500249+l[s+1]<<0,n=n<<30|n>>>2,a=i&n|~i&e,o=r<<5|r>>>27,t=o+a+t+1518500249+l[s+2]<<0,i=i<<30|i>>>2,a=r&i|~r&n,o=t<<5|t>>>27,e=o+a+e+1518500249+l[s+3]<<0,r=r<<30|r>>>2,a=t&r|~t&i,o=e<<5|e>>>27,n=o+a+n+1518500249+l[s+4]<<0,t=t<<30|t>>>2;for(;s<40;s+=5)a=e^t^r,o=n<<5|n>>>27,i=o+a+i+1859775393+l[s]<<0,e=e<<30|e>>>2,a=n^e^t,o=i<<5|i>>>27,r=o+a+r+1859775393+l[s+1]<<0,n=n<<30|n>>>2,a=i^n^e,o=r<<5|r>>>27,t=o+a+t+1859775393+l[s+2]<<0,i=i<<30|i>>>2,a=r^i^n,o=t<<5|t>>>27,e=o+a+e+1859775393+l[s+3]<<0,r=r<<30|r>>>2,a=t^r^i,o=e<<5|e>>>27,n=o+a+n+1859775393+l[s+4]<<0,t=t<<30|t>>>2;for(;s<60;s+=5)a=e&t|e&r|t&r,o=n<<5|n>>>27,i=o+a+i-1894007588+l[s]<<0,e=e<<30|e>>>2,a=n&e|n&t|e&t,o=i<<5|i>>>27,r=o+a+r-1894007588+l[s+1]<<0,n=n<<30|n>>>2,a=i&n|i&e|n&e,o=r<<5|r>>>27,t=o+a+t-1894007588+l[s+2]<<0,i=i<<30|i>>>2,a=r&i|r&n|i&n,o=t<<5|t>>>27,e=o+a+e-1894007588+l[s+3]<<0,r=r<<30|r>>>2,a=t&r|t&i|r&i,o=e<<5|e>>>27,n=o+a+n-1894007588+l[s+4]<<0,t=t<<30|t>>>2;for(;s<80;s+=5)a=e^t^r,o=n<<5|n>>>27,i=o+a+i-899497514+l[s]<<0,e=e<<30|e>>>2,a=n^e^t,o=i<<5|i>>>27,r=o+a+r-899497514+l[s+1]<<0,n=n<<30|n>>>2,a=i^n^e,o=r<<5|r>>>27,t=o+a+t-899497514+l[s+2]<<0,i=i<<30|i>>>2,a=r^i^n,o=t<<5|t>>>27,e=o+a+e-899497514+l[s+3]<<0,r=r<<30|r>>>2,a=t^r^i,o=e<<5|e>>>27,n=o+a+n-899497514+l[s+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+i<<0};wr.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4;return me[n>>28&15]+me[n>>24&15]+me[n>>20&15]+me[n>>16&15]+me[n>>12&15]+me[n>>8&15]+me[n>>4&15]+me[n&15]+me[e>>28&15]+me[e>>24&15]+me[e>>20&15]+me[e>>16&15]+me[e>>12&15]+me[e>>8&15]+me[e>>4&15]+me[e&15]+me[t>>28&15]+me[t>>24&15]+me[t>>20&15]+me[t>>16&15]+me[t>>12&15]+me[t>>8&15]+me[t>>4&15]+me[t&15]+me[r>>28&15]+me[r>>24&15]+me[r>>20&15]+me[r>>16&15]+me[r>>12&15]+me[r>>8&15]+me[r>>4&15]+me[r&15]+me[i>>28&15]+me[i>>24&15]+me[i>>20&15]+me[i>>16&15]+me[i>>12&15]+me[i>>8&15]+me[i>>4&15]+me[i&15]};wr.prototype.toString=wr.prototype.hex;wr.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,i>>24&255,i>>16&255,i>>8&255,i&255]};wr.prototype.array=wr.prototype.digest;wr.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};const XH=n=>new wr(!0).update(n).hex(),Ix=(...n)=>XH(n.join("_"));class QH{}const YH=new Map;class u_ extends QH{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Ix(e,t))??null)}async update(e,t,r){this.cache.set(Ix(e,t),r)}static global(){return new u_(YH)}}class c_ extends Ba{}class zA extends c_{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new ju(this.value)]}}class BA extends c_{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return AA(this.messages)}toChatMessages(){return this.messages}}class eV extends c_{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new ju({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}const Tc={},tV=new s_({});async function nV(n){return n in Tc||(Tc[n]=tV.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new Mw(e)).catch(e=>{throw delete Tc[n],e})),await Tc[n]}async function rV(n){return nV(UO(n))}const iV=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n,aV=()=>!1;class HA extends Qe{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??aV(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class sV extends HA{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){const{cache:i,...a}=r;super({callbacks:e??t,...a}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof i=="object"?this.cache=i:i?this.cache=u_.global():this.cache=void 0,this.caller=new s_(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await rV("modelName"in this?iV(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new zA(e):Array.isArray(e)?new BA(e.map(Yd)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([s,o])=>o!==void 0).map(([s,o])=>`${s}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class th extends HA{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(arguments.length===1&&typeof e=="object"&&!("saveContext"in e)){const{memory:i,callbackManager:a,...s}=e;super({...s,callbacks:a??s.callbacks}),this.memory=i}else super({verbose:t,callbacks:r}),this.memory=e}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){const r=Ie(t),i=await this._formatValues(e),a=await Bn.configure(r==null?void 0:r.callbacks,this.callbacks,r==null?void 0:r.tags,this.tags,r==null?void 0:r.metadata,this.metadata,{verbose:this.verbose}),s=await(a==null?void 0:a.handleChainStart(this.toJSON(),i,void 0,void 0,void 0,void 0,r==null?void 0:r.runName));let o;try{o=await(i.signal?Promise.race([this._call(i,s,r),new Promise((l,u)=>{var c;(c=i.signal)==null||c.addEventListener("abort",()=>{u(new Error("AbortError"))})})]):this._call(i,s,r))}catch(l){throw await(s==null?void 0:s.handleChainError(l)),l}return this.memory!=null&&await this.memory.saveContext(this._selectMemoryInputs(e),o),await(s==null?void 0:s.handleChainEnd(o)),Object.defineProperty(o,hB,{value:s?{runId:s==null?void 0:s.runId}:void 0,configurable:!0}),o}_validateOutputs(e){const t=this.outputKeys.filter(r=>!(r in e));if(t.length)throw new Error(`Missing output keys: ${t.join(", ")} from chain ${this._chainType()}`)}async prepOutputs(e,t,r=!1){return this._validateOutputs(t),this.memory&&await this.memory.saveContext(e,t),r?t:{...e,...t}}serialize(){throw new Error("Method not implemented.")}async run(e,t){const r=this.inputKeys.filter(l=>{var u;return!((u=this.memory)!=null&&u.memoryKeys.includes(l))});if(!(r.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const a=r.length?{[r[0]]:e}:{},s=await this.call(a,t),o=Object.keys(s);if(o.length===1)return s[o[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){const t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),this.memory!=null){const r=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[i,a]of Object.entries(r))t[i]=a}return t}async call(e,t,r){const i={tags:r,...dH(t)};return this.invoke(e,i)}async apply(e,t){return Promise.all(e.map(async(r,i)=>this.call(r,t==null?void 0:t[i])))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:r}=await xt(async()=>{const{LLMChain:i}=await Promise.resolve().then(()=>MV);return{LLMChain:i}},void 0);return r.deserialize(e)}case"sequential_chain":{const{SequentialChain:r}=await xt(async()=>{const{SequentialChain:i}=await import("./sequential_chain-DuJkVmQT.js");return{SequentialChain:i}},[]);return r.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:r}=await xt(async()=>{const{SimpleSequentialChain:i}=await import("./sequential_chain-DuJkVmQT.js");return{SimpleSequentialChain:i}},[]);return r.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:r}=await xt(async()=>{const{StuffDocumentsChain:i}=await Promise.resolve().then(()=>Gp);return{StuffDocumentsChain:i}},void 0);return r.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:r}=await xt(async()=>{const{MapReduceDocumentsChain:i}=await Promise.resolve().then(()=>Gp);return{MapReduceDocumentsChain:i}},void 0);return r.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:r}=await xt(async()=>{const{RefineDocumentsChain:i}=await Promise.resolve().then(()=>Gp);return{RefineDocumentsChain:i}},void 0);return r.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:r}=await xt(async()=>{const{VectorDBQAChain:i}=await import("./vector_db_qa-BxNEeZx8.js");return{VectorDBQAChain:i}},[]);return r.deserialize(e,t)}case"api_chain":{const{APIChain:r}=await xt(async()=>{const{APIChain:i}=await import("./api_chain-C4NIO4Q3.js");return{APIChain:i}},[]);return r.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class nh extends Qe{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[a,s]of Object.entries(t))typeof s=="string"?r[a]=s:r[a]=await s();return{...r,...e}}async invoke(e,t){const r={...this.metadata,...t==null?void 0:t.metadata},i=[...this.tags??[],...(t==null?void 0:t.tags)??[]];return this._callWithConfig(a=>this.formatPromptValue(a),e,{...t,tags:i,metadata:r,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await xt(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>$x);return{PromptTemplate:r}},void 0);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await xt(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>$x);return{PromptTemplate:r}},void 0);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await xt(async()=>{const{FewShotPromptTemplate:r}=await import("./few_shot-BYTIutgu.js");return{FewShotPromptTemplate:r}},[]);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class Bg extends nh{async formatPromptValue(e){const t=await this.format(e);return new zA(t)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var oV=Object.prototype.toString,So=Array.isArray||function(e){return oV.call(e)==="[object Array]"};function d_(n){return typeof n=="function"}function lV(n){return So(n)?"array":typeof n}function qp(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Cx(n,e){return n!=null&&typeof n=="object"&&e in n}function uV(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var cV=RegExp.prototype.test;function dV(n,e){return cV.call(n,e)}var fV=/\S/;function hV(n){return!dV(fV,n)}var pV={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function mV(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return pV[t]})}var gV=/\s*/,yV=/\s+/,Rx=/\s*=/,wV=/\s*\}/,_V=/#|\^|\/|>|\{|&|=|!/;function bV(n,e){if(!n)return[];var t=!1,r=[],i=[],a=[],s=!1,o=!1,l="",u=0;function c(){if(s&&!o)for(;a.length;)delete i[a.pop()];else a=[];s=!1,o=!1}var d,f,h;function p(R){if(typeof R=="string"&&(R=R.split(yV,2)),!So(R)||R.length!==2)throw new Error("Invalid tags: "+R);d=new RegExp(qp(R[0])+"\\s*"),f=new RegExp("\\s*"+qp(R[1])),h=new RegExp("\\s*"+qp("}"+R[1]))}p(e||mn.tags);for(var m=new Fu(n),_,g,y,w,x,k;!m.eos();){if(_=m.pos,y=m.scanUntil(d),y)for(var E=0,P=y.length;E<P;++E)w=y.charAt(E),hV(w)?(a.push(i.length),l+=w):(o=!0,t=!0,l+=" "),i.push(["text",w,_,_+1]),_+=1,w===`
`&&(c(),l="",u=0,t=!1);if(!m.scan(d))break;if(s=!0,g=m.scan(_V)||"name",m.scan(gV),g==="="?(y=m.scanUntil(Rx),m.scan(Rx),m.scanUntil(f)):g==="{"?(y=m.scanUntil(h),m.scan(wV),m.scanUntil(f),g="&"):y=m.scanUntil(f),!m.scan(f))throw new Error("Unclosed tag at "+m.pos);if(g==">"?x=[g,y,_,m.pos,l,u,t]:x=[g,y,_,m.pos],u++,i.push(x),g==="#"||g==="^")r.push(x);else if(g==="/"){if(k=r.pop(),!k)throw new Error('Unopened section "'+y+'" at '+_);if(k[1]!==y)throw new Error('Unclosed section "'+k[1]+'" at '+_)}else g==="name"||g==="{"||g==="&"?o=!0:g==="="&&p(y)}if(c(),k=r.pop(),k)throw new Error('Unclosed section "'+k[1]+'" at '+m.pos);return xV(vV(i))}function vV(n){for(var e=[],t,r,i=0,a=n.length;i<a;++i)t=n[i],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function xV(n){for(var e=[],t=e,r=[],i,a,s=0,o=n.length;s<o;++s)switch(i=n[s],i[0]){case"#":case"^":t.push(i),r.push(i),t=i[4]=[];break;case"/":a=r.pop(),a[5]=i[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(i)}return e}function Fu(n){this.string=n,this.tail=n,this.pos=0}Fu.prototype.eos=function(){return this.tail===""};Fu.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Fu.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function oo(n,e){this.view=n,this.cache={".":this.view},this.parent=e}oo.prototype.push=function(e){return new oo(e,this)};oo.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var i=this,a,s,o,l=!1;i;){if(e.indexOf(".")>0)for(a=i.view,s=e.split("."),o=0;a!=null&&o<s.length;)o===s.length-1&&(l=Cx(a,s[o])||uV(a,s[o])),a=a[s[o++]];else a=i.view[e],l=Cx(i.view,e);if(l){r=a;break}i=i.parent}t[e]=r}return d_(r)&&(r=r.call(this.view)),r};function Jt(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}Jt.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Jt.prototype.parse=function(e,t){var r=this.templateCache,i=e+":"+(t||mn.tags).join(":"),a=typeof r<"u",s=a?r.get(i):void 0;return s==null&&(s=bV(e,t),a&&r.set(i,s)),s};Jt.prototype.render=function(e,t,r,i){var a=this.getConfigTags(i),s=this.parse(e,a),o=t instanceof oo?t:new oo(t,void 0);return this.renderTokens(s,o,r,e,i)};Jt.prototype.renderTokens=function(e,t,r,i,a){for(var s="",o,l,u,c=0,d=e.length;c<d;++c)u=void 0,o=e[c],l=o[0],l==="#"?u=this.renderSection(o,t,r,i,a):l==="^"?u=this.renderInverted(o,t,r,i,a):l===">"?u=this.renderPartial(o,t,r,a):l==="&"?u=this.unescapedValue(o,t):l==="name"?u=this.escapedValue(o,t,a):l==="text"&&(u=this.rawValue(o)),u!==void 0&&(s+=u);return s};Jt.prototype.renderSection=function(e,t,r,i,a){var s=this,o="",l=t.lookup(e[1]);function u(f){return s.render(f,t,r,a)}if(l){if(So(l))for(var c=0,d=l.length;c<d;++c)o+=this.renderTokens(e[4],t.push(l[c]),r,i,a);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")o+=this.renderTokens(e[4],t.push(l),r,i,a);else if(d_(l)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(t.view,i.slice(e[3],e[5]),u),l!=null&&(o+=l)}else o+=this.renderTokens(e[4],t,r,i,a);return o}};Jt.prototype.renderInverted=function(e,t,r,i,a){var s=t.lookup(e[1]);if(!s||So(s)&&s.length===0)return this.renderTokens(e[4],t,r,i,a)};Jt.prototype.indentPartial=function(e,t,r){for(var i=t.replace(/[^ \t]/g,""),a=e.split(`
`),s=0;s<a.length;s++)a[s].length&&(s>0||!r)&&(a[s]=i+a[s]);return a.join(`
`)};Jt.prototype.renderPartial=function(e,t,r,i){if(r){var a=this.getConfigTags(i),s=d_(r)?r(e[1]):r[e[1]];if(s!=null){var o=e[6],l=e[5],u=e[4],c=s;l==0&&u&&(c=this.indentPartial(s,u,o));var d=this.parse(c,a);return this.renderTokens(d,t,r,c,i)}}};Jt.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};Jt.prototype.escapedValue=function(e,t,r){var i=this.getConfigEscape(r)||mn.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&i===mn.escape?String(a):i(a)};Jt.prototype.rawValue=function(e){return e[1]};Jt.prototype.getConfigTags=function(e){return So(e)?e:e&&typeof e=="object"?e.tags:void 0};Jt.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!So(e))return e.escape};var mn={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){mu.templateCache=n},get templateCache(){return mu.templateCache}},mu=new Jt;mn.clearCache=function(){return mu.clearCache()};mn.parse=function(e,t){return mu.parse(e,t)};mn.render=function(e,t,r,i){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+lV(e)+'" was given as the first argument for mustache#render(template, view, partials)');return mu.render(e,t,r,i)};mn.escape=mV;mn.Scanner=Fu;mn.Context=oo;mn.Writer=Jt;function VA(){mn.escape=n=>n}const of=n=>{const e=n.split(""),t=[],r=(a,s)=>{for(let o=s;o<e.length;o+=1)if(a.includes(e[o]))return o;return-1};let i=0;for(;i<e.length;)if(e[i]==="{"&&i+1<e.length&&e[i+1]==="{")t.push({type:"literal",text:"{"}),i+=2;else if(e[i]==="}"&&i+1<e.length&&e[i+1]==="}")t.push({type:"literal",text:"}"}),i+=2;else if(e[i]==="{"){const a=r("}",i);if(a<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(i+1,a).join("")}),i=a+1}else{if(e[i]==="}")throw new Error("Single '}' in template.");{const a=r("{}",i),s=(a<0?e.slice(i):e.slice(i,a)).join("");t.push({type:"literal",text:s}),i=a<0?e.length:a}}return t},EV=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),Hg=n=>{VA();const e=mn.parse(n);return EV(e)},kV=(n,e)=>of(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e){const i=typeof e[r.name]=="string"?e[r.name]:JSON.stringify(e[r.name]);return t+i}throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),SV=(n,e)=>(VA(),mn.render(n,e)),Vg={"f-string":kV,mustache:SV},OV={"f-string":of,mustache:Hg},Is=(n,e,t)=>{try{return Vg[e](n,t)}catch(r){throw e_(r,"INVALID_PROMPT_INPUT")}},AV=(n,e)=>OV[e](n),qA=(n,e,t)=>{if(!(e in Vg)){const r=Object.keys(Vg);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((i,a)=>(i[a]="foo",i),{});Array.isArray(n)?n.forEach(i=>{if(i.type==="text")Is(i.text,e,r);else if(i.type==="image_url")if(typeof i.image_url=="string")Is(i.image_url,e,r);else{const a=i.image_url.url;Is(a,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(i,null,2)}`)}):Is(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class Pn extends Bg{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),qA(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Is(this.template,this.templateFormat,t)}static fromExamples(e,t,r,i=`

`,a=""){const s=[a,...e,t].join(i);return new Pn({inputVariables:r,template:s})}static fromTemplate(e,t){const{templateFormat:r="f-string",...i}=t??{},a=new Set;return AV(e,r).forEach(s=>{s.type==="variable"&&a.add(s.name)}),new Pn({inputVariables:[...a],templateFormat:r,template:e,...i})}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new Pn(i)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new Pn({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const $x=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:Pn},Symbol.toStringTag,{value:"Module"}));class Ol extends nh{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),qA([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new Ol(i)}async format(e){const t={};for(const[s,o]of Object.entries(this.template))typeof o=="string"?t[s]=Is(o,this.templateFormat,e):t[s]=o;const r=e.url||t.url,i=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");const a={url:r};return i&&(a.detail=i),a}async formatPromptValue(e){const t=await this.format(e);return new eV(t)}}class f_ extends Qe{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}}class Nx extends f_{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){const t=e[this.variableName];if(this.optional&&!t)return[];if(!t){const i=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw i.name="InputFormatError",i}let r;try{Array.isArray(t)?r=t.map(Yd):r=[Yd(t)]}catch(i){const a=typeof t=="string"?t:JSON.stringify(t,null,2),s=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${a}`,`Additional message: ${i.message}`].join(`

`));throw s.name="InputFormatError",s.lc_error_code=i.lc_error_code,s}return r}}class PV extends f_{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class TV extends nh{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new BA(t)}}class IV extends PV{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new Kf(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(Pn.fromTemplate(e,{templateFormat:r==null?void 0:r.templateFormat}),t)}}class h_ extends f_{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(i=>{"inputVariables"in i&&(r=r.concat(i.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){const t=this.constructor;if(t._messageClass()){const r=t._messageClass();return new r({content:e})}else if(t.chatMessageClass){const r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(Pn.fromTemplate(e,t));const r=[];for(const i of e)if(typeof i=="string"||typeof i=="object"&&"text"in i){let a="";typeof i=="string"?a=i:typeof i.text=="string"&&(a=i.text??"");const s={...t,...typeof i!="string"?{additionalContentFields:i}:{}};r.push(Pn.fromTemplate(a,s))}else if(typeof i=="object"&&"image_url"in i){let a=i.image_url??"",s,o=[];if(typeof a=="string"){let l;(t==null?void 0:t.templateFormat)==="mustache"?l=Hg(a):l=of(a);const u=l.flatMap(c=>c.type==="variable"?[c.name]:[]);if(((u==null?void 0:u.length)??0)>0){if(u.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${u}
From: ${a}`);o=[u[0]]}else o=[];a={url:a},s=new Ol({template:a,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:i})}else if(typeof a=="object"){if("url"in a){let l;(t==null?void 0:t.templateFormat)==="mustache"?l=Hg(a.url):l=of(a.url),o=l.flatMap(u=>u.type==="variable"?[u.name]:[])}else o=[];s=new Ol({template:a,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:i})}else throw new Error("Invalid image template");r.push(s)}return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof Bg){const t=await this.prompt.format(e);return this.createMessage(t)}else{const t=[];for(const r of this.prompt){let i={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(const a of r.inputVariables)i||(i={[a]:e[a]}),i={...i,[a]:e[a]};if(r instanceof Bg){const a=await r.format(i);let s;"additionalContentFields"in r&&(s=r.additionalContentFields),t.push({...s,type:"text",text:a})}else if(r instanceof Ol){const a=await r.format(i);let s;"additionalContentFields"in r&&(s=r.additionalContentFields),t.push({...s,type:"image_url",image_url:a})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class p_ extends h_{static _messageClass(){return ju}static lc_name(){return"HumanMessagePromptTemplate"}}class CV extends h_{static _messageClass(){return Rg}static lc_name(){return"AIMessagePromptTemplate"}}class GA extends h_{static _messageClass(){return $g}static lc_name(){return"SystemMessagePromptTemplate"}}function RV(n){return typeof n.formatMessages=="function"}function $V(n,e){if(RV(n)||OA(n))return n;if(Array.isArray(n)&&n[0]==="placeholder"){const i=n[1];if((e==null?void 0:e.templateFormat)==="mustache"&&typeof i=="string"&&i.slice(0,2)==="{{"&&i.slice(-2)==="}}"){const a=i.slice(2,-2);return new Nx({variableName:a,optional:!0})}else if(typeof i=="string"&&i[0]==="{"&&i[i.length-1]==="}"){const a=i.slice(1,-1);return new Nx({variableName:a,optional:!0})}throw new Error(`Invalid placeholder template for format ${(e==null?void 0:e.templateFormat)??'"f-string"'}: "${n[1]}". Expected a variable name surrounded by ${(e==null?void 0:e.templateFormat)==="mustache"?"double":"single"} curly braces.`)}const t=Yd(n);let r;if(typeof t.content=="string"?r=t.content:r=t.content.map(i=>"text"in i?{...i,text:i.text}:"image_url"in i?{...i,image_url:i.image_url}:i),t._getType()==="human")return p_.fromTemplate(r,e);if(t._getType()==="ai")return CV.fromTemplate(r,e);if(t._getType()==="system")return GA.fromTemplate(r,e);if(Kf.isInstance(t))return IV.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function NV(n){return n.constructor.lc_name()==="MessagesPlaceholder"}class Al extends TV{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const o of this.promptMessages)if(!(o instanceof ai))for(const l of o.inputVariables)t.add(l);const r=this.inputVariables,i=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),a=new Set([...i].filter(o=>!t.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);const s=new Set([...t].filter(o=>!i.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;const r=await Promise.all(e.content.map(async i=>{if(i.type!=="image_url")return i;let a="";typeof i.image_url=="string"?a=i.image_url:a=i.image_url.url;const o=await Pn.fromTemplate(a,{templateFormat:this.templateFormat}).format(t);return typeof i.image_url!="string"&&"url"in i.image_url?i.image_url.url=o:i.image_url=o,i}));return e.content=r,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const i of this.promptMessages)if(i instanceof ai)r.push(await this._parseImagePrompts(i,t));else{const a=i.inputVariables.reduce((o,l)=>{if(!(l in t)&&!(NV(i)&&i.optional))throw e_(new Error(`Missing value for input variable \`${l.toString()}\``),"INVALID_PROMPT_INPUT");return o[l]=t[l],o},{}),s=await i.formatMessages(a);r=r.concat(s)}return r}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new Al(i)}static fromTemplate(e,t){const r=Pn.fromTemplate(e,t),i=new p_({prompt:r});return this.fromMessages([i])}static fromMessages(e,t){const r=e.reduce((s,o)=>s.concat(o instanceof Al?o.promptMessages:[$V(o,t)]),[]),i=e.reduce((s,o)=>o instanceof Al?Object.assign(s,o.partialVariables):s,Object.create(null)),a=new Set;for(const s of r)if(!(s instanceof ai))for(const o of s.inputVariables)o in i||a.add(o);return new this({...t,inputVariables:[...a],promptMessages:r,partialVariables:i,templateFormat:t==null?void 0:t.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}class jV extends Qe{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,i)=>this.parseResult([{text:r}],i==null?void 0:i.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,i)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],i==null?void 0:i.callbacks),e,{...t,runType:"parser"})}}class LV extends jV{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class DV extends LV{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}function FV(n){return typeof n._llmType=="function"}function rd(n){if(FV(n))return n;if("bound"in n&&Qe.isRunnable(n.bound))return rd(n.bound);if("runnable"in n&&"fallbacks"in n&&Qe.isRunnable(n.runnable))return rd(n.runnable);if("default"in n&&Qe.isRunnable(n.default))return rd(n.default);throw new Error("Unable to extract BaseLanguageModel from llmLike object.")}class ta extends th{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new DV,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}getCallKeys(){return"callKeys"in this.llm?this.llm.callKeys:[]}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e),r=this.getCallKeys();for(const i of r)i in e&&delete t[i];return t}async _getFinalOutput(e,t,r){let i;return this.outputParser?i=await this.outputParser.parseResultWithPrompt(e,t,r==null?void 0:r.getChild()):i=e[0].text,i}call(e,t){return super.call(e,t)}async _call(e,t){const r={...e},i={...this.llmKwargs},a=this.getCallKeys();for(const u of a)u in e&&i&&(i[u]=e[u],delete r[u]);const s=await this.prompt.formatPromptValue(r);if("generatePrompt"in this.llm){const{generations:u}=await this.llm.generatePrompt([s],i,t==null?void 0:t.getChild());return{[this.outputKey]:await this._getFinalOutput(u[0],s,t)}}const l=await(this.outputParser?this.llm.pipe(this.outputParser):this.llm).invoke(s,t==null?void 0:t.getChild());return{[this.outputKey]:l}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:r}=e;if(!t)throw new Error("LLMChain must have llm");if(!r)throw new Error("LLMChain must have prompt");return new ta({llm:await sV.deserialize(t),prompt:await nh.deserialize(r)})}serialize(){const e="serialize"in this.llm?this.llm.serialize():void 0;return{_type:`${this._chainType()}_chain`,llm:e,prompt:this.prompt.serialize()}}_getNumTokens(e){return rd(this.llm).getNumTokens(e)}}const MV=Object.freeze(Object.defineProperty({__proto__:null,LLMChain:ta},Symbol.toStringTag,{value:"Module"}));class Mu extends th{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...r}=e,a=t.map(({pageContent:s})=>s).join(`

`);return{...r,[this.documentVariableName]:a}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t==null?void 0:t.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new Mu({llmChain:await ta.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class m_ extends th{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...i}=e;let a=r,s=[];for(let u=0;u<this.maxIterations;u+=1){const c=a.map(p=>({[this.documentVariableName]:p.pageContent,...i}));if(u!==0||!this.ensureMapStep){const p=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:a,...i}));if(await this.combineDocumentChain.llmChain._getNumTokens(p)<this.maxTokens)break}const f=await this.llmChain.apply(c,t?Array.from({length:c.length},(p,m)=>t.getChild(`map_${m+1}`)):void 0),{outputKey:h}=this.llmChain;this.returnIntermediateSteps&&(s=s.concat(f.map(p=>p[h]))),a=f.map(p=>({pageContent:p[h],metadata:{}}))}const o={[this.combineDocumentChain.inputKey]:a,...i},l=await this.combineDocumentChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnIntermediateSteps?{...l,intermediateSteps:s}:l}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new m_({llmChain:await ta.deserialize(e.llm_chain),combineDocumentChain:await Mu.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class g_ extends th{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new Pn({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const r={page_content:e.pageContent,...e.metadata},i={};return this.documentPrompt.inputVariables.forEach(o=>{i[o]=r[o]}),{...{[this.documentVariableName]:await this.documentPrompt.format({...i})},...t}}async _constructRefineInputs(e,t){const r={page_content:e.pageContent,...e.metadata},i={};this.documentPrompt.inputVariables.forEach(o=>{i[o]=r[o]});const a={[this.documentVariableName]:await this.documentPrompt.format({...i})};return{[this.initialResponseName]:t,...a}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...i}=e,a=r,s=await this._constructInitialInputs(a[0],i);let o=await this.llmChain.predict({...s},t==null?void 0:t.getChild("answer"));for(let l=1;l<a.length;l+=1){const c={...await this._constructRefineInputs(a[l],o),...i};o=await this.refineLLMChain.predict({...c},t==null?void 0:t.getChild("refine"))}return{[this.outputKey]:o}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const r=e.refine_llm_chain;if(!r)throw new Error("Missing refine_llm_chain");return new g_({llmChain:await ta.deserialize(t),refineLLMChain:await ta.deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}const Gp=Object.freeze(Object.defineProperty({__proto__:null,MapReduceDocumentsChain:m_,RefineDocumentsChain:g_,StuffDocumentsChain:Mu},Symbol.toStringTag,{value:"Module"}));class UV{async getPromptAsync(e,t){return this.getPrompt(e).partial((t==null?void 0:t.partialVariables)??{})}}class zV extends UV{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}function BV(n){return n._modelType()==="base_chat_model"}class HV{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent!==void 0?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}}const VV=new Pn({template:`Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.

{context}

Question: {question}
Helpful Answer:`,inputVariables:["context","question"]}),qV=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,GV=[GA.fromTemplate(qV),p_.fromTemplate("{question}")],WV=Al.fromMessages(GV),KV=new zV(VV,[[BV,WV]]);function JV(n,e={}){const{prompt:t=KV.getPrompt(n),verbose:r}=e,i=new ta({prompt:t,llm:n,verbose:r});return new Mu({llmChain:i,verbose:r})}/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function WA(n){return typeof n>"u"||n===null}function ZV(n){return typeof n=="object"&&n!==null}function XV(n){return Array.isArray(n)?n:WA(n)?[]:[n]}function QV(n,e){var t,r,i,a;if(e)for(a=Object.keys(e),t=0,r=a.length;t<r;t+=1)i=a[t],n[i]=e[i];return n}function YV(n,e){var t="",r;for(r=0;r<e;r+=1)t+=n;return t}function e5(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}var t5=WA,n5=ZV,r5=XV,i5=YV,a5=e5,s5=QV,y_={isNothing:t5,isObject:n5,toArray:r5,repeat:i5,isNegativeZero:a5,extend:s5};function KA(n,e){var t="",r=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),r+" "+t):r}function gu(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=KA(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}gu.prototype=Object.create(Error.prototype);gu.prototype.constructor=gu;gu.prototype.toString=function(e){return this.name+": "+KA(this,e)};var ya=gu,o5=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],l5=["scalar","sequence","mapping"];function u5(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){e[String(r)]=t})}),e}function c5(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(o5.indexOf(t)===-1)throw new ya('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=u5(e.styleAliases||null),l5.indexOf(this.kind)===-1)throw new ya('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}var Nt=c5;function jx(n,e){var t=[];return n[e].forEach(function(r){var i=t.length;t.forEach(function(a,s){a.tag===r.tag&&a.kind===r.kind&&a.multi===r.multi&&(i=s)}),t[i]=r}),t}function d5(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function r(i){i.multi?(n.multi[i.kind].push(i),n.multi.fallback.push(i)):n[i.kind][i.tag]=n.fallback[i.tag]=i}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}function qg(n){return this.extend(n)}qg.prototype.extend=function(e){var t=[],r=[];if(e instanceof Nt)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new ya("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(a){if(!(a instanceof Nt))throw new ya("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(a.loadKind&&a.loadKind!=="scalar")throw new ya("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(a.multi)throw new ya("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(a){if(!(a instanceof Nt))throw new ya("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(qg.prototype);return i.implicit=(this.implicit||[]).concat(t),i.explicit=(this.explicit||[]).concat(r),i.compiledImplicit=jx(i,"implicit"),i.compiledExplicit=jx(i,"explicit"),i.compiledTypeMap=d5(i.compiledImplicit,i.compiledExplicit),i};var f5=qg,h5=new Nt("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return n!==null?n:""}}),p5=new Nt("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return n!==null?n:[]}}),m5=new Nt("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return n!==null?n:{}}}),g5=new f5({explicit:[h5,p5,m5]});function y5(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}function w5(){return null}function _5(n){return n===null}var b5=new Nt("tag:yaml.org,2002:null",{kind:"scalar",resolve:y5,construct:w5,predicate:_5,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function v5(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}function x5(n){return n==="true"||n==="True"||n==="TRUE"}function E5(n){return Object.prototype.toString.call(n)==="[object Boolean]"}var k5=new Nt("tag:yaml.org,2002:bool",{kind:"scalar",resolve:v5,construct:x5,predicate:E5,represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"});function S5(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}function O5(n){return 48<=n&&n<=55}function A5(n){return 48<=n&&n<=57}function P5(n){if(n===null)return!1;var e=n.length,t=0,r=!1,i;if(!e)return!1;if(i=n[t],(i==="-"||i==="+")&&(i=n[++t]),i==="0"){if(t+1===e)return!0;if(i=n[++t],i==="b"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(i!=="0"&&i!=="1")return!1;r=!0}return r&&i!=="_"}if(i==="x"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(!S5(n.charCodeAt(t)))return!1;r=!0}return r&&i!=="_"}if(i==="o"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(!O5(n.charCodeAt(t)))return!1;r=!0}return r&&i!=="_"}}if(i==="_")return!1;for(;t<e;t++)if(i=n[t],i!=="_"){if(!A5(n.charCodeAt(t)))return!1;r=!0}return!(!r||i==="_")}function T5(n){var e=n,t=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}function I5(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!y_.isNegativeZero(n)}var C5=new Nt("tag:yaml.org,2002:int",{kind:"scalar",resolve:P5,construct:T5,predicate:I5,represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),R5=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function $5(n){return!(n===null||!R5.test(n)||n[n.length-1]==="_")}function N5(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}var j5=/^[-+]?[0-9]+e/;function L5(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(y_.isNegativeZero(n))return"-0.0";return t=n.toString(10),j5.test(t)?t.replace("e",".e"):t}function D5(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||y_.isNegativeZero(n))}var F5=new Nt("tag:yaml.org,2002:float",{kind:"scalar",resolve:$5,construct:N5,predicate:D5,represent:L5,defaultStyle:"lowercase"}),M5=g5.extend({implicit:[b5,k5,C5,F5]}),U5=M5,JA=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),ZA=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function z5(n){return n===null?!1:JA.exec(n)!==null||ZA.exec(n)!==null}function B5(n){var e,t,r,i,a,s,o,l=0,u=null,c,d,f;if(e=JA.exec(n),e===null&&(e=ZA.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],r=+e[2]-1,i=+e[3],!e[4])return new Date(Date.UTC(t,r,i));if(a=+e[4],s=+e[5],o=+e[6],e[7]){for(l=e[7].slice(0,3);l.length<3;)l+="0";l=+l}return e[9]&&(c=+e[10],d=+(e[11]||0),u=(c*60+d)*6e4,e[9]==="-"&&(u=-u)),f=new Date(Date.UTC(t,r,i,a,s,o,l)),u&&f.setTime(f.getTime()-u),f}function H5(n){return n.toISOString()}var V5=new Nt("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:z5,construct:B5,instanceOf:Date,represent:H5});function q5(n){return n==="<<"||n===null}var G5=new Nt("tag:yaml.org,2002:merge",{kind:"scalar",resolve:q5}),w_=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function W5(n){if(n===null)return!1;var e,t,r=0,i=n.length,a=w_;for(t=0;t<i;t++)if(e=a.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}function K5(n){var e,t,r=n.replace(/[\r\n=]/g,""),i=r.length,a=w_,s=0,o=[];for(e=0;e<i;e++)e%4===0&&e&&(o.push(s>>16&255),o.push(s>>8&255),o.push(s&255)),s=s<<6|a.indexOf(r.charAt(e));return t=i%4*6,t===0?(o.push(s>>16&255),o.push(s>>8&255),o.push(s&255)):t===18?(o.push(s>>10&255),o.push(s>>2&255)):t===12&&o.push(s>>4&255),new Uint8Array(o)}function J5(n){var e="",t=0,r,i,a=n.length,s=w_;for(r=0;r<a;r++)r%3===0&&r&&(e+=s[t>>18&63],e+=s[t>>12&63],e+=s[t>>6&63],e+=s[t&63]),t=(t<<8)+n[r];return i=a%3,i===0?(e+=s[t>>18&63],e+=s[t>>12&63],e+=s[t>>6&63],e+=s[t&63]):i===2?(e+=s[t>>10&63],e+=s[t>>4&63],e+=s[t<<2&63],e+=s[64]):i===1&&(e+=s[t>>2&63],e+=s[t<<4&63],e+=s[64],e+=s[64]),e}function Z5(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}var X5=new Nt("tag:yaml.org,2002:binary",{kind:"scalar",resolve:W5,construct:K5,predicate:Z5,represent:J5}),Q5=Object.prototype.hasOwnProperty,Y5=Object.prototype.toString;function e6(n){if(n===null)return!0;var e=[],t,r,i,a,s,o=n;for(t=0,r=o.length;t<r;t+=1){if(i=o[t],s=!1,Y5.call(i)!=="[object Object]")return!1;for(a in i)if(Q5.call(i,a))if(!s)s=!0;else return!1;if(!s)return!1;if(e.indexOf(a)===-1)e.push(a);else return!1}return!0}function t6(n){return n!==null?n:[]}var n6=new Nt("tag:yaml.org,2002:omap",{kind:"sequence",resolve:e6,construct:t6}),r6=Object.prototype.toString;function i6(n){if(n===null)return!0;var e,t,r,i,a,s=n;for(a=new Array(s.length),e=0,t=s.length;e<t;e+=1){if(r=s[e],r6.call(r)!=="[object Object]"||(i=Object.keys(r),i.length!==1))return!1;a[e]=[i[0],r[i[0]]]}return!0}function a6(n){if(n===null)return[];var e,t,r,i,a,s=n;for(a=new Array(s.length),e=0,t=s.length;e<t;e+=1)r=s[e],i=Object.keys(r),a[e]=[i[0],r[i[0]]];return a}var s6=new Nt("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:i6,construct:a6}),o6=Object.prototype.hasOwnProperty;function l6(n){if(n===null)return!0;var e,t=n;for(e in t)if(o6.call(t,e)&&t[e]!==null)return!1;return!0}function u6(n){return n!==null?n:{}}var c6=new Nt("tag:yaml.org,2002:set",{kind:"mapping",resolve:l6,construct:u6});U5.extend({implicit:[V5,G5],explicit:[X5,n6,s6,c6]});function Lx(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"":n===95?" ":n===76?"\u2028":n===80?"\u2029":""}var d6=new Array(256),f6=new Array(256);for(var rs=0;rs<256;rs++)d6[rs]=Lx(rs)?1:0,f6[rs]=Lx(rs);const h6=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>Oo);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class __ extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class p6 extends __{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class m6 extends __{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class g6 extends __{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Gg;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Gg||(Gg={}));var y6=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})};class w6{constructor(e,{headers:t={},customFetch:r,region:i=Gg.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=h6(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return y6(this,void 0,void 0,function*(){try{const{headers:i,method:a,body:s}=t;let o={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(o["x-region"]=l);let u;s&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&s instanceof Blob||s instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=s):typeof s=="string"?(o["Content-Type"]="text/plain",u=s):typeof FormData<"u"&&s instanceof FormData?u=s:(o["Content-Type"]="application/json",u=JSON.stringify(s)));const c=yield this.fetch(`${this.url}/${e}`,{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:u}).catch(p=>{throw new p6(p)}),d=c.headers.get("x-relay-error");if(d&&d==="true")throw new m6(c);if(!c.ok)throw new g6(c);let f=((r=c.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),h;return f==="application/json"?h=yield c.json():f==="application/octet-stream"?h=yield c.blob():f==="text/event-stream"?h=c:f==="multipart/form-data"?h=yield c.formData():h=yield c.text(),{data:h,error:null}}catch(i){return{data:null,error:i}}})}}var rn={},b_={},rh={},Uu={},ih={},ah={},_6=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},lo=_6();const b6=lo.fetch,XA=lo.fetch.bind(lo),QA=lo.Headers,v6=lo.Request,x6=lo.Response,Oo=Object.freeze(Object.defineProperty({__proto__:null,Headers:QA,Request:v6,Response:x6,default:XA,fetch:b6},Symbol.toStringTag,{value:"Module"})),E6=OP(Oo);var sh={};Object.defineProperty(sh,"__esModule",{value:!0});let k6=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};sh.default=k6;var YA=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ah,"__esModule",{value:!0});const S6=YA(E6),O6=YA(sh);let A6=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=S6.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var s,o,l;let u=null,c=null,d=null,f=a.status,h=a.statusText;if(a.ok){if(this.method!=="HEAD"){const g=await a.text();g===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=g:c=JSON.parse(g))}const m=(s=this.headers.Prefer)===null||s===void 0?void 0:s.match(/count=(exact|planned|estimated)/),_=(o=a.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");m&&_&&_.length>1&&(d=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(c)&&(c.length>1?(u={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,d=null,f=406,h="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{const m=await a.text();try{u=JSON.parse(m),Array.isArray(u)&&a.status===404&&(c=[],u=null,f=200,h="OK")}catch{a.status===404&&m===""?(f=204,h="No Content"):u={message:m}}if(u&&this.isMaybeSingle&&(!((l=u==null?void 0:u.details)===null||l===void 0)&&l.includes("0 rows"))&&(u=null,f=200,h="OK"),u&&this.shouldThrowOnError)throw new O6.default(u)}return{error:u,data:c,count:d,status:f,statusText:h}});return this.shouldThrowOnError||(i=i.catch(a=>{var s,o,l;return{error:{message:`${(s=a==null?void 0:a.name)!==null&&s!==void 0?s:"FetchError"}: ${a==null?void 0:a.message}`,details:`${(o=a==null?void 0:a.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=a==null?void 0:a.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}};ah.default=A6;var P6=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ih,"__esModule",{value:!0});const T6=P6(ah);let I6=class extends T6.default{select(e){let t=!1;const r=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:i,referencedTable:a=i}={}){const s=a?`${a}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:i=r}={}){const a=typeof i>"u"?"offset":`${i}.offset`,s=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(s,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:i=!1,wal:a=!1,format:s="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,i?"buffers":null,a?"wal":null].filter(Boolean).join("|"),u=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${u}"; options=${l};`,s==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};ih.default=I6;var C6=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Uu,"__esModule",{value:!0});const R6=C6(ih);let $6=class extends R6.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:i}={}){let a="";i==="plain"?a="pl":i==="phrase"?a="ph":i==="websearch"&&(a="w");const s=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${a}fts${s}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const i=r?`${r}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Uu.default=$6;var N6=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(rh,"__esModule",{value:!0});const Ho=N6(Uu);let j6=class{constructor(e,{headers:t={},schema:r,fetch:i}){this.url=e,this.headers=t,this.schema=r,this.fetch=i}select(e,{head:t=!1,count:r}={}){const i=t?"HEAD":"GET";let a=!1;const s=(e??"*").split("").map(o=>/\s/.test(o)&&!a?"":(o==='"'&&(a=!a),o)).join("");return this.url.searchParams.set("select",s),r&&(this.headers.Prefer=`count=${r}`),new Ho.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const i="POST",a=[];if(this.headers.Prefer&&a.push(this.headers.Prefer),t&&a.push(`count=${t}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const s=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(s.length>0){const o=[...new Set(s)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new Ho.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:i,defaultToNull:a=!0}={}){const s="POST",o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),a||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const l=e.reduce((u,c)=>u.concat(Object.keys(c)),[]);if(l.length>0){const u=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",u.join(","))}}return new Ho.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new Ho.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Ho.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};rh.default=j6;var oh={},lh={};Object.defineProperty(lh,"__esModule",{value:!0});lh.version=void 0;lh.version="0.0.0-automated";Object.defineProperty(oh,"__esModule",{value:!0});oh.DEFAULT_HEADERS=void 0;const L6=lh;oh.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${L6.version}`};var eP=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(b_,"__esModule",{value:!0});const D6=eP(rh),F6=eP(Uu),M6=oh;let U6=class tP{constructor(e,{headers:t={},schema:r,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},M6.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new D6.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new tP(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:i=!1,count:a}={}){let s;const o=new URL(`${this.url}/rpc/${e}`);let l;r||i?(s=r?"HEAD":"GET",Object.entries(t).filter(([c,d])=>d!==void 0).map(([c,d])=>[c,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([c,d])=>{o.searchParams.append(c,d)})):(s="POST",l=t);const u=Object.assign({},this.headers);return a&&(u.Prefer=`count=${a}`),new F6.default({method:s,url:o,headers:u,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};b_.default=U6;var Ao=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(rn,"__esModule",{value:!0});rn.PostgrestError=rn.PostgrestBuilder=rn.PostgrestTransformBuilder=rn.PostgrestFilterBuilder=rn.PostgrestQueryBuilder=rn.PostgrestClient=void 0;const nP=Ao(b_);rn.PostgrestClient=nP.default;const rP=Ao(rh);rn.PostgrestQueryBuilder=rP.default;const iP=Ao(Uu);rn.PostgrestFilterBuilder=iP.default;const aP=Ao(ih);rn.PostgrestTransformBuilder=aP.default;const sP=Ao(ah);rn.PostgrestBuilder=sP.default;const oP=Ao(sh);rn.PostgrestError=oP.default;var z6=rn.default={PostgrestClient:nP.default,PostgrestQueryBuilder:rP.default,PostgrestFilterBuilder:iP.default,PostgrestTransformBuilder:aP.default,PostgrestBuilder:sP.default,PostgrestError:oP.default};const{PostgrestClient:B6,PostgrestQueryBuilder:RG,PostgrestFilterBuilder:$G,PostgrestTransformBuilder:NG,PostgrestBuilder:jG,PostgrestError:LG}=z6,H6="2.11.2",V6={"X-Client-Info":`realtime-js/${H6}`},q6="1.0.0",lP=1e4,G6=1e3;var qs;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(qs||(qs={}));var En;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(En||(En={}));var sr;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(sr||(sr={}));var Wg;(function(n){n.websocket="websocket"})(Wg||(Wg={}));var wa;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(wa||(wa={}));class W6{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),a=t.getUint8(2);let s=this.HEADER_LENGTH+2;const o=r.decode(e.slice(s,s+i));s=s+i;const l=r.decode(e.slice(s,s+a));s=s+a;const u=JSON.parse(r.decode(e.slice(s,e.byteLength)));return{ref:null,topic:o,event:l,payload:u}}}class uP{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var je;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(je||(je={}));const Dx=(n,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((a,s)=>(a[s]=K6(s,n,e,i),a),{})},K6=(n,e,t,r)=>{const i=e.find(o=>o.name===n),a=i==null?void 0:i.type,s=t[n];return a&&!r.includes(a)?cP(a,s):Kg(s)},cP=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Q6(e,t)}switch(n){case je.bool:return J6(e);case je.float4:case je.float8:case je.int2:case je.int4:case je.int8:case je.numeric:case je.oid:return Z6(e);case je.json:case je.jsonb:return X6(e);case je.timestamp:return Y6(e);case je.abstime:case je.date:case je.daterange:case je.int4range:case je.int8range:case je.money:case je.reltime:case je.text:case je.time:case je.timestamptz:case je.timetz:case je.tsrange:case je.tstzrange:return Kg(e);default:return Kg(e)}},Kg=n=>n,J6=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Z6=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},X6=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Q6=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let a;const s=n.slice(1,t);try{a=JSON.parse("["+s+"]")}catch{a=s?s.split(","):[]}return a.map(o=>cP(e,o))}return n},Y6=n=>typeof n=="string"?n.replace(" ","T"):n,dP=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Wp{constructor(e,t,r={},i=lP){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Fx;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Fx||(Fx={}));class Pl{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:a,onLeave:s,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Pl.syncState(this.state,i,a,s),this.pendingDiffs.forEach(l=>{this.state=Pl.syncDiff(this.state,l,a,s)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},i=>{const{onJoin:a,onLeave:s,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Pl.syncDiff(this.state,i,a,s),o())}),this.onJoin((i,a,s)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:a,newPresences:s})}),this.onLeave((i,a,s)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:a,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const a=this.cloneDeep(e),s=this.transformState(t),o={},l={};return this.map(a,(u,c)=>{s[u]||(l[u]=c)}),this.map(s,(u,c)=>{const d=a[u];if(d){const f=c.map(_=>_.presence_ref),h=d.map(_=>_.presence_ref),p=c.filter(_=>h.indexOf(_.presence_ref)<0),m=d.filter(_=>f.indexOf(_.presence_ref)<0);p.length>0&&(o[u]=p),m.length>0&&(l[u]=m)}else o[u]=c}),this.syncDiff(a,{joins:o,leaves:l},r,i)}static syncDiff(e,t,r,i){const{joins:a,leaves:s}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(a,(o,l)=>{var u;const c=(u=e[o])!==null&&u!==void 0?u:[];if(e[o]=this.cloneDeep(l),c.length>0){const d=e[o].map(h=>h.presence_ref),f=c.filter(h=>d.indexOf(h.presence_ref)<0);e[o].unshift(...f)}r(o,c,l)}),this.map(s,(o,l)=>{let u=e[o];if(!u)return;const c=l.map(d=>d.presence_ref);u=u.filter(d=>c.indexOf(d.presence_ref)<0),e[o]=u,i(o,u,l),u.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Mx;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Mx||(Mx={}));var Ux;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ux||(Ux={}));var Yr;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Yr||(Yr={}));class v_{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=En.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Wp(this,sr.join,this.params,this.timeout),this.rejoinTimer=new uP(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=En.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=En.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=En.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=En.errored,this.rejoinTimer.scheduleTimeout())}),this._on(sr.reply,{},(i,a)=>{this._trigger(this._replyEventName(a),i)}),this.presence=new Pl(this),this.broadcastEndpointURL=dP(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:a,presence:s,private:o}}=this.params;this._onError(c=>e==null?void 0:e(Yr.CHANNEL_ERROR,c)),this._onClose(()=>e==null?void 0:e(Yr.CLOSED));const l={},u={broadcast:a,presence:s,postgres_changes:(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(c=>c.filter))!==null&&i!==void 0?i:[],private:o};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:c})=>{var d;if(this.socket.setAuth(),c===void 0){e==null||e(Yr.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,h=(d=f==null?void 0:f.length)!==null&&d!==void 0?d:0,p=[];for(let m=0;m<h;m++){const _=f[m],{filter:{event:g,schema:y,table:w,filter:x}}=_,k=c&&c[m];if(k&&k.event===g&&k.schema===y&&k.table===w&&k.filter===x)p.push(Object.assign(Object.assign({},_),{id:k.id}));else{this.unsubscribe(),e==null||e(Yr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(Yr.SUBSCRIBED);return}}).receive("error",c=>{e==null||e(Yr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Yr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){const{event:a,payload:s}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:s,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=u.body)===null||i===void 0?void 0:i.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var s,o,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(s=this.params)===null||s===void 0?void 0:s.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&a("ok"),u.receive("ok",()=>a("ok")),u.receive("error",()=>a("error")),u.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=En.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(sr.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const i=new Wp(this,sr.leave,{},e);i.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const i=new AbortController,a=setTimeout(()=>i.abort(),r),s=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(a),s}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Wp(this,e,t,r);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,a;const s=e.toLocaleLowerCase(),{close:o,error:l,leave:u,join:c}=sr;if(r&&[o,l,u,c].indexOf(s)>=0&&r!==this._joinRef())return;let f=this._onMessage(s,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(h=>{var p,m,_;return((p=h.filter)===null||p===void 0?void 0:p.event)==="*"||((_=(m=h.filter)===null||m===void 0?void 0:m.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===s}).map(h=>h.callback(f,r)):(a=this.bindings[s])===null||a===void 0||a.filter(h=>{var p,m,_,g,y,w;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in h){const x=h.id,k=(p=h.filter)===null||p===void 0?void 0:p.event;return x&&((m=t.ids)===null||m===void 0?void 0:m.includes(x))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const x=(y=(g=h==null?void 0:h.filter)===null||g===void 0?void 0:g.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return x==="*"||x===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===s}).map(h=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:m,table:_,commit_timestamp:g,type:y,errors:w}=p;f=Object.assign(Object.assign({},{schema:m,table:_,commit_timestamp:g,eventType:y,new:{},old:{},errors:w}),this._getPayloadRecords(p))}h.callback(f,r)})}_isClosed(){return this.state===En.closed}_isJoined(){return this.state===En.joined}_isJoining(){return this.state===En.joining}_isLeaving(){return this.state===En.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),a={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(a):this.bindings[i]=[a],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(i=>{var a;return!(((a=i.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===r&&v_.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(sr.close,{},e)}_onError(e){this._on(sr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=En.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Dx(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Dx(e.columns,e.old_record)),t}}const e8=()=>{},t8=typeof WebSocket<"u",n8=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class r8{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=V6,this.params={},this.timeout=lP,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=e8,this.conn=null,this.sendBuffer=[],this.serializer=new W6,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=a=>{let s;return a?s=a:typeof fetch>"u"?s=(...o)=>xt(async()=>{const{default:l}=await Promise.resolve().then(()=>Oo);return{default:l}},void 0).then(({default:l})=>l(...o)):s=fetch,(...o)=>s(...o)},this.endPoint=`${e}/${Wg.websocket}`,this.httpEndpoint=dP(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:a=>[1e3,2e3,5e3,1e4][a-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(a,s)=>s(JSON.stringify(a)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new uP(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(t8){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new i8(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),xt(async()=>{const{default:e}=await import("./browser-BYcslUOy.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:q6}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case qs.connecting:return wa.Connecting;case qs.open:return wa.Open;case qs.closing:return wa.Closing;default:return wa.Closed}}isConnected(){return this.connectionState()===wa.Open}channel(e,t={config:{}}){const r=new v_(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:i,ref:a}=e,s=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${r} (${a})`,i),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(i=>{t&&i.updateJoinPayload({access_token:t}),i.joinedOnce&&i._isJoined()&&i._push(sr.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(G6,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:i,payload:a,ref:s}=t;s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${a.status||""} ${r} ${i} ${s&&"("+s+")"||""}`,a),this.channels.filter(o=>o._isMember(r)).forEach(o=>o._trigger(i,a,s)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(sr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([n8],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class i8{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=qs.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class x_ extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ft(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class a8 extends x_{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Jg extends x_{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var s8=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})};const fP=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>Oo);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},o8=()=>s8(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield xt(()=>Promise.resolve().then(()=>Oo),void 0)).Response:Response}),Zg=n=>{if(Array.isArray(n))return n.map(t=>Zg(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[i]=Zg(r)}),e};var Ka=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})};const Kp=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),l8=(n,e,t)=>Ka(void 0,void 0,void 0,function*(){const r=yield o8();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(i=>{e(new a8(Kp(i),n.status||500))}).catch(i=>{e(new Jg(Kp(i),i))}):e(new Jg(Kp(n),n))}),u8=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(i.body=JSON.stringify(r)),Object.assign(Object.assign({},i),t))};function zu(n,e,t,r,i,a){return Ka(this,void 0,void 0,function*(){return new Promise((s,o)=>{n(t,u8(e,r,i,a)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>s(l)).catch(l=>l8(l,o,r))})})}function lf(n,e,t,r){return Ka(this,void 0,void 0,function*(){return zu(n,"GET",e,t,r)})}function Ti(n,e,t,r,i){return Ka(this,void 0,void 0,function*(){return zu(n,"POST",e,r,i,t)})}function c8(n,e,t,r,i){return Ka(this,void 0,void 0,function*(){return zu(n,"PUT",e,r,i,t)})}function d8(n,e,t,r){return Ka(this,void 0,void 0,function*(){return zu(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function hP(n,e,t,r,i){return Ka(this,void 0,void 0,function*(){return zu(n,"DELETE",e,r,i,t)})}var Yt=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})};const f8={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},zx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class h8{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=fP(i)}uploadOrUpdate(e,t,r,i){return Yt(this,void 0,void 0,function*(){try{let a;const s=Object.assign(Object.assign({},zx),i);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(s.upsert)});const l=s.metadata;typeof Blob<"u"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",s.cacheControl),l&&a.append("metadata",this.encodeMetadata(l)),a.append("",r)):typeof FormData<"u"&&r instanceof FormData?(a=r,a.append("cacheControl",s.cacheControl),l&&a.append("metadata",this.encodeMetadata(l))):(a=r,o["cache-control"]=`max-age=${s.cacheControl}`,o["content-type"]=s.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),i!=null&&i.headers&&(o=Object.assign(Object.assign({},o),i.headers));const u=this._removeEmptyFolders(t),c=this._getFinalPath(u),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:a,headers:o},s!=null&&s.duplex?{duplex:s.duplex}:{})),f=yield d.json();return d.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(a){if(ft(a))return{data:null,error:a};throw a}})}upload(e,t,r){return Yt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return Yt(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),s=this._getFinalPath(a),o=new URL(this.url+`/object/upload/sign/${s}`);o.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:zx.upsert},i),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl)):(l=r,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType);const d=yield this.fetch(o.toString(),{method:"PUT",body:l,headers:c}),f=yield d.json();return d.ok?{data:{path:a,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(ft(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return Yt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const a=yield Ti(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),s=new URL(this.url+a.url),o=s.searchParams.get("token");if(!o)throw new x_("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:o},error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}update(e,t,r){return Yt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Yt(this,void 0,void 0,function*(){try{return{data:yield Ti(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}copy(e,t,r){return Yt(this,void 0,void 0,function*(){try{return{data:{path:(yield Ti(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,r){return Yt(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),a=yield Ti(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${s}`)},{data:a,error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return Yt(this,void 0,void 0,function*(){try{const i=yield Ti(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${a}`):null})),error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}download(e,t){return Yt(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),s=a?`?${a}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield lf(this.fetch,`${this.url}/${i}/${o}${s}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(ft(o))return{data:null,error:o};throw o}})}info(e){return Yt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield lf(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Zg(r),error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}exists(e){return Yt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield d8(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(ft(r)&&r instanceof Jg){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],a=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";a!==""&&i.push(a);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let u=i.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${u}`)}}}remove(e){return Yt(this,void 0,void 0,function*(){try{return{data:yield hP(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}list(e,t,r){return Yt(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},f8),t),{prefix:e||""});return{data:yield Ti(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const p8="2.7.1",m8={"X-Client-Info":`storage-js/${p8}`};var is=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})};class g8{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},m8),t),this.fetch=fP(r)}listBuckets(){return is(this,void 0,void 0,function*(){try{return{data:yield lf(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ft(e))return{data:null,error:e};throw e}})}getBucket(e){return is(this,void 0,void 0,function*(){try{return{data:yield lf(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return is(this,void 0,void 0,function*(){try{return{data:yield Ti(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return is(this,void 0,void 0,function*(){try{return{data:yield c8(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}emptyBucket(e){return is(this,void 0,void 0,function*(){try{return{data:yield Ti(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}deleteBucket(e){return is(this,void 0,void 0,function*(){try{return{data:yield hP(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}}class y8 extends g8{constructor(e,t={},r){super(e,t,r)}from(e){return new h8(this.url,this.headers,e,this.fetch)}}const w8="2.48.1";let al="";typeof Deno<"u"?al="deno":typeof document<"u"?al="web":typeof navigator<"u"&&navigator.product==="ReactNative"?al="react-native":al="node";const _8={"X-Client-Info":`supabase-js-${al}/${w8}`},b8={headers:_8},v8={schema:"public"},x8={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},E8={};var k8=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})};const S8=n=>{let e;return n?e=n:typeof fetch>"u"?e=XA:e=fetch,(...t)=>e(...t)},O8=()=>typeof Headers>"u"?QA:Headers,A8=(n,e,t)=>{const r=S8(t),i=O8();return(a,s)=>k8(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:n;let u=new i(s==null?void 0:s.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(a,Object.assign(Object.assign({},s),{headers:u}))})};var P8=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})};function T8(n){return n.replace(/\/$/,"")}function I8(n,e){const{db:t,auth:r,realtime:i,global:a}=n,{db:s,auth:o,realtime:l,global:u}=e,c={db:Object.assign(Object.assign({},s),t),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},u),a),accessToken:()=>P8(this,void 0,void 0,function*(){return""})};return n.accessToken?c.accessToken=n.accessToken:delete c.accessToken,c}const pP="2.67.3",C8="http://localhost:9999",R8="supabase.auth.token",$8={"X-Client-Info":`gotrue-js/${pP}`},Bx=10,Xg="X-Supabase-Api-Version",mP={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function N8(n){return Math.round(Date.now()/1e3)+n}function j8(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const Ir=()=>typeof window<"u"&&typeof document<"u",ua={tested:!1,writable:!1},Tl=()=>{if(!Ir())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ua.tested)return ua.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ua.tested=!0,ua.writable=!0}catch{ua.tested=!0,ua.writable=!1}return ua.writable};function L8(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,a)=>{e[a]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const gP=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>Oo);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},D8=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",yP=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Ic=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Cc=async(n,e)=>{await n.removeItem(e)};function F8(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,i,a,s,o,l,u,c=0;for(n=n.replace("-","+").replace("_","/");c<n.length;)s=e.indexOf(n.charAt(c++)),o=e.indexOf(n.charAt(c++)),l=e.indexOf(n.charAt(c++)),u=e.indexOf(n.charAt(c++)),r=s<<2|o>>4,i=(o&15)<<4|l>>2,a=(l&3)<<6|u,t=t+String.fromCharCode(r),l!=64&&i!=0&&(t=t+String.fromCharCode(i)),u!=64&&a!=0&&(t=t+String.fromCharCode(a));return t}class uh{constructor(){this.promise=new uh.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}uh.promiseConstructor=Promise;function Hx(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(F8(r))}async function M8(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function U8(n,e){return new Promise((r,i)=>{(async()=>{for(let a=0;a<1/0;a++)try{const s=await n(a);if(!e(a,null,s)){r(s);return}}catch(s){if(!e(a,s)){i(s);return}}})()})}function z8(n){return("0"+n.toString(16)).substr(-2)}function B8(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let a=0;a<56;a++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,z8).join("")}async function H8(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(a=>String.fromCharCode(a)).join("")}function V8(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function q8(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await H8(n);return V8(t)}async function as(n,e,t=!1){const r=B8();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await yP(n,`${e}-code-verifier`,i);const a=await q8(r);return[a,r===a?"plain":"s256"]}const G8=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function W8(n){const e=n.headers.get(Xg);if(!e||!e.match(G8))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class E_ extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function ge(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class K8 extends E_{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function J8(n){return ge(n)&&n.name==="AuthApiError"}class wP extends E_{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ja extends E_{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class xi extends Ja{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Z8(n){return ge(n)&&n.name==="AuthSessionMissingError"}class Jp extends Ja{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Rc extends Ja{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class $c extends Ja{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function X8(n){return ge(n)&&n.name==="AuthImplicitGrantRedirectError"}class Vx extends Ja{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Qg extends Ja{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Zp(n){return ge(n)&&n.name==="AuthRetryableFetchError"}class qx extends Ja{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var Q8=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const fa=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Y8=[502,503,504];async function Gx(n){var e;if(!D8(n))throw new Qg(fa(n),0);if(Y8.includes(n.status))throw new Qg(fa(n),n.status);let t;try{t=await n.json()}catch(a){throw new wP(fa(a),a)}let r;const i=W8(n);if(i&&i.getTime()>=mP["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new qx(fa(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new xi}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((a,s)=>a&&typeof s=="string",!0))throw new qx(fa(t),n.status,t.weak_password.reasons);throw new K8(fa(t),n.status||500,r)}const eq=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function xe(n,e,t,r){var i;const a=Object.assign({},r==null?void 0:r.headers);a[Xg]||(a[Xg]=mP["2024-01-01"].name),r!=null&&r.jwt&&(a.Authorization=`Bearer ${r.jwt}`);const s=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(s.redirect_to=r.redirectTo);const o=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await tq(n,e,t+o,{headers:a,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function tq(n,e,t,r,i,a){const s=eq(e,r,i,a);let o;try{o=await n(t,Object.assign({},s))}catch(l){throw console.error(l),new Qg(fa(l),0)}if(o.ok||await Gx(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(l){await Gx(l)}}function Ei(n){var e;let t=null;aq(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=N8(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Wx(n){const e=Ei(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function $i(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function nq(n){return{data:n,error:null}}function rq(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:a}=n,s=Q8(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:a},l=Object.assign({},s);return{data:{properties:o,user:l},error:null}}function iq(n){return n}function aq(n){return n.access_token&&n.refresh_token&&n.expires_in}var sq=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};class oq{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=gP(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await xe(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ge(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await xe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:$i})}catch(r){if(ge(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=sq(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await xe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:rq,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(ge(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await xe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$i})}catch(t){if(ge(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,a,s,o,l;try{const u={nextPage:null,lastPage:0,total:0},c=await xe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(a=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""},xform:iq});if(c.error)throw c.error;const d=await c.json(),f=(s=c.headers.get("x-total-count"))!==null&&s!==void 0?s:0,h=(l=(o=c.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(p.split(";")[1].split("=")[1]);u[`${_}Page`]=m}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(ge(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){try{return await xe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$i})}catch(t){if(ge(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await xe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:$i})}catch(r){if(ge(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await xe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:$i})}catch(r){if(ge(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await xe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(ge(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await xe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ge(t))return{data:null,error:t};throw t}}}const lq={getItem:n=>Tl()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Tl()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Tl()&&globalThis.localStorage.removeItem(n)}};function Kx(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function uq(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ss={debug:!!(globalThis&&Tl()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class _P extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class cq extends _P{}async function dq(n,e,t){ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ss.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new cq(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ss.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}uq();const fq={url:C8,storageKey:R8,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:$8,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Vo=30*1e3,Jx=3;async function Zx(n,e,t){return await t()}class yu{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=yu.nextInstanceID,yu.nextInstanceID+=1,this.instanceID>0&&Ir()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},fq),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new oq({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=gP(i.fetch),this.lock=i.lock||Zx,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Ir()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=dq:this.lock=Zx,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:Tl()?this.storage=lq:(this.memoryStorage={},this.storage=Kx(this.memoryStorage)):(this.memoryStorage={},this.storage=Kx(this.memoryStorage)),Ir()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${pP}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=L8(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),Ir()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:a}=await this._getSessionFromURL(t,r);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),X8(a)){const l=(e=a.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:a}}return await this._removeSession(),{error:a}}const{session:s,redirectType:o}=i;return this._debug("#_initialize()","detected session in URL",s,"redirect type",o),await this._saveSession(s),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ge(t)?{error:t}:{error:new wP("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const a=await xe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Ei}),{data:s,error:o}=a;if(o||!s)return{data:{user:null,session:null},error:o};const l=s.session,u=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(a){if(ge(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(e){var t,r,i;try{let a;if("email"in e){const{email:c,password:d,options:f}=e;let h=null,p=null;this.flowType==="pkce"&&([h,p]=await as(this.storage,this.storageKey)),a=await xe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:c,password:d,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:h,code_challenge_method:p},xform:Ei})}else if("phone"in e){const{phone:c,password:d,options:f}=e;a=await xe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:d,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(i=f==null?void 0:f.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Ei})}else throw new Rc("You must provide either an email or phone number and a password");const{data:s,error:o}=a;if(o||!s)return{data:{user:null,session:null},error:o};const l=s.session,u=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(a){if(ge(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(e){try{let t;if("email"in e){const{email:a,password:s,options:o}=e;t=await xe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Wx})}else if("phone"in e){const{phone:a,password:s,options:o}=e;t=await xe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Wx})}else throw new Rc("You must provide either an email or phone number and a password");const{data:r,error:i}=t;return i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Jp}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(ge(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,i,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Ic(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{const{data:a,error:s}=await xe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ei});if(await Cc(this.storage,`${this.storageKey}-code-verifier`),s)throw s;return!a||!a.session||!a.user?{data:{user:null,session:null,redirectType:null},error:new Jp}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign(Object.assign({},a),{redirectType:i??null}),error:s})}catch(a){if(ge(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:a,nonce:s}=e,o=await xe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:a,nonce:s,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Ei}),{data:l,error:u}=o;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Jp}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(ge(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,i,a,s;try{if("email"in e){const{email:o,options:l}=e;let u=null,c=null;this.flowType==="pkce"&&([u,c]=await as(this.storage,this.storageKey));const{error:d}=await xe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:c},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:o,options:l}=e,{data:u,error:c}=await xe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(a=l==null?void 0:l.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(s=l==null?void 0:l.channel)!==null&&s!==void 0?s:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:c}}throw new Rc("You must provide either an email or phone number.")}catch(o){if(ge(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let i,a;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,a=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:s,error:o}=await xe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:i,xform:Ei});if(o)throw o;if(!s)throw new Error("An error occurred on token verification.");const l=s.session,u=s.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(ge(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,r,i;try{let a=null,s=null;return this.flowType==="pkce"&&([a,s]=await as(this.storage,this.storageKey)),await xe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:s}),headers:this.headers,xform:nq})}catch(a){if(ge(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new xi;const{error:i}=await xe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(ge(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:a}=e,{error:s}=await xe(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:s}}else if("phone"in e){const{phone:r,type:i,options:a}=e,{data:s,error:o}=await xe(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:s==null?void 0:s.message_id},error:o}}throw new Rc("You must provide either an email or phone number and a type")}catch(t){if(ge(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ic(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let s=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,c)=>(!s&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),s=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,c))})}return{data:{session:e},error:null}}const{session:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await xe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$i}):await this._useSession(async t=>{var r,i,a;const{data:s,error:o}=t;if(o)throw o;return!(!((r=s.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new xi}:await xe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(i=s.session)===null||i===void 0?void 0:i.access_token)!==null&&a!==void 0?a:void 0,xform:$i})})}catch(t){if(ge(t))return Z8(t)&&(await this._removeSession(),await Cc(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:a}=r;if(a)throw a;if(!i.session)throw new xi;const s=i.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await as(this.storage,this.storageKey));const{data:u,error:c}=await xe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:s.access_token,xform:$i});if(c)throw c;return s.user=u.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),{data:{user:s.user},error:null}})}catch(r){if(ge(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Hx(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new xi;const t=Date.now()/1e3;let r=t,i=!0,a=null;const s=Hx(e.access_token);if(s.exp&&(r=s.exp,i=r<=t),i){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};a=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;a={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(ge(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:o}=t;if(o)throw o;e=(r=s.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new xi;const{session:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(ge(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Ir())throw new $c("No browser detected.");if(e.error||e.error_description||e.error_code)throw new $c(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Vx("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new $c("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Vx("No code detected.");const{data:y,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:a,refresh_token:s,expires_in:o,expires_at:l,token_type:u}=e;if(!a||!o||!s||!u)throw new $c("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(o);let f=c+d;l&&(f=parseInt(l));const h=f-c;h*1e3<=Vo&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const p=f-d;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,f,c);const{data:m,error:_}=await this._getUser(a);if(_)throw _;const g={provider_token:r,provider_refresh_token:i,access_token:a,expires_in:d,expires_at:f,refresh_token:s,token_type:u,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(r){if(ge(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ic(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:a}=t;if(a)return{error:a};const s=(r=i.session)===null||r===void 0?void 0:r.access_token;if(s){const{error:o}=await this.admin.signOut(s,e);if(o&&!(J8(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Cc(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=j8(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:a},error:s}=t;if(s)throw s;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await as(this.storage,this.storageKey,!0));try{return await xe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(ge(a))return{data:null,error:a};throw a}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(ge(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:i}=await this._useSession(async a=>{var s,o,l,u,c;const{data:d,error:f}=a;if(f)throw f;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(s=e.options)===null||s===void 0?void 0:s.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await xe(this.fetch,"GET",h,{headers:this.headers,jwt:(c=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&c!==void 0?c:void 0})});if(i)throw i;return Ir()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(ge(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:a,error:s}=t;if(s)throw s;return await xe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(ge(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await U8(async i=>(i>0&&await M8(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await xe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ei})),(i,a)=>{const s=200*Math.pow(2,i);return a&&Zp(a)&&Date.now()+s-r<Vo})}catch(r){if(this._debug(t,"error",r),ge(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Ir()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Ic(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const i=Math.round(Date.now()/1e3),a=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<i+Bx;if(this._debug(t,`session has${a?"":" not"} expired with margin of ${Bx}s`),a){if(this.autoRefreshToken&&r.refresh_token){const{error:s}=await this._callRefreshToken(r.refresh_token);s&&(console.error(s),Zp(s)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",s),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new xi;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new uh;const{data:a,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!a.session)throw new xi;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const o={session:a.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(a){if(this._debug(i,"error",a),ge(a)){const s={session:null,error:a};return Zp(a)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(s),s}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(a),a}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const a=[],s=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){a.push(l)}});if(await Promise.all(s),a.length>0){for(let o=0;o<a.length;o+=1)console.error(a[o]);throw a[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await yP(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Cc(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ir()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Vo);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/Vo);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Vo}ms, refresh threshold is ${Jx} ticks`),i<=Jx&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof _P)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ir()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[a,s]=await as(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(s)}`});i.push(o.toString())}if(r!=null&&r.queryParams){const a=new URLSearchParams(r.queryParams);i.push(a.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:a}=t;return a?{data:null,error:a}:await xe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ge(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:a,error:s}=t;if(s)return{data:null,error:s};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await xe(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(ge(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:a}=t;if(a)return{data:null,error:a};const{data:s,error:o}=await xe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),{data:s,error:o})})}catch(t){if(ge(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:a}=t;return a?{data:null,error:a}:await xe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ge(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],i=r.filter(s=>s.factor_type==="totp"&&s.status==="verified"),a=r.filter(s=>s.factor_type==="phone"&&s.status==="verified");return{data:{all:r,totp:i,phone:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:i},error:a}=e;if(a)return{data:null,error:a};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const s=this._decodeJWT(i.access_token);let o=null;s.aal&&(o=s.aal);let l=o;((r=(t=i.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const c=s.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:c},error:null}}))}}yu.nextInstanceID=0;const hq=yu;class pq extends hq{constructor(e){super(e)}}var mq=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?a(c.value):i(c.value).then(o,l)}u((r=r.apply(n,e||[])).next())})};class gq{constructor(e,t,r){var i,a,s;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=T8(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,u={db:v8,realtime:E8,auth:Object.assign(Object.assign({},x8),{storageKey:l}),global:b8},c=I8(r??{},u);this.storageKey=(i=c.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=c.global.headers)!==null&&a!==void 0?a:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=c.auth)!==null&&s!==void 0?s:{},this.headers,c.global.fetch),this.fetch=A8(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.rest=new B6(`${o}/rest/v1`,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),c.accessToken||this._listenForAuthEvents()}get functions(){return new w6(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new y8(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return mq(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,storageKey:a,flowType:s,lock:o,debug:l},u,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new pq({url:this.authUrl,headers:Object.assign(Object.assign({},d),u),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,flowType:s,lock:o,debug:l,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new r8(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const yq=(n,e,t)=>new gq(n,e,t),wq="https://rffaxqhumgggbdctuyca.supabase.co",_q="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmZmF4cWh1bWdnZ2JkY3R1eWNhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg2NTMzMTUsImV4cCI6MjA1NDIyOTMxNX0.1ct4WDv6f-NR9Gf0uCCkU88DdCkxbR4rE95cjmoVwwk",bP=yq(wq,_q),vP="sk-";throw new Error("Please set your OpenAI API key in the .env file (VITE_OPENAI_API_KEY)");const xP=new cB({openAIApiKey:vP}),bq=new oB({openAIApiKey:vP,modelName:"gpt-3.5-turbo",temperature:0});async function vq(n){try{const e=await n.text(),t=await xP.embedQuery(e),{data:r,error:i}=await bP.from("documents").insert({title:n.name,content:e,embedding:t}).select().single();if(i)throw i;return r}catch(e){throw console.error("Error in processDocument:",e),new Error("Failed to process document. Please check your API key and try again.")}}async function xq(n){try{const e=await xP.embedQuery(n),{data:t,error:r}=await bP.rpc("match_documents",{query_embedding:e,match_threshold:.7,match_count:3});if(r)throw r;if(!t||t.length===0)return"I couldn't find any relevant information to answer your question.";const i=JV(bq),a=t.map(o=>new HV({pageContent:o.content}));return(await i.call({input_documents:a,question:n})).text}catch(e){throw console.error("Error in generateAnswer:",e),new Error("Failed to generate answer. Please check your API key and try again.")}}function Eq(){const[n,e]=he.useState([]),[t,r]=he.useState(!1),[i,a]=he.useState(!1),s=async l=>{r(!0);try{const u=await vq(l);a(!0),e([{role:"assistant",content:`I've processed "${l.name}" and stored it in the knowledge base. You can now ask questions about its contents!`}])}catch(u){console.error("Error processing file:",u),e([{role:"assistant",content:"Sorry, there was an error processing your file. Please try again."}])}finally{r(!1)}},o=async l=>{r(!0),e(u=>[...u,{role:"user",content:l}]);try{const u=await xq(l);e(c=>[...c,{role:"assistant",content:u}])}catch(u){console.error("Error processing message:",u),e(c=>[...c,{role:"assistant",content:"Sorry, there was an error generating a response. Please try again."}])}finally{r(!1)}};return ie.jsxs("div",{className:"min-h-screen bg-gray-50",children:[ie.jsx("header",{className:"bg-white shadow",children:ie.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:ie.jsxs("div",{className:"flex items-center space-x-2",children:[ie.jsx(eR,{className:"w-8 h-8 text-blue-500"}),ie.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Document Q&A"})]})})}),ie.jsx("main",{className:"max-w-7xl mx-auto px-4 py-8",children:ie.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[ie.jsx("div",{className:"space-y-6",children:ie.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[ie.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[ie.jsx(tR,{className:"w-6 h-6 text-blue-500"}),ie.jsx("h2",{className:"text-xl font-semibold",children:"Upload Document"})]}),ie.jsx(iR,{onFileSelect:s})]})}),ie.jsx("div",{className:"bg-white rounded-lg shadow h-[600px]",children:i?ie.jsx($L,{messages:n,onSendMessage:o,isLoading:t}):ie.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:ie.jsx("p",{children:"Upload a document to start asking questions"})})})]})})]})}uS(document.getElementById("root")).render(ie.jsx(he.StrictMode,{children:ie.jsx(Eq,{})}));export{Bg as B,ta as L,Pn as P,th as a,qA as c,uo as g,JV as l,Is as r};
